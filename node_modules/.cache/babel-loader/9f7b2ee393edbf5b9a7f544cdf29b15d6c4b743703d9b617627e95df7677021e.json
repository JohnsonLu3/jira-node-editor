{"ast":null,"code":"/*!\n* rete-area-3d-plugin v2.0.3\n* (c) 2024 Vitaliy Stoliarov\n* Released under the MIT license.\n* */\nimport _asyncToGenerator from '@babel/runtime/helpers/asyncToGenerator';\nimport _typeof from '@babel/runtime/helpers/typeof';\nimport _classCallCheck from '@babel/runtime/helpers/classCallCheck';\nimport _createClass from '@babel/runtime/helpers/createClass';\nimport _assertThisInitialized from '@babel/runtime/helpers/assertThisInitialized';\nimport _get from '@babel/runtime/helpers/get';\nimport _inherits from '@babel/runtime/helpers/inherits';\nimport _possibleConstructorReturn from '@babel/runtime/helpers/possibleConstructorReturn';\nimport _getPrototypeOf from '@babel/runtime/helpers/getPrototypeOf';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport _regeneratorRuntime from '@babel/runtime/regenerator';\nimport { BaseAreaPlugin } from 'rete-area-plugin';\nimport { Vector3, Quaternion, Object3D, Matrix4, Mesh, BufferGeometry, ShadowMaterial, NoBlending, FrontSide, MeshBasicMaterial, BackSide, Raycaster, Vector2, EventDispatcher, WebGLRenderer, PCFSoftShadowMap, Ray, Plane, MathUtils, MOUSE, TOUCH, Spherical, Scene, PerspectiveCamera, Shape, ShapeGeometry, PlaneGeometry, BufferAttribute, CircleGeometry } from 'three';\nimport { classicConnectionPath } from 'rete-render-utils';\nimport _slicedToArray from '@babel/runtime/helpers/slicedToArray';\nimport { NodeEditor } from 'rete';\nimport _toConsumableArray from '@babel/runtime/helpers/toConsumableArray';\n\n/**\n * Based on http://www.emagix.net/academic/mscs-project/item/camera-sync-with-css3-and-webgl-threejs\n */\n\nconst _position = new Vector3();\nconst _quaternion = new Quaternion();\nconst _scale = new Vector3();\nclass CSS3DObject extends Object3D {\n  constructor(element = document.createElement('div')) {\n    super();\n    this.isCSS3DObject = true;\n    this.element = element;\n    this.element.style.position = 'absolute';\n    this.element.style.pointerEvents = 'auto';\n    this.element.style.userSelect = 'none';\n    this.element.setAttribute('draggable', false);\n    this.addEventListener('removed', function () {\n      this.traverse(function (object) {\n        if (object.element instanceof Element && object.element.parentNode !== null) {\n          object.element.parentNode.removeChild(object.element);\n        }\n      });\n    });\n  }\n  copy(source, recursive) {\n    super.copy(source, recursive);\n    this.element = source.element.cloneNode(true);\n    return this;\n  }\n}\n\n//\n\nconst _matrix = new Matrix4();\nconst _matrix2 = new Matrix4();\nclass CSS3DRenderer {\n  constructor(parameters = {}) {\n    const _this = this;\n    let _width, _height;\n    let _widthHalf, _heightHalf;\n    const cache = {\n      camera: {\n        fov: 0,\n        style: ''\n      },\n      objects: new WeakMap()\n    };\n    const domElement = parameters.element !== undefined ? parameters.element : document.createElement('div');\n    domElement.style.overflow = 'hidden';\n    this.domElement = domElement;\n    const viewElement = document.createElement('div');\n    viewElement.style.transformOrigin = '0 0';\n    viewElement.style.pointerEvents = 'none';\n    domElement.appendChild(viewElement);\n    const cameraElement = document.createElement('div');\n    cameraElement.style.transformStyle = 'preserve-3d';\n    viewElement.appendChild(cameraElement);\n    this.getSize = function () {\n      return {\n        width: _width,\n        height: _height\n      };\n    };\n    this.render = function (scene, camera) {\n      const fov = camera.projectionMatrix.elements[5] * _heightHalf;\n      if (cache.camera.fov !== fov) {\n        viewElement.style.perspective = camera.isPerspectiveCamera ? fov + 'px' : '';\n        cache.camera.fov = fov;\n      }\n      if (camera.view && camera.view.enabled) {\n        // view offset\n        viewElement.style.transform = `translate( ${-camera.view.offsetX * (_width / camera.view.width)}px, ${-camera.view.offsetY * (_height / camera.view.height)}px )`;\n\n        // view fullWidth and fullHeight, view width and height\n        viewElement.style.transform += `scale( ${camera.view.fullWidth / camera.view.width}, ${camera.view.fullHeight / camera.view.height} )`;\n      } else {\n        viewElement.style.transform = '';\n      }\n      if (scene.matrixWorldAutoUpdate === true) scene.updateMatrixWorld();\n      if (camera.parent === null && camera.matrixWorldAutoUpdate === true) camera.updateMatrixWorld();\n      let tx, ty;\n      if (camera.isOrthographicCamera) {\n        tx = -(camera.right + camera.left) / 2;\n        ty = (camera.top + camera.bottom) / 2;\n      }\n      const scaleByViewOffset = camera.view && camera.view.enabled ? camera.view.height / camera.view.fullHeight : 1;\n      const cameraCSSMatrix = camera.isOrthographicCamera ? `scale( ${scaleByViewOffset} )` + 'scale(' + fov + ')' + 'translate(' + epsilon(tx) + 'px,' + epsilon(ty) + 'px)' + getCameraCSSMatrix(camera.matrixWorldInverse) : `scale( ${scaleByViewOffset} )` + 'translateZ(' + fov + 'px)' + getCameraCSSMatrix(camera.matrixWorldInverse);\n      const style = cameraCSSMatrix + 'translate(' + _widthHalf + 'px,' + _heightHalf + 'px)';\n      if (cache.camera.style !== style) {\n        cameraElement.style.transform = style;\n        cache.camera.style = style;\n      }\n      renderObject(scene, scene, camera);\n    };\n    this.setSize = function (width, height) {\n      _width = width;\n      _height = height;\n      _widthHalf = _width / 2;\n      _heightHalf = _height / 2;\n      domElement.style.width = width + 'px';\n      domElement.style.height = height + 'px';\n      viewElement.style.width = width + 'px';\n      viewElement.style.height = height + 'px';\n      cameraElement.style.width = width + 'px';\n      cameraElement.style.height = height + 'px';\n    };\n    function epsilon(value) {\n      return Math.abs(value) < 1e-10 ? 0 : value;\n    }\n    function getCameraCSSMatrix(matrix) {\n      const elements = matrix.elements;\n      return 'matrix3d(' + epsilon(elements[0]) + ',' + epsilon(-elements[1]) + ',' + epsilon(elements[2]) + ',' + epsilon(elements[3]) + ',' + epsilon(elements[4]) + ',' + epsilon(-elements[5]) + ',' + epsilon(elements[6]) + ',' + epsilon(elements[7]) + ',' + epsilon(elements[8]) + ',' + epsilon(-elements[9]) + ',' + epsilon(elements[10]) + ',' + epsilon(elements[11]) + ',' + epsilon(elements[12]) + ',' + epsilon(-elements[13]) + ',' + epsilon(elements[14]) + ',' + epsilon(elements[15]) + ')';\n    }\n    function getObjectCSSMatrix(matrix) {\n      const elements = matrix.elements;\n      const matrix3d = 'matrix3d(' + epsilon(elements[0]) + ',' + epsilon(elements[1]) + ',' + epsilon(elements[2]) + ',' + epsilon(elements[3]) + ',' + epsilon(-elements[4]) + ',' + epsilon(-elements[5]) + ',' + epsilon(-elements[6]) + ',' + epsilon(-elements[7]) + ',' + epsilon(elements[8]) + ',' + epsilon(elements[9]) + ',' + epsilon(elements[10]) + ',' + epsilon(elements[11]) + ',' + epsilon(elements[12]) + ',' + epsilon(elements[13]) + ',' + epsilon(elements[14]) + ',' + epsilon(elements[15]) + ')';\n      return 'translate(-50%,-50%)' + matrix3d;\n    }\n    function renderObject(object, scene, camera, cameraCSSMatrix) {\n      if (object.isCSS3DObject) {\n        const visible = object.visible === true && object.layers.test(camera.layers) === true;\n        object.element.style.display = visible === true ? '' : 'none';\n        if (visible === true) {\n          object.onBeforeRender(_this, scene, camera);\n          let style;\n          if (object.isCSS3DSprite) {\n            // http://swiftcoder.wordpress.com/2008/11/25/constructing-a-billboard-matrix/\n\n            _matrix.copy(camera.matrixWorldInverse);\n            _matrix.transpose();\n            if (object.rotation2D !== 0) _matrix.multiply(_matrix2.makeRotationZ(object.rotation2D));\n            object.matrixWorld.decompose(_position, _quaternion, _scale);\n            _matrix.setPosition(_position);\n            _matrix.scale(_scale);\n            _matrix.elements[3] = 0;\n            _matrix.elements[7] = 0;\n            _matrix.elements[11] = 0;\n            _matrix.elements[15] = 1;\n            style = getObjectCSSMatrix(_matrix);\n          } else {\n            style = getObjectCSSMatrix(object.matrixWorld);\n          }\n          const element = object.element;\n          const cachedObject = cache.objects.get(object);\n          if (cachedObject === undefined || cachedObject.style !== style) {\n            element.style.transform = style;\n            const objectData = {\n              style: style\n            };\n            cache.objects.set(object, objectData);\n          }\n          if (element.parentNode !== cameraElement) {\n            cameraElement.appendChild(element);\n          }\n          object.onAfterRender(_this, scene, camera);\n        }\n      }\n      for (let i = 0, l = object.children.length; i < l; i++) {\n        renderObject(object.children[i], scene, camera);\n      }\n    }\n  }\n}\nfunction flipFaces(geometry) {\n  var index = geometry.getIndex();\n  if (index) {\n    var numTriangles = index.count / 3;\n    for (var i = 0; i < numTriangles; i++) {\n      var a = index.getX(i * 3 + 2);\n      var b = index.getX(i * 3 + 1);\n      var c = index.getX(i * 3);\n      index.setXYZ(i * 3, a, b, c);\n    }\n  }\n}\nfunction _createSuper$3(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct$3();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _isNativeReflectConstruct$3() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nfunction createMaterial(transparent) {\n  return new ShadowMaterial({\n    transparent: true,\n    opacity: transparent ? 0.5 : 0.7,\n    blending: NoBlending,\n    side: FrontSide\n  });\n}\nfunction createBackMaterial() {\n  return new MeshBasicMaterial({\n    color: 0x6e88ff,\n    side: BackSide\n  });\n}\nvar ObjectHTML = /*#__PURE__*/function (_Object3D) {\n  _inherits(ObjectHTML, _Object3D);\n  var _super = _createSuper$3(ObjectHTML);\n  function ObjectHTML(element) {\n    var _this;\n    _classCallCheck(this, ObjectHTML);\n    _this = _super.call(this);\n    _this.css3dObject = new CSS3DObject(element);\n    _this.css3dObject.onAfterRender = function () {\n      var internalTranslate = ' translate(50%, 50%)';\n      if (!element.style.transform.endsWith(internalTranslate)) {\n        element.style.transform += internalTranslate;\n      }\n    };\n    _this.add(_this.css3dObject);\n    var front = new Mesh();\n    _this.front = front;\n    _this.add(front);\n    var back = new Mesh();\n    back.castShadow = true;\n    _this.back = back;\n    _this.add(back);\n    _this.updateMaterials();\n    return _this;\n  }\n  _createClass(ObjectHTML, [{\n    key: \"updateGeometry\",\n    value: function updateGeometry(geometry) {\n      var scaled = geometry === null || geometry === void 0 ? void 0 : geometry.clone().scale(1, -1, 1);\n      if (scaled) flipFaces(scaled);\n      if (this.front) this.front.geometry = scaled || new BufferGeometry();\n      if (this.back) this.back.geometry = scaled || new BufferGeometry();\n    }\n  }, {\n    key: \"updateMaterials\",\n    value: function updateMaterials(materials) {\n      if (this.front) this.front.material = (materials === null || materials === void 0 ? void 0 : materials.front) || createMaterial(false);\n      if (this.back) this.back.material = (materials === null || materials === void 0 ? void 0 : materials.back) || createBackMaterial();\n    }\n  }]);\n  return ObjectHTML;\n}(Object3D);\nfunction findTop(objects) {\n  objects.sort(function (a, b) {\n    if (!a.css3dObject || !b.css3dObject) return 0;\n    var position = a.css3dObject.element.compareDocumentPosition(b.css3dObject.element);\n    if (position & Node.DOCUMENT_POSITION_FOLLOWING) {\n      return 1;\n    } else if (position & Node.DOCUMENT_POSITION_PRECEDING) {\n      return -1;\n    }\n    return 0;\n  });\n  return objects[0];\n}\n\n/**\n * Responsible for managing 2D content in the plane of 3D scene for a current editor\n */\nvar Content = /*#__PURE__*/function () {\n  function Content(scene, scope, reordered) {\n    var _scene$renderer$css3d;\n    _classCallCheck(this, Content);\n    _defineProperty(this, \"objects\", new WeakMap());\n    this.scene = scene;\n    this.scope = scope;\n    this.reordered = reordered;\n    var css3dContainer = (_scene$renderer$css3d = scene.renderer.css3d.domElement.firstElementChild) === null || _scene$renderer$css3d === void 0 ? void 0 : _scene$renderer$css3d.firstElementChild;\n    if (!css3dContainer || !(css3dContainer instanceof HTMLElement)) {\n      throw new Error('cannot find container for css3d element');\n    }\n    this.holder = css3dContainer;\n  }\n  _createClass(Content, [{\n    key: \"getPointerFrom\",\n    value: function getPointerFrom(event) {\n      var _this$holder$getBound = this.holder.getBoundingClientRect(),\n        left = _this$holder$getBound.left,\n        top = _this$holder$getBound.top;\n      var x = event.clientX - left;\n      var y = event.clientY - top;\n      return {\n        x: x,\n        y: y\n      };\n    }\n\n    /**\n     * Add an HTML element to the 3D scene\n     * @param element HTML element\n     */\n  }, {\n    key: \"add\",\n    value: function add(element) {\n      var object = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new ObjectHTML(element);\n      this.objects.set(element, object);\n      this.holder.appendChild(element);\n      this.scene.add(object, this.scope);\n    }\n\n    /**\n     * Reorder the given element in the 3D scene\n     * @param target HTML element to reorder\n     * @param next HTML element to insert before\n     * @throws if `target` or `next` are not in the scene\n     */\n    // eslint-disable-next-line no-undef\n  }, {\n    key: \"reorder\",\n    value: function () {\n      var _reorder = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(target, next) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (this.holder.contains(target)) {\n                _context.next = 2;\n                break;\n              }\n              throw new Error(\"content doesn't have 'target' for reordering\");\n            case 2:\n              if (!(next !== null && !this.holder.contains(next))) {\n                _context.next = 4;\n                break;\n              }\n              throw new Error(\"content doesn't have 'next' for reordering\");\n            case 4:\n              this.holder.insertBefore(target, next);\n              _context.next = 7;\n              return this.reordered(target);\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function reorder(_x, _x2) {\n        return _reorder.apply(this, arguments);\n      }\n      return reorder;\n    }()\n    /**\n     * Remove an HTML element from the 3D scene\n     * @param element HTML element\n     */\n  }, {\n    key: \"remove\",\n    value: function remove(element) {\n      var object = this.objects.get(element);\n      if (object) {\n        this.objects[\"delete\"](element);\n        this.scene.remove(object, this.scope);\n      }\n    }\n\n    /**\n     * Update the form (geometry) of the given element\n     */\n  }, {\n    key: \"updateGeometry\",\n    value: function updateGeometry(element, geometry) {\n      var object = this.objects.get(element);\n      if (object) {\n        object.updateGeometry(typeof geometry === 'function' ? geometry(object.front.geometry) : geometry);\n      }\n    }\n\n    /**\n     * Update the material of the given element\n     */\n  }, {\n    key: \"updateMaterials\",\n    value: function updateMaterials(element, materials) {\n      var object = this.objects.get(element);\n      if (object) object.updateMaterials(materials);\n    }\n  }]);\n  return Content;\n}();\nfunction _createSuper$2(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct$2();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _isNativeReflectConstruct$2() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nvar raycaster = new Raycaster();\n\n// EventDispatcher should have default generic for three 152-156 compatibility\nvar DragControls = /*#__PURE__*/function (_EventDispatcher) {\n  _inherits(DragControls, _EventDispatcher);\n  var _super = _createSuper$2(DragControls);\n  function DragControls(camera, domElement, getPlane) {\n    var _this;\n    _classCallCheck(this, DragControls);\n    _this = _super.call(this);\n    _defineProperty(_assertThisInitialized(_this), \"enabled\", true);\n    _defineProperty(_assertThisInitialized(_this), \"intersections\", []);\n    _defineProperty(_assertThisInitialized(_this), \"selected\", null);\n    _defineProperty(_assertThisInitialized(_this), \"hovered\", null);\n    _defineProperty(_assertThisInitialized(_this), \"objects\", new Set());\n    _defineProperty(_assertThisInitialized(_this), \"pointer\", new Vector2());\n    _defineProperty(_assertThisInitialized(_this), \"offset\", new Vector3());\n    _defineProperty(_assertThisInitialized(_this), \"intersection\", new Vector3());\n    _defineProperty(_assertThisInitialized(_this), \"worldPosition\", new Vector3());\n    _defineProperty(_assertThisInitialized(_this), \"inverseMatrix\", new Matrix4());\n    _defineProperty(_assertThisInitialized(_this), \"onPointerMove\", function (event) {\n      if (_this.enabled === false) return;\n      _this.updatePointer(event);\n      raycaster.setFromCamera(_this.pointer, _this.camera);\n      if (_this.selected) {\n        if (raycaster.ray.intersectPlane(_this.getPlane(_this.selected), _this.intersection)) {\n          var newPosition = _this.intersection.sub(_this.offset).applyMatrix4(_this.inverseMatrix);\n          var eventData = {\n            type: 'drag',\n            object: _this.selected,\n            position: newPosition\n          };\n          _this.dispatchEvent(eventData);\n        }\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onPointerDown\", function (event) {\n      if (_this.enabled === false) return;\n      _this.updatePointer(event);\n      _this.intersections.length = 0;\n      raycaster.setFromCamera(_this.pointer, _this.camera);\n      _this.intersections = raycaster.intersectObjects(_this.getObjects(), true);\n      if (_this.intersections.length > 0) {\n        _this.selected = _this.findIntersectedObject(_this.intersections) || null;\n        if (!_this.selected) return;\n        if (!_this.selected.parent) throw new Error('parent required for selected object');\n        if (raycaster.ray.intersectPlane(_this.getPlane(_this.selected), _this.intersection)) {\n          _this.inverseMatrix.copy(_this.selected.parent.matrixWorld).invert();\n          _this.offset.copy(_this.intersection).sub(_this.worldPosition.setFromMatrixPosition(_this.selected.matrixWorld));\n        }\n        event.stopPropagation();\n        _this.domElement.style.cursor = 'move';\n        var eventData = {\n          type: 'dragstart',\n          object: _this.selected\n        };\n        _this.dispatchEvent(eventData);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onPointerCancel\", function () {\n      if (_this.enabled === false) return;\n      if (_this.selected) {\n        var eventData = {\n          type: 'dragend',\n          object: _this.selected\n        };\n        _this.dispatchEvent(eventData);\n        _this.selected = null;\n      }\n      _this.domElement.style.cursor = _this.hovered ? 'pointer' : 'auto';\n    });\n    _defineProperty(_assertThisInitialized(_this), \"updatePointer\", function (event) {\n      var rect = _this.domElement.getBoundingClientRect();\n      _this.pointer.x = (event.clientX - rect.left) / rect.width * 2 - 1;\n      _this.pointer.y = -(event.clientY - rect.top) / rect.height * 2 + 1;\n    });\n    _this.camera = camera;\n    _this.domElement = domElement;\n    _this.getPlane = getPlane;\n    _this.domElement.style.touchAction = 'none'; // disable touch scroll\n    _this.activate();\n    return _this;\n  }\n  _createClass(DragControls, [{\n    key: \"attach\",\n    value: function attach(object) {\n      this.objects.add(object);\n    }\n  }, {\n    key: \"detach\",\n    value: function detach(object) {\n      this.objects[\"delete\"](object);\n    }\n  }, {\n    key: \"activate\",\n    value: function activate() {\n      this.domElement.addEventListener('pointermove', this.onPointerMove);\n      this.domElement.addEventListener('pointerdown', this.onPointerDown);\n      this.domElement.addEventListener('pointerup', this.onPointerCancel);\n      this.domElement.addEventListener('pointerleave', this.onPointerCancel);\n    }\n  }, {\n    key: \"deactivate\",\n    value: function deactivate() {\n      this.domElement.removeEventListener('pointermove', this.onPointerMove);\n      this.domElement.removeEventListener('pointerdown', this.onPointerDown);\n      this.domElement.removeEventListener('pointerup', this.onPointerCancel);\n      this.domElement.removeEventListener('pointerleave', this.onPointerCancel);\n      this.domElement.style.cursor = '';\n    }\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      this.deactivate();\n    }\n  }, {\n    key: \"getObjects\",\n    value: function getObjects() {\n      return Array.from(this.objects.values());\n    }\n  }, {\n    key: \"getRaycaster\",\n    value: function getRaycaster() {\n      return raycaster;\n    }\n  }, {\n    key: \"findContainer\",\n    value: function findContainer(intersection) {\n      var object = null;\n      var objects = this.getObjects();\n      intersection.object.traverseAncestors(function (intersectedObject) {\n        if (objects.includes(intersectedObject) && intersectedObject instanceof ObjectHTML) object = intersectedObject;\n      });\n      if (!object) throw new Error('cannot find Object3D');\n      return object;\n    }\n  }, {\n    key: \"findIntersectedObject\",\n    value: function findIntersectedObject(intersections) {\n      var _this2 = this;\n      return findTop(intersections.map(function (i) {\n        return _this2.findContainer(i);\n      }));\n    }\n  }]);\n  return DragControls;\n}(EventDispatcher);\nfunction _createSuper$1(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct$1();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _isNativeReflectConstruct$1() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nvar DraggableObject3D = /*#__PURE__*/function (_ObjectHTML) {\n  _inherits(DraggableObject3D, _ObjectHTML);\n  var _super = _createSuper$1(DraggableObject3D);\n  function DraggableObject3D(element, events) {\n    var _this;\n    _classCallCheck(this, DraggableObject3D);\n    _this = _super.call(this, element);\n    _this.events = events;\n    return _this;\n  }\n  return _createClass(DraggableObject3D);\n}(ObjectHTML);\nfunction attachDraggableHooks(controls) {\n  controls.addEventListener('dragstart', function (e) {\n    var event = e;\n    if (event.object instanceof DraggableObject3D) {\n      event.object.events.start();\n    }\n  });\n  controls.addEventListener('drag', function (e) {\n    var event = e;\n    if (event.object instanceof DraggableObject3D) {\n      var _event$position = event.position,\n        x = _event$position.x,\n        y = _event$position.y,\n        z = _event$position.z;\n      event.object.events.translate(x, y, z);\n    }\n  });\n  controls.addEventListener('dragend', function (e) {\n    var event = e;\n    if (event.object instanceof DraggableObject3D) {\n      event.object.events.drag();\n    }\n  });\n}\n\n/**\n * HybridRenderer is a wrapper for Three.js CSS3DRenderer and WebGLRenderer.\n */\nvar HybridRenderer = /*#__PURE__*/function () {\n  /** CSS3DRenderer instance created by default */\n\n  /** WebGLRenderer instance created by default */\n\n  function HybridRenderer() {\n    _classCallCheck(this, HybridRenderer);\n    this.css3d = this.getDefaultCSS3DRenderer();\n    this.webgl = this.getDefaultWebGLRenderer();\n    this.domElement = document.createElement('div');\n    this.css3d.domElement.setAttribute('data-css3d', 'true');\n    fillAbsolute(this.domElement);\n    fillAbsolute(this.css3d.domElement);\n    fillAbsolute(this.webgl.domElement);\n    this.domElement.appendChild(this.css3d.domElement);\n    this.domElement.appendChild(this.webgl.domElement);\n    this.webgl.domElement.style.pointerEvents = 'none';\n  }\n  _createClass(HybridRenderer, [{\n    key: \"getContent\",\n    value: function getContent() {\n      return this.webgl.domElement.firstElementChild;\n    }\n  }, {\n    key: \"getDefaultCSS3DRenderer\",\n    value: function getDefaultCSS3DRenderer() {\n      var css3d = new CSS3DRenderer();\n      return css3d;\n    }\n  }, {\n    key: \"getDefaultWebGLRenderer\",\n    value: function getDefaultWebGLRenderer() {\n      var webgl = new WebGLRenderer({\n        alpha: false,\n        antialias: true\n      });\n      webgl.setPixelRatio(window.devicePixelRatio);\n      webgl.setClearColor(0xffffff, 0);\n      webgl.shadowMap.enabled = true;\n      webgl.shadowMap.type = PCFSoftShadowMap;\n      return webgl;\n    }\n  }, {\n    key: \"setSize\",\n    value: function setSize(width, height) {\n      this.css3d.setSize(width, height);\n      this.webgl.setSize(width, height);\n    }\n  }, {\n    key: \"render\",\n    value: function render(scene, camera) {\n      this.css3d.render(scene, camera);\n      this.webgl.render(scene, camera);\n    }\n  }]);\n  return HybridRenderer;\n}();\nfunction fillAbsolute(el) {\n  el.style.width = '100%';\n  el.style.height = '100%';\n  el.style.position = 'absolute';\n  el.style.left = '0';\n  el.style.top = '0';\n}\n\n// OrbitControls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one-finger move\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\n\nconst _changeEvent = {\n  type: 'change'\n};\nconst _startEvent = {\n  type: 'start'\n};\nconst _endEvent = {\n  type: 'end'\n};\nconst _ray = new Ray();\nconst _plane = new Plane();\nconst TILT_LIMIT = Math.cos(70 * MathUtils.DEG2RAD);\nclass OrbitControls extends EventDispatcher {\n  constructor(object, domElement) {\n    super();\n    this.object = object;\n    this.domElement = domElement;\n    this.domElement.style.touchAction = 'none'; // disable touch scroll\n\n    // Set to false to disable this control\n    this.enabled = true;\n\n    // \"target\" sets the location of focus, where the object orbits around\n    this.target = new Vector3();\n\n    // How far you can dolly in and out ( PerspectiveCamera only )\n    this.minDistance = 0;\n    this.maxDistance = Infinity;\n\n    // How far you can zoom in and out ( OrthographicCamera only )\n    this.minZoom = 0;\n    this.maxZoom = Infinity;\n\n    // How far you can orbit vertically, upper and lower limits.\n    // Range is 0 to Math.PI radians.\n    this.minPolarAngle = 0; // radians\n    this.maxPolarAngle = Math.PI; // radians\n\n    // How far you can orbit horizontally, upper and lower limits.\n    // If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\n    this.minAzimuthAngle = -Infinity; // radians\n    this.maxAzimuthAngle = Infinity; // radians\n\n    // Set to true to enable damping (inertia)\n    // If damping is enabled, you must call controls.update() in your animation loop\n    this.enableDamping = false;\n    this.dampingFactor = 0.05;\n\n    // This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n    // Set to false to disable zooming\n    this.enableZoom = true;\n    this.zoomSpeed = 1.0;\n\n    // Set to false to disable rotating\n    this.enableRotate = true;\n    this.rotateSpeed = 1.0;\n\n    // Set to false to disable panning\n    this.enablePan = true;\n    this.panSpeed = 1.0;\n    this.screenSpacePanning = true; // if false, pan orthogonal to world-space direction camera.up\n    this.keyPanSpeed = 7.0; // pixels moved per arrow key push\n    this.zoomToCursor = false;\n\n    // Set to true to automatically rotate around the target\n    // If auto-rotate is enabled, you must call controls.update() in your animation loop\n    this.autoRotate = false;\n    this.autoRotateSpeed = 2.0; // 30 seconds per orbit when fps is 60\n\n    // The four arrow keys\n    this.keys = {\n      LEFT: 'ArrowLeft',\n      UP: 'ArrowUp',\n      RIGHT: 'ArrowRight',\n      BOTTOM: 'ArrowDown'\n    };\n\n    // Mouse buttons\n    this.mouseButtons = {\n      LEFT: MOUSE.ROTATE,\n      MIDDLE: MOUSE.DOLLY,\n      RIGHT: MOUSE.PAN\n    };\n\n    // Touch fingers\n    this.touches = {\n      ONE: TOUCH.ROTATE,\n      TWO: TOUCH.DOLLY_PAN\n    };\n\n    // for reset\n    this.target0 = this.target.clone();\n    this.position0 = this.object.position.clone();\n    this.zoom0 = this.object.zoom;\n\n    // the target DOM element for key events\n    this._domElementKeyEvents = null;\n\n    //\n    // public methods\n    //\n\n    this.getPolarAngle = function () {\n      return spherical.phi;\n    };\n    this.getAzimuthalAngle = function () {\n      return spherical.theta;\n    };\n    this.getDistance = function () {\n      return this.object.position.distanceTo(this.target);\n    };\n    this.listenToKeyEvents = function (domElement) {\n      domElement.addEventListener('keydown', onKeyDown);\n      this._domElementKeyEvents = domElement;\n    };\n    this.stopListenToKeyEvents = function () {\n      this._domElementKeyEvents.removeEventListener('keydown', onKeyDown);\n      this._domElementKeyEvents = null;\n    };\n    this.saveState = function () {\n      scope.target0.copy(scope.target);\n      scope.position0.copy(scope.object.position);\n      scope.zoom0 = scope.object.zoom;\n    };\n    this.reset = function () {\n      scope.target.copy(scope.target0);\n      scope.object.position.copy(scope.position0);\n      scope.object.zoom = scope.zoom0;\n      scope.object.updateProjectionMatrix();\n      scope.dispatchEvent(_changeEvent);\n      scope.update();\n      state = STATE.NONE;\n    };\n\n    // this method is exposed, but perhaps it would be better if we can make it private...\n    this.update = function () {\n      const offset = new Vector3();\n\n      // so camera.up is the orbit axis\n      const quat = new Quaternion().setFromUnitVectors(object.up, new Vector3(0, 1, 0));\n      const quatInverse = quat.clone().invert();\n      const lastPosition = new Vector3();\n      const lastQuaternion = new Quaternion();\n      const lastTargetPosition = new Vector3();\n      const twoPI = 2 * Math.PI;\n      return function update(deltaTime = null) {\n        const position = scope.object.position;\n        offset.copy(position).sub(scope.target);\n\n        // rotate offset to \"y-axis-is-up\" space\n        offset.applyQuaternion(quat);\n\n        // angle from z-axis around y-axis\n        spherical.setFromVector3(offset);\n        if (scope.autoRotate && state === STATE.NONE) {\n          rotateLeft(getAutoRotationAngle(deltaTime));\n        }\n        if (scope.enableDamping) {\n          spherical.theta += sphericalDelta.theta * scope.dampingFactor;\n          spherical.phi += sphericalDelta.phi * scope.dampingFactor;\n        } else {\n          spherical.theta += sphericalDelta.theta;\n          spherical.phi += sphericalDelta.phi;\n        }\n\n        // restrict theta to be between desired limits\n\n        let min = scope.minAzimuthAngle;\n        let max = scope.maxAzimuthAngle;\n        if (isFinite(min) && isFinite(max)) {\n          if (min < -Math.PI) min += twoPI;else if (min > Math.PI) min -= twoPI;\n          if (max < -Math.PI) max += twoPI;else if (max > Math.PI) max -= twoPI;\n          if (min <= max) {\n            spherical.theta = Math.max(min, Math.min(max, spherical.theta));\n          } else {\n            spherical.theta = spherical.theta > (min + max) / 2 ? Math.max(min, spherical.theta) : Math.min(max, spherical.theta);\n          }\n        }\n\n        // restrict phi to be between desired limits\n        spherical.phi = Math.max(scope.minPolarAngle, Math.min(scope.maxPolarAngle, spherical.phi));\n        spherical.makeSafe();\n\n        // move target to panned location\n\n        if (scope.enableDamping === true) {\n          scope.target.addScaledVector(panOffset, scope.dampingFactor);\n        } else {\n          scope.target.add(panOffset);\n        }\n\n        // adjust the camera position based on zoom only if we're not zooming to the cursor or if it's an ortho camera\n        // we adjust zoom later in these cases\n        if (scope.zoomToCursor && performCursorZoom || scope.object.isOrthographicCamera) {\n          spherical.radius = clampDistance(spherical.radius);\n        } else {\n          spherical.radius = clampDistance(spherical.radius * scale);\n        }\n        offset.setFromSpherical(spherical);\n\n        // rotate offset back to \"camera-up-vector-is-up\" space\n        offset.applyQuaternion(quatInverse);\n        position.copy(scope.target).add(offset);\n        scope.object.lookAt(scope.target);\n        if (scope.enableDamping === true) {\n          sphericalDelta.theta *= 1 - scope.dampingFactor;\n          sphericalDelta.phi *= 1 - scope.dampingFactor;\n          panOffset.multiplyScalar(1 - scope.dampingFactor);\n        } else {\n          sphericalDelta.set(0, 0, 0);\n          panOffset.set(0, 0, 0);\n        }\n\n        // adjust camera position\n        let zoomChanged = false;\n        if (scope.zoomToCursor && performCursorZoom) {\n          let newRadius = null;\n          if (scope.object.isPerspectiveCamera) {\n            // move the camera down the pointer ray\n            // this method avoids floating point error\n            const prevRadius = offset.length();\n            newRadius = clampDistance(prevRadius * scale);\n            const radiusDelta = prevRadius - newRadius;\n            scope.object.position.addScaledVector(dollyDirection, radiusDelta);\n            scope.object.updateMatrixWorld();\n          } else if (scope.object.isOrthographicCamera) {\n            // adjust the ortho camera position based on zoom changes\n            const mouseBefore = new Vector3(mouse.x, mouse.y, 0);\n            mouseBefore.unproject(scope.object);\n            scope.object.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.object.zoom / scale));\n            scope.object.updateProjectionMatrix();\n            zoomChanged = true;\n            const mouseAfter = new Vector3(mouse.x, mouse.y, 0);\n            mouseAfter.unproject(scope.object);\n            scope.object.position.sub(mouseAfter).add(mouseBefore);\n            scope.object.updateMatrixWorld();\n            newRadius = offset.length();\n          } else {\n            console.warn('WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled.');\n            scope.zoomToCursor = false;\n          }\n\n          // handle the placement of the target\n          if (newRadius !== null) {\n            if (this.screenSpacePanning) {\n              // position the orbit target in front of the new camera position\n              scope.target.set(0, 0, -1).transformDirection(scope.object.matrix).multiplyScalar(newRadius).add(scope.object.position);\n            } else {\n              // get the ray and translation plane to compute target\n              _ray.origin.copy(scope.object.position);\n              _ray.direction.set(0, 0, -1).transformDirection(scope.object.matrix);\n\n              // if the camera is 20 degrees above the horizon then don't adjust the focus target to avoid\n              // extremely large values\n              if (Math.abs(scope.object.up.dot(_ray.direction)) < TILT_LIMIT) {\n                object.lookAt(scope.target);\n              } else {\n                _plane.setFromNormalAndCoplanarPoint(scope.object.up, scope.target);\n                _ray.intersectPlane(_plane, scope.target);\n              }\n            }\n          }\n        } else if (scope.object.isOrthographicCamera) {\n          scope.object.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.object.zoom / scale));\n          scope.object.updateProjectionMatrix();\n          zoomChanged = true;\n        }\n        scale = 1;\n        performCursorZoom = false;\n\n        // update condition is:\n        // min(camera displacement, camera rotation in radians)^2 > EPS\n        // using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n        if (zoomChanged || lastPosition.distanceToSquared(scope.object.position) > EPS || 8 * (1 - lastQuaternion.dot(scope.object.quaternion)) > EPS || lastTargetPosition.distanceToSquared(scope.target) > 0) {\n          scope.dispatchEvent(_changeEvent);\n          lastPosition.copy(scope.object.position);\n          lastQuaternion.copy(scope.object.quaternion);\n          lastTargetPosition.copy(scope.target);\n          zoomChanged = false;\n          return true;\n        }\n        return false;\n      };\n    }();\n    this.dispose = function () {\n      scope.domElement.removeEventListener('contextmenu', onContextMenu);\n      scope.domElement.removeEventListener('pointerdown', onPointerDown);\n      scope.domElement.removeEventListener('pointercancel', onPointerUp);\n      scope.domElement.removeEventListener('wheel', onMouseWheel);\n      scope.domElement.removeEventListener('pointermove', onPointerMove);\n      scope.domElement.removeEventListener('pointerup', onPointerUp);\n      if (scope._domElementKeyEvents !== null) {\n        scope._domElementKeyEvents.removeEventListener('keydown', onKeyDown);\n        scope._domElementKeyEvents = null;\n      }\n\n      //scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n    };\n\n    //\n    // internals\n    //\n\n    const scope = this;\n    const STATE = {\n      NONE: -1,\n      ROTATE: 0,\n      DOLLY: 1,\n      PAN: 2,\n      TOUCH_ROTATE: 3,\n      TOUCH_PAN: 4,\n      TOUCH_DOLLY_PAN: 5,\n      TOUCH_DOLLY_ROTATE: 6\n    };\n    let state = STATE.NONE;\n    const EPS = 0.000001;\n\n    // current position in spherical coordinates\n    const spherical = new Spherical();\n    const sphericalDelta = new Spherical();\n    let scale = 1;\n    const panOffset = new Vector3();\n    const rotateStart = new Vector2();\n    const rotateEnd = new Vector2();\n    const rotateDelta = new Vector2();\n    const panStart = new Vector2();\n    const panEnd = new Vector2();\n    const panDelta = new Vector2();\n    const dollyStart = new Vector2();\n    const dollyEnd = new Vector2();\n    const dollyDelta = new Vector2();\n    const dollyDirection = new Vector3();\n    const mouse = new Vector2();\n    let performCursorZoom = false;\n    const pointers = [];\n    const pointerPositions = {};\n    function getAutoRotationAngle(deltaTime) {\n      if (deltaTime !== null) {\n        return 2 * Math.PI / 60 * scope.autoRotateSpeed * deltaTime;\n      } else {\n        return 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n      }\n    }\n    function getZoomScale() {\n      return Math.pow(0.95, scope.zoomSpeed);\n    }\n    function rotateLeft(angle) {\n      sphericalDelta.theta -= angle;\n    }\n    function rotateUp(angle) {\n      sphericalDelta.phi -= angle;\n    }\n    const panLeft = function () {\n      const v = new Vector3();\n      return function panLeft(distance, objectMatrix) {\n        v.setFromMatrixColumn(objectMatrix, 0); // get X column of objectMatrix\n        v.multiplyScalar(-distance);\n        panOffset.add(v);\n      };\n    }();\n    const panUp = function () {\n      const v = new Vector3();\n      return function panUp(distance, objectMatrix) {\n        if (scope.screenSpacePanning === true) {\n          v.setFromMatrixColumn(objectMatrix, 1);\n        } else {\n          v.setFromMatrixColumn(objectMatrix, 0);\n          v.crossVectors(scope.object.up, v);\n        }\n        v.multiplyScalar(distance);\n        panOffset.add(v);\n      };\n    }();\n\n    // deltaX and deltaY are in pixels; right and down are positive\n    const pan = function () {\n      const offset = new Vector3();\n      return function pan(deltaX, deltaY) {\n        const element = scope.domElement;\n        if (scope.object.isPerspectiveCamera) {\n          // perspective\n          const position = scope.object.position;\n          offset.copy(position).sub(scope.target);\n          let targetDistance = offset.length();\n\n          // half of the fov is center to top of screen\n          targetDistance *= Math.tan(scope.object.fov / 2 * Math.PI / 180.0);\n\n          // we use only clientHeight here so aspect ratio does not distort speed\n          panLeft(2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix);\n          panUp(2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix);\n        } else if (scope.object.isOrthographicCamera) {\n          // orthographic\n          panLeft(deltaX * (scope.object.right - scope.object.left) / scope.object.zoom / element.clientWidth, scope.object.matrix);\n          panUp(deltaY * (scope.object.top - scope.object.bottom) / scope.object.zoom / element.clientHeight, scope.object.matrix);\n        } else {\n          // camera neither orthographic nor perspective\n          console.warn('WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.');\n          scope.enablePan = false;\n        }\n      };\n    }();\n    function dollyOut(dollyScale) {\n      if (scope.object.isPerspectiveCamera || scope.object.isOrthographicCamera) {\n        scale /= dollyScale;\n      } else {\n        console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');\n        scope.enableZoom = false;\n      }\n    }\n    function dollyIn(dollyScale) {\n      if (scope.object.isPerspectiveCamera || scope.object.isOrthographicCamera) {\n        scale *= dollyScale;\n      } else {\n        console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');\n        scope.enableZoom = false;\n      }\n    }\n    function updateMouseParameters(event) {\n      if (!scope.zoomToCursor) {\n        return;\n      }\n      performCursorZoom = true;\n      const rect = scope.domElement.getBoundingClientRect();\n      const x = event.clientX - rect.left;\n      const y = event.clientY - rect.top;\n      const w = rect.width;\n      const h = rect.height;\n      mouse.x = x / w * 2 - 1;\n      mouse.y = -(y / h) * 2 + 1;\n      dollyDirection.set(mouse.x, mouse.y, 1).unproject(scope.object).sub(scope.object.position).normalize();\n    }\n    function clampDistance(dist) {\n      return Math.max(scope.minDistance, Math.min(scope.maxDistance, dist));\n    }\n\n    //\n    // event callbacks - update the object state\n    //\n\n    function handleMouseDownRotate(event) {\n      rotateStart.set(event.clientX, event.clientY);\n    }\n    function handleMouseDownDolly(event) {\n      updateMouseParameters(event);\n      dollyStart.set(event.clientX, event.clientY);\n    }\n    function handleMouseDownPan(event) {\n      panStart.set(event.clientX, event.clientY);\n    }\n    function handleMouseMoveRotate(event) {\n      rotateEnd.set(event.clientX, event.clientY);\n      rotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed);\n      const element = scope.domElement;\n      rotateLeft(2 * Math.PI * rotateDelta.x / element.clientHeight); // yes, height\n\n      rotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight);\n      rotateStart.copy(rotateEnd);\n      scope.update();\n    }\n    function handleMouseMoveDolly(event) {\n      dollyEnd.set(event.clientX, event.clientY);\n      dollyDelta.subVectors(dollyEnd, dollyStart);\n      if (dollyDelta.y > 0) {\n        dollyOut(getZoomScale());\n      } else if (dollyDelta.y < 0) {\n        dollyIn(getZoomScale());\n      }\n      dollyStart.copy(dollyEnd);\n      scope.update();\n    }\n    function handleMouseMovePan(event) {\n      panEnd.set(event.clientX, event.clientY);\n      panDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed);\n      pan(panDelta.x, panDelta.y);\n      panStart.copy(panEnd);\n      scope.update();\n    }\n    function handleMouseWheel(event) {\n      updateMouseParameters(event);\n      if (event.deltaY < 0) {\n        dollyIn(getZoomScale());\n      } else if (event.deltaY > 0) {\n        dollyOut(getZoomScale());\n      }\n      scope.update();\n    }\n    function handleKeyDown(event) {\n      let needsUpdate = false;\n      switch (event.code) {\n        case scope.keys.UP:\n          if (event.ctrlKey || event.metaKey || event.shiftKey) {\n            rotateUp(2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight);\n          } else {\n            pan(0, scope.keyPanSpeed);\n          }\n          needsUpdate = true;\n          break;\n        case scope.keys.BOTTOM:\n          if (event.ctrlKey || event.metaKey || event.shiftKey) {\n            rotateUp(-2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight);\n          } else {\n            pan(0, -scope.keyPanSpeed);\n          }\n          needsUpdate = true;\n          break;\n        case scope.keys.LEFT:\n          if (event.ctrlKey || event.metaKey || event.shiftKey) {\n            rotateLeft(2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight);\n          } else {\n            pan(scope.keyPanSpeed, 0);\n          }\n          needsUpdate = true;\n          break;\n        case scope.keys.RIGHT:\n          if (event.ctrlKey || event.metaKey || event.shiftKey) {\n            rotateLeft(-2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight);\n          } else {\n            pan(-scope.keyPanSpeed, 0);\n          }\n          needsUpdate = true;\n          break;\n      }\n      if (needsUpdate) {\n        // prevent the browser from scrolling on cursor keys\n        event.preventDefault();\n        scope.update();\n      }\n    }\n    function handleTouchStartRotate() {\n      if (pointers.length === 1) {\n        rotateStart.set(pointers[0].pageX, pointers[0].pageY);\n      } else {\n        const x = 0.5 * (pointers[0].pageX + pointers[1].pageX);\n        const y = 0.5 * (pointers[0].pageY + pointers[1].pageY);\n        rotateStart.set(x, y);\n      }\n    }\n    function handleTouchStartPan() {\n      if (pointers.length === 1) {\n        panStart.set(pointers[0].pageX, pointers[0].pageY);\n      } else {\n        const x = 0.5 * (pointers[0].pageX + pointers[1].pageX);\n        const y = 0.5 * (pointers[0].pageY + pointers[1].pageY);\n        panStart.set(x, y);\n      }\n    }\n    function handleTouchStartDolly() {\n      const dx = pointers[0].pageX - pointers[1].pageX;\n      const dy = pointers[0].pageY - pointers[1].pageY;\n      const distance = Math.sqrt(dx * dx + dy * dy);\n      dollyStart.set(0, distance);\n    }\n    function handleTouchStartDollyPan() {\n      if (scope.enableZoom) handleTouchStartDolly();\n      if (scope.enablePan) handleTouchStartPan();\n    }\n    function handleTouchStartDollyRotate() {\n      if (scope.enableZoom) handleTouchStartDolly();\n      if (scope.enableRotate) handleTouchStartRotate();\n    }\n    function handleTouchMoveRotate(event) {\n      if (pointers.length == 1) {\n        rotateEnd.set(event.pageX, event.pageY);\n      } else {\n        const position = getSecondPointerPosition(event);\n        const x = 0.5 * (event.pageX + position.x);\n        const y = 0.5 * (event.pageY + position.y);\n        rotateEnd.set(x, y);\n      }\n      rotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed);\n      const element = scope.domElement;\n      rotateLeft(2 * Math.PI * rotateDelta.x / element.clientHeight); // yes, height\n\n      rotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight);\n      rotateStart.copy(rotateEnd);\n    }\n    function handleTouchMovePan(event) {\n      if (pointers.length === 1) {\n        panEnd.set(event.pageX, event.pageY);\n      } else {\n        const position = getSecondPointerPosition(event);\n        const x = 0.5 * (event.pageX + position.x);\n        const y = 0.5 * (event.pageY + position.y);\n        panEnd.set(x, y);\n      }\n      panDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed);\n      pan(panDelta.x, panDelta.y);\n      panStart.copy(panEnd);\n    }\n    function handleTouchMoveDolly(event) {\n      const position = getSecondPointerPosition(event);\n      const dx = event.pageX - position.x;\n      const dy = event.pageY - position.y;\n      const distance = Math.sqrt(dx * dx + dy * dy);\n      dollyEnd.set(0, distance);\n      dollyDelta.set(0, Math.pow(dollyEnd.y / dollyStart.y, scope.zoomSpeed));\n      dollyOut(dollyDelta.y);\n      dollyStart.copy(dollyEnd);\n    }\n    function handleTouchMoveDollyPan(event) {\n      if (scope.enableZoom) handleTouchMoveDolly(event);\n      if (scope.enablePan) handleTouchMovePan(event);\n    }\n    function handleTouchMoveDollyRotate(event) {\n      if (scope.enableZoom) handleTouchMoveDolly(event);\n      if (scope.enableRotate) handleTouchMoveRotate(event);\n    }\n\n    //\n    // event handlers - FSM: listen for events and reset state\n    //\n\n    function onPointerDown(event) {\n      if (scope.enabled === false) return;\n      if (pointers.length === 0) {\n        scope.domElement.setPointerCapture(event.pointerId);\n        scope.domElement.addEventListener('pointermove', onPointerMove);\n        scope.domElement.addEventListener('pointerup', onPointerUp);\n      }\n\n      //\n\n      addPointer(event);\n      if (event.pointerType === 'touch') {\n        onTouchStart(event);\n      } else {\n        onMouseDown(event);\n      }\n    }\n    function onPointerMove(event) {\n      if (scope.enabled === false) return;\n      if (event.pointerType === 'touch') {\n        onTouchMove(event);\n      } else {\n        onMouseMove(event);\n      }\n    }\n    function onPointerUp(event) {\n      removePointer(event);\n      if (pointers.length === 0) {\n        scope.domElement.releasePointerCapture(event.pointerId);\n        scope.domElement.removeEventListener('pointermove', onPointerMove);\n        scope.domElement.removeEventListener('pointerup', onPointerUp);\n      }\n      scope.dispatchEvent(_endEvent);\n      state = STATE.NONE;\n    }\n    function onMouseDown(event) {\n      let mouseAction;\n      switch (event.button) {\n        case 0:\n          mouseAction = scope.mouseButtons.LEFT;\n          break;\n        case 1:\n          mouseAction = scope.mouseButtons.MIDDLE;\n          break;\n        case 2:\n          mouseAction = scope.mouseButtons.RIGHT;\n          break;\n        default:\n          mouseAction = -1;\n      }\n      switch (mouseAction) {\n        case MOUSE.DOLLY:\n          if (scope.enableZoom === false) return;\n          handleMouseDownDolly(event);\n          state = STATE.DOLLY;\n          break;\n        case MOUSE.ROTATE:\n          if (event.ctrlKey || event.metaKey || event.shiftKey) {\n            if (scope.enablePan === false) return;\n            handleMouseDownPan(event);\n            state = STATE.PAN;\n          } else {\n            if (scope.enableRotate === false) return;\n            handleMouseDownRotate(event);\n            state = STATE.ROTATE;\n          }\n          break;\n        case MOUSE.PAN:\n          if (event.ctrlKey || event.metaKey || event.shiftKey) {\n            if (scope.enableRotate === false) return;\n            handleMouseDownRotate(event);\n            state = STATE.ROTATE;\n          } else {\n            if (scope.enablePan === false) return;\n            handleMouseDownPan(event);\n            state = STATE.PAN;\n          }\n          break;\n        default:\n          state = STATE.NONE;\n      }\n      if (state !== STATE.NONE) {\n        scope.dispatchEvent(_startEvent);\n      }\n    }\n    function onMouseMove(event) {\n      switch (state) {\n        case STATE.ROTATE:\n          if (scope.enableRotate === false) return;\n          handleMouseMoveRotate(event);\n          break;\n        case STATE.DOLLY:\n          if (scope.enableZoom === false) return;\n          handleMouseMoveDolly(event);\n          break;\n        case STATE.PAN:\n          if (scope.enablePan === false) return;\n          handleMouseMovePan(event);\n          break;\n      }\n    }\n    function onMouseWheel(event) {\n      if (scope.enabled === false || scope.enableZoom === false || state !== STATE.NONE) return;\n      event.preventDefault();\n      scope.dispatchEvent(_startEvent);\n      handleMouseWheel(event);\n      scope.dispatchEvent(_endEvent);\n    }\n    function onKeyDown(event) {\n      if (scope.enabled === false || scope.enablePan === false) return;\n      handleKeyDown(event);\n    }\n    function onTouchStart(event) {\n      trackPointer(event);\n      switch (pointers.length) {\n        case 1:\n          switch (scope.touches.ONE) {\n            case TOUCH.ROTATE:\n              if (scope.enableRotate === false) return;\n              handleTouchStartRotate();\n              state = STATE.TOUCH_ROTATE;\n              break;\n            case TOUCH.PAN:\n              if (scope.enablePan === false) return;\n              handleTouchStartPan();\n              state = STATE.TOUCH_PAN;\n              break;\n            default:\n              state = STATE.NONE;\n          }\n          break;\n        case 2:\n          switch (scope.touches.TWO) {\n            case TOUCH.DOLLY_PAN:\n              if (scope.enableZoom === false && scope.enablePan === false) return;\n              handleTouchStartDollyPan();\n              state = STATE.TOUCH_DOLLY_PAN;\n              break;\n            case TOUCH.DOLLY_ROTATE:\n              if (scope.enableZoom === false && scope.enableRotate === false) return;\n              handleTouchStartDollyRotate();\n              state = STATE.TOUCH_DOLLY_ROTATE;\n              break;\n            default:\n              state = STATE.NONE;\n          }\n          break;\n        default:\n          state = STATE.NONE;\n      }\n      if (state !== STATE.NONE) {\n        scope.dispatchEvent(_startEvent);\n      }\n    }\n    function onTouchMove(event) {\n      trackPointer(event);\n      switch (state) {\n        case STATE.TOUCH_ROTATE:\n          if (scope.enableRotate === false) return;\n          handleTouchMoveRotate(event);\n          scope.update();\n          break;\n        case STATE.TOUCH_PAN:\n          if (scope.enablePan === false) return;\n          handleTouchMovePan(event);\n          scope.update();\n          break;\n        case STATE.TOUCH_DOLLY_PAN:\n          if (scope.enableZoom === false && scope.enablePan === false) return;\n          handleTouchMoveDollyPan(event);\n          scope.update();\n          break;\n        case STATE.TOUCH_DOLLY_ROTATE:\n          if (scope.enableZoom === false && scope.enableRotate === false) return;\n          handleTouchMoveDollyRotate(event);\n          scope.update();\n          break;\n        default:\n          state = STATE.NONE;\n      }\n    }\n    function onContextMenu(event) {\n      if (scope.enabled === false) return;\n      event.preventDefault();\n    }\n    function addPointer(event) {\n      pointers.push(event);\n    }\n    function removePointer(event) {\n      delete pointerPositions[event.pointerId];\n      for (let i = 0; i < pointers.length; i++) {\n        if (pointers[i].pointerId == event.pointerId) {\n          pointers.splice(i, 1);\n          return;\n        }\n      }\n    }\n    function trackPointer(event) {\n      let position = pointerPositions[event.pointerId];\n      if (position === undefined) {\n        position = new Vector2();\n        pointerPositions[event.pointerId] = position;\n      }\n      position.set(event.pageX, event.pageY);\n    }\n    function getSecondPointerPosition(event) {\n      const pointer = event.pointerId === pointers[0].pointerId ? pointers[1] : pointers[0];\n      return pointerPositions[pointer.pointerId];\n    }\n\n    //\n\n    scope.domElement.addEventListener('contextmenu', onContextMenu);\n    scope.domElement.addEventListener('pointerdown', onPointerDown);\n    scope.domElement.addEventListener('pointercancel', onPointerUp);\n    scope.domElement.addEventListener('wheel', onMouseWheel, {\n      passive: false\n    });\n\n    // force an update at start\n\n    this.update();\n  }\n}\nfunction orbitControlsRestrictor(orbit, camera, check, updated) {\n  var previous;\n  var previousTarget;\n\n  // eslint-disable-next-line max-statements\n  orbit.addEventListener('change', /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var position, rotation, _previous, p, r, t;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          position = camera.position.clone();\n          rotation = camera.rotation.clone();\n          _context.next = 4;\n          return check({\n            position: position,\n            rotation: rotation\n          }, previous);\n        case 4:\n          if (!_context.sent) {\n            _context.next = 9;\n            break;\n          }\n          previous = {\n            position: position,\n            rotation: rotation\n          };\n          previousTarget = orbit.target.clone();\n          _context.next = 13;\n          break;\n        case 9:\n          if (previous && previousTarget) {\n            _previous = previous, p = _previous.position, r = _previous.rotation;\n            t = previousTarget;\n            camera.position.fromArray([p.x, p.y, p.z]);\n            camera.rotation.fromArray([r.x, r.y, r.z]);\n            orbit.target.fromArray([t.x, t.y, t.z]);\n          }\n          orbit.update();\n          _context.next = 13;\n          return updated({\n            position: position,\n            rotation: rotation\n          }, previous);\n        case 13:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  })));\n}\n\n/**\n * HybridScene is a wrapper for Three.js Scene with some additional features such as:\n * - drag controls\n * - orbit controls\n * - camera\n * - renderer\n */\nvar HybridScene = /*#__PURE__*/function () {\n  function HybridScene(container) {\n    _classCallCheck(this, HybridScene);\n    _defineProperty(this, \"root\", new Scene());\n    _defineProperty(this, \"canvases\", new Map());\n    this.container = container;\n    this.camera = new PerspectiveCamera();\n    this.camera.position.set(0, 0, 1000);\n    this.camera.fov = 45;\n    this.camera.near = 1;\n    this.camera.far = 4000;\n    this.renderer = new HybridRenderer();\n    container.appendChild(this.renderer.domElement);\n    this.orbit = this.createOrbitControls();\n    this.controls = this.createDragControls(this.orbit);\n  }\n  _createClass(HybridScene, [{\n    key: \"createOrbitControls\",\n    value: function createOrbitControls() {\n      var orbit = new OrbitControls(this.camera, this.renderer.domElement);\n      orbit.update();\n      var orbitChangeNumber = 0;\n      orbit.addEventListener('start', function () {\n        orbitChangeNumber = 0;\n      });\n      orbit.addEventListener('change', function () {\n        orbitChangeNumber++;\n      });\n      this.renderer.domElement.addEventListener('contextmenu', function (e) {\n        if (orbitChangeNumber > 5) e.stopPropagation();\n      });\n      return orbit;\n    }\n  }, {\n    key: \"createDragControls\",\n    value: function createDragControls(orbit) {\n      var _this = this;\n      var controls = new DragControls(this.camera, this.renderer.domElement, function (object) {\n        var canvas = object.parent;\n        if (!canvas) throw new Error('object doesnt have parent');\n        if (!Array.from(_this.canvases.values()).includes(canvas)) throw new Error('object parent isnt canvas');\n        return _this.canvasToPlane(canvas);\n      });\n      attachDraggableHooks(controls);\n      controls.addEventListener('dragstart', function () {\n        return orbit.enabled = false;\n      });\n      controls.addEventListener('dragend', function () {\n        return orbit.enabled = true;\n      });\n      return controls;\n    }\n  }, {\n    key: \"canvasToPlane\",\n    value: function canvasToPlane(canvas) {\n      var plane = new Plane();\n      var normal = new Vector3(0, 0, 1);\n      normal.applyQuaternion(canvas.quaternion);\n      plane.setFromNormalAndCoplanarPoint(normal, canvas.position.clone());\n      return plane;\n    }\n  }, {\n    key: \"addCanvasFor\",\n    value: function addCanvasFor(scope) {\n      var canvas = new Object3D();\n      canvas.scale.set(1, -1, 1);\n      this.canvases.set(scope, canvas);\n      this.root.add(canvas);\n    }\n  }, {\n    key: \"resize\",\n    value: function resize(width, height) {\n      this.camera.aspect = width / height;\n      this.camera.updateProjectionMatrix();\n      this.renderer.setSize(width, height);\n    }\n\n    /**\n     * Render the frame. Can be directly used instead of `animate` extension.\n     */\n  }, {\n    key: \"render\",\n    value: function render() {\n      this.renderer.render(this.root, this.camera);\n    }\n  }, {\n    key: \"getCanvasFor\",\n    value: function getCanvasFor(scope) {\n      var canvas = this.canvases.get(scope);\n      if (!canvas) throw new Error('cannot find canvas for the scope');\n      return canvas;\n    }\n  }, {\n    key: \"add\",\n    value: function add(object, scope) {\n      object.scale.set(1, -1, 1);\n      this.getCanvasFor(scope).add(object);\n      if (object instanceof DraggableObject3D) this.controls.attach(object);\n      this.render(); // force DOM elements to be rendered synchronously\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(object, scope) {\n      this.getCanvasFor(scope).remove(object);\n      if (object instanceof DraggableObject3D) this.controls.detach(object);\n      this.render(); // force DOM elements to be rendered synchronously\n    }\n  }, {\n    key: \"getPointerFrom\",\n    value: function getPointerFrom(event, scope) {\n      var rect = this.container.getBoundingClientRect();\n      var raycaster = new Raycaster();\n      var pointer = new Vector2((event.clientX - rect.left) / rect.width * 2 - 1, -(event.clientY - rect.top) / rect.height * 2 + 1);\n      raycaster.setFromCamera(pointer, this.camera);\n      var canvas = this.getCanvasFor(scope);\n      var plane = this.canvasToPlane(canvas);\n      var intersection = raycaster.ray.intersectPlane(plane, new Vector3());\n      if (intersection) {\n        return canvas.worldToLocal(intersection);\n      }\n      return null;\n    }\n  }]);\n  return HybridScene;\n}();\n\n/**\n * Area class is responsible for managing 3D scene for a current editor\n */\nvar Area = /*#__PURE__*/function () {\n  function Area(container, scene, scope, events, guards) {\n    var _this = this;\n    _classCallCheck(this, Area);\n    _defineProperty(this, \"pointer\", {\n      x: 0,\n      y: 0\n    });\n    _defineProperty(this, \"pointerdown\", function (event) {\n      _this.setPointerFrom(event);\n      _this.events.pointerDown(_this.pointer, event);\n    });\n    _defineProperty(this, \"pointermove\", function (event) {\n      _this.setPointerFrom(event);\n      _this.events.pointerMove(_this.pointer, event);\n    });\n    _defineProperty(this, \"pointerup\", function (event) {\n      _this.setPointerFrom(event);\n      _this.events.pointerUp(_this.pointer, event);\n    });\n    /**\n     * Force resize the container of the 3D scene\n     * @param event The resize event\n     */\n    _defineProperty(this, \"resize\", function (event) {\n      _this.events.resize(event);\n      _this.scene.resize(_this.container.clientWidth, _this.container.clientHeight);\n    });\n    this.container = container;\n    this.scope = scope;\n    this.events = events;\n    this.guards = guards;\n    this.scene = scene || new HybridScene(this.container);\n    this.content = new Content(this.scene, scope, function (element) {\n      return _this.events.reordered(element);\n    });\n    this.container.addEventListener('pointerdown', this.pointerdown);\n    this.container.addEventListener('pointermove', this.pointermove);\n    window.addEventListener('pointerup', this.pointerup);\n    window.addEventListener('resize', this.resize);\n    orbitControlsRestrictor(this.scene.orbit, this.scene.camera, function (current, previous) {\n      return _this.guards.transform({\n        previous: previous,\n        current: current\n      });\n    }, function (current, previous) {\n      return _this.events.transformed({\n        previous: previous,\n        current: current\n      });\n    });\n    this.scene.resize(this.container.clientWidth, this.container.clientHeight);\n  }\n\n  /**\n   * Get the canvas in form of Object3D for the current scope\n   */\n  _createClass(Area, [{\n    key: \"getCanvas\",\n    value: function getCanvas() {\n      return this.scene.canvases.get(this.scope);\n    }\n\n    /**\n     * Set the pointer position from the given mouse event into the `pointer` property\n     */\n  }, {\n    key: \"setPointerFrom\",\n    value: function setPointerFrom(event) {\n      var point = this.scene.getPointerFrom(event, this.scope);\n      if (point) {\n        this.pointer = {\n          x: point.x,\n          y: point.y\n        };\n      }\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.container.removeEventListener('pointerdown', this.pointerdown);\n      this.container.removeEventListener('pointermove', this.pointermove);\n      window.removeEventListener('pointerup', this.pointerup);\n      window.removeEventListener('resize', this.resize);\n    }\n  }]);\n  return Area;\n}();\nvar ConnectionView = /*#__PURE__*/_createClass(function ConnectionView(events) {\n  _classCallCheck(this, ConnectionView);\n  this.element = document.createElement('div');\n  this.element.style.position = 'absolute';\n  this.element.style.left = '0';\n  this.element.style.top = '0';\n  this.element.addEventListener('contextmenu', function (event) {\n    return events.contextmenu(event);\n  });\n  this.object = new ObjectHTML(this.element);\n}\n\n// public update(params?: HTML3DOptions) {\n//   setHTMLElement(this.object, this.element, {\n//     materials: {\n//       front: params?.materials?.front || createMaterial(false),\n//       back: params?.materials?.back || createBackMaterial()\n//     }\n//   })\n// }\n);\nvar ElementsHolder = /*#__PURE__*/function () {\n  function ElementsHolder() {\n    _classCallCheck(this, ElementsHolder);\n    _defineProperty(this, \"views\", new WeakMap());\n    _defineProperty(this, \"viewsElements\", new Map());\n  }\n  _createClass(ElementsHolder, [{\n    key: \"set\",\n    value: function set(context) {\n      var element = context.element,\n        type = context.type,\n        payload = context.payload;\n      if (payload !== null && payload !== void 0 && payload.id) {\n        this.views.set(element, context);\n        this.viewsElements.set(\"\".concat(type, \"_\").concat(payload.id), element);\n      }\n    }\n  }, {\n    key: \"get\",\n    value: function get(type, id) {\n      var element = this.viewsElements.get(\"\".concat(type, \"_\").concat(id));\n      return element && this.views.get(element);\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete(element) {\n      var _view$payload;\n      var view = this.views.get(element);\n      if (view && (_view$payload = view.payload) !== null && _view$payload !== void 0 && _view$payload.id) {\n        this.views[\"delete\"](element);\n        this.viewsElements[\"delete\"](\"\".concat(view.type, \"_\").concat(view.payload.id));\n      }\n    }\n  }]);\n  return ElementsHolder;\n}();\nfunction ownKeys$1(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread$1(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys$1(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$1(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nvar NodeView = /*#__PURE__*/function () {\n  function NodeView(events, guards) {\n    var _this = this;\n    _classCallCheck(this, NodeView);\n    _defineProperty(this, \"translate\", /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(x, y) {\n        var previous, translation;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              previous = _objectSpread$1({}, _this.position);\n              _context.next = 3;\n              return _this.guards.translate({\n                previous: previous,\n                position: {\n                  x: x,\n                  y: y\n                }\n              });\n            case 3:\n              translation = _context.sent;\n              if (translation) {\n                _context.next = 6;\n                break;\n              }\n              return _context.abrupt(\"return\", false);\n            case 6:\n              _this.position = _objectSpread$1({}, translation.data.position);\n              _this.object.position.set(_this.position.x, _this.position.y, _this.object.position.z);\n              _context.next = 10;\n              return _this.events.translated({\n                position: _this.position,\n                previous: previous\n              });\n            case 10:\n              return _context.abrupt(\"return\", true);\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n    _defineProperty(this, \"resize\", /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(width, height) {\n        var size, el;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              size = {\n                width: width,\n                height: height\n              };\n              _context2.next = 3;\n              return _this.guards.resize({\n                size: size\n              });\n            case 3:\n              if (_context2.sent) {\n                _context2.next = 5;\n                break;\n              }\n              return _context2.abrupt(\"return\", false);\n            case 5:\n              el = _this.element.children.item(0);\n              if (!(!el || !(el instanceof HTMLElement))) {\n                _context2.next = 8;\n                break;\n              }\n              return _context2.abrupt(\"return\", false);\n            case 8:\n              el.style.width = \"\".concat(width, \"px\");\n              el.style.height = \"\".concat(height, \"px\");\n              _context2.next = 12;\n              return _this.events.resized({\n                size: size\n              });\n            case 12:\n              return _context2.abrupt(\"return\", true);\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }));\n      return function (_x3, _x4) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n    this.events = events;\n    this.guards = guards;\n    this.element = document.createElement('div');\n    this.element.style.position = 'absolute';\n    this.position = {\n      x: 0,\n      y: 0\n    };\n    this.translate(0, 0);\n    this.element.addEventListener('contextmenu', function (event) {\n      return _this.events.contextmenu(event);\n    });\n    this.object = new DraggableObject3D(this.element, {\n      start: this.events.picked,\n      translate: this.translate,\n      drag: this.events.dragged\n    });\n  }\n  _createClass(NodeView, [{\n    key: \"destroy\",\n    value: function destroy() {}\n  }]);\n  return NodeView;\n}();\n\n/**\n * Animate the given 3D scene, uses `requestAnimationFrame`\n * @param area The 3D area plugin\n * @param tick Optional callback to be called on each frame\n * @example Area3DExtensions.animate(area)\n * @example Area3DExtensions.animate(area, time => console.log(time))\n */\nfunction animate(area, tick) {\n  function render(time) {\n    if (tick) tick(time);\n    area.area.scene.render();\n    requestAnimationFrame(function (t) {\n      return render(t);\n    });\n  }\n  render(performance.now());\n}\n\n// eslint-disable-next-line max-statements\nfunction getRoundedShape(width, height, radius) {\n  var shape = new Shape();\n  var x = 0;\n  var y = 0;\n  shape.moveTo(x + radius, y);\n  shape.lineTo(x + width - radius, y);\n  shape.quadraticCurveTo(x + width, y, x + width, y + radius);\n  shape.lineTo(x + width, y + height - radius);\n  shape.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n  shape.lineTo(x + radius, y + height);\n  shape.quadraticCurveTo(x, y + height, x, y + height - radius);\n  shape.lineTo(x, y + radius);\n  shape.quadraticCurveTo(x, y, x + radius, y);\n  shape.closePath();\n  return shape;\n}\n\n/**\n * Form generator for embedding rete-comment-plugin into 3D scene.\n * @param scope Area3DPlugin instance\n */\nfunction comment(scope) {\n  var commentScope = scope;\n  var area = commentScope.parentScope(Area3DPlugin);\n  commentScope.addPipe(function (context) {\n    if (context.type === 'commentcreated') {\n      updateCommentGeometry(area, context.data);\n    }\n    if (context.type === 'commenttranslated') {\n      var id = context.data.id;\n      var c = commentScope.comments.get(id);\n      if (c) {\n        updateCommentGeometry(area, c);\n      }\n    }\n    return context;\n  });\n}\nfunction commentGeometry(width, height, x, y) {\n  var shape = getRoundedShape(width, height, 18);\n  var geometry = new ShapeGeometry(shape);\n  geometry.__commentGeometry = {\n    width: width,\n    height: height,\n    x: x,\n    y: y\n  };\n  geometry.translate(x, y, 0);\n  return geometry;\n}\nfunction updateCommentGeometry(area, c) {\n  area.area.content.updateGeometry(c.element, function (existing) {\n    var meta = existing === null || existing === void 0 ? void 0 : existing.__commentGeometry;\n    if (meta) {\n      if (meta.width !== c.width || meta.height !== c.height) {\n        return commentGeometry(c.width, c.height, c.x, c.y);\n      }\n      if (meta.x !== c.x || meta.y !== c.y) {\n        return existing === null || existing === void 0 ? void 0 : existing.translate(c.x - meta.x, c.y - meta.y, 0);\n      }\n    }\n    return commentGeometry(c.width, c.height, c.x, c.y);\n  });\n}\nfunction getDefaultExportFromCjs(x) {\n  return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n}\nvar parseSvgPath = parse;\n\n/**\n * expected argument lengths\n * @type {Object}\n */\n\nvar length = {\n  a: 7,\n  c: 6,\n  h: 1,\n  l: 2,\n  m: 2,\n  q: 4,\n  s: 4,\n  t: 2,\n  v: 1,\n  z: 0\n};\n\n/**\n * segment pattern\n * @type {RegExp}\n */\n\nvar segment = /([astvzqmhlc])([^astvzqmhlc]*)/ig;\n\n/**\n * parse an svg path data string. Generates an Array\n * of commands where each command is an Array of the\n * form `[command, arg1, arg2, ...]`\n *\n * @param {String} path\n * @return {Array}\n */\n\nfunction parse(path) {\n  var data = [];\n  path.replace(segment, function (_, command, args) {\n    var type = command.toLowerCase();\n    args = parseValues(args);\n\n    // overloaded moveTo\n    if (type == 'm' && args.length > 2) {\n      data.push([command].concat(args.splice(0, 2)));\n      type = 'l';\n      command = command == 'm' ? 'l' : 'L';\n    }\n    while (true) {\n      if (args.length == length[type]) {\n        args.unshift(command);\n        return data.push(args);\n      }\n      if (args.length < length[type]) throw new Error('malformed path data');\n      data.push([command].concat(args.splice(0, length[type])));\n    }\n  });\n  return data;\n}\nvar number = /-?[0-9]*\\.?[0-9]+(?:e[-+]?\\d+)?/ig;\nfunction parseValues(args) {\n  var numbers = args.match(number);\n  return numbers ? numbers.map(Number) : [];\n}\nvar parse$1 = /*@__PURE__*/getDefaultExportFromCjs(parseSvgPath);\nfunction clone(point) {\n  //TODO: use gl-vec2 for this\n  return [point[0], point[1]];\n}\nfunction vec2(x, y) {\n  return [x, y];\n}\nvar _function = function createBezierBuilder(opt) {\n  opt = opt || {};\n  var RECURSION_LIMIT = typeof opt.recursion === 'number' ? opt.recursion : 8;\n  var FLT_EPSILON = typeof opt.epsilon === 'number' ? opt.epsilon : 1.19209290e-7;\n  var PATH_DISTANCE_EPSILON = typeof opt.pathEpsilon === 'number' ? opt.pathEpsilon : 1.0;\n  var curve_angle_tolerance_epsilon = typeof opt.angleEpsilon === 'number' ? opt.angleEpsilon : 0.01;\n  var m_angle_tolerance = opt.angleTolerance || 0;\n  var m_cusp_limit = opt.cuspLimit || 0;\n  return function bezierCurve(start, c1, c2, end, scale, points) {\n    if (!points) points = [];\n    scale = typeof scale === 'number' ? scale : 1.0;\n    var distanceTolerance = PATH_DISTANCE_EPSILON / scale;\n    distanceTolerance *= distanceTolerance;\n    begin(start, c1, c2, end, points, distanceTolerance);\n    return points;\n  };\n\n  ////// Based on:\n  ////// https://github.com/pelson/antigrain/blob/master/agg-2.4/src/agg_curves.cpp\n\n  function begin(start, c1, c2, end, points, distanceTolerance) {\n    points.push(clone(start));\n    var x1 = start[0],\n      y1 = start[1],\n      x2 = c1[0],\n      y2 = c1[1],\n      x3 = c2[0],\n      y3 = c2[1],\n      x4 = end[0],\n      y4 = end[1];\n    recursive(x1, y1, x2, y2, x3, y3, x4, y4, points, distanceTolerance, 0);\n    points.push(clone(end));\n  }\n  function recursive(x1, y1, x2, y2, x3, y3, x4, y4, points, distanceTolerance, level) {\n    if (level > RECURSION_LIMIT) return;\n    var pi = Math.PI;\n\n    // Calculate all the mid-points of the line segments\n    //----------------------\n    var x12 = (x1 + x2) / 2;\n    var y12 = (y1 + y2) / 2;\n    var x23 = (x2 + x3) / 2;\n    var y23 = (y2 + y3) / 2;\n    var x34 = (x3 + x4) / 2;\n    var y34 = (y3 + y4) / 2;\n    var x123 = (x12 + x23) / 2;\n    var y123 = (y12 + y23) / 2;\n    var x234 = (x23 + x34) / 2;\n    var y234 = (y23 + y34) / 2;\n    var x1234 = (x123 + x234) / 2;\n    var y1234 = (y123 + y234) / 2;\n    if (level > 0) {\n      // Enforce subdivision first time\n      // Try to approximate the full cubic curve by a single straight line\n      //------------------\n      var dx = x4 - x1;\n      var dy = y4 - y1;\n      var d2 = Math.abs((x2 - x4) * dy - (y2 - y4) * dx);\n      var d3 = Math.abs((x3 - x4) * dy - (y3 - y4) * dx);\n      var da1, da2;\n      if (d2 > FLT_EPSILON && d3 > FLT_EPSILON) {\n        // Regular care\n        //-----------------\n        if ((d2 + d3) * (d2 + d3) <= distanceTolerance * (dx * dx + dy * dy)) {\n          // If the curvature doesn't exceed the distanceTolerance value\n          // we tend to finish subdivisions.\n          //----------------------\n          if (m_angle_tolerance < curve_angle_tolerance_epsilon) {\n            points.push(vec2(x1234, y1234));\n            return;\n          }\n\n          // Angle & Cusp Condition\n          //----------------------\n          var a23 = Math.atan2(y3 - y2, x3 - x2);\n          da1 = Math.abs(a23 - Math.atan2(y2 - y1, x2 - x1));\n          da2 = Math.abs(Math.atan2(y4 - y3, x4 - x3) - a23);\n          if (da1 >= pi) da1 = 2 * pi - da1;\n          if (da2 >= pi) da2 = 2 * pi - da2;\n          if (da1 + da2 < m_angle_tolerance) {\n            // Finally we can stop the recursion\n            //----------------------\n            points.push(vec2(x1234, y1234));\n            return;\n          }\n          if (m_cusp_limit !== 0.0) {\n            if (da1 > m_cusp_limit) {\n              points.push(vec2(x2, y2));\n              return;\n            }\n            if (da2 > m_cusp_limit) {\n              points.push(vec2(x3, y3));\n              return;\n            }\n          }\n        }\n      } else {\n        if (d2 > FLT_EPSILON) {\n          // p1,p3,p4 are collinear, p2 is considerable\n          //----------------------\n          if (d2 * d2 <= distanceTolerance * (dx * dx + dy * dy)) {\n            if (m_angle_tolerance < curve_angle_tolerance_epsilon) {\n              points.push(vec2(x1234, y1234));\n              return;\n            }\n\n            // Angle Condition\n            //----------------------\n            da1 = Math.abs(Math.atan2(y3 - y2, x3 - x2) - Math.atan2(y2 - y1, x2 - x1));\n            if (da1 >= pi) da1 = 2 * pi - da1;\n            if (da1 < m_angle_tolerance) {\n              points.push(vec2(x2, y2));\n              points.push(vec2(x3, y3));\n              return;\n            }\n            if (m_cusp_limit !== 0.0) {\n              if (da1 > m_cusp_limit) {\n                points.push(vec2(x2, y2));\n                return;\n              }\n            }\n          }\n        } else if (d3 > FLT_EPSILON) {\n          // p1,p2,p4 are collinear, p3 is considerable\n          //----------------------\n          if (d3 * d3 <= distanceTolerance * (dx * dx + dy * dy)) {\n            if (m_angle_tolerance < curve_angle_tolerance_epsilon) {\n              points.push(vec2(x1234, y1234));\n              return;\n            }\n\n            // Angle Condition\n            //----------------------\n            da1 = Math.abs(Math.atan2(y4 - y3, x4 - x3) - Math.atan2(y3 - y2, x3 - x2));\n            if (da1 >= pi) da1 = 2 * pi - da1;\n            if (da1 < m_angle_tolerance) {\n              points.push(vec2(x2, y2));\n              points.push(vec2(x3, y3));\n              return;\n            }\n            if (m_cusp_limit !== 0.0) {\n              if (da1 > m_cusp_limit) {\n                points.push(vec2(x3, y3));\n                return;\n              }\n            }\n          }\n        } else {\n          // Collinear case\n          //-----------------\n          dx = x1234 - (x1 + x4) / 2;\n          dy = y1234 - (y1 + y4) / 2;\n          if (dx * dx + dy * dy <= distanceTolerance) {\n            points.push(vec2(x1234, y1234));\n            return;\n          }\n        }\n      }\n    }\n\n    // Continue subdivision\n    //----------------------\n    recursive(x1, y1, x12, y12, x123, y123, x1234, y1234, points, distanceTolerance, level + 1);\n    recursive(x1234, y1234, x234, y234, x34, y34, x4, y4, points, distanceTolerance, level + 1);\n  }\n};\nvar adaptiveBezierCurve = _function();\nvar absSvgPath = absolutize;\n\n/**\n * redefine `path` with absolute coordinates\n *\n * @param {Array} path\n * @return {Array}\n */\n\nfunction absolutize(path) {\n  var startX = 0;\n  var startY = 0;\n  var x = 0;\n  var y = 0;\n  return path.map(function (seg) {\n    seg = seg.slice();\n    var type = seg[0];\n    var command = type.toUpperCase();\n\n    // is relative\n    if (type != command) {\n      seg[0] = command;\n      switch (type) {\n        case 'a':\n          seg[6] += x;\n          seg[7] += y;\n          break;\n        case 'v':\n          seg[1] += y;\n          break;\n        case 'h':\n          seg[1] += x;\n          break;\n        default:\n          for (var i = 1; i < seg.length;) {\n            seg[i++] += x;\n            seg[i++] += y;\n          }\n      }\n    }\n\n    // update cursor state\n    switch (command) {\n      case 'Z':\n        x = startX;\n        y = startY;\n        break;\n      case 'H':\n        x = seg[1];\n        break;\n      case 'V':\n        y = seg[1];\n        break;\n      case 'M':\n        x = startX = seg[1];\n        y = startY = seg[2];\n        break;\n      default:\n        x = seg[seg.length - 2];\n        y = seg[seg.length - 1];\n    }\n    return seg;\n  });\n}\nvar  = Math.PI;\nvar _120 = radians(120);\nvar normalizeSvgPath = normalize;\n\n/**\n * describe `path` in terms of cubic bzier \n * curves and move commands\n *\n * @param {Array} path\n * @return {Array}\n */\n\nfunction normalize(path) {\n  // init state\n  var prev;\n  var result = [];\n  var bezierX = 0;\n  var bezierY = 0;\n  var startX = 0;\n  var startY = 0;\n  var quadX = null;\n  var quadY = null;\n  var x = 0;\n  var y = 0;\n  for (var i = 0, len = path.length; i < len; i++) {\n    var seg = path[i];\n    var command = seg[0];\n    switch (command) {\n      case 'M':\n        startX = seg[1];\n        startY = seg[2];\n        break;\n      case 'A':\n        seg = arc(x, y, seg[1], seg[2], radians(seg[3]), seg[4], seg[5], seg[6], seg[7]);\n        // split multi part\n        seg.unshift('C');\n        if (seg.length > 7) {\n          result.push(seg.splice(0, 7));\n          seg.unshift('C');\n        }\n        break;\n      case 'S':\n        // default control point\n        var cx = x;\n        var cy = y;\n        if (prev == 'C' || prev == 'S') {\n          cx += cx - bezierX; // reflect the previous command's control\n          cy += cy - bezierY; // point relative to the current point\n        }\n        seg = ['C', cx, cy, seg[1], seg[2], seg[3], seg[4]];\n        break;\n      case 'T':\n        if (prev == 'Q' || prev == 'T') {\n          quadX = x * 2 - quadX; // as with 'S' reflect previous control point\n          quadY = y * 2 - quadY;\n        } else {\n          quadX = x;\n          quadY = y;\n        }\n        seg = quadratic(x, y, quadX, quadY, seg[1], seg[2]);\n        break;\n      case 'Q':\n        quadX = seg[1];\n        quadY = seg[2];\n        seg = quadratic(x, y, seg[1], seg[2], seg[3], seg[4]);\n        break;\n      case 'L':\n        seg = line(x, y, seg[1], seg[2]);\n        break;\n      case 'H':\n        seg = line(x, y, seg[1], y);\n        break;\n      case 'V':\n        seg = line(x, y, x, seg[1]);\n        break;\n      case 'Z':\n        seg = line(x, y, startX, startY);\n        break;\n    }\n\n    // update state\n    prev = command;\n    x = seg[seg.length - 2];\n    y = seg[seg.length - 1];\n    if (seg.length > 4) {\n      bezierX = seg[seg.length - 4];\n      bezierY = seg[seg.length - 3];\n    } else {\n      bezierX = x;\n      bezierY = y;\n    }\n    result.push(seg);\n  }\n  return result;\n}\nfunction line(x1, y1, x2, y2) {\n  return ['C', x1, y1, x2, y2, x2, y2];\n}\nfunction quadratic(x1, y1, cx, cy, x2, y2) {\n  return ['C', x1 / 3 + 2 / 3 * cx, y1 / 3 + 2 / 3 * cy, x2 / 3 + 2 / 3 * cx, y2 / 3 + 2 / 3 * cy, x2, y2];\n}\n\n// This function is ripped from \n// github.com/DmitryBaranovskiy/raphael/blob/4d97d4/raphael.js#L2216-L2304 \n// which references w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\n// TODO: make it human readable\n\nfunction arc(x1, y1, rx, ry, angle, large_arc_flag, sweep_flag, x2, y2, recursive) {\n  if (!recursive) {\n    var xy = rotate(x1, y1, -angle);\n    x1 = xy.x;\n    y1 = xy.y;\n    xy = rotate(x2, y2, -angle);\n    x2 = xy.x;\n    y2 = xy.y;\n    var x = (x1 - x2) / 2;\n    var y = (y1 - y2) / 2;\n    var h = x * x / (rx * rx) + y * y / (ry * ry);\n    if (h > 1) {\n      h = Math.sqrt(h);\n      rx = h * rx;\n      ry = h * ry;\n    }\n    var rx2 = rx * rx;\n    var ry2 = ry * ry;\n    var k = (large_arc_flag == sweep_flag ? -1 : 1) * Math.sqrt(Math.abs((rx2 * ry2 - rx2 * y * y - ry2 * x * x) / (rx2 * y * y + ry2 * x * x)));\n    if (k == Infinity) k = 1; // neutralize\n    var cx = k * rx * y / ry + (x1 + x2) / 2;\n    var cy = k * -ry * x / rx + (y1 + y2) / 2;\n    var f1 = Math.asin(((y1 - cy) / ry).toFixed(9));\n    var f2 = Math.asin(((y2 - cy) / ry).toFixed(9));\n    f1 = x1 < cx ?  - f1 : f1;\n    f2 = x2 < cx ?  - f2 : f2;\n    if (f1 < 0) f1 =  * 2 + f1;\n    if (f2 < 0) f2 =  * 2 + f2;\n    if (sweep_flag && f1 > f2) f1 = f1 -  * 2;\n    if (!sweep_flag && f2 > f1) f2 = f2 -  * 2;\n  } else {\n    f1 = recursive[0];\n    f2 = recursive[1];\n    cx = recursive[2];\n    cy = recursive[3];\n  }\n  // greater than 120 degrees requires multiple segments\n  if (Math.abs(f2 - f1) > _120) {\n    var f2old = f2;\n    var x2old = x2;\n    var y2old = y2;\n    f2 = f1 + _120 * (sweep_flag && f2 > f1 ? 1 : -1);\n    x2 = cx + rx * Math.cos(f2);\n    y2 = cy + ry * Math.sin(f2);\n    var res = arc(x2, y2, rx, ry, angle, 0, sweep_flag, x2old, y2old, [f2, f2old, cx, cy]);\n  }\n  var t = Math.tan((f2 - f1) / 4);\n  var hx = 4 / 3 * rx * t;\n  var hy = 4 / 3 * ry * t;\n  var curve = [2 * x1 - (x1 + hx * Math.sin(f1)), 2 * y1 - (y1 - hy * Math.cos(f1)), x2 + hx * Math.sin(f2), y2 - hy * Math.cos(f2), x2, y2];\n  if (recursive) return curve;\n  if (res) curve = curve.concat(res);\n  for (var i = 0; i < curve.length;) {\n    var rot = rotate(curve[i], curve[i + 1], angle);\n    curve[i++] = rot.x;\n    curve[i++] = rot.y;\n  }\n  return curve;\n}\nfunction rotate(x, y, rad) {\n  return {\n    x: x * Math.cos(rad) - y * Math.sin(rad),\n    y: x * Math.sin(rad) + y * Math.cos(rad)\n  };\n}\nfunction radians(degress) {\n  return degress * ( / 180);\n}\nvar vec2Copy = function vec2Copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n};\nvar bezier = adaptiveBezierCurve;\nvar abs = absSvgPath;\nvar norm = normalizeSvgPath;\nvar copy = vec2Copy;\nfunction set(out, x, y) {\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\nvar tmp1 = [0, 0],\n  tmp2 = [0, 0],\n  tmp3 = [0, 0];\nfunction bezierTo(points, scale, start, seg) {\n  bezier(start, set(tmp1, seg[1], seg[2]), set(tmp2, seg[3], seg[4]), set(tmp3, seg[5], seg[6]), scale, points);\n}\nvar svgPathContours = function contours(svg, scale) {\n  var paths = [];\n  var points = [];\n  var pen = [0, 0];\n  norm(abs(svg)).forEach(function (segment, i, self) {\n    if (segment[0] === 'M') {\n      copy(pen, segment.slice(1));\n      if (points.length > 0) {\n        paths.push(points);\n        points = [];\n      }\n    } else if (segment[0] === 'C') {\n      bezierTo(points, scale, pen, segment);\n      set(pen, segment[5], segment[6]);\n    } else {\n      throw new Error('illegal type in SVG: ' + segment[0]);\n    }\n  });\n  if (points.length > 0) paths.push(points);\n  return paths;\n};\nvar contours = /*@__PURE__*/getDefaultExportFromCjs(svgPathContours);\n\n/**\n * Create geometry for classic connection.\n * Can be used in `customize` option.\n * @param path SVG path\n * @param width Connection width\n * @returns Connection geometry\n */\n// eslint-disable-next-line max-statements\nfunction createClassicConnectionGeometry(path, width) {\n  var segments = contours(parse$1(path));\n  var points = segments.map(function (segment) {\n    return segment.map(function (_ref) {\n      var _ref2 = _slicedToArray(_ref, 2),\n        x = _ref2[0],\n        y = _ref2[1];\n      return {\n        x: x,\n        y: y\n      };\n    });\n  }).flat();\n  var geometry = new PlaneGeometry(100, 10, points.length - 1, 1);\n  for (var i = 0; i < points.length; i++) {\n    var normal = new Vector2(0, width / 2);\n    var point = new Vector2(points[i].x, points[i].y);\n    if (i > 0 && i < points.length - 1) {\n      var prevPoint = new Vector2(points[i - 1].x, points[i - 1].y);\n      var nextPoint = new Vector2(points[i + 1].x, points[i + 1].y);\n      var vectorBetweenPoints = nextPoint.clone().sub(prevPoint);\n      var normalBetweenPoints = new Vector2(-vectorBetweenPoints.y, vectorBetweenPoints.x).clone().normalize();\n      normal.set(normalBetweenPoints.x, normalBetweenPoints.y).multiplyScalar(width / 2);\n    }\n    geometry.attributes.position.setX(i, point.x + normal.x);\n    geometry.attributes.position.setY(i, point.y + normal.y);\n    geometry.attributes.position.setX(i + points.length, point.x - normal.x);\n    geometry.attributes.position.setY(i + points.length, point.y - normal.y);\n  }\n  return geometry;\n}\n\n/**\n * Options for node form generator\n */\n\n/**\n * Form generator for embedding connections into 3D scene.\n * @param scope Area3DPlugin instance\n * @param props Options for connection form generator\n */\nfunction connection(scope, props) {\n  var renderScope = scope;\n  var area = renderScope.parentScope(Area3DPlugin);\n  // const editor = area.parentScope<NodeEditor<S>>(NodeEditor)\n\n  renderScope.addPipe(function (context) {\n    if (!context || _typeof(context) !== 'object' || !('type' in context)) return context;\n    if (context.type === 'connectionpath') {\n      var id = context.data.payload.id;\n      var view = area.connectionViews.get(id);\n      if (view) {\n        var _path = context.data.path || classicConnectionPath(context.data.points, 0.3);\n        var geometry = props !== null && props !== void 0 && props.customize ? props.customize(_path) : createClassicConnectionGeometry(_path, 4.6);\n        if (geometry) {\n          area.area.content.updateGeometry(view.element, geometry);\n        }\n      }\n    }\n    return context;\n  });\n}\n\n/**\n * @param  {Array<BufferGeometry>} geometries\n * @param  {Boolean} useGroups\n * @return {BufferGeometry}\n */\nfunction mergeGeometries(geometries, useGroups = false) {\n  const isIndexed = geometries[0].index !== null;\n  const attributesUsed = new Set(Object.keys(geometries[0].attributes));\n  const morphAttributesUsed = new Set(Object.keys(geometries[0].morphAttributes));\n  const attributes = {};\n  const morphAttributes = {};\n  const morphTargetsRelative = geometries[0].morphTargetsRelative;\n  const mergedGeometry = new BufferGeometry();\n  let offset = 0;\n  for (let i = 0; i < geometries.length; ++i) {\n    const geometry = geometries[i];\n    let attributesCount = 0;\n\n    // ensure that all geometries are indexed, or none\n\n    if (isIndexed !== (geometry.index !== null)) {\n      console.error('THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.');\n      return null;\n    }\n\n    // gather attributes, exit early if they're different\n\n    for (const name in geometry.attributes) {\n      if (!attributesUsed.has(name)) {\n        console.error('THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure \"' + name + '\" attribute exists among all geometries, or in none of them.');\n        return null;\n      }\n      if (attributes[name] === undefined) attributes[name] = [];\n      attributes[name].push(geometry.attributes[name]);\n      attributesCount++;\n    }\n\n    // ensure geometries have the same number of attributes\n\n    if (attributesCount !== attributesUsed.size) {\n      console.error('THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. Make sure all geometries have the same number of attributes.');\n      return null;\n    }\n\n    // gather morph attributes, exit early if they're different\n\n    if (morphTargetsRelative !== geometry.morphTargetsRelative) {\n      console.error('THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. .morphTargetsRelative must be consistent throughout all geometries.');\n      return null;\n    }\n    for (const name in geometry.morphAttributes) {\n      if (!morphAttributesUsed.has(name)) {\n        console.error('THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '.  .morphAttributes must be consistent throughout all geometries.');\n        return null;\n      }\n      if (morphAttributes[name] === undefined) morphAttributes[name] = [];\n      morphAttributes[name].push(geometry.morphAttributes[name]);\n    }\n    if (useGroups) {\n      let count;\n      if (isIndexed) {\n        count = geometry.index.count;\n      } else if (geometry.attributes.position !== undefined) {\n        count = geometry.attributes.position.count;\n      } else {\n        console.error('THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. The geometry must have either an index or a position attribute');\n        return null;\n      }\n      mergedGeometry.addGroup(offset, count, i);\n      offset += count;\n    }\n  }\n\n  // merge indices\n\n  if (isIndexed) {\n    let indexOffset = 0;\n    const mergedIndex = [];\n    for (let i = 0; i < geometries.length; ++i) {\n      const index = geometries[i].index;\n      for (let j = 0; j < index.count; ++j) {\n        mergedIndex.push(index.getX(j) + indexOffset);\n      }\n      indexOffset += geometries[i].attributes.position.count;\n    }\n    mergedGeometry.setIndex(mergedIndex);\n  }\n\n  // merge attributes\n\n  for (const name in attributes) {\n    const mergedAttribute = mergeAttributes(attributes[name]);\n    if (!mergedAttribute) {\n      console.error('THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the ' + name + ' attribute.');\n      return null;\n    }\n    mergedGeometry.setAttribute(name, mergedAttribute);\n  }\n\n  // merge morph attributes\n\n  for (const name in morphAttributes) {\n    const numMorphTargets = morphAttributes[name][0].length;\n    if (numMorphTargets === 0) break;\n    mergedGeometry.morphAttributes = mergedGeometry.morphAttributes || {};\n    mergedGeometry.morphAttributes[name] = [];\n    for (let i = 0; i < numMorphTargets; ++i) {\n      const morphAttributesToMerge = [];\n      for (let j = 0; j < morphAttributes[name].length; ++j) {\n        morphAttributesToMerge.push(morphAttributes[name][j][i]);\n      }\n      const mergedMorphAttribute = mergeAttributes(morphAttributesToMerge);\n      if (!mergedMorphAttribute) {\n        console.error('THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the ' + name + ' morphAttribute.');\n        return null;\n      }\n      mergedGeometry.morphAttributes[name].push(mergedMorphAttribute);\n    }\n  }\n  return mergedGeometry;\n}\n\n/**\n * @param {Array<BufferAttribute>} attributes\n * @return {BufferAttribute}\n */\nfunction mergeAttributes(attributes) {\n  let TypedArray;\n  let itemSize;\n  let normalized;\n  let gpuType = -1;\n  let arrayLength = 0;\n  for (let i = 0; i < attributes.length; ++i) {\n    const attribute = attributes[i];\n    if (attribute.isInterleavedBufferAttribute) {\n      console.error('THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported.');\n      return null;\n    }\n    if (TypedArray === undefined) TypedArray = attribute.array.constructor;\n    if (TypedArray !== attribute.array.constructor) {\n      console.error('THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes.');\n      return null;\n    }\n    if (itemSize === undefined) itemSize = attribute.itemSize;\n    if (itemSize !== attribute.itemSize) {\n      console.error('THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes.');\n      return null;\n    }\n    if (normalized === undefined) normalized = attribute.normalized;\n    if (normalized !== attribute.normalized) {\n      console.error('THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes.');\n      return null;\n    }\n    if (gpuType === -1) gpuType = attribute.gpuType;\n    if (gpuType !== attribute.gpuType) {\n      console.error('THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes.');\n      return null;\n    }\n    arrayLength += attribute.array.length;\n  }\n  const array = new TypedArray(arrayLength);\n  let offset = 0;\n  for (let i = 0; i < attributes.length; ++i) {\n    array.set(attributes[i].array, offset);\n    offset += attributes[i].array.length;\n  }\n  const result = new BufferAttribute(array, itemSize, normalized);\n  if (gpuType !== undefined) {\n    result.gpuType = gpuType;\n  }\n  return result;\n}\n\n/**\n * Classic node geometry parameters\n */\n\n/**\n * Create classic node geometry\n * @param size Node size\n * @param params Geometry parameters\n * @returns Node geometry\n */ // eslint-disable-next-line max-statements\nfunction createClassicNodeGeometry(size, params) {\n  var _ref = params || {},\n    _ref$borderRadius = _ref.borderRadius,\n    borderRadius = _ref$borderRadius === void 0 ? 10 : _ref$borderRadius,\n    _ref$inputsOffset = _ref.inputsOffset,\n    inputsOffset = _ref$inputsOffset === void 0 ? 15.5 : _ref$inputsOffset,\n    _ref$outputsOffset = _ref.outputsOffset,\n    outputsOffset = _ref$outputsOffset === void 0 ? 44.5 : _ref$outputsOffset,\n    _ref$socketRadius = _ref.socketRadius,\n    socketRadius = _ref$socketRadius === void 0 ? 12.3 : _ref$socketRadius,\n    _ref$socketMargin = _ref.socketMargin,\n    socketMargin = _ref$socketMargin === void 0 ? 11.5 : _ref$socketMargin;\n  var fixWidth = size.width - 1; // hide border artifact\n  var fixHeight = size.height - 1; // hide border artifact\n  var shape = getRoundedShape(fixWidth, fixHeight, borderRadius * 1.05);\n  var geometry = new ShapeGeometry(shape);\n  var circle = new CircleGeometry(socketRadius, 16);\n  var extra = [];\n  if ('inputs' in size) {\n    var inputs = Object.entries(size.inputs).length;\n    for (var index = 0; index < inputs; index++) {\n      var geom = circle.clone();\n      var x = 1.5;\n      var y = size.height - socketRadius - inputsOffset - (socketRadius * 2 + socketMargin) * index;\n      geom.translate(x, y, 0);\n      extra.push(geom);\n    }\n  }\n  if ('outputs' in size) {\n    var outputs = Object.entries(size.outputs).length;\n    for (var _index = 0; _index < outputs; _index++) {\n      var _geom = circle.clone();\n      var _x = size.width - 1.5;\n      var _y = socketRadius + outputsOffset + (socketRadius * 2 + socketMargin) * _index;\n      _geom.translate(_x, _y, 0);\n      extra.push(_geom);\n    }\n  }\n  return mergeGeometries([].concat(extra, [geometry]));\n}\n\n/**\n * Options for node form generator\n */\n\n/**\n * Form generator for embedding nodes into 3D scene.\n * @param area Area3DPlugin instance\n * @param props Options for node form generator\n */\nfunction node(area, props) {\n  var editor = area.parentScope(NodeEditor);\n  area.addPipe(function (context) {\n    if (!context || _typeof(context) !== 'object' || !('type' in context)) return context;\n    if (context.type === 'render' && context.data.type === 'node') {\n      var id = context.data.payload.id;\n      var currentNode = editor.getNode(id);\n      var geometry = props !== null && props !== void 0 && props.customize ? props.customize(currentNode) : createClassicNodeGeometry(currentNode);\n      area.area.content.updateGeometry(context.data.element, geometry);\n    }\n    return context;\n  });\n}\n\n/**\n * Form generator for embedding rete-connection-reroute-plugin into 3D scene.\n * @param scope Area3DPlugin instance\n */\nfunction reroute(scope) {\n  if (!(scope instanceof Area3DPlugin)) throw new Error('');\n  var area = scope;\n  area.addPipe(function (context) {\n    if (!context || _typeof(context) !== 'object' || !('type' in context)) return context;\n    if (context.type === 'render' && context.data.type === 'reroute-pins') {\n      var pinGeometry = new CircleGeometry(10, 16);\n      var pins = context.data.data.pins.map(function (pin) {\n        return pinGeometry.clone().translate(pin.position.x, pin.position.y, 0);\n      });\n\n      // eslint-disable-next-line no-undefined\n      area.area.content.updateGeometry(context.data.element, pins.length ? mergeGeometries(pins) : undefined);\n    }\n    return context;\n  });\n}\n\n/**\n * Group of functions to replicate forms.\n * This extension provides a functions for generating geometry that replicates the form of HTML elements embedded in the scene.\n * @module Extensions/Forms\n */\n\nvar index$1 = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  comment: comment,\n  connection: connection,\n  createClassicConnectionGeometry: createClassicConnectionGeometry,\n  createClassicNodeGeometry: createClassicNodeGeometry,\n  node: node,\n  reroute: reroute\n});\n\n/**\n * Bounding box\n */\nvar min = function min(arr) {\n  return arr.length === 0 ? 0 : Math.min.apply(Math, _toConsumableArray(arr));\n};\nvar max = function max(arr) {\n  return arr.length === 0 ? 0 : Math.max.apply(Math, _toConsumableArray(arr));\n};\nfunction getBoundingBox$1(rects) {\n  var left = min(rects.map(function (rect) {\n    return rect.position.x;\n  }));\n  var top = min(rects.map(function (rect) {\n    return rect.position.y;\n  }));\n  var right = max(rects.map(function (rect) {\n    return rect.position.x + rect.width;\n  }));\n  var bottom = max(rects.map(function (rect) {\n    return rect.position.y + rect.height;\n  }));\n  return {\n    left: left,\n    right: right,\n    top: top,\n    bottom: bottom,\n    width: Math.abs(left - right),\n    height: Math.abs(top - bottom),\n    center: {\n      x: (left + right) / 2,\n      y: (top + bottom) / 2\n    }\n  };\n}\nfunction getNodesRect(nodes, views) {\n  return nodes.map(function (node) {\n    return {\n      view: views.get(node.id),\n      node: node\n    };\n  }).filter(function (item) {\n    return item.view;\n  }).map(function (_ref) {\n    var view = _ref.view,\n      node = _ref.node;\n    var width = node.width,\n      height = node.height;\n    if (typeof width !== 'undefined' && typeof height !== 'undefined') {\n      return {\n        position: view.position,\n        width: width,\n        height: height\n      };\n    }\n    return {\n      position: view.position,\n      width: view.element.clientWidth,\n      height: view.element.clientHeight\n    };\n  });\n}\nfunction getBoundingBox(plugin, nodes) {\n  var editor = plugin.parentScope(NodeEditor);\n  var list = nodes.map(function (node) {\n    return _typeof(node) === 'object' ? node : editor.getNode(node);\n  });\n  var rects = getNodesRect(list, plugin.nodeViews);\n  return getBoundingBox$1(rects);\n}\n\n/**\n * Parameters for `zoomAt` extension\n */\n\n/**\n * Move the camera to look at the given nodes\n * @param area The 3D area plugin\n * @param nodes The nodes to look at\n * @param params The lookAt parameters\n * @example Area3DExtensions.lookAt(area, [node1, node2])\n * @example Area3DExtensions.lookAt(area, [node1, node2], { scale: 0.8 })\n */\nfunction lookAt(area, nodes, params) {\n  var _ref = params || {},\n    _ref$scale = _ref.scale,\n    scale = _ref$scale === void 0 ? 0.9 : _ref$scale;\n  var scene = area.area.scene;\n  var camera = scene.camera,\n    orbit = scene.orbit,\n    canvases = scene.canvases;\n  var canvas = canvases.get(area);\n  var bbox = getBoundingBox(area, nodes);\n  if (!canvas) throw new Error('cannot found canvas');\n  var distance = getTargetDistance(camera, area.container, bbox, scale);\n  var target = new Vector3(bbox.center.x, bbox.center.y, 0);\n  var source = target.clone().add(new Vector3(0, 0, distance));\n  canvas.localToWorld(target);\n  canvas.localToWorld(source);\n  camera.position.copy(source);\n  orbit.target.copy(target);\n  orbit.update();\n}\nfunction getTargetDistance(camera, container, size, scale) {\n  var fov = camera.fov * (Math.PI / 180);\n  var fovh = 2 * Math.atan(Math.tan(fov / 2) * camera.aspect);\n  var dx = Math.abs(size.width / 2 / Math.tan(fovh / 2));\n  var dy = Math.abs(size.height / 2 / Math.tan(fov / 2));\n  var minDistance = Math.abs(container.clientHeight / 2 / Math.tan(fov / 2));\n  var distance = Math.max(dx, dy, minDistance);\n  return distance / scale;\n}\n\n/**\n * Area 3D extensions.\n * These extensions are specific to the 3D area and provide additional functionality, while many of rete-area-plugin's extensions are also available for this plugin.\n * @priority 7\n * @module Extensions\n */\n\nvar index = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  forms: index$1,\n  animate: animate,\n  lookAt: lookAt\n});\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n/**\n * Signal types produced by Area3DPlugin instance\n * @priority 10\n */\n/**\n * Plugin for embedding node editor into 3D scene.\n * @priority 9\n */\nvar Area3DPlugin = /*#__PURE__*/function (_BaseAreaPlugin) {\n  _inherits(Area3DPlugin, _BaseAreaPlugin);\n  var _super = _createSuper(Area3DPlugin);\n  function Area3DPlugin(argument) {\n    var _this;\n    _classCallCheck(this, Area3DPlugin);\n    _this = _super.call(this, 'area-3d');\n    /**\n     * Area instance, contains nodes, connections and other elements\n     */\n    _defineProperty(_assertThisInitialized(_this), \"nodeViews\", new Map());\n    _defineProperty(_assertThisInitialized(_this), \"connectionViews\", new Map());\n    _defineProperty(_assertThisInitialized(_this), \"elements\", new ElementsHolder());\n    _defineProperty(_assertThisInitialized(_this), \"onContextMenu\", function (event) {\n      _this.emit({\n        type: 'contextmenu',\n        data: {\n          event: event,\n          context: 'root'\n        }\n      });\n    });\n    _this.container = argument instanceof Area3DPlugin ? argument.container : argument;\n    _this.container.style.overflow = 'hidden';\n    _this.container.addEventListener('contextmenu', _this.onContextMenu);\n    _this.area = new Area(_this.container, argument instanceof Area3DPlugin ? argument.area.scene : null, _assertThisInitialized(_this), {\n      pointerDown: function pointerDown(position, event) {\n        return _this.emit({\n          type: 'pointerdown',\n          data: {\n            position: position,\n            event: event\n          }\n        });\n      },\n      pointerMove: function pointerMove(position, event) {\n        return _this.emit({\n          type: 'pointermove',\n          data: {\n            position: position,\n            event: event\n          }\n        });\n      },\n      pointerUp: function pointerUp(position, event) {\n        return _this.emit({\n          type: 'pointerup',\n          data: {\n            position: position,\n            event: event\n          }\n        });\n      },\n      resize: function resize(event) {\n        return _this.emit({\n          type: 'resized',\n          data: {\n            event: event\n          }\n        });\n      },\n      transformed: function transformed(params) {\n        return _this.emit({\n          type: 'transformed',\n          data: params\n        });\n      },\n      reordered: function reordered(element) {\n        return _this.emit({\n          type: 'reordered',\n          data: {\n            element: element\n          }\n        });\n      }\n    }, {\n      transform: function transform(params) {\n        return _this.emit({\n          type: 'transform',\n          data: params\n        });\n      }\n    });\n    _this.area.scene.addCanvasFor(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  /**\n   * Share the 3D scene with multiple instances of Area3DPlugin\n   * @returns new instance of Area3DPlugin\n   */\n  _createClass(Area3DPlugin, [{\n    key: \"share\",\n    value: function share() {\n      return new Area3DPlugin(this);\n    }\n  }, {\n    key: \"setParent\",\n    value: function setParent(scope) {\n      var _this2 = this;\n      _get(_getPrototypeOf(Area3DPlugin.prototype), \"setParent\", this).call(this, scope);\n      this.addPipe(function (context) {\n        if (!context || !(_typeof(context) === 'object' && 'type' in context)) return context;\n        if (context.type === 'nodecreated') {\n          _this2.addNodeView(context.data);\n        }\n        if (context.type === 'noderemoved') {\n          _this2.removeNodeView(context.data.id);\n        }\n        if (context.type === 'connectioncreated') {\n          _this2.addConnectionView(context.data);\n        }\n        if (context.type === 'connectionremoved') {\n          _this2.removeConnectionView(context.data.id);\n        }\n        if (context.type === 'render') {\n          _this2.elements.set(context.data);\n        }\n        if (context.type === 'unmount') {\n          _this2.elements[\"delete\"](context.data.element);\n        }\n        return context;\n      });\n    }\n  }, {\n    key: \"addNodeView\",\n    value: function addNodeView(node) {\n      var _this3 = this;\n      var id = node.id;\n      var view = new NodeView({\n        picked: function picked() {\n          return _this3.emit({\n            type: 'nodepicked',\n            data: {\n              id: id\n            }\n          });\n        },\n        translated: function translated(data) {\n          return _this3.emit({\n            type: 'nodetranslated',\n            data: _objectSpread({\n              id: id\n            }, data)\n          });\n        },\n        dragged: function dragged() {\n          return _this3.emit({\n            type: 'nodedragged',\n            data: node\n          });\n        },\n        contextmenu: function contextmenu(event) {\n          return _this3.emit({\n            type: 'contextmenu',\n            data: {\n              event: event,\n              context: node\n            }\n          });\n        },\n        resized: function resized(_ref) {\n          var size = _ref.size;\n          return _this3.emit({\n            type: 'noderesized',\n            data: {\n              id: node.id,\n              size: size\n            }\n          });\n        }\n      }, {\n        translate: function translate(data) {\n          return _this3.emit({\n            type: 'nodetranslate',\n            data: _objectSpread({\n              id: id\n            }, data)\n          });\n        },\n        resize: function resize(_ref2) {\n          var size = _ref2.size;\n          return _this3.emit({\n            type: 'noderesize',\n            data: {\n              id: node.id,\n              size: size\n            }\n          });\n        }\n      });\n      this.nodeViews.set(id, view);\n      this.area.content.add(view.element, view.object);\n      this.emit({\n        type: 'render',\n        data: {\n          element: view.element,\n          type: 'node',\n          payload: node\n        }\n      });\n      return view;\n    }\n  }, {\n    key: \"removeNodeView\",\n    value: function removeNodeView(id) {\n      var view = this.nodeViews.get(id);\n      if (view) {\n        this.emit({\n          type: 'unmount',\n          data: {\n            element: view.element\n          }\n        });\n        this.nodeViews[\"delete\"](id);\n        this.area.content.remove(view.element);\n      }\n    }\n  }, {\n    key: \"addConnectionView\",\n    value: function addConnectionView(connection) {\n      var _this4 = this;\n      var view = new ConnectionView({\n        contextmenu: function contextmenu(event) {\n          return _this4.emit({\n            type: 'contextmenu',\n            data: {\n              event: event,\n              context: connection\n            }\n          });\n        }\n      });\n      this.connectionViews.set(connection.id, view);\n      this.area.content.add(view.element, view.object);\n      this.emit({\n        type: 'render',\n        data: {\n          element: view.element,\n          type: 'connection',\n          payload: connection\n        }\n      });\n      return view;\n    }\n  }, {\n    key: \"removeConnectionView\",\n    value: function removeConnectionView(id) {\n      var view = this.connectionViews.get(id);\n      if (view) {\n        this.emit({\n          type: 'unmount',\n          data: {\n            element: view.element\n          }\n        });\n        this.connectionViews[\"delete\"](id);\n        this.area.content.remove(view.element);\n      }\n    }\n\n    /**\n     * Translate node to position\n     * @param id Node id\n     * @param position Position\n     */\n  }, {\n    key: \"translate\",\n    value: function () {\n      var _translate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(id, _ref3) {\n        var x, y, view;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              x = _ref3.x, y = _ref3.y;\n              view = this.nodeViews.get(id);\n              if (!view) {\n                _context.next = 6;\n                break;\n              }\n              _context.next = 5;\n              return view.translate(x, y);\n            case 5:\n              return _context.abrupt(\"return\", _context.sent);\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function translate(_x, _x2) {\n        return _translate.apply(this, arguments);\n      }\n      return translate;\n    }()\n    /**\n     * Resize node\n     * @param id Node id\n     * @param width Desired width\n     * @param height Desired height\n     */\n  }, {\n    key: \"resize\",\n    value: function () {\n      var _resize = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id, width, height) {\n        var view;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              view = this.nodeViews.get(id);\n              if (!view) {\n                _context2.next = 5;\n                break;\n              }\n              _context2.next = 4;\n              return view.resize(width, height);\n            case 4:\n              return _context2.abrupt(\"return\", _context2.sent);\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function resize(_x3, _x4, _x5) {\n        return _resize.apply(this, arguments);\n      }\n      return resize;\n    }()\n    /**\n     * Force update rendered element by id (node, connection, etc.)\n     * @param type Element type\n     * @param id Element id\n     * @emits render\n     */\n  }, {\n    key: \"update\",\n    value: function () {\n      var _update = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(type, id) {\n        var data;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              data = this.elements.get(type, id);\n              if (!data) {\n                _context3.next = 4;\n                break;\n              }\n              _context3.next = 4;\n              return this.emit({\n                type: 'render',\n                data: data\n              });\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function update(_x6, _x7) {\n        return _update.apply(this, arguments);\n      }\n      return update;\n    }()\n    /**\n     * Destroy all views and remove all event listeners\n     */\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      var _this5 = this;\n      this.container.removeEventListener('contextmenu', this.onContextMenu);\n      Array.from(this.connectionViews.keys()).forEach(function (id) {\n        return _this5.removeConnectionView(id);\n      });\n      Array.from(this.nodeViews.keys()).forEach(function (id) {\n        return _this5.removeNodeView(id);\n      });\n      this.area.destroy();\n    }\n  }]);\n  return Area3DPlugin;\n}(BaseAreaPlugin);\nexport { index as Area3DExtensions, Area3DPlugin };","map":{"version":3,"names":["_position","Vector3","_quaternion","Quaternion","_scale","CSS3DObject","Object3D","constructor","element","document","createElement","isCSS3DObject","style","position","pointerEvents","userSelect","setAttribute","addEventListener","traverse","object","Element","parentNode","removeChild","copy","source","recursive","cloneNode","_matrix","Matrix4","_matrix2","CSS3DRenderer","parameters","_this","_width","_height","_widthHalf","_heightHalf","cache","camera","fov","objects","WeakMap","domElement","undefined","overflow","viewElement","transformOrigin","appendChild","cameraElement","transformStyle","getSize","width","height","render","scene","projectionMatrix","elements","perspective","isPerspectiveCamera","view","enabled","transform","offsetX","offsetY","fullWidth","fullHeight","matrixWorldAutoUpdate","updateMatrixWorld","parent","tx","ty","isOrthographicCamera","right","left","top","bottom","scaleByViewOffset","cameraCSSMatrix","epsilon","getCameraCSSMatrix","matrixWorldInverse","renderObject","setSize","value","Math","abs","matrix","getObjectCSSMatrix","matrix3d","visible","layers","test","display","onBeforeRender","isCSS3DSprite","transpose","rotation2D","multiply","makeRotationZ","matrixWorld","decompose","setPosition","scale","cachedObject","get","objectData","set","onAfterRender","i","l","children","length","flipFaces","geometry","index","getIndex","numTriangles","count","a","getX","b","c","setXYZ","createMaterial","transparent","ShadowMaterial","opacity","blending","NoBlending","side","FrontSide","createBackMaterial","MeshBasicMaterial","color","BackSide","ObjectHTML","_Object3D","_inherits","_super","_createSuper$3","_classCallCheck","call","css3dObject","internalTranslate","endsWith","add","front","Mesh","back","castShadow","updateMaterials","_createClass","key","updateGeometry","scaled","clone","BufferGeometry","materials","material","findTop","sort","compareDocumentPosition","Node","DOCUMENT_POSITION_FOLLOWING","DOCUMENT_POSITION_PRECEDING","Content","scope","reordered","_scene$renderer$css3d","_defineProperty","css3dContainer","renderer","css3d","firstElementChild","HTMLElement","Error","holder","getPointerFrom","event","_this$holder$getBound","getBoundingClientRect","x","clientX","y","clientY","arguments","_reorder","_asyncToGenerator","_regeneratorRuntime","mark","_callee","target","next","wrap","_callee$","_context","prev","contains","insertBefore","stop","reorder","_x","_x2","apply","remove","raycaster","Raycaster","DragControls","_EventDispatcher","_createSuper$2","getPlane","_assertThisInitialized","Set","Vector2","updatePointer","setFromCamera","pointer","selected","ray","intersectPlane","intersection","newPosition","sub","offset","applyMatrix4","inverseMatrix","eventData","type","dispatchEvent","intersections","intersectObjects","getObjects","findIntersectedObject","invert","worldPosition","setFromMatrixPosition","stopPropagation","cursor","hovered","rect","touchAction","activate","attach","detach","onPointerMove","onPointerDown","onPointerCancel","deactivate","removeEventListener","dispose","Array","from","values","getRaycaster","findContainer","traverseAncestors","intersectedObject","includes","_this2","map","EventDispatcher","DraggableObject3D","_ObjectHTML","_createSuper$1","events","attachDraggableHooks","controls","e","start","_event$position","z","translate","drag","HybridRenderer","getDefaultCSS3DRenderer","webgl","getDefaultWebGLRenderer","fillAbsolute","getContent","WebGLRenderer","alpha","antialias","setPixelRatio","window","devicePixelRatio","setClearColor","shadowMap","PCFSoftShadowMap","el","_changeEvent","_startEvent","_endEvent","_ray","Ray","_plane","Plane","TILT_LIMIT","cos","MathUtils","DEG2RAD","OrbitControls","minDistance","maxDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","PI","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","zoomToCursor","autoRotate","autoRotateSpeed","keys","LEFT","UP","RIGHT","BOTTOM","mouseButtons","MOUSE","ROTATE","MIDDLE","DOLLY","PAN","touches","ONE","TOUCH","TWO","DOLLY_PAN","target0","position0","zoom0","zoom","_domElementKeyEvents","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","getDistance","distanceTo","listenToKeyEvents","onKeyDown","stopListenToKeyEvents","saveState","reset","updateProjectionMatrix","update","state","STATE","NONE","quat","setFromUnitVectors","up","quatInverse","lastPosition","lastQuaternion","lastTargetPosition","twoPI","deltaTime","applyQuaternion","setFromVector3","rotateLeft","getAutoRotationAngle","sphericalDelta","min","max","isFinite","makeSafe","addScaledVector","panOffset","performCursorZoom","radius","clampDistance","setFromSpherical","lookAt","multiplyScalar","zoomChanged","newRadius","prevRadius","radiusDelta","dollyDirection","mouseBefore","mouse","unproject","mouseAfter","console","warn","transformDirection","origin","direction","dot","setFromNormalAndCoplanarPoint","distanceToSquared","EPS","quaternion","onContextMenu","onPointerUp","onMouseWheel","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","pointers","pointerPositions","getZoomScale","pow","angle","rotateUp","panLeft","v","distance","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","targetDistance","tan","clientHeight","clientWidth","dollyOut","dollyScale","dollyIn","updateMouseParameters","w","h","normalize","dist","handleMouseDownRotate","handleMouseDownDolly","handleMouseDownPan","handleMouseMoveRotate","subVectors","handleMouseMoveDolly","handleMouseMovePan","handleMouseWheel","handleKeyDown","needsUpdate","code","ctrlKey","metaKey","shiftKey","preventDefault","handleTouchStartRotate","pageX","pageY","handleTouchStartPan","handleTouchStartDolly","dx","dy","sqrt","handleTouchStartDollyPan","handleTouchStartDollyRotate","handleTouchMoveRotate","getSecondPointerPosition","handleTouchMovePan","handleTouchMoveDolly","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","setPointerCapture","pointerId","addPointer","pointerType","onTouchStart","onMouseDown","onTouchMove","onMouseMove","removePointer","releasePointerCapture","mouseAction","button","trackPointer","DOLLY_ROTATE","push","splice","passive","orbitControlsRestrictor","orbit","check","updated","previous","previousTarget","rotation","_previous","p","r","t","sent","fromArray","HybridScene","container","Scene","Map","PerspectiveCamera","near","far","createOrbitControls","createDragControls","orbitChangeNumber","canvas","canvases","canvasToPlane","plane","normal","addCanvasFor","root","resize","aspect","getCanvasFor","worldToLocal","Area","guards","setPointerFrom","pointerDown","pointerMove","pointerUp","content","pointerdown","pointermove","pointerup","current","transformed","getCanvas","point","destroy","ConnectionView","contextmenu","ElementsHolder","context","payload","id","views","viewsElements","concat","_delete","_view$payload","NodeView","_ref","translation","_objectSpread$1","abrupt","data","translated","_ref2","_callee2","size","_callee2$","_context2","item","resized","_x3","_x4","picked","dragged","animate","area","tick","time","requestAnimationFrame","performance","now","getRoundedShape","shape","Shape","moveTo","lineTo","quadraticCurveTo","closePath","comment","commentScope","parentScope","Area3DPlugin","addPipe","updateCommentGeometry","comments","commentGeometry","ShapeGeometry","__commentGeometry","existing","meta","parseSvgPath","parse","m","q","s","segment","path","replace","_","command","args","toLowerCase","parseValues","unshift","number","numbers","match","Number","vec2","_function","createBezierBuilder","opt","RECURSION_LIMIT","recursion","FLT_EPSILON","PATH_DISTANCE_EPSILON","pathEpsilon","curve_angle_tolerance_epsilon","angleEpsilon","m_angle_tolerance","angleTolerance","m_cusp_limit","cuspLimit","bezierCurve","c1","c2","end","points","distanceTolerance","begin","x1","y1","x2","y2","x3","y3","x4","y4","level","pi","x12","y12","x23","y23","x34","y34","x123","y123","x234","y234","x1234","y1234","d2","d3","da1","da2","a23","atan2","adaptiveBezierCurve","absSvgPath","absolutize","startX","startY","seg","slice","toUpperCase","","_120","radians","normalizeSvgPath","result","bezierX","bezierY","quadX","quadY","len","arc","cx","cy","quadratic","line","rx","ry","large_arc_flag","sweep_flag","xy","rotate","rx2","ry2","k","f1","asin","toFixed","f2","f2old","x2old","y2old","sin","res","hx","hy","curve","rot","rad","degress","vec2Copy","out","bezier","norm","tmp1","tmp2","tmp3","bezierTo","svgPathContours","contours","svg","paths","pen","forEach","self","createClassicConnectionGeometry","segments","parse$1","_slicedToArray","flat","PlaneGeometry","prevPoint","nextPoint","vectorBetweenPoints","normalBetweenPoints","attributes","setX","setY","connection","props","renderScope","_typeof","connectionViews","_path","classicConnectionPath","customize","mergeGeometries","geometries","useGroups","isIndexed","attributesUsed","Object","morphAttributesUsed","morphAttributes","morphTargetsRelative","mergedGeometry","attributesCount","error","name","has","addGroup","indexOffset","mergedIndex","j","setIndex","mergedAttribute","mergeAttributes","numMorphTargets","morphAttributesToMerge","mergedMorphAttribute","TypedArray","itemSize","normalized","gpuType","arrayLength","attribute","isInterleavedBufferAttribute","array","BufferAttribute","createClassicNodeGeometry","params","_ref$borderRadius","borderRadius","_ref$inputsOffset","inputsOffset","_ref$outputsOffset","outputsOffset","_ref$socketRadius","socketRadius","_ref$socketMargin","socketMargin","fixWidth","fixHeight","circle","CircleGeometry","extra","inputs","entries","geom","outputs","_index","_geom","_y","node","editor","NodeEditor","currentNode","getNode","reroute","pinGeometry","pins","pin","arr","_toConsumableArray","getBoundingBox$1","rects","center","getNodesRect","nodes","filter","getBoundingBox","plugin","list","nodeViews","_ref$scale","bbox","getTargetDistance","localToWorld","fovh","atan","_BaseAreaPlugin","_createSuper","argument","emit","share","setParent","_get","_getPrototypeOf","prototype","addNodeView","removeNodeView","addConnectionView","removeConnectionView","_this3","_objectSpread","_this4","_translate","_ref3","_resize","_x5","_update","_callee3","_callee3$","_context3","_x6","_x7","_this5","BaseAreaPlugin"],"sources":["/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/node_modules/three/examples/jsm/renderers/CSS3DRenderer.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/utils/geometry.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/scene/ObjectHTML.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/content.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/scene/Drag/DragControls.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/scene/Drag/DraggableObject3D.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/scene/Drag/index.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/scene/HybridRenderer.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/node_modules/three/examples/jsm/controls/OrbitControls.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/scene/OrbitControls/index.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/scene/index.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/area.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/connection-view.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/elements-holder.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/node-view.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/extensions/animate.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/utils/shapes.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/extensions/forms/comment.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/node_modules/parse-svg-path/index.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/node_modules/adaptive-bezier-curve/function.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/node_modules/adaptive-bezier-curve/index.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/node_modules/abs-svg-path/index.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/node_modules/normalize-svg-path/index.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/node_modules/vec2-copy/index.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/node_modules/svg-path-contours/index.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/extensions/forms/connection/geometry.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/extensions/forms/connection/index.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/node_modules/three/examples/jsm/utils/BufferGeometryUtils.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/extensions/forms/node/geometry.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/extensions/forms/node/index.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/extensions/forms/reroute.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/extensions/forms/index.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/utils/bounding-box.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/utils/rects.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/extensions/bounding-box.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/extensions/lookAt.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/extensions/index.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-3d-plugin/src/index.ts"],"sourcesContent":["import {\n\tMatrix4,\n\tObject3D,\n\tQuaternion,\n\tVector3\n} from 'three';\n\n/**\n * Based on http://www.emagix.net/academic/mscs-project/item/camera-sync-with-css3-and-webgl-threejs\n */\n\nconst _position = new Vector3();\nconst _quaternion = new Quaternion();\nconst _scale = new Vector3();\n\nclass CSS3DObject extends Object3D {\n\n\tconstructor( element = document.createElement( 'div' ) ) {\n\n\t\tsuper();\n\n\t\tthis.isCSS3DObject = true;\n\n\t\tthis.element = element;\n\t\tthis.element.style.position = 'absolute';\n\t\tthis.element.style.pointerEvents = 'auto';\n\t\tthis.element.style.userSelect = 'none';\n\n\t\tthis.element.setAttribute( 'draggable', false );\n\n\t\tthis.addEventListener( 'removed', function () {\n\n\t\t\tthis.traverse( function ( object ) {\n\n\t\t\t\tif ( object.element instanceof Element && object.element.parentNode !== null ) {\n\n\t\t\t\t\tobject.element.parentNode.removeChild( object.element );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\tcopy( source, recursive ) {\n\n\t\tsuper.copy( source, recursive );\n\n\t\tthis.element = source.element.cloneNode( true );\n\n\t\treturn this;\n\n\t}\n\n}\n\nclass CSS3DSprite extends CSS3DObject {\n\n\tconstructor( element ) {\n\n\t\tsuper( element );\n\n\t\tthis.isCSS3DSprite = true;\n\n\t\tthis.rotation2D = 0;\n\n\t}\n\n\tcopy( source, recursive ) {\n\n\t\tsuper.copy( source, recursive );\n\n\t\tthis.rotation2D = source.rotation2D;\n\n\t\treturn this;\n\n\t}\n\n}\n\n//\n\nconst _matrix = new Matrix4();\nconst _matrix2 = new Matrix4();\n\nclass CSS3DRenderer {\n\n\tconstructor( parameters = {} ) {\n\n\t\tconst _this = this;\n\n\t\tlet _width, _height;\n\t\tlet _widthHalf, _heightHalf;\n\n\t\tconst cache = {\n\t\t\tcamera: { fov: 0, style: '' },\n\t\t\tobjects: new WeakMap()\n\t\t};\n\n\t\tconst domElement = parameters.element !== undefined ? parameters.element : document.createElement( 'div' );\n\n\t\tdomElement.style.overflow = 'hidden';\n\n\t\tthis.domElement = domElement;\n\n\t\tconst viewElement = document.createElement( 'div' );\n\t\tviewElement.style.transformOrigin = '0 0';\n\t\tviewElement.style.pointerEvents = 'none';\n\t\tdomElement.appendChild( viewElement );\n\n\t\tconst cameraElement = document.createElement( 'div' );\n\n\t\tcameraElement.style.transformStyle = 'preserve-3d';\n\n\t\tviewElement.appendChild( cameraElement );\n\n\t\tthis.getSize = function () {\n\n\t\t\treturn {\n\t\t\t\twidth: _width,\n\t\t\t\theight: _height\n\t\t\t};\n\n\t\t};\n\n\t\tthis.render = function ( scene, camera ) {\n\n\t\t\tconst fov = camera.projectionMatrix.elements[ 5 ] * _heightHalf;\n\n\t\t\tif ( cache.camera.fov !== fov ) {\n\n\t\t\t\tviewElement.style.perspective = camera.isPerspectiveCamera ? fov + 'px' : '';\n\t\t\t\tcache.camera.fov = fov;\n\n\t\t\t}\n\n\t\t\tif ( camera.view && camera.view.enabled ) {\n\n\t\t\t\t// view offset\n\t\t\t\tviewElement.style.transform = `translate( ${ - camera.view.offsetX * ( _width / camera.view.width ) }px, ${ - camera.view.offsetY * ( _height / camera.view.height ) }px )`;\n\n\t\t\t\t// view fullWidth and fullHeight, view width and height\n\t\t\t\tviewElement.style.transform += `scale( ${ camera.view.fullWidth / camera.view.width }, ${ camera.view.fullHeight / camera.view.height } )`;\n\n\t\t\t} else {\n\n\t\t\t\tviewElement.style.transform = '';\n\n\t\t\t}\n\n\t\t\tif ( scene.matrixWorldAutoUpdate === true ) scene.updateMatrixWorld();\n\t\t\tif ( camera.parent === null && camera.matrixWorldAutoUpdate === true ) camera.updateMatrixWorld();\n\n\t\t\tlet tx, ty;\n\n\t\t\tif ( camera.isOrthographicCamera ) {\n\n\t\t\t\ttx = - ( camera.right + camera.left ) / 2;\n\t\t\t\tty = ( camera.top + camera.bottom ) / 2;\n\n\t\t\t}\n\n\t\t\tconst scaleByViewOffset = camera.view && camera.view.enabled ? camera.view.height / camera.view.fullHeight : 1;\n\t\t\tconst cameraCSSMatrix = camera.isOrthographicCamera ?\n\t\t\t\t`scale( ${ scaleByViewOffset } )` + 'scale(' + fov + ')' + 'translate(' + epsilon( tx ) + 'px,' + epsilon( ty ) + 'px)' + getCameraCSSMatrix( camera.matrixWorldInverse ) :\n\t\t\t\t`scale( ${ scaleByViewOffset } )` + 'translateZ(' + fov + 'px)' + getCameraCSSMatrix( camera.matrixWorldInverse );\n\n\t\t\tconst style = cameraCSSMatrix +\n\t\t\t\t'translate(' + _widthHalf + 'px,' + _heightHalf + 'px)';\n\n\t\t\tif ( cache.camera.style !== style ) {\n\n\t\t\t\tcameraElement.style.transform = style;\n\n\t\t\t\tcache.camera.style = style;\n\n\t\t\t}\n\n\t\t\trenderObject( scene, scene, camera, cameraCSSMatrix );\n\n\t\t};\n\n\t\tthis.setSize = function ( width, height ) {\n\n\t\t\t_width = width;\n\t\t\t_height = height;\n\t\t\t_widthHalf = _width / 2;\n\t\t\t_heightHalf = _height / 2;\n\n\t\t\tdomElement.style.width = width + 'px';\n\t\t\tdomElement.style.height = height + 'px';\n\n\t\t\tviewElement.style.width = width + 'px';\n\t\t\tviewElement.style.height = height + 'px';\n\n\t\t\tcameraElement.style.width = width + 'px';\n\t\t\tcameraElement.style.height = height + 'px';\n\n\t\t};\n\n\t\tfunction epsilon( value ) {\n\n\t\t\treturn Math.abs( value ) < 1e-10 ? 0 : value;\n\n\t\t}\n\n\t\tfunction getCameraCSSMatrix( matrix ) {\n\n\t\t\tconst elements = matrix.elements;\n\n\t\t\treturn 'matrix3d(' +\n\t\t\t\tepsilon( elements[ 0 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 1 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 2 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 3 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 4 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 5 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 6 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 7 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 8 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 9 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 10 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 11 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 12 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 13 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 14 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 15 ] ) +\n\t\t\t')';\n\n\t\t}\n\n\t\tfunction getObjectCSSMatrix( matrix ) {\n\n\t\t\tconst elements = matrix.elements;\n\t\t\tconst matrix3d = 'matrix3d(' +\n\t\t\t\tepsilon( elements[ 0 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 1 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 2 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 3 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 4 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 5 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 6 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 7 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 8 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 9 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 10 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 11 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 12 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 13 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 14 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 15 ] ) +\n\t\t\t')';\n\n\t\t\treturn 'translate(-50%,-50%)' + matrix3d;\n\n\t\t}\n\n\t\tfunction renderObject( object, scene, camera, cameraCSSMatrix ) {\n\n\t\t\tif ( object.isCSS3DObject ) {\n\n\t\t\t\tconst visible = ( object.visible === true ) && ( object.layers.test( camera.layers ) === true );\n\t\t\t\tobject.element.style.display = ( visible === true ) ? '' : 'none';\n\n\t\t\t\tif ( visible === true ) {\n\n\t\t\t\t\tobject.onBeforeRender( _this, scene, camera );\n\n\t\t\t\t\tlet style;\n\n\t\t\t\t\tif ( object.isCSS3DSprite ) {\n\n\t\t\t\t\t\t// http://swiftcoder.wordpress.com/2008/11/25/constructing-a-billboard-matrix/\n\n\t\t\t\t\t\t_matrix.copy( camera.matrixWorldInverse );\n\t\t\t\t\t\t_matrix.transpose();\n\n\t\t\t\t\t\tif ( object.rotation2D !== 0 ) _matrix.multiply( _matrix2.makeRotationZ( object.rotation2D ) );\n\n\t\t\t\t\t\tobject.matrixWorld.decompose( _position, _quaternion, _scale );\n\t\t\t\t\t\t_matrix.setPosition( _position );\n\t\t\t\t\t\t_matrix.scale( _scale );\n\n\t\t\t\t\t\t_matrix.elements[ 3 ] = 0;\n\t\t\t\t\t\t_matrix.elements[ 7 ] = 0;\n\t\t\t\t\t\t_matrix.elements[ 11 ] = 0;\n\t\t\t\t\t\t_matrix.elements[ 15 ] = 1;\n\n\t\t\t\t\t\tstyle = getObjectCSSMatrix( _matrix );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tstyle = getObjectCSSMatrix( object.matrixWorld );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tconst element = object.element;\n\t\t\t\t\tconst cachedObject = cache.objects.get( object );\n\n\t\t\t\t\tif ( cachedObject === undefined || cachedObject.style !== style ) {\n\n\t\t\t\t\t\telement.style.transform = style;\n\n\t\t\t\t\t\tconst objectData = { style: style };\n\t\t\t\t\t\tcache.objects.set( object, objectData );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( element.parentNode !== cameraElement ) {\n\n\t\t\t\t\t\tcameraElement.appendChild( element );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tobject.onAfterRender( _this, scene, camera );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, l = object.children.length; i < l; i ++ ) {\n\n\t\t\t\trenderObject( object.children[ i ], scene, camera, cameraCSSMatrix );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\nexport { CSS3DObject, CSS3DSprite, CSS3DRenderer };\n","import { BufferGeometry } from 'three'\n\nexport function flipFaces(geometry: BufferGeometry) {\n  const index = geometry.getIndex()\n\n  if (index) {\n    const numTriangles = index.count / 3\n\n    for (let i = 0; i < numTriangles; i++) {\n      const a = index.getX(i * 3 + 2)\n      const b = index.getX(i * 3 + 1)\n      const c = index.getX(i * 3)\n\n      index.setXYZ(i * 3, a, b, c)\n    }\n  }\n}\n","import {\n  BackSide, BufferGeometry, FrontSide, Material,\n  Mesh, MeshBasicMaterial, NoBlending, Object3D, ShadowMaterial\n} from 'three'\nimport { CSS3DObject } from 'three/examples/jsm/renderers/CSS3DRenderer.js'\n\nimport { flipFaces } from '../utils/geometry'\n\nexport function createMaterial(transparent: boolean) {\n  return new ShadowMaterial({\n    transparent: true,\n    opacity: transparent ? 0.5 : 0.7,\n    blending: NoBlending,\n    side: FrontSide\n  })\n}\n\nexport function createBackMaterial() {\n  return new MeshBasicMaterial({\n    color: 0x6e88ff,\n    side: BackSide\n  })\n}\n\nexport type ObjectHTMLMaterials = {\n  front?: Material\n  back?: Material\n}\n\nexport class ObjectHTML extends Object3D {\n  css3dObject: CSS3DObject\n  front: Mesh\n  back: Mesh\n\n  constructor(element: HTMLElement) {\n    super()\n    this.css3dObject = new CSS3DObject(element)\n    this.css3dObject.onAfterRender = () => {\n      const internalTranslate = ' translate(50%, 50%)'\n\n      if (!element.style.transform.endsWith(internalTranslate)) {\n        element.style.transform += internalTranslate\n      }\n    }\n    this.add(this.css3dObject)\n\n    const front = new Mesh()\n\n    this.front = front\n    this.add(front)\n\n    const back = new Mesh()\n\n    back.castShadow = true\n    this.back = back\n    this.add(back)\n\n    this.updateMaterials()\n  }\n\n  updateGeometry(geometry?: BufferGeometry) {\n    const scaled = geometry?.clone().scale(1, -1, 1)\n\n    if (scaled) flipFaces(scaled)\n\n    if (this.front) this.front.geometry = scaled || new BufferGeometry()\n    if (this.back) this.back.geometry = scaled || new BufferGeometry()\n  }\n\n  updateMaterials(materials?: ObjectHTMLMaterials) {\n    if (this.front) this.front.material = materials?.front || createMaterial(false)\n    if (this.back) this.back.material = materials?.back || createBackMaterial()\n  }\n}\n\nexport function findTop(objects: ObjectHTML[]) {\n  objects.sort((a, b) => {\n    if (!a.css3dObject || !b.css3dObject) return 0\n    const position = a.css3dObject.element.compareDocumentPosition(b.css3dObject.element)\n\n    if (position & Node.DOCUMENT_POSITION_FOLLOWING) {\n      return 1\n    } else if (position & Node.DOCUMENT_POSITION_PRECEDING) {\n      return -1\n    }\n    return 0\n  })\n\n  return objects[0]\n}\n","import { BufferGeometry } from 'three'\n\nimport { HybridScene } from './scene'\nimport { ObjectHTML, ObjectHTMLMaterials } from './scene/ObjectHTML'\n\n/**\n * Responsible for managing 2D content in the plane of 3D scene for a current editor\n */\nexport class Content<Scope> {\n  public holder: HTMLElement\n  public objects = new WeakMap<HTMLElement, ObjectHTML>()\n\n  constructor(private scene: HybridScene<Scope>, private scope: Scope, private reordered: (target: HTMLElement) => Promise<unknown>) {\n    const css3dContainer = scene.renderer.css3d.domElement.firstElementChild?.firstElementChild\n\n    if (!css3dContainer || !(css3dContainer instanceof HTMLElement)) {\n      throw new Error('cannot find container for css3d element')\n    }\n\n    this.holder = css3dContainer\n  }\n\n  public getPointerFrom(event: MouseEvent) {\n    const { left, top } = this.holder.getBoundingClientRect()\n    const x = event.clientX - left\n    const y = event.clientY - top\n\n    return { x, y }\n  }\n\n  /**\n   * Add an HTML element to the 3D scene\n   * @param element HTML element\n   */\n  add(element: HTMLElement, object = new ObjectHTML(element)) {\n    this.objects.set(element, object)\n    this.holder.appendChild(element)\n    this.scene.add(object, this.scope)\n  }\n\n  /**\n   * Reorder the given element in the 3D scene\n   * @param target HTML element to reorder\n   * @param next HTML element to insert before\n   * @throws if `target` or `next` are not in the scene\n   */\n  // eslint-disable-next-line no-undef\n  async reorder(target: HTMLElement, next: ChildNode | null) {\n    if (!this.holder.contains(target)) {\n      throw new Error(`content doesn't have 'target' for reordering`)\n    }\n    if (next !== null && !this.holder.contains(next)) {\n      throw new Error(`content doesn't have 'next' for reordering`)\n    }\n\n    this.holder.insertBefore(target, next)\n    await this.reordered(target)\n  }\n\n  /**\n   * Remove an HTML element from the 3D scene\n   * @param element HTML element\n   */\n  remove(element: HTMLElement) {\n    const object = this.objects.get(element)\n\n    if (object) {\n      this.objects.delete(element)\n      this.scene.remove(object, this.scope)\n    }\n  }\n\n  /**\n   * Update the form (geometry) of the given element\n   */\n  updateGeometry(element: HTMLElement, geometry?: BufferGeometry | ((old?: BufferGeometry) => BufferGeometry | undefined)) {\n    const object = this.objects.get(element)\n\n    if (object) {\n      object.updateGeometry(typeof geometry === 'function' ? geometry(object.front.geometry) : geometry)\n    }\n  }\n\n  /**\n   * Update the material of the given element\n   */\n  updateMaterials(element: HTMLElement, materials?: ObjectHTMLMaterials) {\n    const object = this.objects.get(element)\n\n    if (object) object.updateMaterials(materials)\n  }\n}\n","import {\n  Camera, EventDispatcher, Intersection, Matrix4,\n  Object3D, Plane, Raycaster, Vector2, Vector3\n} from 'three'\n\nimport { findTop, ObjectHTML } from '../ObjectHTML'\n\ntype DefaultObject3D = Object3D\nexport type DragStartEvent = { type: 'dragstart', object: DefaultObject3D }\nexport type DragEvent = { type: 'drag', object: DefaultObject3D, position: Vector3 }\nexport type DragEndEvent = { type: 'dragend', object: DefaultObject3D }\n\nconst raycaster = new Raycaster()\n\n// EventDispatcher should have default generic for three 152-156 compatibility\nclass DragControls extends EventDispatcher {\n  enabled = true\n  intersections: Intersection<ObjectHTML>[] = []\n  selected: Object3D | null = null\n  hovered: Object3D | null = null\n  objects = new Set<DefaultObject3D>()\n\n  private pointer = new Vector2()\n  private offset = new Vector3()\n  private intersection = new Vector3()\n  private worldPosition = new Vector3()\n  private inverseMatrix = new Matrix4()\n\n  constructor(private camera: Camera, private domElement: HTMLElement, private getPlane: (object: Object3D) => Plane) {\n    super()\n\n    this.domElement.style.touchAction = 'none' // disable touch scroll\n    this.activate()\n  }\n\n  attach(object: Object3D) {\n    this.objects.add(object)\n  }\n\n  detach(object: Object3D) {\n    this.objects.delete(object)\n  }\n\n  activate() {\n    this.domElement.addEventListener('pointermove', this.onPointerMove)\n    this.domElement.addEventListener('pointerdown', this.onPointerDown)\n    this.domElement.addEventListener('pointerup', this.onPointerCancel)\n    this.domElement.addEventListener('pointerleave', this.onPointerCancel)\n  }\n\n  deactivate() {\n    this.domElement.removeEventListener('pointermove', this.onPointerMove)\n    this.domElement.removeEventListener('pointerdown', this.onPointerDown)\n    this.domElement.removeEventListener('pointerup', this.onPointerCancel)\n    this.domElement.removeEventListener('pointerleave', this.onPointerCancel)\n\n    this.domElement.style.cursor = ''\n  }\n\n  dispose() {\n    this.deactivate()\n  }\n\n  getObjects(): Object3D[] {\n    return Array.from(this.objects.values())\n  }\n\n  getRaycaster() {\n    return raycaster\n  }\n\n  onPointerMove = (event: PointerEvent) => {\n    if (this.enabled === false) return\n\n    this.updatePointer(event)\n\n    raycaster.setFromCamera(this.pointer, this.camera)\n\n    if (this.selected) {\n      if (raycaster.ray.intersectPlane(this.getPlane(this.selected), this.intersection)) {\n        const newPosition = this.intersection.sub(this.offset).applyMatrix4(this.inverseMatrix)\n\n        const eventData: DragEvent = { type: 'drag', object: this.selected, position: newPosition }\n\n        this.dispatchEvent(eventData as never)\n      }\n    }\n  }\n\n  findContainer(intersection: Intersection<ObjectHTML>) {\n    let object: ObjectHTML | null = null\n    const objects = this.getObjects()\n\n    intersection.object.traverseAncestors(intersectedObject => {\n      if (objects.includes(intersectedObject) && intersectedObject instanceof ObjectHTML) object = intersectedObject\n    })\n    if (!object) throw new Error('cannot find Object3D')\n\n    return object\n  }\n\n  findIntersectedObject(intersections: Intersection<ObjectHTML>[]) {\n    return findTop(intersections.map(i => this.findContainer(i)))\n  }\n\n  onPointerDown = (event: MouseEvent) => {\n    if (this.enabled === false) return\n\n    this.updatePointer(event)\n\n    this.intersections.length = 0\n\n    raycaster.setFromCamera(this.pointer, this.camera)\n    this.intersections = raycaster.intersectObjects(this.getObjects(), true)\n\n    if (this.intersections.length > 0) {\n      this.selected = this.findIntersectedObject(this.intersections) || null\n\n      if (!this.selected) return\n      if (!this.selected.parent) throw new Error('parent required for selected object')\n\n      if (raycaster.ray.intersectPlane(this.getPlane(this.selected), this.intersection)) {\n        this.inverseMatrix.copy(this.selected.parent.matrixWorld).invert()\n        this.offset.copy(this.intersection).sub(this.worldPosition.setFromMatrixPosition(this.selected.matrixWorld))\n      }\n\n      event.stopPropagation()\n      this.domElement.style.cursor = 'move'\n\n      const eventData: DragStartEvent = { type: 'dragstart', object: this.selected }\n\n      this.dispatchEvent(eventData as never)\n    }\n  }\n\n  onPointerCancel = () => {\n    if (this.enabled === false) return\n\n    if (this.selected) {\n      const eventData: DragEndEvent = { type: 'dragend', object: this.selected }\n\n      this.dispatchEvent(eventData as never)\n\n      this.selected = null\n    }\n\n    this.domElement.style.cursor = this.hovered ? 'pointer' : 'auto'\n  }\n\n  updatePointer = (event: MouseEvent) => {\n    const rect = this.domElement.getBoundingClientRect()\n\n    this.pointer.x = (event.clientX - rect.left) / rect.width * 2 - 1\n    this.pointer.y = - (event.clientY - rect.top) / rect.height * 2 + 1\n  }\n}\n\nexport { DragControls }\n","import { ObjectHTML } from '../ObjectHTML'\n\nexport class DraggableObject3D extends ObjectHTML {\n  constructor(element: HTMLElement, public events: {\n    start: () => void,\n    translate: (x: number, y: number, z: number) => void,\n    drag: () => void\n  }) {\n    super(element)\n  }\n}\n","import { DragControls, DragStartEvent, DragEvent, DragEndEvent } from './DragControls'\nimport { DraggableObject3D } from './DraggableObject3D'\n\nexport { DragControls, DraggableObject3D }\n\nexport function attachDraggableHooks(controls: DragControls) {\n  controls.addEventListener('dragstart', (e: any) => {\n    const event = e as DragStartEvent\n\n    if (event.object instanceof DraggableObject3D) {\n      event.object.events.start()\n    }\n  })\n  controls.addEventListener('drag', (e: any) => {\n    const event = e as DragEvent\n\n    if (event.object instanceof DraggableObject3D) {\n      const { x, y, z } = event.position\n\n      event.object.events.translate(x, y, z)\n    }\n  })\n  controls.addEventListener('dragend', (e: any) => {\n    const event = e as DragEndEvent\n\n    if (event.object instanceof DraggableObject3D) {\n      event.object.events.drag()\n    }\n  })\n}\n","import { Camera, PCFSoftShadowMap, Scene, WebGLRenderer } from 'three'\nimport { CSS3DRenderer } from 'three/examples/jsm/renderers/CSS3DRenderer.js'\n\n/**\n * HybridRenderer is a wrapper for Three.js CSS3DRenderer and WebGLRenderer.\n */\nexport class HybridRenderer {\n  /** CSS3DRenderer instance created by default */\n  css3d: CSS3DRenderer\n  /** WebGLRenderer instance created by default */\n  webgl: WebGLRenderer\n  domElement: HTMLElement\n\n  constructor() {\n    this.css3d = this.getDefaultCSS3DRenderer()\n    this.webgl = this.getDefaultWebGLRenderer()\n\n    this.domElement = document.createElement('div')\n\n    this.css3d.domElement.setAttribute('data-css3d', 'true')\n\n    fillAbsolute(this.domElement)\n    fillAbsolute(this.css3d.domElement)\n    fillAbsolute(this.webgl.domElement)\n\n    this.domElement.appendChild(this.css3d.domElement)\n    this.domElement.appendChild(this.webgl.domElement)\n\n    this.webgl.domElement.style.pointerEvents = 'none'\n  }\n\n  getContent() {\n    return this.webgl.domElement.firstElementChild\n  }\n\n  private getDefaultCSS3DRenderer() {\n    const css3d = new CSS3DRenderer()\n\n    return css3d\n  }\n\n  private getDefaultWebGLRenderer() {\n    const webgl = new WebGLRenderer({ alpha: false, antialias: true })\n\n    webgl.setPixelRatio(window.devicePixelRatio)\n    webgl.setClearColor(0xffffff, 0)\n    webgl.shadowMap.enabled = true\n    webgl.shadowMap.type = PCFSoftShadowMap\n\n    return webgl\n  }\n\n  setSize(width: number, height: number) {\n    this.css3d.setSize(width, height)\n    this.webgl.setSize(width, height)\n  }\n\n  render(scene: Scene, camera: Camera) {\n    this.css3d.render(scene, camera)\n    this.webgl.render(scene, camera)\n  }\n}\n\nfunction fillAbsolute(el: HTMLElement) {\n  el.style.width = '100%'\n  el.style.height = '100%'\n  el.style.position = 'absolute'\n  el.style.left = '0'\n  el.style.top = '0'\n}\n","import {\n\tEventDispatcher,\n\tMOUSE,\n\tQuaternion,\n\tSpherical,\n\tTOUCH,\n\tVector2,\n\tVector3,\n\tPlane,\n\tRay,\n\tMathUtils\n} from 'three';\n\n// OrbitControls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one-finger move\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\n\nconst _changeEvent = { type: 'change' };\nconst _startEvent = { type: 'start' };\nconst _endEvent = { type: 'end' };\nconst _ray = new Ray();\nconst _plane = new Plane();\nconst TILT_LIMIT = Math.cos( 70 * MathUtils.DEG2RAD );\n\nclass OrbitControls extends EventDispatcher {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper();\n\n\t\tthis.object = object;\n\t\tthis.domElement = domElement;\n\t\tthis.domElement.style.touchAction = 'none'; // disable touch scroll\n\n\t\t// Set to false to disable this control\n\t\tthis.enabled = true;\n\n\t\t// \"target\" sets the location of focus, where the object orbits around\n\t\tthis.target = new Vector3();\n\n\t\t// How far you can dolly in and out ( PerspectiveCamera only )\n\t\tthis.minDistance = 0;\n\t\tthis.maxDistance = Infinity;\n\n\t\t// How far you can zoom in and out ( OrthographicCamera only )\n\t\tthis.minZoom = 0;\n\t\tthis.maxZoom = Infinity;\n\n\t\t// How far you can orbit vertically, upper and lower limits.\n\t\t// Range is 0 to Math.PI radians.\n\t\tthis.minPolarAngle = 0; // radians\n\t\tthis.maxPolarAngle = Math.PI; // radians\n\n\t\t// How far you can orbit horizontally, upper and lower limits.\n\t\t// If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\n\t\tthis.minAzimuthAngle = - Infinity; // radians\n\t\tthis.maxAzimuthAngle = Infinity; // radians\n\n\t\t// Set to true to enable damping (inertia)\n\t\t// If damping is enabled, you must call controls.update() in your animation loop\n\t\tthis.enableDamping = false;\n\t\tthis.dampingFactor = 0.05;\n\n\t\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n\t\t// Set to false to disable zooming\n\t\tthis.enableZoom = true;\n\t\tthis.zoomSpeed = 1.0;\n\n\t\t// Set to false to disable rotating\n\t\tthis.enableRotate = true;\n\t\tthis.rotateSpeed = 1.0;\n\n\t\t// Set to false to disable panning\n\t\tthis.enablePan = true;\n\t\tthis.panSpeed = 1.0;\n\t\tthis.screenSpacePanning = true; // if false, pan orthogonal to world-space direction camera.up\n\t\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\t\tthis.zoomToCursor = false;\n\n\t\t// Set to true to automatically rotate around the target\n\t\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\n\t\tthis.autoRotate = false;\n\t\tthis.autoRotateSpeed = 2.0; // 30 seconds per orbit when fps is 60\n\n\t\t// The four arrow keys\n\t\tthis.keys = { LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown' };\n\n\t\t// Mouse buttons\n\t\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\n\n\t\t// Touch fingers\n\t\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\n\n\t\t// for reset\n\t\tthis.target0 = this.target.clone();\n\t\tthis.position0 = this.object.position.clone();\n\t\tthis.zoom0 = this.object.zoom;\n\n\t\t// the target DOM element for key events\n\t\tthis._domElementKeyEvents = null;\n\n\t\t//\n\t\t// public methods\n\t\t//\n\n\t\tthis.getPolarAngle = function () {\n\n\t\t\treturn spherical.phi;\n\n\t\t};\n\n\t\tthis.getAzimuthalAngle = function () {\n\n\t\t\treturn spherical.theta;\n\n\t\t};\n\n\t\tthis.getDistance = function () {\n\n\t\t\treturn this.object.position.distanceTo( this.target );\n\n\t\t};\n\n\t\tthis.listenToKeyEvents = function ( domElement ) {\n\n\t\t\tdomElement.addEventListener( 'keydown', onKeyDown );\n\t\t\tthis._domElementKeyEvents = domElement;\n\n\t\t};\n\n\t\tthis.stopListenToKeyEvents = function () {\n\n\t\t\tthis._domElementKeyEvents.removeEventListener( 'keydown', onKeyDown );\n\t\t\tthis._domElementKeyEvents = null;\n\n\t\t};\n\n\t\tthis.saveState = function () {\n\n\t\t\tscope.target0.copy( scope.target );\n\t\t\tscope.position0.copy( scope.object.position );\n\t\t\tscope.zoom0 = scope.object.zoom;\n\n\t\t};\n\n\t\tthis.reset = function () {\n\n\t\t\tscope.target.copy( scope.target0 );\n\t\t\tscope.object.position.copy( scope.position0 );\n\t\t\tscope.object.zoom = scope.zoom0;\n\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\tscope.update();\n\n\t\t\tstate = STATE.NONE;\n\n\t\t};\n\n\t\t// this method is exposed, but perhaps it would be better if we can make it private...\n\t\tthis.update = function () {\n\n\t\t\tconst offset = new Vector3();\n\n\t\t\t// so camera.up is the orbit axis\n\t\t\tconst quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\n\t\t\tconst quatInverse = quat.clone().invert();\n\n\t\t\tconst lastPosition = new Vector3();\n\t\t\tconst lastQuaternion = new Quaternion();\n\t\t\tconst lastTargetPosition = new Vector3();\n\n\t\t\tconst twoPI = 2 * Math.PI;\n\n\t\t\treturn function update( deltaTime = null ) {\n\n\t\t\t\tconst position = scope.object.position;\n\n\t\t\t\toffset.copy( position ).sub( scope.target );\n\n\t\t\t\t// rotate offset to \"y-axis-is-up\" space\n\t\t\t\toffset.applyQuaternion( quat );\n\n\t\t\t\t// angle from z-axis around y-axis\n\t\t\t\tspherical.setFromVector3( offset );\n\n\t\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\n\n\t\t\t\t\trotateLeft( getAutoRotationAngle( deltaTime ) );\n\n\t\t\t\t}\n\n\t\t\t\tif ( scope.enableDamping ) {\n\n\t\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\n\t\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tspherical.theta += sphericalDelta.theta;\n\t\t\t\t\tspherical.phi += sphericalDelta.phi;\n\n\t\t\t\t}\n\n\t\t\t\t// restrict theta to be between desired limits\n\n\t\t\t\tlet min = scope.minAzimuthAngle;\n\t\t\t\tlet max = scope.maxAzimuthAngle;\n\n\t\t\t\tif ( isFinite( min ) && isFinite( max ) ) {\n\n\t\t\t\t\tif ( min < - Math.PI ) min += twoPI; else if ( min > Math.PI ) min -= twoPI;\n\n\t\t\t\t\tif ( max < - Math.PI ) max += twoPI; else if ( max > Math.PI ) max -= twoPI;\n\n\t\t\t\t\tif ( min <= max ) {\n\n\t\t\t\t\t\tspherical.theta = Math.max( min, Math.min( max, spherical.theta ) );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tspherical.theta = ( spherical.theta > ( min + max ) / 2 ) ?\n\t\t\t\t\t\t\tMath.max( min, spherical.theta ) :\n\t\t\t\t\t\t\tMath.min( max, spherical.theta );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// restrict phi to be between desired limits\n\t\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\n\n\t\t\t\tspherical.makeSafe();\n\n\n\t\t\t\t// move target to panned location\n\n\t\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\t\tscope.target.addScaledVector( panOffset, scope.dampingFactor );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tscope.target.add( panOffset );\n\n\t\t\t\t}\n\n\t\t\t\t// adjust the camera position based on zoom only if we're not zooming to the cursor or if it's an ortho camera\n\t\t\t\t// we adjust zoom later in these cases\n\t\t\t\tif ( scope.zoomToCursor && performCursorZoom || scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\tspherical.radius = clampDistance( spherical.radius );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tspherical.radius = clampDistance( spherical.radius * scale );\n\n\t\t\t\t}\n\n\n\t\t\t\toffset.setFromSpherical( spherical );\n\n\t\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\t\t\toffset.applyQuaternion( quatInverse );\n\n\t\t\t\tposition.copy( scope.target ).add( offset );\n\n\t\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\n\t\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\n\n\t\t\t\t\tpanOffset.multiplyScalar( 1 - scope.dampingFactor );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tsphericalDelta.set( 0, 0, 0 );\n\n\t\t\t\t\tpanOffset.set( 0, 0, 0 );\n\n\t\t\t\t}\n\n\t\t\t\t// adjust camera position\n\t\t\t\tlet zoomChanged = false;\n\t\t\t\tif ( scope.zoomToCursor && performCursorZoom ) {\n\n\t\t\t\t\tlet newRadius = null;\n\t\t\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t\t// move the camera down the pointer ray\n\t\t\t\t\t\t// this method avoids floating point error\n\t\t\t\t\t\tconst prevRadius = offset.length();\n\t\t\t\t\t\tnewRadius = clampDistance( prevRadius * scale );\n\n\t\t\t\t\t\tconst radiusDelta = prevRadius - newRadius;\n\t\t\t\t\t\tscope.object.position.addScaledVector( dollyDirection, radiusDelta );\n\t\t\t\t\t\tscope.object.updateMatrixWorld();\n\n\t\t\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\t\t// adjust the ortho camera position based on zoom changes\n\t\t\t\t\t\tconst mouseBefore = new Vector3( mouse.x, mouse.y, 0 );\n\t\t\t\t\t\tmouseBefore.unproject( scope.object );\n\n\t\t\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / scale ) );\n\t\t\t\t\t\tscope.object.updateProjectionMatrix();\n\t\t\t\t\t\tzoomChanged = true;\n\n\t\t\t\t\t\tconst mouseAfter = new Vector3( mouse.x, mouse.y, 0 );\n\t\t\t\t\t\tmouseAfter.unproject( scope.object );\n\n\t\t\t\t\t\tscope.object.position.sub( mouseAfter ).add( mouseBefore );\n\t\t\t\t\t\tscope.object.updateMatrixWorld();\n\n\t\t\t\t\t\tnewRadius = offset.length();\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled.' );\n\t\t\t\t\t\tscope.zoomToCursor = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// handle the placement of the target\n\t\t\t\t\tif ( newRadius !== null ) {\n\n\t\t\t\t\t\tif ( this.screenSpacePanning ) {\n\n\t\t\t\t\t\t\t// position the orbit target in front of the new camera position\n\t\t\t\t\t\t\tscope.target.set( 0, 0, - 1 )\n\t\t\t\t\t\t\t\t.transformDirection( scope.object.matrix )\n\t\t\t\t\t\t\t\t.multiplyScalar( newRadius )\n\t\t\t\t\t\t\t\t.add( scope.object.position );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// get the ray and translation plane to compute target\n\t\t\t\t\t\t\t_ray.origin.copy( scope.object.position );\n\t\t\t\t\t\t\t_ray.direction.set( 0, 0, - 1 ).transformDirection( scope.object.matrix );\n\n\t\t\t\t\t\t\t// if the camera is 20 degrees above the horizon then don't adjust the focus target to avoid\n\t\t\t\t\t\t\t// extremely large values\n\t\t\t\t\t\t\tif ( Math.abs( scope.object.up.dot( _ray.direction ) ) < TILT_LIMIT ) {\n\n\t\t\t\t\t\t\t\tobject.lookAt( scope.target );\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t_plane.setFromNormalAndCoplanarPoint( scope.object.up, scope.target );\n\t\t\t\t\t\t\t\t_ray.intersectPlane( _plane, scope.target );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / scale ) );\n\t\t\t\t\tscope.object.updateProjectionMatrix();\n\t\t\t\t\tzoomChanged = true;\n\n\t\t\t\t}\n\n\t\t\t\tscale = 1;\n\t\t\t\tperformCursorZoom = false;\n\n\t\t\t\t// update condition is:\n\t\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\t\t\tif ( zoomChanged ||\n\t\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\n\t\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ||\n\t\t\t\t\tlastTargetPosition.distanceToSquared( scope.target ) > 0 ) {\n\n\t\t\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\t\t\tlastPosition.copy( scope.object.position );\n\t\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\n\t\t\t\t\tlastTargetPosition.copy( scope.target );\n\n\t\t\t\t\tzoomChanged = false;\n\n\t\t\t\t\treturn true;\n\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t};\n\n\t\t}();\n\n\t\tthis.dispose = function () {\n\n\t\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu );\n\n\t\t\tscope.domElement.removeEventListener( 'pointerdown', onPointerDown );\n\t\t\tscope.domElement.removeEventListener( 'pointercancel', onPointerUp );\n\t\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel );\n\n\t\t\tscope.domElement.removeEventListener( 'pointermove', onPointerMove );\n\t\t\tscope.domElement.removeEventListener( 'pointerup', onPointerUp );\n\n\n\t\t\tif ( scope._domElementKeyEvents !== null ) {\n\n\t\t\t\tscope._domElementKeyEvents.removeEventListener( 'keydown', onKeyDown );\n\t\t\t\tscope._domElementKeyEvents = null;\n\n\t\t\t}\n\n\t\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n\n\t\t};\n\n\t\t//\n\t\t// internals\n\t\t//\n\n\t\tconst scope = this;\n\n\t\tconst STATE = {\n\t\t\tNONE: - 1,\n\t\t\tROTATE: 0,\n\t\t\tDOLLY: 1,\n\t\t\tPAN: 2,\n\t\t\tTOUCH_ROTATE: 3,\n\t\t\tTOUCH_PAN: 4,\n\t\t\tTOUCH_DOLLY_PAN: 5,\n\t\t\tTOUCH_DOLLY_ROTATE: 6\n\t\t};\n\n\t\tlet state = STATE.NONE;\n\n\t\tconst EPS = 0.000001;\n\n\t\t// current position in spherical coordinates\n\t\tconst spherical = new Spherical();\n\t\tconst sphericalDelta = new Spherical();\n\n\t\tlet scale = 1;\n\t\tconst panOffset = new Vector3();\n\n\t\tconst rotateStart = new Vector2();\n\t\tconst rotateEnd = new Vector2();\n\t\tconst rotateDelta = new Vector2();\n\n\t\tconst panStart = new Vector2();\n\t\tconst panEnd = new Vector2();\n\t\tconst panDelta = new Vector2();\n\n\t\tconst dollyStart = new Vector2();\n\t\tconst dollyEnd = new Vector2();\n\t\tconst dollyDelta = new Vector2();\n\n\t\tconst dollyDirection = new Vector3();\n\t\tconst mouse = new Vector2();\n\t\tlet performCursorZoom = false;\n\n\t\tconst pointers = [];\n\t\tconst pointerPositions = {};\n\n\t\tfunction getAutoRotationAngle( deltaTime ) {\n\n\t\t\tif ( deltaTime !== null ) {\n\n\t\t\t\treturn ( 2 * Math.PI / 60 * scope.autoRotateSpeed ) * deltaTime;\n\n\t\t\t} else {\n\n\t\t\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction getZoomScale() {\n\n\t\t\treturn Math.pow( 0.95, scope.zoomSpeed );\n\n\t\t}\n\n\t\tfunction rotateLeft( angle ) {\n\n\t\t\tsphericalDelta.theta -= angle;\n\n\t\t}\n\n\t\tfunction rotateUp( angle ) {\n\n\t\t\tsphericalDelta.phi -= angle;\n\n\t\t}\n\n\t\tconst panLeft = function () {\n\n\t\t\tconst v = new Vector3();\n\n\t\t\treturn function panLeft( distance, objectMatrix ) {\n\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\n\t\t\t\tv.multiplyScalar( - distance );\n\n\t\t\t\tpanOffset.add( v );\n\n\t\t\t};\n\n\t\t}();\n\n\t\tconst panUp = function () {\n\n\t\t\tconst v = new Vector3();\n\n\t\t\treturn function panUp( distance, objectMatrix ) {\n\n\t\t\t\tif ( scope.screenSpacePanning === true ) {\n\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 1 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 );\n\t\t\t\t\tv.crossVectors( scope.object.up, v );\n\n\t\t\t\t}\n\n\t\t\t\tv.multiplyScalar( distance );\n\n\t\t\t\tpanOffset.add( v );\n\n\t\t\t};\n\n\t\t}();\n\n\t\t// deltaX and deltaY are in pixels; right and down are positive\n\t\tconst pan = function () {\n\n\t\t\tconst offset = new Vector3();\n\n\t\t\treturn function pan( deltaX, deltaY ) {\n\n\t\t\t\tconst element = scope.domElement;\n\n\t\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t// perspective\n\t\t\t\t\tconst position = scope.object.position;\n\t\t\t\t\toffset.copy( position ).sub( scope.target );\n\t\t\t\t\tlet targetDistance = offset.length();\n\n\t\t\t\t\t// half of the fov is center to top of screen\n\t\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n\t\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\n\t\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\n\t\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\n\n\t\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\t// orthographic\n\t\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\n\t\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// camera neither orthographic nor perspective\n\t\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n\t\t\t\t\tscope.enablePan = false;\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}();\n\n\t\tfunction dollyOut( dollyScale ) {\n\n\t\t\tif ( scope.object.isPerspectiveCamera || scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscale /= dollyScale;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\t\tscope.enableZoom = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction dollyIn( dollyScale ) {\n\n\t\t\tif ( scope.object.isPerspectiveCamera || scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscale *= dollyScale;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\t\tscope.enableZoom = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction updateMouseParameters( event ) {\n\n\t\t\tif ( ! scope.zoomToCursor ) {\n\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tperformCursorZoom = true;\n\n\t\t\tconst rect = scope.domElement.getBoundingClientRect();\n\t\t\tconst x = event.clientX - rect.left;\n\t\t\tconst y = event.clientY - rect.top;\n\t\t\tconst w = rect.width;\n\t\t\tconst h = rect.height;\n\n\t\t\tmouse.x = ( x / w ) * 2 - 1;\n\t\t\tmouse.y = - ( y / h ) * 2 + 1;\n\n\t\t\tdollyDirection.set( mouse.x, mouse.y, 1 ).unproject( scope.object ).sub( scope.object.position ).normalize();\n\n\t\t}\n\n\t\tfunction clampDistance( dist ) {\n\n\t\t\treturn Math.max( scope.minDistance, Math.min( scope.maxDistance, dist ) );\n\n\t\t}\n\n\t\t//\n\t\t// event callbacks - update the object state\n\t\t//\n\n\t\tfunction handleMouseDownRotate( event ) {\n\n\t\t\trotateStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseDownDolly( event ) {\n\n\t\t\tupdateMouseParameters( event );\n\t\t\tdollyStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseDownPan( event ) {\n\n\t\t\tpanStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseMoveRotate( event ) {\n\n\t\t\trotateEnd.set( event.clientX, event.clientY );\n\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\t\tconst element = scope.domElement;\n\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseMoveDolly( event ) {\n\n\t\t\tdollyEnd.set( event.clientX, event.clientY );\n\n\t\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\n\n\t\t\tif ( dollyDelta.y > 0 ) {\n\n\t\t\t\tdollyOut( getZoomScale() );\n\n\t\t\t} else if ( dollyDelta.y < 0 ) {\n\n\t\t\t\tdollyIn( getZoomScale() );\n\n\t\t\t}\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseMovePan( event ) {\n\n\t\t\tpanEnd.set( event.clientX, event.clientY );\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseWheel( event ) {\n\n\t\t\tupdateMouseParameters( event );\n\n\t\t\tif ( event.deltaY < 0 ) {\n\n\t\t\t\tdollyIn( getZoomScale() );\n\n\t\t\t} else if ( event.deltaY > 0 ) {\n\n\t\t\t\tdollyOut( getZoomScale() );\n\n\t\t\t}\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleKeyDown( event ) {\n\n\t\t\tlet needsUpdate = false;\n\n\t\t\tswitch ( event.code ) {\n\n\t\t\t\tcase scope.keys.UP:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\trotateUp( 2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tpan( 0, scope.keyPanSpeed );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.BOTTOM:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\trotateUp( - 2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tpan( 0, - scope.keyPanSpeed );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.LEFT:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\trotateLeft( 2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tpan( scope.keyPanSpeed, 0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.RIGHT:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\trotateLeft( - 2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tpan( - scope.keyPanSpeed, 0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( needsUpdate ) {\n\n\t\t\t\t// prevent the browser from scrolling on cursor keys\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tscope.update();\n\n\t\t\t}\n\n\n\t\t}\n\n\t\tfunction handleTouchStartRotate() {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\trotateStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\n\n\t\t\t\trotateStart.set( x, y );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction handleTouchStartPan() {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\tpanStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\n\n\t\t\t\tpanStart.set( x, y );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction handleTouchStartDolly() {\n\n\t\t\tconst dx = pointers[ 0 ].pageX - pointers[ 1 ].pageX;\n\t\t\tconst dy = pointers[ 0 ].pageY - pointers[ 1 ].pageY;\n\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyStart.set( 0, distance );\n\n\t\t}\n\n\t\tfunction handleTouchStartDollyPan() {\n\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\n\n\t\t\tif ( scope.enablePan ) handleTouchStartPan();\n\n\t\t}\n\n\t\tfunction handleTouchStartDollyRotate() {\n\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\n\n\t\t\tif ( scope.enableRotate ) handleTouchStartRotate();\n\n\t\t}\n\n\t\tfunction handleTouchMoveRotate( event ) {\n\n\t\t\tif ( pointers.length == 1 ) {\n\n\t\t\t\trotateEnd.set( event.pageX, event.pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\t\trotateEnd.set( x, y );\n\n\t\t\t}\n\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\t\tconst element = scope.domElement;\n\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMovePan( event ) {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\tpanEnd.set( event.pageX, event.pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\t\tpanEnd.set( x, y );\n\n\t\t\t}\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDolly( event ) {\n\n\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\tconst dx = event.pageX - position.x;\n\t\t\tconst dy = event.pageY - position.y;\n\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyEnd.set( 0, distance );\n\n\t\t\tdollyDelta.set( 0, Math.pow( dollyEnd.y / dollyStart.y, scope.zoomSpeed ) );\n\n\t\t\tdollyOut( dollyDelta.y );\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDollyPan( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\t\tif ( scope.enablePan ) handleTouchMovePan( event );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDollyRotate( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\t\tif ( scope.enableRotate ) handleTouchMoveRotate( event );\n\n\t\t}\n\n\t\t//\n\t\t// event handlers - FSM: listen for events and reset state\n\t\t//\n\n\t\tfunction onPointerDown( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( pointers.length === 0 ) {\n\n\t\t\t\tscope.domElement.setPointerCapture( event.pointerId );\n\n\t\t\t\tscope.domElement.addEventListener( 'pointermove', onPointerMove );\n\t\t\t\tscope.domElement.addEventListener( 'pointerup', onPointerUp );\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\taddPointer( event );\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchStart( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseDown( event );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerMove( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchMove( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseMove( event );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerUp( event ) {\n\n\t\t\tremovePointer( event );\n\n\t\t\tif ( pointers.length === 0 ) {\n\n\t\t\t\tscope.domElement.releasePointerCapture( event.pointerId );\n\n\t\t\t\tscope.domElement.removeEventListener( 'pointermove', onPointerMove );\n\t\t\t\tscope.domElement.removeEventListener( 'pointerup', onPointerUp );\n\n\t\t\t}\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t\tfunction onMouseDown( event ) {\n\n\t\t\tlet mouseAction;\n\n\t\t\tswitch ( event.button ) {\n\n\t\t\t\tcase 0:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.LEFT;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.MIDDLE;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.RIGHT;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tmouseAction = - 1;\n\n\t\t\t}\n\n\t\t\tswitch ( mouseAction ) {\n\n\t\t\t\tcase MOUSE.DOLLY:\n\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\thandleMouseDownDolly( event );\n\n\t\t\t\t\tstate = STATE.DOLLY;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MOUSE.ROTATE:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MOUSE.PAN:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t\tif ( state !== STATE.NONE ) {\n\n\t\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseMove( event ) {\n\n\t\t\tswitch ( state ) {\n\n\t\t\t\tcase STATE.ROTATE:\n\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleMouseMoveRotate( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.DOLLY:\n\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\thandleMouseMoveDolly( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.PAN:\n\n\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\thandleMouseMovePan( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseWheel( event ) {\n\n\t\t\tif ( scope.enabled === false || scope.enableZoom === false || state !== STATE.NONE ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\thandleMouseWheel( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t}\n\n\t\tfunction onKeyDown( event ) {\n\n\t\t\tif ( scope.enabled === false || scope.enablePan === false ) return;\n\n\t\t\thandleKeyDown( event );\n\n\t\t}\n\n\t\tfunction onTouchStart( event ) {\n\n\t\t\ttrackPointer( event );\n\n\t\t\tswitch ( pointers.length ) {\n\n\t\t\t\tcase 1:\n\n\t\t\t\t\tswitch ( scope.touches.ONE ) {\n\n\t\t\t\t\t\tcase TOUCH.ROTATE:\n\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartRotate();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase TOUCH.PAN:\n\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartPan();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\n\t\t\t\t\tswitch ( scope.touches.TWO ) {\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_PAN:\n\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartDollyPan();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\n\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartDollyRotate();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t\tif ( state !== STATE.NONE ) {\n\n\t\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onTouchMove( event ) {\n\n\t\t\ttrackPointer( event );\n\n\t\t\tswitch ( state ) {\n\n\t\t\t\tcase STATE.TOUCH_ROTATE:\n\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleTouchMoveRotate( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_PAN:\n\n\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\thandleTouchMovePan( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_PAN:\n\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\thandleTouchMoveDollyPan( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\n\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleTouchMoveDollyRotate( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onContextMenu( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t}\n\n\t\tfunction addPointer( event ) {\n\n\t\t\tpointers.push( event );\n\n\t\t}\n\n\t\tfunction removePointer( event ) {\n\n\t\t\tdelete pointerPositions[ event.pointerId ];\n\n\t\t\tfor ( let i = 0; i < pointers.length; i ++ ) {\n\n\t\t\t\tif ( pointers[ i ].pointerId == event.pointerId ) {\n\n\t\t\t\t\tpointers.splice( i, 1 );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction trackPointer( event ) {\n\n\t\t\tlet position = pointerPositions[ event.pointerId ];\n\n\t\t\tif ( position === undefined ) {\n\n\t\t\t\tposition = new Vector2();\n\t\t\t\tpointerPositions[ event.pointerId ] = position;\n\n\t\t\t}\n\n\t\t\tposition.set( event.pageX, event.pageY );\n\n\t\t}\n\n\t\tfunction getSecondPointerPosition( event ) {\n\n\t\t\tconst pointer = ( event.pointerId === pointers[ 0 ].pointerId ) ? pointers[ 1 ] : pointers[ 0 ];\n\n\t\t\treturn pointerPositions[ pointer.pointerId ];\n\n\t\t}\n\n\t\t//\n\n\t\tscope.domElement.addEventListener( 'contextmenu', onContextMenu );\n\n\t\tscope.domElement.addEventListener( 'pointerdown', onPointerDown );\n\t\tscope.domElement.addEventListener( 'pointercancel', onPointerUp );\n\t\tscope.domElement.addEventListener( 'wheel', onMouseWheel, { passive: false } );\n\n\t\t// force an update at start\n\n\t\tthis.update();\n\n\t}\n\n}\n\nexport { OrbitControls };\n","/* eslint-disable init-declarations */\nimport { Camera, Euler, Vector3 } from 'three'\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js'\n\nexport { OrbitControls }\n\nexport type Transform = { position: Vector3, rotation: Euler }\n\ntype Check = (current: Transform, previous: Transform | undefined) => Promise<boolean | unknown>\ntype Updated = (current: Transform, previous: Transform | undefined) => Promise<boolean | unknown>\n\nexport function orbitControlsRestrictor(orbit: OrbitControls, camera: Camera, check: Check, updated: Updated) {\n  let previous: Transform | undefined\n  let previousTarget: Vector3\n\n  // eslint-disable-next-line max-statements\n  orbit.addEventListener('change', async () => {\n    const position = camera.position.clone()\n    const rotation = camera.rotation.clone()\n\n    if (await check({ position, rotation }, previous)) {\n      previous = { position, rotation }\n      previousTarget = orbit.target.clone()\n    } else {\n      if (previous && previousTarget) {\n        const { position: p, rotation: r } = previous\n        const t = previousTarget\n\n        camera.position.fromArray([p.x, p.y, p.z])\n        camera.rotation.fromArray([r.x, r.y, r.z])\n        orbit.target.fromArray([t.x, t.y, t.z])\n      }\n      orbit.update()\n      await updated({ position, rotation }, previous)\n    }\n  })\n}\n","import {\n  Object3D, PerspectiveCamera, Plane,\n  Raycaster, Scene, Vector2, Vector3\n} from 'three'\n\nimport { attachDraggableHooks, DragControls, DraggableObject3D } from './Drag'\nimport { HybridRenderer } from './HybridRenderer'\nimport { OrbitControls } from './OrbitControls'\n\nexport { DraggableObject3D }\n\ntype DefaultObject3D = Object3D\n\n/**\n * HybridScene is a wrapper for Three.js Scene with some additional features such as:\n * - drag controls\n * - orbit controls\n * - camera\n * - renderer\n */\nexport class HybridScene<Scope> {\n  camera: PerspectiveCamera\n  renderer: HybridRenderer\n  root = new Scene()\n  canvases = new Map<Scope, DefaultObject3D>()\n  controls: DragControls\n  orbit: OrbitControls\n\n  constructor(private container: HTMLElement) {\n    this.camera = new PerspectiveCamera()\n    this.camera.position.set(0, 0, 1000)\n    this.camera.fov = 45\n    this.camera.near = 1\n    this.camera.far = 4000\n\n    this.renderer = new HybridRenderer()\n\n    container.appendChild(this.renderer.domElement)\n\n    this.orbit = this.createOrbitControls()\n    this.controls = this.createDragControls(this.orbit)\n  }\n\n  private createOrbitControls() {\n    const orbit = new OrbitControls(this.camera, this.renderer.domElement)\n\n    orbit.update()\n\n    let orbitChangeNumber = 0\n\n    orbit.addEventListener('start', () => {\n      orbitChangeNumber = 0\n    })\n\n    orbit.addEventListener('change', () => {\n      orbitChangeNumber++\n    })\n\n    this.renderer.domElement.addEventListener('contextmenu', e => {\n      if (orbitChangeNumber > 5) e.stopPropagation()\n    })\n\n    return orbit\n  }\n\n  private createDragControls(orbit: OrbitControls) {\n    const controls = new DragControls(\n      this.camera,\n      this.renderer.domElement,\n      (object) => {\n        const canvas = object.parent\n\n        if (!canvas) throw new Error('object doesnt have parent')\n        if (!Array.from(this.canvases.values()).includes(canvas)) throw new Error('object parent isnt canvas')\n\n        return this.canvasToPlane(canvas)\n      }\n    )\n\n    attachDraggableHooks(controls)\n\n    controls.addEventListener('dragstart', () => orbit.enabled = false)\n    controls.addEventListener('dragend', () => orbit.enabled = true)\n\n    return controls\n  }\n\n  canvasToPlane(canvas: Object3D) {\n    const plane = new Plane()\n    const normal = new Vector3(0, 0, 1)\n\n    normal.applyQuaternion(canvas.quaternion)\n    plane.setFromNormalAndCoplanarPoint(normal, canvas.position.clone())\n\n    return plane\n  }\n\n  addCanvasFor(scope: Scope) {\n    const canvas = new Object3D()\n\n    canvas.scale.set(1, -1, 1)\n    this.canvases.set(scope, canvas)\n    this.root.add(canvas)\n  }\n\n  resize(width: number, height: number) {\n    this.camera.aspect = width / height\n    this.camera.updateProjectionMatrix()\n    this.renderer.setSize(width, height)\n  }\n\n  /**\n   * Render the frame. Can be directly used instead of `animate` extension.\n   */\n  public render() {\n    this.renderer.render(this.root, this.camera)\n  }\n\n  private getCanvasFor(scope: Scope) {\n    const canvas = this.canvases.get(scope)\n\n    if (!canvas) throw new Error('cannot find canvas for the scope')\n\n    return canvas\n  }\n\n  add(object: Object3D, scope: Scope) {\n    object.scale.set(1, -1, 1)\n    this.getCanvasFor(scope).add(object)\n    if (object instanceof DraggableObject3D) this.controls.attach(object)\n    this.render() // force DOM elements to be rendered synchronously\n  }\n\n  remove(object: Object3D, scope: Scope) {\n    this.getCanvasFor(scope).remove(object)\n    if (object instanceof DraggableObject3D) this.controls.detach(object)\n    this.render() // force DOM elements to be rendered synchronously\n  }\n\n  public getPointerFrom(event: MouseEvent, scope: Scope) {\n    const rect = this.container.getBoundingClientRect()\n    const raycaster = new Raycaster()\n    const pointer = new Vector2(\n      (event.clientX - rect.left) / rect.width * 2 - 1,\n      - (event.clientY - rect.top) / rect.height * 2 + 1\n    )\n\n    raycaster.setFromCamera(pointer, this.camera)\n\n    const canvas = this.getCanvasFor(scope)\n    const plane = this.canvasToPlane(canvas)\n\n    const intersection = raycaster.ray.intersectPlane(plane, new Vector3())\n\n    if (intersection) {\n      return canvas.worldToLocal(intersection)\n    }\n    return null\n  }\n}\n","import { Object3D } from 'three'\nimport { Content } from './content'\nimport { HybridScene } from './scene'\nimport { orbitControlsRestrictor } from './scene/OrbitControls'\nimport { Position, Vector3D } from './types'\n\nexport type Transform = { position: Vector3D, rotation: Vector3D }\nexport type TransformEventParams = { previous: Transform | undefined, current: Transform }\n\ntype Events = {\n  pointerDown: (position: Position, event: PointerEvent) => void\n  pointerMove: (position: Position, event: PointerEvent) => void\n  pointerUp: (position: Position, event: PointerEvent) => void\n  resize: (event: Event) => void\n  transformed: (params: TransformEventParams) => Promise<unknown>\n  reordered: (element: HTMLElement) => Promise<unknown>\n}\ntype Guards = {\n  transform: (params: TransformEventParams) => Promise<unknown | boolean>\n}\n\n/**\n * Area class is responsible for managing 3D scene for a current editor\n */\nexport class Area<Scope> {\n  scene: HybridScene<Scope>\n  pointer: Position = { x: 0, y: 0 }\n\n  content: Content<Scope>\n\n  constructor(private container: HTMLElement, scene: HybridScene<Scope> | null, private scope: Scope, private events: Events, private guards: Guards) {\n    this.scene = scene || new HybridScene(this.container)\n    this.content = new Content(this.scene, scope, element => this.events.reordered(element))\n\n    this.container.addEventListener('pointerdown', this.pointerdown)\n    this.container.addEventListener('pointermove', this.pointermove)\n    window.addEventListener('pointerup', this.pointerup)\n    window.addEventListener('resize', this.resize)\n\n    orbitControlsRestrictor(\n      this.scene.orbit,\n      this.scene.camera,\n      (current, previous) => this.guards.transform({ previous, current }),\n      (current, previous) => this.events.transformed({ previous, current })\n    )\n\n    this.scene.resize(this.container.clientWidth, this.container.clientHeight)\n  }\n\n  /**\n   * Get the canvas in form of Object3D for the current scope\n   */\n  public getCanvas(): Object3D | undefined {\n    return this.scene.canvases.get(this.scope)\n  }\n\n  /**\n   * Set the pointer position from the given mouse event into the `pointer` property\n   */\n  public setPointerFrom(event: MouseEvent) {\n    const point = this.scene.getPointerFrom(event, this.scope)\n\n    if (point) {\n      this.pointer = {\n        x: point.x,\n        y: point.y\n      }\n    }\n  }\n\n  private pointerdown = (event: PointerEvent) => {\n    this.setPointerFrom(event)\n    this.events.pointerDown(this.pointer, event)\n  }\n\n  private pointermove = (event: PointerEvent) => {\n    this.setPointerFrom(event)\n    this.events.pointerMove(this.pointer, event)\n  }\n\n  private pointerup = (event: PointerEvent) => {\n    this.setPointerFrom(event)\n    this.events.pointerUp(this.pointer, event)\n  }\n\n  /**\n   * Force resize the container of the 3D scene\n   * @param event The resize event\n   */\n  public resize = (event: Event) => {\n    this.events.resize(event)\n    this.scene.resize(this.container.clientWidth, this.container.clientHeight)\n  }\n\n  public destroy() {\n    this.container.removeEventListener('pointerdown', this.pointerdown)\n    this.container.removeEventListener('pointermove', this.pointermove)\n    window.removeEventListener('pointerup', this.pointerup)\n    window.removeEventListener('resize', this.resize)\n  }\n}\n","import { ObjectHTML } from './scene/ObjectHTML'\n\ntype Events = {\n  contextmenu: (event: MouseEvent) => void\n}\n\nexport class ConnectionView {\n  element: HTMLElement\n  object: ObjectHTML\n\n  constructor(events: Events) {\n    this.element = document.createElement('div')\n\n    this.element.style.position = 'absolute'\n    this.element.style.left = '0'\n    this.element.style.top = '0'\n    this.element.addEventListener('contextmenu', event => events.contextmenu(event))\n\n    this.object = new ObjectHTML(this.element)\n  }\n\n  // public update(params?: HTML3DOptions) {\n  //   setHTMLElement(this.object, this.element, {\n  //     materials: {\n  //       front: params?.materials?.front || createMaterial(false),\n  //       back: params?.materials?.back || createBackMaterial()\n  //     }\n  //   })\n  // }\n}\n","\nexport class ElementsHolder<E extends HTMLElement, Ctx extends { type: string, element: E, payload?: { id: string } }> {\n  views = new WeakMap<E, Ctx>()\n  viewsElements = new Map<`${string}_${string}`, E>()\n\n  public set(context: Ctx) {\n    const { element, type, payload } = context\n\n    if (payload?.id) {\n      this.views.set(element, context)\n      this.viewsElements.set(`${type}_${payload.id}`, element)\n    }\n  }\n\n  public get(type: string, id: string) {\n    const element = this.viewsElements.get(`${type}_${id}`)\n\n    return element && this.views.get(element)\n  }\n\n  public delete(element: E) {\n    const view = this.views.get(element)\n\n    if (view && view.payload?.id) {\n      this.views.delete(element)\n      this.viewsElements.delete(`${view.type}_${view.payload.id}`)\n    }\n  }\n}\n","import { DraggableObject3D } from './scene'\nimport { ObjectHTML } from './scene/ObjectHTML'\nimport { Position, Size } from './types'\n\nexport type NodeTranslateEventParams = { position: Position, previous: Position }\nexport type NodeResizeEventParams = { size: Size }\n\ntype Events = {\n  picked: () => void\n  translated: (params: NodeTranslateEventParams) => Promise<unknown | boolean>\n  dragged: () => void\n  contextmenu: (event: MouseEvent) => void\n  resized: (params: NodeResizeEventParams) => Promise<unknown | boolean>\n}\ntype Guards = {\n  resize: (params: NodeResizeEventParams) => Promise<unknown | boolean>\n  translate: (params: NodeTranslateEventParams) => Promise<unknown | boolean>\n}\n\nexport class NodeView {\n  element: HTMLElement\n  object: ObjectHTML\n  position: Position\n\n  constructor(private events: Events, private guards: Guards) {\n    this.element = document.createElement('div')\n    this.element.style.position = 'absolute'\n    this.position = { x: 0, y: 0 }\n    this.translate(0, 0)\n\n    this.element.addEventListener('contextmenu', event => this.events.contextmenu(event))\n\n    this.object = new DraggableObject3D(this.element, {\n      start: this.events.picked,\n      translate: this.translate,\n      drag: this.events.dragged\n    })\n  }\n\n  public translate = async (x: number, y: number) => {\n    type Params = undefined | { data: NodeTranslateEventParams }\n    const previous = { ...this.position }\n    const translation = await this.guards.translate({ previous, position: { x, y } }) as Params\n\n    if (!translation) return false\n\n    this.position = { ...translation.data.position }\n    this.object.position.set(this.position.x, this.position.y, this.object.position.z)\n\n    await this.events.translated({ position: this.position, previous })\n\n    return true\n  }\n\n  public resize = async (width: number, height: number) => {\n    const size = { width, height }\n\n    if (!(await this.guards.resize({ size }))) return false\n\n    const el = this.element.children.item(0)\n\n    if (!el || !(el instanceof HTMLElement)) return false\n\n    el.style.width = `${width}px`\n    el.style.height = `${height}px`\n\n    await this.events.resized({ size })\n\n    return true\n  }\n\n  public destroy() {\n    null\n  }\n}\n","import { Area3DPlugin } from '..'\nimport { ExpectSchemes } from '../types'\n\n/**\n * Animate the given 3D scene, uses `requestAnimationFrame`\n * @param area The 3D area plugin\n * @param tick Optional callback to be called on each frame\n * @example Area3DExtensions.animate(area)\n * @example Area3DExtensions.animate(area, time => console.log(time))\n */\nexport function animate<S extends ExpectSchemes, K>(area: Area3DPlugin<S, K>, tick?: (time: number) => void) {\n  function render(time: number) {\n    if (tick) tick(time)\n\n    area.area.scene.render()\n    requestAnimationFrame((t) => render(t))\n  }\n\n  render(performance.now())\n}\n","import { Shape } from 'three'\n\n// eslint-disable-next-line max-statements\nexport function getRoundedShape(width: number, height: number, radius: number) {\n  const shape = new Shape()\n  const x = 0\n  const y = 0\n\n  shape.moveTo(x + radius, y)\n  shape.lineTo(x + width - radius, y)\n  shape.quadraticCurveTo(x + width, y, x + width, y + radius)\n  shape.lineTo(x + width, y + height - radius)\n  shape.quadraticCurveTo(x + width, y + height, x + width - radius, y + height)\n  shape.lineTo(x + radius, y + height)\n  shape.quadraticCurveTo(x, y + height, x, y + height - radius)\n  shape.lineTo(x, y + radius)\n  shape.quadraticCurveTo(x, y, x + radius, y)\n  shape.closePath()\n\n  return shape\n}\n","import { ConnectionId, NodeId, Scope, ScopeAsParameter } from 'rete'\nimport { BufferGeometry, ShapeGeometry } from 'three'\n\nimport { Area3DPlugin } from '../..'\nimport { ExpectSchemes, Position } from '../../types'\nimport { getRoundedShape } from '../../utils/shapes'\n\nexport type Pin = {\n  id: string\n  position: Position\n  selected?: boolean\n}\nexport type PinData = {\n  id: ConnectionId\n  pins: Pin[]\n}\n\ntype Comment = {\n  element: HTMLElement\n  id: string\n  width: number\n  height: number\n  x: number\n  y: number\n}\n\ntype Requires =\n  | { type: 'commentcreated', data: Comment }\n  | { type: 'commentremoved', data: Comment }\n  | { type: 'editcomment', data: Comment }\n  | { type: 'commentselected', data: Comment }\n  | { type: 'commentunselected', data: Comment }\n  | { type: 'commenttranslated', data: { id: Comment['id'], dx: number, dy: number, sources?: NodeId[] } }\n  | { type: 'commentlinktranslate', data: { id: Comment['id'], link: string } }\n\n/**\n * Form generator for embedding rete-comment-plugin into 3D scene.\n * @param scope Area3DPlugin instance\n */\nexport function comment<S extends ExpectSchemes, K>(scope: ScopeAsParameter<Scope<K, any[]>, [Requires]>) {\n  const commentScope = scope as unknown as Scope<Requires> & {\n    comments: Map<string, Comment>\n  }\n  const area = commentScope.parentScope<Area3DPlugin<S, any>>(Area3DPlugin)\n\n  commentScope.addPipe(context => {\n    if (context.type === 'commentcreated') {\n      updateCommentGeometry(area, context.data)\n    }\n    if (context.type === 'commenttranslated') {\n      const { id } = context.data\n      const c = commentScope.comments.get(id)\n\n      if (c) {\n        updateCommentGeometry(area, c)\n      }\n    }\n    return context\n  })\n}\n\ntype CommentGeometry = BufferGeometry & {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  __commentGeometry?: {\n    width: number\n    height: number\n    x: number\n    y: number\n  }\n}\n\nfunction commentGeometry(width: number, height: number, x: number, y: number) {\n  const shape = getRoundedShape(width, height, 18)\n  const geometry = new ShapeGeometry(shape) as CommentGeometry\n\n  geometry.__commentGeometry = {\n    width,\n    height,\n    x,\n    y\n  }\n\n  geometry.translate(x, y, 0)\n\n  return geometry\n}\n\nfunction updateCommentGeometry(area: Area3DPlugin<ExpectSchemes, any>, c: Comment) {\n  area.area.content.updateGeometry(c.element, existing => {\n    const meta = (existing as CommentGeometry)?.__commentGeometry\n\n    if (meta) {\n      if (meta.width !== c.width || meta.height !== c.height) {\n        return commentGeometry(c.width, c.height, c.x, c.y)\n      }\n      if (meta.x !== c.x || meta.y !== c.y) {\n        return existing?.translate(c.x - meta.x, c.y - meta.y, 0)\n      }\n    }\n    return commentGeometry(c.width, c.height, c.x, c.y)\n  })\n}\n","\nmodule.exports = parse\n\n/**\n * expected argument lengths\n * @type {Object}\n */\n\nvar length = {a: 7, c: 6, h: 1, l: 2, m: 2, q: 4, s: 4, t: 2, v: 1, z: 0}\n\n/**\n * segment pattern\n * @type {RegExp}\n */\n\nvar segment = /([astvzqmhlc])([^astvzqmhlc]*)/ig\n\n/**\n * parse an svg path data string. Generates an Array\n * of commands where each command is an Array of the\n * form `[command, arg1, arg2, ...]`\n *\n * @param {String} path\n * @return {Array}\n */\n\nfunction parse(path) {\n\tvar data = []\n\tpath.replace(segment, function(_, command, args){\n\t\tvar type = command.toLowerCase()\n\t\targs = parseValues(args)\n\n\t\t// overloaded moveTo\n\t\tif (type == 'm' && args.length > 2) {\n\t\t\tdata.push([command].concat(args.splice(0, 2)))\n\t\t\ttype = 'l'\n\t\t\tcommand = command == 'm' ? 'l' : 'L'\n\t\t}\n\n\t\twhile (true) {\n\t\t\tif (args.length == length[type]) {\n\t\t\t\targs.unshift(command)\n\t\t\t\treturn data.push(args)\n\t\t\t}\n\t\t\tif (args.length < length[type]) throw new Error('malformed path data')\n\t\t\tdata.push([command].concat(args.splice(0, length[type])))\n\t\t}\n\t})\n\treturn data\n}\n\nvar number = /-?[0-9]*\\.?[0-9]+(?:e[-+]?\\d+)?/ig\n\nfunction parseValues(args) {\n\tvar numbers = args.match(number)\n\treturn numbers ? numbers.map(Number) : []\n}\n","function clone(point) { //TODO: use gl-vec2 for this\n    return [point[0], point[1]]\n}\n\nfunction vec2(x, y) {\n    return [x, y]\n}\n\nmodule.exports = function createBezierBuilder(opt) {\n    opt = opt||{}\n\n    var RECURSION_LIMIT = typeof opt.recursion === 'number' ? opt.recursion : 8\n    var FLT_EPSILON = typeof opt.epsilon === 'number' ? opt.epsilon : 1.19209290e-7\n    var PATH_DISTANCE_EPSILON = typeof opt.pathEpsilon === 'number' ? opt.pathEpsilon : 1.0\n\n    var curve_angle_tolerance_epsilon = typeof opt.angleEpsilon === 'number' ? opt.angleEpsilon : 0.01\n    var m_angle_tolerance = opt.angleTolerance || 0\n    var m_cusp_limit = opt.cuspLimit || 0\n\n    return function bezierCurve(start, c1, c2, end, scale, points) {\n        if (!points)\n            points = []\n\n        scale = typeof scale === 'number' ? scale : 1.0\n        var distanceTolerance = PATH_DISTANCE_EPSILON / scale\n        distanceTolerance *= distanceTolerance\n        begin(start, c1, c2, end, points, distanceTolerance)\n        return points\n    }\n\n\n    ////// Based on:\n    ////// https://github.com/pelson/antigrain/blob/master/agg-2.4/src/agg_curves.cpp\n\n    function begin(start, c1, c2, end, points, distanceTolerance) {\n        points.push(clone(start))\n        var x1 = start[0],\n            y1 = start[1],\n            x2 = c1[0],\n            y2 = c1[1],\n            x3 = c2[0],\n            y3 = c2[1],\n            x4 = end[0],\n            y4 = end[1]\n        recursive(x1, y1, x2, y2, x3, y3, x4, y4, points, distanceTolerance, 0)\n        points.push(clone(end))\n    }\n\n    function recursive(x1, y1, x2, y2, x3, y3, x4, y4, points, distanceTolerance, level) {\n        if(level > RECURSION_LIMIT) \n            return\n\n        var pi = Math.PI\n\n        // Calculate all the mid-points of the line segments\n        //----------------------\n        var x12   = (x1 + x2) / 2\n        var y12   = (y1 + y2) / 2\n        var x23   = (x2 + x3) / 2\n        var y23   = (y2 + y3) / 2\n        var x34   = (x3 + x4) / 2\n        var y34   = (y3 + y4) / 2\n        var x123  = (x12 + x23) / 2\n        var y123  = (y12 + y23) / 2\n        var x234  = (x23 + x34) / 2\n        var y234  = (y23 + y34) / 2\n        var x1234 = (x123 + x234) / 2\n        var y1234 = (y123 + y234) / 2\n\n        if(level > 0) { // Enforce subdivision first time\n            // Try to approximate the full cubic curve by a single straight line\n            //------------------\n            var dx = x4-x1\n            var dy = y4-y1\n\n            var d2 = Math.abs((x2 - x4) * dy - (y2 - y4) * dx)\n            var d3 = Math.abs((x3 - x4) * dy - (y3 - y4) * dx)\n\n            var da1, da2\n\n            if(d2 > FLT_EPSILON && d3 > FLT_EPSILON) {\n                // Regular care\n                //-----------------\n                if((d2 + d3)*(d2 + d3) <= distanceTolerance * (dx*dx + dy*dy)) {\n                    // If the curvature doesn't exceed the distanceTolerance value\n                    // we tend to finish subdivisions.\n                    //----------------------\n                    if(m_angle_tolerance < curve_angle_tolerance_epsilon) {\n                        points.push(vec2(x1234, y1234))\n                        return\n                    }\n\n                    // Angle & Cusp Condition\n                    //----------------------\n                    var a23 = Math.atan2(y3 - y2, x3 - x2)\n                    da1 = Math.abs(a23 - Math.atan2(y2 - y1, x2 - x1))\n                    da2 = Math.abs(Math.atan2(y4 - y3, x4 - x3) - a23)\n                    if(da1 >= pi) da1 = 2*pi - da1\n                    if(da2 >= pi) da2 = 2*pi - da2\n\n                    if(da1 + da2 < m_angle_tolerance) {\n                        // Finally we can stop the recursion\n                        //----------------------\n                        points.push(vec2(x1234, y1234))\n                        return\n                    }\n\n                    if(m_cusp_limit !== 0.0) {\n                        if(da1 > m_cusp_limit) {\n                            points.push(vec2(x2, y2))\n                            return\n                        }\n\n                        if(da2 > m_cusp_limit) {\n                            points.push(vec2(x3, y3))\n                            return\n                        }\n                    }\n                }\n            }\n            else {\n                if(d2 > FLT_EPSILON) {\n                    // p1,p3,p4 are collinear, p2 is considerable\n                    //----------------------\n                    if(d2 * d2 <= distanceTolerance * (dx*dx + dy*dy)) {\n                        if(m_angle_tolerance < curve_angle_tolerance_epsilon) {\n                            points.push(vec2(x1234, y1234))\n                            return\n                        }\n\n                        // Angle Condition\n                        //----------------------\n                        da1 = Math.abs(Math.atan2(y3 - y2, x3 - x2) - Math.atan2(y2 - y1, x2 - x1))\n                        if(da1 >= pi) da1 = 2*pi - da1\n\n                        if(da1 < m_angle_tolerance) {\n                            points.push(vec2(x2, y2))\n                            points.push(vec2(x3, y3))\n                            return\n                        }\n\n                        if(m_cusp_limit !== 0.0) {\n                            if(da1 > m_cusp_limit) {\n                                points.push(vec2(x2, y2))\n                                return\n                            }\n                        }\n                    }\n                }\n                else if(d3 > FLT_EPSILON) {\n                    // p1,p2,p4 are collinear, p3 is considerable\n                    //----------------------\n                    if(d3 * d3 <= distanceTolerance * (dx*dx + dy*dy)) {\n                        if(m_angle_tolerance < curve_angle_tolerance_epsilon) {\n                            points.push(vec2(x1234, y1234))\n                            return\n                        }\n\n                        // Angle Condition\n                        //----------------------\n                        da1 = Math.abs(Math.atan2(y4 - y3, x4 - x3) - Math.atan2(y3 - y2, x3 - x2))\n                        if(da1 >= pi) da1 = 2*pi - da1\n\n                        if(da1 < m_angle_tolerance) {\n                            points.push(vec2(x2, y2))\n                            points.push(vec2(x3, y3))\n                            return\n                        }\n\n                        if(m_cusp_limit !== 0.0) {\n                            if(da1 > m_cusp_limit)\n                            {\n                                points.push(vec2(x3, y3))\n                                return\n                            }\n                        }\n                    }\n                }\n                else {\n                    // Collinear case\n                    //-----------------\n                    dx = x1234 - (x1 + x4) / 2\n                    dy = y1234 - (y1 + y4) / 2\n                    if(dx*dx + dy*dy <= distanceTolerance) {\n                        points.push(vec2(x1234, y1234))\n                        return\n                    }\n                }\n            }\n        }\n\n        // Continue subdivision\n        //----------------------\n        recursive(x1, y1, x12, y12, x123, y123, x1234, y1234, points, distanceTolerance, level + 1) \n        recursive(x1234, y1234, x234, y234, x34, y34, x4, y4, points, distanceTolerance, level + 1) \n    }\n}\n","module.exports = require('./function')()","\nmodule.exports = absolutize\n\n/**\n * redefine `path` with absolute coordinates\n *\n * @param {Array} path\n * @return {Array}\n */\n\nfunction absolutize(path){\n\tvar startX = 0\n\tvar startY = 0\n\tvar x = 0\n\tvar y = 0\n\n\treturn path.map(function(seg){\n\t\tseg = seg.slice()\n\t\tvar type = seg[0]\n\t\tvar command = type.toUpperCase()\n\n\t\t// is relative\n\t\tif (type != command) {\n\t\t\tseg[0] = command\n\t\t\tswitch (type) {\n\t\t\t\tcase 'a':\n\t\t\t\t\tseg[6] += x\n\t\t\t\t\tseg[7] += y\n\t\t\t\t\tbreak\n\t\t\t\tcase 'v':\n\t\t\t\t\tseg[1] += y\n\t\t\t\t\tbreak\n\t\t\t\tcase 'h':\n\t\t\t\t\tseg[1] += x\n\t\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tfor (var i = 1; i < seg.length;) {\n\t\t\t\t\t\tseg[i++] += x\n\t\t\t\t\t\tseg[i++] += y\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// update cursor state\n\t\tswitch (command) {\n\t\t\tcase 'Z':\n\t\t\t\tx = startX\n\t\t\t\ty = startY\n\t\t\t\tbreak\n\t\t\tcase 'H':\n\t\t\t\tx = seg[1]\n\t\t\t\tbreak\n\t\t\tcase 'V':\n\t\t\t\ty = seg[1]\n\t\t\t\tbreak\n\t\t\tcase 'M':\n\t\t\t\tx = startX = seg[1]\n\t\t\t\ty = startY = seg[2]\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tx = seg[seg.length - 2]\n\t\t\t\ty = seg[seg.length - 1]\n\t\t}\n\n\t\treturn seg\n\t})\n}\n","\nvar  = Math.PI\nvar _120 = radians(120)\n\nmodule.exports = normalize\n\n/**\n * describe `path` in terms of cubic bzier \n * curves and move commands\n *\n * @param {Array} path\n * @return {Array}\n */\n\nfunction normalize(path){\n\t// init state\n\tvar prev\n\tvar result = []\n\tvar bezierX = 0\n\tvar bezierY = 0\n\tvar startX = 0\n\tvar startY = 0\n\tvar quadX = null\n\tvar quadY = null\n\tvar x = 0\n\tvar y = 0\n\n\tfor (var i = 0, len = path.length; i < len; i++) {\n\t\tvar seg = path[i]\n\t\tvar command = seg[0]\n\t\tswitch (command) {\n\t\t\tcase 'M':\n\t\t\t\tstartX = seg[1]\n\t\t\t\tstartY = seg[2]\n\t\t\t\tbreak\n\t\t\tcase 'A':\n\t\t\t\tseg = arc(x, y,seg[1],seg[2],radians(seg[3]),seg[4],seg[5],seg[6],seg[7])\n\t\t\t\t// split multi part\n\t\t\t\tseg.unshift('C')\n\t\t\t\tif (seg.length > 7) {\n\t\t\t\t\tresult.push(seg.splice(0, 7))\n\t\t\t\t\tseg.unshift('C')\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase 'S':\n\t\t\t\t// default control point\n\t\t\t\tvar cx = x\n\t\t\t\tvar cy = y\n\t\t\t\tif (prev == 'C' || prev == 'S') {\n\t\t\t\t\tcx += cx - bezierX // reflect the previous command's control\n\t\t\t\t\tcy += cy - bezierY // point relative to the current point\n\t\t\t\t}\n\t\t\t\tseg = ['C', cx, cy, seg[1], seg[2], seg[3], seg[4]]\n\t\t\t\tbreak\n\t\t\tcase 'T':\n\t\t\t\tif (prev == 'Q' || prev == 'T') {\n\t\t\t\t\tquadX = x * 2 - quadX // as with 'S' reflect previous control point\n\t\t\t\t\tquadY = y * 2 - quadY\n\t\t\t\t} else {\n\t\t\t\t\tquadX = x\n\t\t\t\t\tquadY = y\n\t\t\t\t}\n\t\t\t\tseg = quadratic(x, y, quadX, quadY, seg[1], seg[2])\n\t\t\t\tbreak\n\t\t\tcase 'Q':\n\t\t\t\tquadX = seg[1]\n\t\t\t\tquadY = seg[2]\n\t\t\t\tseg = quadratic(x, y, seg[1], seg[2], seg[3], seg[4])\n\t\t\t\tbreak\n\t\t\tcase 'L':\n\t\t\t\tseg = line(x, y, seg[1], seg[2])\n\t\t\t\tbreak\n\t\t\tcase 'H':\n\t\t\t\tseg = line(x, y, seg[1], y)\n\t\t\t\tbreak\n\t\t\tcase 'V':\n\t\t\t\tseg = line(x, y, x, seg[1])\n\t\t\t\tbreak\n\t\t\tcase 'Z':\n\t\t\t\tseg = line(x, y, startX, startY)\n\t\t\t\tbreak\n\t\t}\n\n\t\t// update state\n\t\tprev = command\n\t\tx = seg[seg.length - 2]\n\t\ty = seg[seg.length - 1]\n\t\tif (seg.length > 4) {\n\t\t\tbezierX = seg[seg.length - 4]\n\t\t\tbezierY = seg[seg.length - 3]\n\t\t} else {\n\t\t\tbezierX = x\n\t\t\tbezierY = y\n\t\t}\n\t\tresult.push(seg)\n\t}\n\n\treturn result\n}\n\nfunction line(x1, y1, x2, y2){\n\treturn ['C', x1, y1, x2, y2, x2, y2]\n}\n\nfunction quadratic(x1, y1, cx, cy, x2, y2){\n\treturn [\n\t\t'C',\n\t\tx1/3 + (2/3) * cx,\n\t\ty1/3 + (2/3) * cy,\n\t\tx2/3 + (2/3) * cx,\n\t\ty2/3 + (2/3) * cy,\n\t\tx2,\n\t\ty2\n\t]\n}\n\n// This function is ripped from \n// github.com/DmitryBaranovskiy/raphael/blob/4d97d4/raphael.js#L2216-L2304 \n// which references w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\n// TODO: make it human readable\n\nfunction arc(x1, y1, rx, ry, angle, large_arc_flag, sweep_flag, x2, y2, recursive) {\n\tif (!recursive) {\n\t\tvar xy = rotate(x1, y1, -angle)\n\t\tx1 = xy.x\n\t\ty1 = xy.y\n\t\txy = rotate(x2, y2, -angle)\n\t\tx2 = xy.x\n\t\ty2 = xy.y\n\t\tvar x = (x1 - x2) / 2\n\t\tvar y = (y1 - y2) / 2\n\t\tvar h = (x * x) / (rx * rx) + (y * y) / (ry * ry)\n\t\tif (h > 1) {\n\t\t\th = Math.sqrt(h)\n\t\t\trx = h * rx\n\t\t\try = h * ry\n\t\t}\n\t\tvar rx2 = rx * rx\n\t\tvar ry2 = ry * ry\n\t\tvar k = (large_arc_flag == sweep_flag ? -1 : 1)\n\t\t\t* Math.sqrt(Math.abs((rx2 * ry2 - rx2 * y * y - ry2 * x * x) / (rx2 * y * y + ry2 * x * x)))\n\t\tif (k == Infinity) k = 1 // neutralize\n\t\tvar cx = k * rx * y / ry + (x1 + x2) / 2\n\t\tvar cy = k * -ry * x / rx + (y1 + y2) / 2\n\t\tvar f1 = Math.asin(((y1 - cy) / ry).toFixed(9))\n\t\tvar f2 = Math.asin(((y2 - cy) / ry).toFixed(9))\n\n\t\tf1 = x1 < cx ?  - f1 : f1\n\t\tf2 = x2 < cx ?  - f2 : f2\n\t\tif (f1 < 0) f1 =  * 2 + f1\n\t\tif (f2 < 0) f2 =  * 2 + f2\n\t\tif (sweep_flag && f1 > f2) f1 = f1 -  * 2\n\t\tif (!sweep_flag && f2 > f1) f2 = f2 -  * 2\n\t} else {\n\t\tf1 = recursive[0]\n\t\tf2 = recursive[1]\n\t\tcx = recursive[2]\n\t\tcy = recursive[3]\n\t}\n\t// greater than 120 degrees requires multiple segments\n\tif (Math.abs(f2 - f1) > _120) {\n\t\tvar f2old = f2\n\t\tvar x2old = x2\n\t\tvar y2old = y2\n\t\tf2 = f1 + _120 * (sweep_flag && f2 > f1 ? 1 : -1)\n\t\tx2 = cx + rx * Math.cos(f2)\n\t\ty2 = cy + ry * Math.sin(f2)\n\t\tvar res = arc(x2, y2, rx, ry, angle, 0, sweep_flag, x2old, y2old, [f2, f2old, cx, cy])\n\t}\n\tvar t = Math.tan((f2 - f1) / 4)\n\tvar hx = 4 / 3 * rx * t\n\tvar hy = 4 / 3 * ry * t\n\tvar curve = [\n\t\t2 * x1 - (x1 + hx * Math.sin(f1)),\n\t\t2 * y1 - (y1 - hy * Math.cos(f1)),\n\t\tx2 + hx * Math.sin(f2),\n\t\ty2 - hy * Math.cos(f2),\n\t\tx2,\n\t\ty2\n\t]\n\tif (recursive) return curve\n\tif (res) curve = curve.concat(res)\n\tfor (var i = 0; i < curve.length;) {\n\t\tvar rot = rotate(curve[i], curve[i+1], angle)\n\t\tcurve[i++] = rot.x\n\t\tcurve[i++] = rot.y\n\t}\n\treturn curve\n}\n\nfunction rotate(x, y, rad){\n\treturn {\n\t\tx: x * Math.cos(rad) - y * Math.sin(rad),\n\t\ty: x * Math.sin(rad) + y * Math.cos(rad)\n\t}\n}\n\nfunction radians(degress){\n\treturn degress * ( / 180)\n}\n","module.exports = function vec2Copy(out, a) {\n    out[0] = a[0]\n    out[1] = a[1]\n    return out\n}","var bezier = require('adaptive-bezier-curve')\nvar abs = require('abs-svg-path')\nvar norm = require('normalize-svg-path')\nvar copy = require('vec2-copy')\n\nfunction set(out, x, y) {\n    out[0] = x\n    out[1] = y\n    return out\n}\n\nvar tmp1 = [0,0],\n    tmp2 = [0,0],\n    tmp3 = [0,0]\n\nfunction bezierTo(points, scale, start, seg) {\n    bezier(start, \n        set(tmp1, seg[1], seg[2]), \n        set(tmp2, seg[3], seg[4]),\n        set(tmp3, seg[5], seg[6]), scale, points)\n}\n\nmodule.exports = function contours(svg, scale) {\n    var paths = []\n\n    var points = []\n    var pen = [0, 0]\n    norm(abs(svg)).forEach(function(segment, i, self) {\n        if (segment[0] === 'M') {\n            copy(pen, segment.slice(1))\n            if (points.length>0) {\n                paths.push(points)\n                points = []\n            }\n        } else if (segment[0] === 'C') {\n            bezierTo(points, scale, pen, segment)\n            set(pen, segment[5], segment[6])\n        } else {\n            throw new Error('illegal type in SVG: '+segment[0])\n        }\n    })\n    if (points.length>0)\n        paths.push(points)\n    return paths\n}","/* eslint-disable @typescript-eslint/ban-ts-comment */\n// @ts-ignore\nimport parse from 'parse-svg-path'\n// @ts-ignore\nimport contours from 'svg-path-contours'\nimport { BufferGeometry, PlaneGeometry, Vector2 } from 'three'\n\n/**\n * Create geometry for classic connection.\n * Can be used in `customize` option.\n * @param path SVG path\n * @param width Connection width\n * @returns Connection geometry\n */\n// eslint-disable-next-line max-statements\nexport function createClassicConnectionGeometry(path: string, width: number): BufferGeometry {\n  const segments = contours(parse(path)) as [number, number][][]\n  const points = segments.map(segment => segment.map(([x, y]) => ({ x, y }))).flat()\n  const geometry: BufferGeometry = new PlaneGeometry(100, 10, points.length - 1, 1)\n\n  for (let i = 0; i < points.length; i++) {\n    const normal = new Vector2(0, width / 2)\n    const point = new Vector2(points[i].x, points[i].y)\n\n    if (i > 0 && i < points.length - 1) {\n      const prevPoint = new Vector2(points[i - 1].x, points[i - 1].y)\n      const nextPoint = new Vector2(points[i + 1].x, points[i + 1].y)\n      const vectorBetweenPoints = nextPoint.clone().sub(prevPoint)\n      const normalBetweenPoints = new Vector2(-vectorBetweenPoints.y, vectorBetweenPoints.x).clone().normalize()\n\n      normal.set(normalBetweenPoints.x, normalBetweenPoints.y).multiplyScalar(width / 2)\n    }\n\n    geometry.attributes.position.setX(i, point.x + normal.x)\n    geometry.attributes.position.setY(i, point.y + normal.y)\n\n    geometry.attributes.position.setX(i + points.length, point.x - normal.x)\n    geometry.attributes.position.setY(i + points.length, point.y - normal.y)\n  }\n\n  return geometry\n}\n","import { BaseSchemes, Scope, ScopeAsParameter } from 'rete'\nimport { classicConnectionPath } from 'rete-render-utils'\nimport { BufferGeometry } from 'three'\n\nimport { Area3DPlugin } from '../../..'\nimport { ExpectSchemes } from '../../../types'\nimport { createClassicConnectionGeometry } from './geometry'\n\nexport { createClassicConnectionGeometry }\n\ntype Position = { x: number, y: number }\ntype Requires<Schemes extends BaseSchemes> =\n  | { type: 'connectionpath', data: { payload: Schemes['Connection'], path?: string, points: Position[] } }\n\n/**\n * Options for node form generator\n */\nexport type Props = {\n  /** Customize connection geometry */\n  customize?: (path: string) => BufferGeometry\n}\n\n/**\n * Form generator for embedding connections into 3D scene.\n * @param scope Area3DPlugin instance\n * @param props Options for connection form generator\n */\nexport function connection<S extends ExpectSchemes, K, E>(scope: ScopeAsParameter<Scope<K, E[]>, [Requires<S>]>, props?: Props) {\n  const renderScope = scope as Scope<Requires<S>, E[]>\n  const area = renderScope.parentScope<Area3DPlugin<S, Requires<S>>>(Area3DPlugin)\n  // const editor = area.parentScope<NodeEditor<S>>(NodeEditor)\n\n  renderScope.addPipe(context => {\n    if (!context || typeof context !== 'object' || !('type' in context)) return context\n\n    if (context.type === 'connectionpath') {\n      const { id } = context.data.payload\n      const view = area.connectionViews.get(id)\n\n      if (view) {\n        const path = context.data.path || classicConnectionPath(context.data.points as [Position, Position], 0.3)\n        const geometry = props?.customize ? props.customize(path) : createClassicConnectionGeometry(path, 4.6)\n\n        if (geometry) {\n          area.area.content.updateGeometry(view.element, geometry)\n        }\n      }\n    }\n    return context\n  })\n}\n","import {\n\tBufferAttribute,\n\tBufferGeometry,\n\tFloat32BufferAttribute,\n\tInstancedBufferAttribute,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tTrianglesDrawMode,\n\tVector3,\n} from 'three';\n\nfunction computeMikkTSpaceTangents( geometry, MikkTSpace, negateSign = true ) {\n\n\tif ( ! MikkTSpace || ! MikkTSpace.isReady ) {\n\n\t\tthrow new Error( 'BufferGeometryUtils: Initialized MikkTSpace library required.' );\n\n\t}\n\n\tif ( ! geometry.hasAttribute( 'position' ) || ! geometry.hasAttribute( 'normal' ) || ! geometry.hasAttribute( 'uv' ) ) {\n\n\t\tthrow new Error( 'BufferGeometryUtils: Tangents require \"position\", \"normal\", and \"uv\" attributes.' );\n\n\t}\n\n\tfunction getAttributeArray( attribute ) {\n\n\t\tif ( attribute.normalized || attribute.isInterleavedBufferAttribute ) {\n\n\t\t\tconst dstArray = new Float32Array( attribute.count * attribute.itemSize );\n\n\t\t\tfor ( let i = 0, j = 0; i < attribute.count; i ++ ) {\n\n\t\t\t\tdstArray[ j ++ ] = attribute.getX( i );\n\t\t\t\tdstArray[ j ++ ] = attribute.getY( i );\n\n\t\t\t\tif ( attribute.itemSize > 2 ) {\n\n\t\t\t\t\tdstArray[ j ++ ] = attribute.getZ( i );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn dstArray;\n\n\t\t}\n\n\t\tif ( attribute.array instanceof Float32Array ) {\n\n\t\t\treturn attribute.array;\n\n\t\t}\n\n\t\treturn new Float32Array( attribute.array );\n\n\t}\n\n\t// MikkTSpace algorithm requires non-indexed input.\n\n\tconst _geometry = geometry.index ? geometry.toNonIndexed() : geometry;\n\n\t// Compute vertex tangents.\n\n\tconst tangents = MikkTSpace.generateTangents(\n\n\t\tgetAttributeArray( _geometry.attributes.position ),\n\t\tgetAttributeArray( _geometry.attributes.normal ),\n\t\tgetAttributeArray( _geometry.attributes.uv )\n\n\t);\n\n\t// Texture coordinate convention of glTF differs from the apparent\n\t// default of the MikkTSpace library; .w component must be flipped.\n\n\tif ( negateSign ) {\n\n\t\tfor ( let i = 3; i < tangents.length; i += 4 ) {\n\n\t\t\ttangents[ i ] *= - 1;\n\n\t\t}\n\n\t}\n\n\t//\n\n\t_geometry.setAttribute( 'tangent', new BufferAttribute( tangents, 4 ) );\n\n\tif ( geometry !== _geometry ) {\n\n\t\tgeometry.copy( _geometry );\n\n\t}\n\n\treturn geometry;\n\n}\n\n/**\n * @param  {Array<BufferGeometry>} geometries\n * @param  {Boolean} useGroups\n * @return {BufferGeometry}\n */\nfunction mergeGeometries( geometries, useGroups = false ) {\n\n\tconst isIndexed = geometries[ 0 ].index !== null;\n\n\tconst attributesUsed = new Set( Object.keys( geometries[ 0 ].attributes ) );\n\tconst morphAttributesUsed = new Set( Object.keys( geometries[ 0 ].morphAttributes ) );\n\n\tconst attributes = {};\n\tconst morphAttributes = {};\n\n\tconst morphTargetsRelative = geometries[ 0 ].morphTargetsRelative;\n\n\tconst mergedGeometry = new BufferGeometry();\n\n\tlet offset = 0;\n\n\tfor ( let i = 0; i < geometries.length; ++ i ) {\n\n\t\tconst geometry = geometries[ i ];\n\t\tlet attributesCount = 0;\n\n\t\t// ensure that all geometries are indexed, or none\n\n\t\tif ( isIndexed !== ( geometry.index !== null ) ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// gather attributes, exit early if they're different\n\n\t\tfor ( const name in geometry.attributes ) {\n\n\t\t\tif ( ! attributesUsed.has( name ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure \"' + name + '\" attribute exists among all geometries, or in none of them.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tif ( attributes[ name ] === undefined ) attributes[ name ] = [];\n\n\t\t\tattributes[ name ].push( geometry.attributes[ name ] );\n\n\t\t\tattributesCount ++;\n\n\t\t}\n\n\t\t// ensure geometries have the same number of attributes\n\n\t\tif ( attributesCount !== attributesUsed.size ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. Make sure all geometries have the same number of attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// gather morph attributes, exit early if they're different\n\n\t\tif ( morphTargetsRelative !== geometry.morphTargetsRelative ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. .morphTargetsRelative must be consistent throughout all geometries.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tfor ( const name in geometry.morphAttributes ) {\n\n\t\t\tif ( ! morphAttributesUsed.has( name ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '.  .morphAttributes must be consistent throughout all geometries.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tif ( morphAttributes[ name ] === undefined ) morphAttributes[ name ] = [];\n\n\t\t\tmorphAttributes[ name ].push( geometry.morphAttributes[ name ] );\n\n\t\t}\n\n\t\tif ( useGroups ) {\n\n\t\t\tlet count;\n\n\t\t\tif ( isIndexed ) {\n\n\t\t\t\tcount = geometry.index.count;\n\n\t\t\t} else if ( geometry.attributes.position !== undefined ) {\n\n\t\t\t\tcount = geometry.attributes.position.count;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. The geometry must have either an index or a position attribute' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tmergedGeometry.addGroup( offset, count, i );\n\n\t\t\toffset += count;\n\n\t\t}\n\n\t}\n\n\t// merge indices\n\n\tif ( isIndexed ) {\n\n\t\tlet indexOffset = 0;\n\t\tconst mergedIndex = [];\n\n\t\tfor ( let i = 0; i < geometries.length; ++ i ) {\n\n\t\t\tconst index = geometries[ i ].index;\n\n\t\t\tfor ( let j = 0; j < index.count; ++ j ) {\n\n\t\t\t\tmergedIndex.push( index.getX( j ) + indexOffset );\n\n\t\t\t}\n\n\t\t\tindexOffset += geometries[ i ].attributes.position.count;\n\n\t\t}\n\n\t\tmergedGeometry.setIndex( mergedIndex );\n\n\t}\n\n\t// merge attributes\n\n\tfor ( const name in attributes ) {\n\n\t\tconst mergedAttribute = mergeAttributes( attributes[ name ] );\n\n\t\tif ( ! mergedAttribute ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the ' + name + ' attribute.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tmergedGeometry.setAttribute( name, mergedAttribute );\n\n\t}\n\n\t// merge morph attributes\n\n\tfor ( const name in morphAttributes ) {\n\n\t\tconst numMorphTargets = morphAttributes[ name ][ 0 ].length;\n\n\t\tif ( numMorphTargets === 0 ) break;\n\n\t\tmergedGeometry.morphAttributes = mergedGeometry.morphAttributes || {};\n\t\tmergedGeometry.morphAttributes[ name ] = [];\n\n\t\tfor ( let i = 0; i < numMorphTargets; ++ i ) {\n\n\t\t\tconst morphAttributesToMerge = [];\n\n\t\t\tfor ( let j = 0; j < morphAttributes[ name ].length; ++ j ) {\n\n\t\t\t\tmorphAttributesToMerge.push( morphAttributes[ name ][ j ][ i ] );\n\n\t\t\t}\n\n\t\t\tconst mergedMorphAttribute = mergeAttributes( morphAttributesToMerge );\n\n\t\t\tif ( ! mergedMorphAttribute ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the ' + name + ' morphAttribute.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tmergedGeometry.morphAttributes[ name ].push( mergedMorphAttribute );\n\n\t\t}\n\n\t}\n\n\treturn mergedGeometry;\n\n}\n\n/**\n * @param {Array<BufferAttribute>} attributes\n * @return {BufferAttribute}\n */\nfunction mergeAttributes( attributes ) {\n\n\tlet TypedArray;\n\tlet itemSize;\n\tlet normalized;\n\tlet gpuType = - 1;\n\tlet arrayLength = 0;\n\n\tfor ( let i = 0; i < attributes.length; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\n\t\tif ( attribute.isInterleavedBufferAttribute ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( TypedArray === undefined ) TypedArray = attribute.array.constructor;\n\t\tif ( TypedArray !== attribute.array.constructor ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( itemSize === undefined ) itemSize = attribute.itemSize;\n\t\tif ( itemSize !== attribute.itemSize ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( normalized === undefined ) normalized = attribute.normalized;\n\t\tif ( normalized !== attribute.normalized ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( gpuType === - 1 ) gpuType = attribute.gpuType;\n\t\tif ( gpuType !== attribute.gpuType ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tarrayLength += attribute.array.length;\n\n\t}\n\n\tconst array = new TypedArray( arrayLength );\n\tlet offset = 0;\n\n\tfor ( let i = 0; i < attributes.length; ++ i ) {\n\n\t\tarray.set( attributes[ i ].array, offset );\n\n\t\toffset += attributes[ i ].array.length;\n\n\t}\n\n\tconst result = new BufferAttribute( array, itemSize, normalized );\n\tif ( gpuType !== undefined ) {\n\n\t\tresult.gpuType = gpuType;\n\n\t}\n\n\treturn result;\n\n}\n\n/**\n * @param {BufferAttribute}\n * @return {BufferAttribute}\n */\nexport function deepCloneAttribute( attribute ) {\n\n\tif ( attribute.isInstancedInterleavedBufferAttribute || attribute.isInterleavedBufferAttribute ) {\n\n\t\treturn deinterleaveAttribute( attribute );\n\n\t}\n\n\tif ( attribute.isInstancedBufferAttribute ) {\n\n\t\treturn new InstancedBufferAttribute().copy( attribute );\n\n\t}\n\n\treturn new BufferAttribute().copy( attribute );\n\n}\n\n/**\n * @param {Array<BufferAttribute>} attributes\n * @return {Array<InterleavedBufferAttribute>}\n */\nfunction interleaveAttributes( attributes ) {\n\n\t// Interleaves the provided attributes into an InterleavedBuffer and returns\n\t// a set of InterleavedBufferAttributes for each attribute\n\tlet TypedArray;\n\tlet arrayLength = 0;\n\tlet stride = 0;\n\n\t// calculate the length and type of the interleavedBuffer\n\tfor ( let i = 0, l = attributes.length; i < l; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\n\t\tif ( TypedArray === undefined ) TypedArray = attribute.array.constructor;\n\t\tif ( TypedArray !== attribute.array.constructor ) {\n\n\t\t\tconsole.error( 'AttributeBuffers of different types cannot be interleaved' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tarrayLength += attribute.array.length;\n\t\tstride += attribute.itemSize;\n\n\t}\n\n\t// Create the set of buffer attributes\n\tconst interleavedBuffer = new InterleavedBuffer( new TypedArray( arrayLength ), stride );\n\tlet offset = 0;\n\tconst res = [];\n\tconst getters = [ 'getX', 'getY', 'getZ', 'getW' ];\n\tconst setters = [ 'setX', 'setY', 'setZ', 'setW' ];\n\n\tfor ( let j = 0, l = attributes.length; j < l; j ++ ) {\n\n\t\tconst attribute = attributes[ j ];\n\t\tconst itemSize = attribute.itemSize;\n\t\tconst count = attribute.count;\n\t\tconst iba = new InterleavedBufferAttribute( interleavedBuffer, itemSize, offset, attribute.normalized );\n\t\tres.push( iba );\n\n\t\toffset += itemSize;\n\n\t\t// Move the data for each attribute into the new interleavedBuffer\n\t\t// at the appropriate offset\n\t\tfor ( let c = 0; c < count; c ++ ) {\n\n\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\tiba[ setters[ k ] ]( c, attribute[ getters[ k ] ]( c ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\treturn res;\n\n}\n\n// returns a new, non-interleaved version of the provided attribute\nexport function deinterleaveAttribute( attribute ) {\n\n\tconst cons = attribute.data.array.constructor;\n\tconst count = attribute.count;\n\tconst itemSize = attribute.itemSize;\n\tconst normalized = attribute.normalized;\n\n\tconst array = new cons( count * itemSize );\n\tlet newAttribute;\n\tif ( attribute.isInstancedInterleavedBufferAttribute ) {\n\n\t\tnewAttribute = new InstancedBufferAttribute( array, itemSize, normalized, attribute.meshPerAttribute );\n\n\t} else {\n\n\t\tnewAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t}\n\n\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\tnewAttribute.setX( i, attribute.getX( i ) );\n\n\t\tif ( itemSize >= 2 ) {\n\n\t\t\tnewAttribute.setY( i, attribute.getY( i ) );\n\n\t\t}\n\n\t\tif ( itemSize >= 3 ) {\n\n\t\t\tnewAttribute.setZ( i, attribute.getZ( i ) );\n\n\t\t}\n\n\t\tif ( itemSize >= 4 ) {\n\n\t\t\tnewAttribute.setW( i, attribute.getW( i ) );\n\n\t\t}\n\n\t}\n\n\treturn newAttribute;\n\n}\n\n// deinterleaves all attributes on the geometry\nexport function deinterleaveGeometry( geometry ) {\n\n\tconst attributes = geometry.attributes;\n\tconst morphTargets = geometry.morphTargets;\n\tconst attrMap = new Map();\n\n\tfor ( const key in attributes ) {\n\n\t\tconst attr = attributes[ key ];\n\t\tif ( attr.isInterleavedBufferAttribute ) {\n\n\t\t\tif ( ! attrMap.has( attr ) ) {\n\n\t\t\t\tattrMap.set( attr, deinterleaveAttribute( attr ) );\n\n\t\t\t}\n\n\t\t\tattributes[ key ] = attrMap.get( attr );\n\n\t\t}\n\n\t}\n\n\tfor ( const key in morphTargets ) {\n\n\t\tconst attr = morphTargets[ key ];\n\t\tif ( attr.isInterleavedBufferAttribute ) {\n\n\t\t\tif ( ! attrMap.has( attr ) ) {\n\n\t\t\t\tattrMap.set( attr, deinterleaveAttribute( attr ) );\n\n\t\t\t}\n\n\t\t\tmorphTargets[ key ] = attrMap.get( attr );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * @param {Array<BufferGeometry>} geometry\n * @return {number}\n */\nfunction estimateBytesUsed( geometry ) {\n\n\t// Return the estimated memory used by this geometry in bytes\n\t// Calculate using itemSize, count, and BYTES_PER_ELEMENT to account\n\t// for InterleavedBufferAttributes.\n\tlet mem = 0;\n\tfor ( const name in geometry.attributes ) {\n\n\t\tconst attr = geometry.getAttribute( name );\n\t\tmem += attr.count * attr.itemSize * attr.array.BYTES_PER_ELEMENT;\n\n\t}\n\n\tconst indices = geometry.getIndex();\n\tmem += indices ? indices.count * indices.itemSize * indices.array.BYTES_PER_ELEMENT : 0;\n\treturn mem;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {number} tolerance\n * @return {BufferGeometry}\n */\nfunction mergeVertices( geometry, tolerance = 1e-4 ) {\n\n\ttolerance = Math.max( tolerance, Number.EPSILON );\n\n\t// Generate an index buffer if the geometry doesn't have one, or optimize it\n\t// if it's already available.\n\tconst hashToIndex = {};\n\tconst indices = geometry.getIndex();\n\tconst positions = geometry.getAttribute( 'position' );\n\tconst vertexCount = indices ? indices.count : positions.count;\n\n\t// next value for triangle indices\n\tlet nextIndex = 0;\n\n\t// attributes and new attribute arrays\n\tconst attributeNames = Object.keys( geometry.attributes );\n\tconst tmpAttributes = {};\n\tconst tmpMorphAttributes = {};\n\tconst newIndices = [];\n\tconst getters = [ 'getX', 'getY', 'getZ', 'getW' ];\n\tconst setters = [ 'setX', 'setY', 'setZ', 'setW' ];\n\n\t// Initialize the arrays, allocating space conservatively. Extra\n\t// space will be trimmed in the last step.\n\tfor ( let i = 0, l = attributeNames.length; i < l; i ++ ) {\n\n\t\tconst name = attributeNames[ i ];\n\t\tconst attr = geometry.attributes[ name ];\n\n\t\ttmpAttributes[ name ] = new BufferAttribute(\n\t\t\tnew attr.array.constructor( attr.count * attr.itemSize ),\n\t\t\tattr.itemSize,\n\t\t\tattr.normalized\n\t\t);\n\n\t\tconst morphAttr = geometry.morphAttributes[ name ];\n\t\tif ( morphAttr ) {\n\n\t\t\ttmpMorphAttributes[ name ] = new BufferAttribute(\n\t\t\t\tnew morphAttr.array.constructor( morphAttr.count * morphAttr.itemSize ),\n\t\t\t\tmorphAttr.itemSize,\n\t\t\t\tmorphAttr.normalized\n\t\t\t);\n\n\t\t}\n\n\t}\n\n\t// convert the error tolerance to an amount of decimal places to truncate to\n\tconst decimalShift = Math.log10( 1 / tolerance );\n\tconst shiftMultiplier = Math.pow( 10, decimalShift );\n\tfor ( let i = 0; i < vertexCount; i ++ ) {\n\n\t\tconst index = indices ? indices.getX( i ) : i;\n\n\t\t// Generate a hash for the vertex attributes at the current index 'i'\n\t\tlet hash = '';\n\t\tfor ( let j = 0, l = attributeNames.length; j < l; j ++ ) {\n\n\t\t\tconst name = attributeNames[ j ];\n\t\t\tconst attribute = geometry.getAttribute( name );\n\t\t\tconst itemSize = attribute.itemSize;\n\n\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\t// double tilde truncates the decimal value\n\t\t\t\thash += `${ ~ ~ ( attribute[ getters[ k ] ]( index ) * shiftMultiplier ) },`;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Add another reference to the vertex if it's already\n\t\t// used by another index\n\t\tif ( hash in hashToIndex ) {\n\n\t\t\tnewIndices.push( hashToIndex[ hash ] );\n\n\t\t} else {\n\n\t\t\t// copy data to the new index in the temporary attributes\n\t\t\tfor ( let j = 0, l = attributeNames.length; j < l; j ++ ) {\n\n\t\t\t\tconst name = attributeNames[ j ];\n\t\t\t\tconst attribute = geometry.getAttribute( name );\n\t\t\t\tconst morphAttr = geometry.morphAttributes[ name ];\n\t\t\t\tconst itemSize = attribute.itemSize;\n\t\t\t\tconst newarray = tmpAttributes[ name ];\n\t\t\t\tconst newMorphArrays = tmpMorphAttributes[ name ];\n\n\t\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\t\tconst getterFunc = getters[ k ];\n\t\t\t\t\tconst setterFunc = setters[ k ];\n\t\t\t\t\tnewarray[ setterFunc ]( nextIndex, attribute[ getterFunc ]( index ) );\n\n\t\t\t\t\tif ( morphAttr ) {\n\n\t\t\t\t\t\tfor ( let m = 0, ml = morphAttr.length; m < ml; m ++ ) {\n\n\t\t\t\t\t\t\tnewMorphArrays[ m ][ setterFunc ]( nextIndex, morphAttr[ m ][ getterFunc ]( index ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\thashToIndex[ hash ] = nextIndex;\n\t\t\tnewIndices.push( nextIndex );\n\t\t\tnextIndex ++;\n\n\t\t}\n\n\t}\n\n\t// generate result BufferGeometry\n\tconst result = geometry.clone();\n\tfor ( const name in geometry.attributes ) {\n\n\t\tconst tmpAttribute = tmpAttributes[ name ];\n\n\t\tresult.setAttribute( name, new BufferAttribute(\n\t\t\ttmpAttribute.array.slice( 0, nextIndex * tmpAttribute.itemSize ),\n\t\t\ttmpAttribute.itemSize,\n\t\t\ttmpAttribute.normalized,\n\t\t) );\n\n\t\tif ( ! ( name in tmpMorphAttributes ) ) continue;\n\n\t\tfor ( let j = 0; j < tmpMorphAttributes[ name ].length; j ++ ) {\n\n\t\t\tconst tmpMorphAttribute = tmpMorphAttributes[ name ][ j ];\n\n\t\t\tresult.morphAttributes[ name ][ j ] = new BufferAttribute(\n\t\t\t\ttmpMorphAttribute.array.slice( 0, nextIndex * tmpMorphAttribute.itemSize ),\n\t\t\t\ttmpMorphAttribute.itemSize,\n\t\t\t\ttmpMorphAttribute.normalized,\n\t\t\t);\n\n\t\t}\n\n\t}\n\n\t// indices\n\n\tresult.setIndex( newIndices );\n\n\treturn result;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {number} drawMode\n * @return {BufferGeometry}\n */\nfunction toTrianglesDrawMode( geometry, drawMode ) {\n\n\tif ( drawMode === TrianglesDrawMode ) {\n\n\t\tconsole.warn( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles.' );\n\t\treturn geometry;\n\n\t}\n\n\tif ( drawMode === TriangleFanDrawMode || drawMode === TriangleStripDrawMode ) {\n\n\t\tlet index = geometry.getIndex();\n\n\t\t// generate index if not present\n\n\t\tif ( index === null ) {\n\n\t\t\tconst indices = [];\n\n\t\t\tconst position = geometry.getAttribute( 'position' );\n\n\t\t\tif ( position !== undefined ) {\n\n\t\t\t\tfor ( let i = 0; i < position.count; i ++ ) {\n\n\t\t\t\t\tindices.push( i );\n\n\t\t\t\t}\n\n\t\t\t\tgeometry.setIndex( indices );\n\t\t\t\tindex = geometry.getIndex();\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );\n\t\t\t\treturn geometry;\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\n\t\tconst numberOfTriangles = index.count - 2;\n\t\tconst newIndices = [];\n\n\t\tif ( drawMode === TriangleFanDrawMode ) {\n\n\t\t\t// gl.TRIANGLE_FAN\n\n\t\t\tfor ( let i = 1; i <= numberOfTriangles; i ++ ) {\n\n\t\t\t\tnewIndices.push( index.getX( 0 ) );\n\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\t// gl.TRIANGLE_STRIP\n\n\t\t\tfor ( let i = 0; i < numberOfTriangles; i ++ ) {\n\n\t\t\t\tif ( i % 2 === 0 ) {\n\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( ( newIndices.length / 3 ) !== numberOfTriangles ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );\n\n\t\t}\n\n\t\t// build final geometry\n\n\t\tconst newGeometry = geometry.clone();\n\t\tnewGeometry.setIndex( newIndices );\n\t\tnewGeometry.clearGroups();\n\n\t\treturn newGeometry;\n\n\t} else {\n\n\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:', drawMode );\n\t\treturn geometry;\n\n\t}\n\n}\n\n/**\n * Calculates the morphed attributes of a morphed/skinned BufferGeometry.\n * Helpful for Raytracing or Decals.\n * @param {Mesh | Line | Points} object An instance of Mesh, Line or Points.\n * @return {Object} An Object with original position/normal attributes and morphed ones.\n */\nfunction computeMorphedAttributes( object ) {\n\n\tconst _vA = new Vector3();\n\tconst _vB = new Vector3();\n\tconst _vC = new Vector3();\n\n\tconst _tempA = new Vector3();\n\tconst _tempB = new Vector3();\n\tconst _tempC = new Vector3();\n\n\tconst _morphA = new Vector3();\n\tconst _morphB = new Vector3();\n\tconst _morphC = new Vector3();\n\n\tfunction _calculateMorphedAttributeData(\n\t\tobject,\n\t\tattribute,\n\t\tmorphAttribute,\n\t\tmorphTargetsRelative,\n\t\ta,\n\t\tb,\n\t\tc,\n\t\tmodifiedAttributeArray\n\t) {\n\n\t\t_vA.fromBufferAttribute( attribute, a );\n\t\t_vB.fromBufferAttribute( attribute, b );\n\t\t_vC.fromBufferAttribute( attribute, c );\n\n\t\tconst morphInfluences = object.morphTargetInfluences;\n\n\t\tif ( morphAttribute && morphInfluences ) {\n\n\t\t\t_morphA.set( 0, 0, 0 );\n\t\t\t_morphB.set( 0, 0, 0 );\n\t\t\t_morphC.set( 0, 0, 0 );\n\n\t\t\tfor ( let i = 0, il = morphAttribute.length; i < il; i ++ ) {\n\n\t\t\t\tconst influence = morphInfluences[ i ];\n\t\t\t\tconst morph = morphAttribute[ i ];\n\n\t\t\t\tif ( influence === 0 ) continue;\n\n\t\t\t\t_tempA.fromBufferAttribute( morph, a );\n\t\t\t\t_tempB.fromBufferAttribute( morph, b );\n\t\t\t\t_tempC.fromBufferAttribute( morph, c );\n\n\t\t\t\tif ( morphTargetsRelative ) {\n\n\t\t\t\t\t_morphA.addScaledVector( _tempA, influence );\n\t\t\t\t\t_morphB.addScaledVector( _tempB, influence );\n\t\t\t\t\t_morphC.addScaledVector( _tempC, influence );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t_morphA.addScaledVector( _tempA.sub( _vA ), influence );\n\t\t\t\t\t_morphB.addScaledVector( _tempB.sub( _vB ), influence );\n\t\t\t\t\t_morphC.addScaledVector( _tempC.sub( _vC ), influence );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t_vA.add( _morphA );\n\t\t\t_vB.add( _morphB );\n\t\t\t_vC.add( _morphC );\n\n\t\t}\n\n\t\tif ( object.isSkinnedMesh ) {\n\n\t\t\tobject.applyBoneTransform( a, _vA );\n\t\t\tobject.applyBoneTransform( b, _vB );\n\t\t\tobject.applyBoneTransform( c, _vC );\n\n\t\t}\n\n\t\tmodifiedAttributeArray[ a * 3 + 0 ] = _vA.x;\n\t\tmodifiedAttributeArray[ a * 3 + 1 ] = _vA.y;\n\t\tmodifiedAttributeArray[ a * 3 + 2 ] = _vA.z;\n\t\tmodifiedAttributeArray[ b * 3 + 0 ] = _vB.x;\n\t\tmodifiedAttributeArray[ b * 3 + 1 ] = _vB.y;\n\t\tmodifiedAttributeArray[ b * 3 + 2 ] = _vB.z;\n\t\tmodifiedAttributeArray[ c * 3 + 0 ] = _vC.x;\n\t\tmodifiedAttributeArray[ c * 3 + 1 ] = _vC.y;\n\t\tmodifiedAttributeArray[ c * 3 + 2 ] = _vC.z;\n\n\t}\n\n\tconst geometry = object.geometry;\n\tconst material = object.material;\n\n\tlet a, b, c;\n\tconst index = geometry.index;\n\tconst positionAttribute = geometry.attributes.position;\n\tconst morphPosition = geometry.morphAttributes.position;\n\tconst morphTargetsRelative = geometry.morphTargetsRelative;\n\tconst normalAttribute = geometry.attributes.normal;\n\tconst morphNormal = geometry.morphAttributes.position;\n\n\tconst groups = geometry.groups;\n\tconst drawRange = geometry.drawRange;\n\tlet i, j, il, jl;\n\tlet group;\n\tlet start, end;\n\n\tconst modifiedPosition = new Float32Array( positionAttribute.count * positionAttribute.itemSize );\n\tconst modifiedNormal = new Float32Array( normalAttribute.count * normalAttribute.itemSize );\n\n\tif ( index !== null ) {\n\n\t\t// indexed buffer geometry\n\n\t\tif ( Array.isArray( material ) ) {\n\n\t\t\tfor ( i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\tgroup = groups[ i ];\n\n\t\t\t\tstart = Math.max( group.start, drawRange.start );\n\t\t\t\tend = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\tfor ( j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\ta = index.getX( j );\n\t\t\t\t\tb = index.getX( j + 1 );\n\t\t\t\t\tc = index.getX( j + 2 );\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tpositionAttribute,\n\t\t\t\t\t\tmorphPosition,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedPosition\n\t\t\t\t\t);\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\tmorphNormal,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedNormal\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tstart = Math.max( 0, drawRange.start );\n\t\t\tend = Math.min( index.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\tfor ( i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\ta = index.getX( i );\n\t\t\t\tb = index.getX( i + 1 );\n\t\t\t\tc = index.getX( i + 2 );\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tpositionAttribute,\n\t\t\t\t\tmorphPosition,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedPosition\n\t\t\t\t);\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tnormalAttribute,\n\t\t\t\t\tmorphNormal,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedNormal\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t} else {\n\n\t\t// non-indexed buffer geometry\n\n\t\tif ( Array.isArray( material ) ) {\n\n\t\t\tfor ( i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\tgroup = groups[ i ];\n\n\t\t\t\tstart = Math.max( group.start, drawRange.start );\n\t\t\t\tend = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\tfor ( j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\ta = j;\n\t\t\t\t\tb = j + 1;\n\t\t\t\t\tc = j + 2;\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tpositionAttribute,\n\t\t\t\t\t\tmorphPosition,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedPosition\n\t\t\t\t\t);\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\tmorphNormal,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedNormal\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tstart = Math.max( 0, drawRange.start );\n\t\t\tend = Math.min( positionAttribute.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\tfor ( i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\ta = i;\n\t\t\t\tb = i + 1;\n\t\t\t\tc = i + 2;\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tpositionAttribute,\n\t\t\t\t\tmorphPosition,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedPosition\n\t\t\t\t);\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tnormalAttribute,\n\t\t\t\t\tmorphNormal,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedNormal\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tconst morphedPositionAttribute = new Float32BufferAttribute( modifiedPosition, 3 );\n\tconst morphedNormalAttribute = new Float32BufferAttribute( modifiedNormal, 3 );\n\n\treturn {\n\n\t\tpositionAttribute: positionAttribute,\n\t\tnormalAttribute: normalAttribute,\n\t\tmorphedPositionAttribute: morphedPositionAttribute,\n\t\tmorphedNormalAttribute: morphedNormalAttribute\n\n\t};\n\n}\n\nfunction mergeGroups( geometry ) {\n\n\tif ( geometry.groups.length === 0 ) {\n\n\t\tconsole.warn( 'THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge.' );\n\t\treturn geometry;\n\n\t}\n\n\tlet groups = geometry.groups;\n\n\t// sort groups by material index\n\n\tgroups = groups.sort( ( a, b ) => {\n\n\t\tif ( a.materialIndex !== b.materialIndex ) return a.materialIndex - b.materialIndex;\n\n\t\treturn a.start - b.start;\n\n\t} );\n\n\t// create index for non-indexed geometries\n\n\tif ( geometry.getIndex() === null ) {\n\n\t\tconst positionAttribute = geometry.getAttribute( 'position' );\n\t\tconst indices = [];\n\n\t\tfor ( let i = 0; i < positionAttribute.count; i += 3 ) {\n\n\t\t\tindices.push( i, i + 1, i + 2 );\n\n\t\t}\n\n\t\tgeometry.setIndex( indices );\n\n\t}\n\n\t// sort index\n\n\tconst index = geometry.getIndex();\n\n\tconst newIndices = [];\n\n\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tconst groupStart = group.start;\n\t\tconst groupLength = groupStart + group.count;\n\n\t\tfor ( let j = groupStart; j < groupLength; j ++ ) {\n\n\t\t\tnewIndices.push( index.getX( j ) );\n\n\t\t}\n\n\t}\n\n\tgeometry.dispose(); // Required to force buffer recreation\n\tgeometry.setIndex( newIndices );\n\n\t// update groups indices\n\n\tlet start = 0;\n\n\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tgroup.start = start;\n\t\tstart += group.count;\n\n\t}\n\n\t// merge groups\n\n\tlet currentGroup = groups[ 0 ];\n\n\tgeometry.groups = [ currentGroup ];\n\n\tfor ( let i = 1; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tif ( currentGroup.materialIndex === group.materialIndex ) {\n\n\t\t\tcurrentGroup.count += group.count;\n\n\t\t} else {\n\n\t\t\tcurrentGroup = group;\n\t\t\tgeometry.groups.push( currentGroup );\n\n\t\t}\n\n\t}\n\n\treturn geometry;\n\n}\n\n\n/**\n * Modifies the supplied geometry if it is non-indexed, otherwise creates a new,\n * non-indexed geometry. Returns the geometry with smooth normals everywhere except\n * faces that meet at an angle greater than the crease angle.\n *\n * @param {BufferGeometry} geometry\n * @param {number} [creaseAngle]\n * @return {BufferGeometry}\n */\nfunction toCreasedNormals( geometry, creaseAngle = Math.PI / 3 /* 60 degrees */ ) {\n\n\tconst creaseDot = Math.cos( creaseAngle );\n\tconst hashMultiplier = ( 1 + 1e-10 ) * 1e2;\n\n\t// reusable vectors\n\tconst verts = [ new Vector3(), new Vector3(), new Vector3() ];\n\tconst tempVec1 = new Vector3();\n\tconst tempVec2 = new Vector3();\n\tconst tempNorm = new Vector3();\n\tconst tempNorm2 = new Vector3();\n\n\t// hashes a vector\n\tfunction hashVertex( v ) {\n\n\t\tconst x = ~ ~ ( v.x * hashMultiplier );\n\t\tconst y = ~ ~ ( v.y * hashMultiplier );\n\t\tconst z = ~ ~ ( v.z * hashMultiplier );\n\t\treturn `${x},${y},${z}`;\n\n\t}\n\n\t// BufferGeometry.toNonIndexed() warns if the geometry is non-indexed\n\t// and returns the original geometry\n\tconst resultGeometry = geometry.index ? geometry.toNonIndexed() : geometry;\n\tconst posAttr = resultGeometry.attributes.position;\n\tconst vertexMap = {};\n\n\t// find all the normals shared by commonly located vertices\n\tfor ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {\n\n\t\tconst i3 = 3 * i;\n\t\tconst a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );\n\t\tconst b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );\n\t\tconst c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );\n\n\t\ttempVec1.subVectors( c, b );\n\t\ttempVec2.subVectors( a, b );\n\n\t\t// add the normal to the map for all vertices\n\t\tconst normal = new Vector3().crossVectors( tempVec1, tempVec2 ).normalize();\n\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\tconst vert = verts[ n ];\n\t\t\tconst hash = hashVertex( vert );\n\t\t\tif ( ! ( hash in vertexMap ) ) {\n\n\t\t\t\tvertexMap[ hash ] = [];\n\n\t\t\t}\n\n\t\t\tvertexMap[ hash ].push( normal );\n\n\t\t}\n\n\t}\n\n\t// average normals from all vertices that share a common location if they are within the\n\t// provided crease threshold\n\tconst normalArray = new Float32Array( posAttr.count * 3 );\n\tconst normAttr = new BufferAttribute( normalArray, 3, false );\n\tfor ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {\n\n\t\t// get the face normal for this vertex\n\t\tconst i3 = 3 * i;\n\t\tconst a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );\n\t\tconst b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );\n\t\tconst c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );\n\n\t\ttempVec1.subVectors( c, b );\n\t\ttempVec2.subVectors( a, b );\n\n\t\ttempNorm.crossVectors( tempVec1, tempVec2 ).normalize();\n\n\t\t// average all normals that meet the threshold and set the normal value\n\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\tconst vert = verts[ n ];\n\t\t\tconst hash = hashVertex( vert );\n\t\t\tconst otherNormals = vertexMap[ hash ];\n\t\t\ttempNorm2.set( 0, 0, 0 );\n\n\t\t\tfor ( let k = 0, lk = otherNormals.length; k < lk; k ++ ) {\n\n\t\t\t\tconst otherNorm = otherNormals[ k ];\n\t\t\t\tif ( tempNorm.dot( otherNorm ) > creaseDot ) {\n\n\t\t\t\t\ttempNorm2.add( otherNorm );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttempNorm2.normalize();\n\t\t\tnormAttr.setXYZ( i3 + n, tempNorm2.x, tempNorm2.y, tempNorm2.z );\n\n\t\t}\n\n\t}\n\n\tresultGeometry.setAttribute( 'normal', normAttr );\n\treturn resultGeometry;\n\n}\n\nfunction mergeBufferGeometries( geometries, useGroups = false ) {\n\n\tconsole.warn( 'THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries().' ); // @deprecated, r151\n\treturn mergeGeometries( geometries, useGroups );\n\n}\n\nfunction mergeBufferAttributes( attributes ) {\n\n\tconsole.warn( 'THREE.BufferGeometryUtils: mergeBufferAttributes() has been renamed to mergeAttributes().' ); // @deprecated, r151\n\treturn mergeAttributes( attributes );\n\n}\n\nexport {\n\tcomputeMikkTSpaceTangents,\n\tmergeGeometries,\n\tmergeBufferGeometries,\n\tmergeAttributes,\n\tmergeBufferAttributes,\n\tinterleaveAttributes,\n\testimateBytesUsed,\n\tmergeVertices,\n\ttoTrianglesDrawMode,\n\tcomputeMorphedAttributes,\n\tmergeGroups,\n\ttoCreasedNormals\n};\n","import { BufferGeometry, CircleGeometry, ShapeGeometry } from 'three'\nimport { mergeGeometries } from 'three/examples/jsm/utils/BufferGeometryUtils.js'\n\nimport { Size } from '../../../types'\nimport { getRoundedShape } from '../../../utils/shapes'\n\n/**\n * Classic node geometry parameters\n */\nexport type Params = {\n  /** Socket radius, default: 12.3 */\n  socketRadius?: number\n  /** Socket margin, default: 11.5 */\n  socketMargin?: number\n  /** Inputs offset relative to bottom, default: 15.5 */\n  inputsOffset?: number\n  /** Outputs offset relative to top, default: 44.5 */\n  outputsOffset?: number\n  /** Border radius, default: 10 */\n  borderRadius?: number\n}\n\n/**\n * Create classic node geometry\n * @param size Node size\n * @param params Geometry parameters\n * @returns Node geometry\n */\n// eslint-disable-next-line max-statements\nexport function createClassicNodeGeometry(size: Size, params?: Params): BufferGeometry {\n  const {\n    borderRadius = 10,\n    inputsOffset = 15.5,\n    outputsOffset = 44.5,\n    socketRadius = 12.3,\n    socketMargin = 11.5\n  } = params || {}\n  const fixWidth = size.width - 1 // hide border artifact\n  const fixHeight = size.height - 1 // hide border artifact\n  const shape = getRoundedShape(fixWidth, fixHeight, borderRadius * 1.05)\n  const geometry = new ShapeGeometry(shape)\n  const circle = new CircleGeometry(socketRadius, 16)\n\n  const extra: BufferGeometry[] = []\n\n  if ('inputs' in size) {\n    const inputs = Object.entries((size as any).inputs).length\n\n    for (let index = 0; index < inputs; index++) {\n      const geom = circle.clone()\n      const x = 1.5\n      const y = size.height - socketRadius - inputsOffset - ((socketRadius * 2 + socketMargin) * index)\n\n      geom.translate(x, y, 0)\n\n      extra.push(geom)\n    }\n  }\n  if ('outputs' in size) {\n    const outputs = Object.entries((size as any).outputs).length\n\n    for (let index = 0; index < outputs; index++) {\n      const geom = circle.clone()\n      const x = size.width - 1.5\n      const y = socketRadius + outputsOffset + ((socketRadius * 2 + socketMargin) * index)\n\n      geom.translate(x, y, 0)\n\n      extra.push(geom)\n    }\n  }\n\n  return mergeGeometries([...extra, geometry])\n}\n","import { NodeEditor } from 'rete'\nimport { BufferGeometry } from 'three'\n\nimport { Area3DPlugin } from '../../..'\nimport { ExpectSchemes } from '../../../types'\nimport { createClassicNodeGeometry } from './geometry'\n\nexport { createClassicNodeGeometry }\n\n/**\n * Options for node form generator\n */\nexport type Props<S extends ExpectSchemes> = {\n  /** Customize node geometry */\n  customize?: (node: S['Node']) => BufferGeometry\n}\n\n/**\n * Form generator for embedding nodes into 3D scene.\n * @param area Area3DPlugin instance\n * @param props Options for node form generator\n */\nexport function node<S extends ExpectSchemes, K>(area: Area3DPlugin<S, K>, props?: Props<S>) {\n  const editor = area.parentScope<NodeEditor<S>>(NodeEditor)\n\n  area.addPipe(context => {\n    if (!context || typeof context !== 'object' || !('type' in context)) return context\n    if (context.type === 'render' && context.data.type === 'node') {\n      const id = context.data.payload.id\n      const currentNode = editor.getNode(id)\n      const geometry = props?.customize ? props.customize(currentNode) : createClassicNodeGeometry(currentNode)\n\n      area.area.content.updateGeometry(context.data.element, geometry)\n    }\n    return context\n  })\n}\n","import { ConnectionId, Root, Scope, ScopeAsParameter } from 'rete'\nimport { RenderSignal } from 'rete-area-plugin'\nimport { CircleGeometry } from 'three'\nimport { mergeGeometries } from 'three/examples/jsm/utils/BufferGeometryUtils.js'\n\nimport { Area3DPlugin } from '../..'\nimport { ExpectSchemes, Position } from '../../types'\n\nexport type Pin = {\n  id: string\n  position: Position\n  selected?: boolean\n}\nexport type PinData = {\n  id: ConnectionId\n  pins: Pin[]\n}\n\ntype Requires =\n  | RenderSignal<'reroute-pins', { data: PinData }>\n\n/**\n * Form generator for embedding rete-connection-reroute-plugin into 3D scene.\n * @param scope Area3DPlugin instance\n */\nexport function reroute<S extends ExpectSchemes, K>(scope: ScopeAsParameter<Scope<K, [Root<S>]>, [Requires]>) {\n  if (!(scope instanceof Area3DPlugin<S, Requires>)) throw new Error('')\n  const area = scope as Area3DPlugin<S, Requires>\n\n  area.addPipe(context => {\n    if (!context || typeof context !== 'object' || !('type' in context)) return context\n    if (context.type === 'render' && context.data.type === 'reroute-pins') {\n      const pinGeometry = new CircleGeometry(10, 16)\n      const pins = context.data.data.pins.map(pin => {\n        return pinGeometry.clone().translate(pin.position.x, pin.position.y, 0)\n      })\n\n      // eslint-disable-next-line no-undefined\n      area.area.content.updateGeometry(context.data.element, pins.length ? mergeGeometries(pins) : undefined)\n    }\n    return context\n  })\n}\n","/**\n * Group of functions to replicate forms.\n * This extension provides a functions for generating geometry that replicates the form of HTML elements embedded in the scene.\n * @module Extensions/Forms\n */\nexport { comment } from './comment'\nexport type { Props as ConnectionForm } from './connection'\nexport { connection, createClassicConnectionGeometry } from './connection'\nexport type { Props as NodeForm } from './node'\nexport { createClassicNodeGeometry, node } from './node'\nexport type { Params as ClassicNodeOptions } from './node/geometry'\nexport { reroute } from './reroute'\n","import { Position, Size } from '../types'\n\n/**\n * Bounding box\n */\nconst min = (arr: number[]) => arr.length === 0 ? 0 : Math.min(...arr)\nconst max = (arr: number[]) => arr.length === 0 ? 0 : Math.max(...arr)\n\nexport function getBoundingBox(rects: ({ position: Position } & Size)[]) {\n  const left = min(rects.map(rect => rect.position.x))\n  const top = min(rects.map(rect => rect.position.y))\n  const right = max(rects.map(rect => rect.position.x + rect.width))\n  const bottom = max(rects.map(rect => rect.position.y + rect.height))\n\n  return {\n    left,\n    right,\n    top,\n    bottom,\n    width: Math.abs(left - right),\n    height: Math.abs(top - bottom),\n    center: {\n      x: (left + right) / 2,\n      y: (top + bottom) / 2\n    }\n  }\n}\n","import { NodeId } from 'rete'\n\nimport { NodeView } from '../node-view'\nimport { ExpectSchemes } from '../types'\n\nexport function getNodesRect<S extends ExpectSchemes>(nodes: S['Node'][], views: Map<NodeId, NodeView>) {\n  return nodes\n    .map(node => ({ view: views.get(node.id) as NodeView, node }))\n    .filter(item => item.view)\n    .map(({ view, node }) => {\n      const { width, height } = node\n\n      if (typeof width !== 'undefined' && typeof height !== 'undefined') {\n        return {\n          position: view.position,\n          width,\n          height\n        }\n      }\n\n      return {\n        position: view.position,\n        width: view.element.clientWidth,\n        height: view.element.clientHeight\n      }\n    })\n}\n","import { BaseSchemes, NodeEditor } from 'rete'\n\nimport { Area3DPlugin } from '..'\nimport { ExpectSchemes } from '../types'\nimport { getBoundingBox as getBBox } from '../utils/bounding-box'\nimport { getNodesRect } from '../utils/rects'\n\nexport type NodeRef<Schemes extends BaseSchemes> = Schemes['Node'] | Schemes['Node']['id']\n\nexport function getBoundingBox<Schemes extends ExpectSchemes, K>(plugin: Area3DPlugin<Schemes, K>, nodes: NodeRef<Schemes>[]) {\n  const editor = plugin.parentScope<NodeEditor<Schemes>>(NodeEditor)\n  const list = nodes.map(node => typeof node === 'object' ? node : editor.getNode(node))\n  const rects = getNodesRect(list, plugin.nodeViews)\n\n  return getBBox(rects)\n}\n","import { PerspectiveCamera, Vector3 } from 'three'\n\nimport { Area3DPlugin } from '..'\nimport { ExpectSchemes } from '../types'\nimport { getBoundingBox } from './bounding-box'\n\n/**\n * Parameters for `zoomAt` extension\n */\nexport type Params = {\n  /** Set gap between nodes and the viewport border */\n  scale?: number\n}\n\n/**\n * Move the camera to look at the given nodes\n * @param area The 3D area plugin\n * @param nodes The nodes to look at\n * @param params The lookAt parameters\n * @example Area3DExtensions.lookAt(area, [node1, node2])\n * @example Area3DExtensions.lookAt(area, [node1, node2], { scale: 0.8 })\n */\nexport function lookAt<S extends ExpectSchemes, K>(area: Area3DPlugin<S, K>, nodes: S['Node'][], params?: Params) {\n  const { scale = 0.9 } = params || {}\n  const { scene } = area.area\n  const { camera, orbit, canvases } = scene\n  const canvas = canvases.get(area)\n  const bbox = getBoundingBox(area, nodes)\n\n  if (!canvas) throw new Error('cannot found canvas')\n\n  const distance = getTargetDistance(camera, area.container, bbox, scale)\n  const target = new Vector3(bbox.center.x, bbox.center.y, 0)\n  const source = target.clone().add(new Vector3(0, 0, distance))\n\n  canvas.localToWorld(target)\n  canvas.localToWorld(source)\n\n  camera.position.copy(source)\n  orbit.target.copy(target)\n  orbit.update()\n}\n\nfunction getTargetDistance(camera: PerspectiveCamera, container: HTMLElement, size: { width: number, height: number }, scale: number) {\n  const fov = camera.fov * (Math.PI / 180)\n  const fovh = 2 * Math.atan(Math.tan(fov / 2) * camera.aspect)\n  const dx = Math.abs(size.width / 2 / Math.tan(fovh / 2))\n  const dy = Math.abs(size.height / 2 / Math.tan(fov / 2))\n  const minDistance = Math.abs(container.clientHeight / 2 / Math.tan(fov / 2))\n  const distance = Math.max(dx, dy, minDistance)\n\n  return distance / scale\n}\n","/**\n * Area 3D extensions.\n * These extensions are specific to the 3D area and provide additional functionality, while many of rete-area-plugin's extensions are also available for this plugin.\n * @priority 7\n * @module Extensions\n */\n\nexport { animate } from './animate'\nexport * as forms from './forms'\nexport type { Params as LookAt } from './lookAt'\nexport { lookAt } from './lookAt'\n","import { ConnectionId, NodeId, Root, Scope } from 'rete'\nimport { BaseArea, BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { Area, TransformEventParams } from './area'\nimport { ConnectionView } from './connection-view'\nimport { ElementsHolder } from './elements-holder'\nimport { NodeView } from './node-view'\nimport { ExpectSchemes, GetRenderTypes, Position } from './types'\n\nexport type { Area } from './area'\nexport * as Area3DExtensions from './extensions'\nexport type { HybridScene } from './scene'\nexport type { HybridRenderer } from './scene/HybridRenderer'\n\nexport type RenderMeta = { filled?: boolean }\n\n/**\n * Signal types produced by Area3DPlugin instance\n * @priority 10\n */\nexport type Area3D<Schemes extends ExpectSchemes> =\n  | BaseArea<Schemes>\n  | { type: 'transform', data: TransformEventParams }\n  | { type: 'transformed', data: TransformEventParams }\n  | { type: 'resized', data: { event: Event } }\n\nexport type Area3DInherited<Schemes extends ExpectSchemes, ExtraSignals = never> = [Area3D<Schemes> | ExtraSignals, Root<Schemes>]\n\n/**\n * Plugin for embedding node editor into 3D scene.\n * @priority 9\n */\nexport class Area3DPlugin<Schemes extends ExpectSchemes, ExtraSignals = never> extends BaseAreaPlugin<Schemes, Area3D<Schemes> | ExtraSignals> {\n  /**\n   * Area instance, contains nodes, connections and other elements\n   */\n  public area: Area<Area3DPlugin<Schemes, ExtraSignals>>\n  public nodeViews = new Map<NodeId, NodeView>()\n  public connectionViews = new Map<ConnectionId, ConnectionView>()\n  public elements = new ElementsHolder<HTMLElement, Extract<Area3D<Schemes>, { type: 'render' }>['data'] & RenderMeta>()\n  public container: HTMLElement\n\n  /**\n   * @param container HTML element to render area in\n   */\n  constructor(container: HTMLElement)\n  constructor(shared: Area3DPlugin<Schemes, ExtraSignals>)\n  constructor(argument: HTMLElement | Area3DPlugin<Schemes, ExtraSignals>) {\n    super('area-3d')\n    this.container = argument instanceof Area3DPlugin ? argument.container : argument\n    this.container.style.overflow = 'hidden'\n    this.container.addEventListener('contextmenu', this.onContextMenu)\n\n    this.area = new Area(\n      this.container,\n      argument instanceof Area3DPlugin ? argument.area.scene : null,\n      this,\n      {\n        pointerDown: (position, event) => this.emit({ type: 'pointerdown', data: { position, event } }),\n        pointerMove: (position, event) => this.emit({ type: 'pointermove', data: { position, event } }),\n        pointerUp: (position, event) => this.emit({ type: 'pointerup', data: { position, event } }),\n        resize: event => this.emit({ type: 'resized', data: { event } }),\n        transformed: params => this.emit({ type: 'transformed', data: params }),\n        reordered: element => this.emit({ type: 'reordered', data: { element } })\n      },\n      {\n        transform: params => this.emit({ type: 'transform', data: params })\n      }\n    )\n    this.area.scene.addCanvasFor(this)\n  }\n\n  /**\n   * Share the 3D scene with multiple instances of Area3DPlugin\n   * @returns new instance of Area3DPlugin\n   */\n  share() {\n    return new Area3DPlugin<Schemes, ExtraSignals>(this)\n  }\n\n  setParent(scope: Scope<Root<Schemes>, []>) {\n    super.setParent(scope)\n\n    this.addPipe(context => {\n      if (!context || !(typeof context === 'object' && 'type' in context)) return context\n      if (context.type === 'nodecreated') {\n        this.addNodeView(context.data)\n      }\n      if (context.type === 'noderemoved') {\n        this.removeNodeView(context.data.id)\n      }\n      if (context.type === 'connectioncreated') {\n        this.addConnectionView(context.data)\n      }\n      if (context.type === 'connectionremoved') {\n        this.removeConnectionView(context.data.id)\n      }\n      if (context.type === 'render') {\n        this.elements.set(context.data)\n      }\n      if (context.type === 'unmount') {\n        this.elements.delete(context.data.element)\n      }\n      return context\n    })\n  }\n\n  private onContextMenu = (event: MouseEvent) => {\n    this.emit({ type: 'contextmenu', data: { event, context: 'root' } })\n  }\n\n  public addNodeView(node: Schemes['Node']) {\n    const { id } = node\n    const view = new NodeView(\n      {\n        picked: () => this.emit({ type: 'nodepicked', data: { id } }),\n        translated: data => this.emit({ type: 'nodetranslated', data: { id, ...data } }),\n        dragged: () => this.emit({ type: 'nodedragged', data: node }),\n        contextmenu: event => this.emit({ type: 'contextmenu', data: { event, context: node } }),\n        resized: ({ size }) => this.emit({ type: 'noderesized', data: { id: node.id, size } })\n      },\n      {\n        translate: data => this.emit({ type: 'nodetranslate', data: { id, ...data } }),\n        resize: ({ size }) => this.emit({ type: 'noderesize', data: { id: node.id, size } })\n      }\n    )\n\n    this.nodeViews.set(id, view)\n    this.area.content.add(view.element, view.object)\n\n    this.emit({\n      type: 'render',\n      data: { element: view.element, type: 'node', payload: node }\n    })\n\n    return view\n  }\n\n  public removeNodeView(id: NodeId) {\n    const view = this.nodeViews.get(id)\n\n    if (view) {\n      this.emit({ type: 'unmount', data: { element: view.element } })\n      this.nodeViews.delete(id)\n      this.area.content.remove(view.element)\n    }\n  }\n\n  public addConnectionView(connection: Schemes['Connection']) {\n    const view = new ConnectionView({\n      contextmenu: event => this.emit({ type: 'contextmenu', data: { event, context: connection } })\n    })\n\n    this.connectionViews.set(connection.id, view)\n    this.area.content.add(view.element, view.object)\n\n    this.emit({\n      type: 'render',\n      data: { element: view.element, type: 'connection', payload: connection }\n    })\n\n    return view\n  }\n\n  public removeConnectionView(id: ConnectionId) {\n    const view = this.connectionViews.get(id)\n\n    if (view) {\n      this.emit({ type: 'unmount', data: { element: view.element } })\n      this.connectionViews.delete(id)\n      this.area.content.remove(view.element)\n    }\n  }\n\n  /**\n   * Translate node to position\n   * @param id Node id\n   * @param position Position\n   */\n  public async translate(id: NodeId, { x, y }: Position) {\n    const view = this.nodeViews.get(id)\n\n    if (view) return await view.translate(x, y)\n  }\n\n  /**\n   * Resize node\n   * @param id Node id\n   * @param width Desired width\n   * @param height Desired height\n   */\n  public async resize(id: NodeId, width: number, height: number) {\n    const view = this.nodeViews.get(id)\n\n    if (view) return await view.resize(width, height)\n  }\n\n  /**\n   * Force update rendered element by id (node, connection, etc.)\n   * @param type Element type\n   * @param id Element id\n   * @emits render\n   */\n  public async update(type: GetRenderTypes<Area3D<Schemes>> | GetRenderTypes<ExtraSignals>, id: string) {\n    const data = this.elements.get(type, id)\n\n    if (data) await this.emit({ type: 'render', data } as Area3D<Schemes>)\n  }\n\n  /**\n   * Destroy all views and remove all event listeners\n   */\n  destroy() {\n    this.container.removeEventListener('contextmenu', this.onContextMenu)\n    Array.from(this.connectionViews.keys()).forEach(id => this.removeConnectionView(id))\n    Array.from(this.nodeViews.keys()).forEach(id => this.removeNodeView(id))\n    this.area.destroy()\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}