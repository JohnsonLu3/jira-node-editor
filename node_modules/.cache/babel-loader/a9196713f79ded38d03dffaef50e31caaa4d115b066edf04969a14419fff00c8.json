{"ast":null,"code":"/*!\n* rete-react-plugin v2.0.4\n* (c) 2024 Vitaliy Stoliarov\n* Released under the MIT license.\n* */\nimport _typeof from '@babel/runtime/helpers/typeof';\nimport _classCallCheck from '@babel/runtime/helpers/classCallCheck';\nimport _createClass from '@babel/runtime/helpers/createClass';\nimport _assertThisInitialized from '@babel/runtime/helpers/assertThisInitialized';\nimport _get from '@babel/runtime/helpers/get';\nimport _inherits from '@babel/runtime/helpers/inherits';\nimport _possibleConstructorReturn from '@babel/runtime/helpers/possibleConstructorReturn';\nimport _getPrototypeOf from '@babel/runtime/helpers/getPrototypeOf';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport * as React from 'react';\nimport { useState, useRef, useEffect, useContext, createContext, useCallback, useLayoutEffect } from 'react';\nimport { ClassicPreset, Scope } from 'rete';\nimport * as ReactDOM from 'react-dom';\nimport { flushSync } from 'react-dom';\nimport _slicedToArray from '@babel/runtime/helpers/slicedToArray';\nimport _asyncToGenerator from '@babel/runtime/helpers/asyncToGenerator';\nimport _regeneratorRuntime from '@babel/runtime/regenerator';\nimport { getDOMSocketPosition, loopConnectionPath, classicConnectionPath } from 'rete-render-utils';\nimport _taggedTemplateLiteral from '@babel/runtime/helpers/taggedTemplateLiteral';\nimport styled, { css } from 'styled-components';\nimport _extends from '@babel/runtime/helpers/extends';\nimport _objectWithoutProperties from '@babel/runtime/helpers/objectWithoutProperties';\nimport { BaseAreaPlugin } from 'rete-area-plugin';\nfunction getRenderer(props) {\n  var createRoot = props === null || props === void 0 ? void 0 : props.createRoot;\n  var wrappers = new WeakMap();\n  function getWrapper(container) {\n    var wrapper = wrappers.get(container);\n    if (wrapper) return wrapper;\n    var span = document.createElement('span');\n    container.appendChild(span);\n    return wrappers.set(container, span).get(container);\n  }\n  function removeWrapper(container) {\n    var wrapper = wrappers.get(container);\n    if (wrapper) wrapper.remove();\n    wrappers[\"delete\"](container);\n  }\n  if (createRoot) {\n    var roots = new WeakMap();\n    return {\n      mount: function (element, container) {\n        var wrapper = getWrapper(container);\n        if (!roots.has(wrapper)) {\n          roots.set(wrapper, createRoot(wrapper));\n        }\n        var root = roots.get(wrapper);\n        return root.render(element);\n      },\n      unmount: function unmount(container) {\n        var wrapper = getWrapper(container);\n        var root = roots.get(wrapper);\n        if (root) {\n          root.unmount();\n          roots[\"delete\"](wrapper);\n          removeWrapper(container);\n        }\n      }\n    };\n  }\n  return {\n    mount: function (element, container) {\n      return ReactDOM.render(element, getWrapper(container));\n    },\n    unmount: function unmount(container) {\n      ReactDOM.unmountComponentAtNode(getWrapper(container));\n      removeWrapper(container);\n    }\n  };\n}\nfunction Root(_ref) {\n  var children = _ref.children,\n    rendered = _ref.rendered;\n  useEffect(function () {\n    rendered();\n  });\n  return children;\n}\nfunction syncFlush() {\n  var ready = useRef(false);\n  useEffect(function () {\n    ready.current = true;\n  }, []);\n  return {\n    apply: function apply(f) {\n      if (ready.current) {\n        queueMicrotask(function () {\n          return flushSync(f);\n        });\n      } else {\n        f();\n      }\n    }\n  };\n}\nfunction useRete(create) {\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    container = _useState2[0],\n    setContainer = _useState2[1];\n  var editorRef = useRef();\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    editor = _useState4[0],\n    setEditor = _useState4[1];\n  var ref = useRef(null);\n  useEffect(function () {\n    if (container) {\n      if (editorRef.current) {\n        editorRef.current.destroy();\n        container.innerHTML = '';\n      }\n      create(container).then(function (value) {\n        editorRef.current = value;\n        setEditor(value);\n      });\n    }\n  }, [container, create]);\n  useEffect(function () {\n    return function () {\n      if (editorRef.current) {\n        editorRef.current.destroy();\n      }\n    };\n  }, []);\n  useEffect(function () {\n    if (ref.current) {\n      setContainer(ref.current);\n    }\n  }, [ref.current]);\n  return [ref, editor];\n}\nvar ConnectionContext = /*#__PURE__*/createContext({\n  start: null,\n  end: null,\n  path: null\n});\nfunction ConnectionWrapper(props) {\n  var children = props.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    computedStart = _useState2[0],\n    setStart = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    computedEnd = _useState4[0],\n    setEnd = _useState4[1];\n  var _useState5 = useState(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    path = _useState6[0],\n    setPath = _useState6[1];\n  var start = 'x' in props.start ? props.start : computedStart;\n  var end = 'x' in props.end ? props.end : computedEnd;\n  var flush = syncFlush();\n  useEffect(function () {\n    var unwatch1 = typeof props.start === 'function' && props.start(function (s) {\n      return flush.apply(function () {\n        return setStart(s);\n      });\n    });\n    var unwatch2 = typeof props.end === 'function' && props.end(function (s) {\n      return flush.apply(function () {\n        return setEnd(s);\n      });\n    });\n    return function () {\n      unwatch1 && unwatch1();\n      unwatch2 && unwatch2();\n    };\n  }, []);\n  useEffect(function () {\n    if (start && end) props.path(start, end).then(function (p) {\n      return flush.apply(function () {\n        return setPath(p);\n      });\n    });\n  }, [start, end]);\n  return /*#__PURE__*/React.createElement(ConnectionContext.Provider, {\n    value: {\n      start: start,\n      end: end,\n      path: path\n    }\n  }, children);\n}\nfunction useConnection() {\n  return useContext(ConnectionContext);\n}\nvar _templateObject$b, _templateObject2$3;\nvar Svg = styled.svg(_templateObject$b || (_templateObject$b = _taggedTemplateLiteral([\"\\n    overflow: visible !important;\\n    position: absolute;\\n    pointer-events: none;\\n    width: 9999px;\\n    height: 9999px;\\n\"])));\nvar Path = styled.path(_templateObject2$3 || (_templateObject2$3 = _taggedTemplateLiteral([\"\\n    fill: none;\\n    stroke-width: 5px;\\n    stroke: steelblue;\\n    pointer-events: auto;\\n    \", \"\\n\"])), function (props) {\n  return props.styles && props.styles(props);\n});\nfunction Connection(props) {\n  var _useConnection = useConnection(),\n    path = _useConnection.path;\n  if (!path) return null;\n  return /*#__PURE__*/React.createElement(Svg, {\n    \"data-testid\": \"connection\"\n  }, /*#__PURE__*/React.createElement(Path, {\n    styles: props.styles,\n    d: path\n  }));\n}\nfunction _createForOfIteratorHelper$1(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray$1(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n      var F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var normalCompletion = true,\n    didErr = false,\n    err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\nfunction _unsupportedIterableToArray$1(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray$1(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray$1(o, minLen);\n}\nfunction _arrayLikeToArray$1(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nfunction copyEvent(e) {\n  var newEvent = new e.constructor(e.type);\n  var current = newEvent;\n  while (current = Object.getPrototypeOf(current)) {\n    var keys = Object.getOwnPropertyNames(current);\n    var _iterator = _createForOfIteratorHelper$1(keys),\n      _step;\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var k = _step.value;\n        var item = newEvent[k];\n        if (typeof item === 'function') continue;\n        Object.defineProperty(newEvent, k, {\n          value: e[k]\n        });\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n  }\n  return newEvent;\n}\nvar rootPrefix = '__reactContainer$';\nfunction findReactRoot(element) {\n  var current = element;\n  while (current) {\n    if (current._reactRootContainer || Object.keys(current).some(function (key) {\n      return key.startsWith(rootPrefix);\n    })) return current;\n    current = current.parentElement;\n  }\n}\nfunction ownKeys$1(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread$1(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys$1(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$1(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nfunction useDrag(translate, getPointer) {\n  return {\n    start: function start(e) {\n      var previous = _objectSpread$1({}, getPointer(e));\n      function move(moveEvent) {\n        var current = _objectSpread$1({}, getPointer(moveEvent));\n        var dx = current.x - previous.x;\n        var dy = current.y - previous.y;\n        previous = current;\n        translate(dx, dy);\n      }\n      function up() {\n        window.removeEventListener('pointermove', move);\n        window.removeEventListener('pointerup', up);\n        window.removeEventListener('pointercancel', up);\n      }\n      window.addEventListener('pointermove', move);\n      window.addEventListener('pointerup', up);\n      window.addEventListener('pointercancel', up);\n    }\n  };\n}\nfunction useNoDrag(ref, disabled) {\n  React.useEffect(function () {\n    var handleClick = function handleClick(e) {\n      if (disabled) return;\n      var root = findReactRoot(e.target);\n      var target = React.version.startsWith('16') ? document : root;\n      if (target) {\n        e.stopPropagation();\n        target.dispatchEvent(copyEvent(e));\n      }\n    };\n    var el = ref.current;\n    el === null || el === void 0 ? void 0 : el.addEventListener('pointerdown', handleClick);\n    return function () {\n      el === null || el === void 0 ? void 0 : el.removeEventListener('pointerdown', handleClick);\n    };\n  }, [ref, disabled]);\n}\nfunction NoDrag(props) {\n  var ref = React.useRef(null);\n  useNoDrag(ref, props.disabled);\n  return /*#__PURE__*/React.createElement(\"span\", {\n    ref: ref\n  }, props.children);\n}\nvar drag = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  useDrag: useDrag,\n  useNoDrag: useNoDrag,\n  NoDrag: NoDrag\n});\nvar _templateObject$a;\nvar Input = styled.input(_templateObject$a || (_templateObject$a = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  border-radius: 30px;\\n  background-color: white;\\n  padding: 2px 6px;\\n  border: 1px solid #999;\\n  font-size: 110%;\\n  box-sizing: border-box;\\n  \", \"\\n\"])), function (props) {\n  return props.styles && props.styles(props);\n});\nfunction Control(props) {\n  var _React$useState = React.useState(props.data.value),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    value = _React$useState2[0],\n    setValue = _React$useState2[1];\n  var ref = React.useRef(null);\n  useNoDrag(ref);\n  React.useEffect(function () {\n    setValue(props.data.value);\n  }, [props.data.value]);\n  return /*#__PURE__*/React.createElement(Input, {\n    value: value,\n    type: props.data.type,\n    ref: ref,\n    readOnly: props.data.readonly,\n    onChange: function onChange(e) {\n      var val = props.data.type === 'number' ? +e.target.value : e.target.value;\n      setValue(val);\n      props.data.setValue(val);\n    },\n    styles: props.styles\n  });\n}\nvar $nodecolor = 'rgba(110,136,255,0.8)';\nvar $nodecolorselected = '#ffd92c';\nvar $socketsize = 24;\nvar $socketmargin = 6;\nvar $socketcolor = '#96b38a';\nvar $nodewidth = 180;\nvar vars = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  $nodecolor: $nodecolor,\n  $nodecolorselected: $nodecolorselected,\n  $socketsize: $socketsize,\n  $socketmargin: $socketmargin,\n  $socketcolor: $socketcolor,\n  $nodewidth: $nodewidth\n});\nvar _excluded$2 = [\"init\", \"unmount\"];\n/**\n * Component for rendering various elements embedded in the React.js component tree.\n */\nfunction RefComponent(_ref) {\n  var init = _ref.init,\n    unmount = _ref.unmount,\n    props = _objectWithoutProperties(_ref, _excluded$2);\n  var ref = React.useRef(null);\n  React.useEffect(function () {\n    var element = ref.current;\n    return function () {\n      if (element) unmount(element);\n    };\n  }, []);\n  React.useEffect(function () {\n    if (ref.current) init(ref.current);\n  });\n  return /*#__PURE__*/React.createElement(\"span\", _extends({}, props, {\n    ref: ref\n  }));\n}\nvar _excluded$1 = [\"name\", \"emit\", \"payload\"];\nfunction RefControl(_ref) {\n  var name = _ref.name,\n    emit = _ref.emit,\n    payload = _ref.payload,\n    props = _objectWithoutProperties(_ref, _excluded$1);\n  return /*#__PURE__*/React.createElement(RefComponent, _extends({}, props, {\n    className: name,\n    init: function init(ref) {\n      return emit({\n        type: 'render',\n        data: {\n          type: 'control',\n          element: ref,\n          payload: payload\n        }\n      });\n    },\n    unmount: function unmount(ref) {\n      return emit({\n        type: 'unmount',\n        data: {\n          element: ref\n        }\n      });\n    }\n  }));\n}\nvar _excluded = [\"name\", \"emit\", \"nodeId\", \"side\", \"socketKey\", \"payload\"];\nfunction RefSocket(_ref) {\n  var name = _ref.name,\n    emit = _ref.emit,\n    nodeId = _ref.nodeId,\n    side = _ref.side,\n    socketKey = _ref.socketKey,\n    payload = _ref.payload,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return /*#__PURE__*/React.createElement(RefComponent, _extends({}, props, {\n    className: name,\n    init: function init(ref) {\n      return emit({\n        type: 'render',\n        data: {\n          type: 'socket',\n          side: side,\n          key: socketKey,\n          nodeId: nodeId,\n          element: ref,\n          payload: payload\n        }\n      });\n    },\n    unmount: function unmount(ref) {\n      return emit({\n        type: 'unmount',\n        data: {\n          element: ref\n        }\n      });\n    }\n  }));\n}\nvar _templateObject$9, _templateObject2$2;\nvar NodeStyles = styled.div(_templateObject$9 || (_templateObject$9 = _taggedTemplateLiteral([\"\\n    background: \", \";\\n    border: 2px solid #4e58bf;\\n    border-radius: 10px;\\n    cursor: pointer;\\n    box-sizing: border-box;\\n    width: \", \";\\n    height: \", \";\\n    padding-bottom: 6px;\\n    position: relative;\\n    user-select: none;\\n    line-height: initial;\\n    font-family: Arial;\\n\\n    &:hover {\\n        background: lighten(\", \",4%);\\n    }\\n    \", \"\\n    .title {\\n        color: white;\\n        font-family: sans-serif;\\n        font-size: 18px;\\n        padding: 8px;\\n    }\\n    .output {\\n        text-align: right;\\n    }\\n    .input {\\n        text-align: left;\\n    }\\n    .output-socket {\\n        text-align: right;\\n        margin-right: -\", \"px;\\n        display: inline-block;\\n    }\\n    .input-socket {\\n        text-align: left;\\n        margin-left: -\", \"px;\\n        display: inline-block;\\n    }\\n    .input-title,.output-title {\\n        vertical-align: middle;\\n        color: white;\\n        display: inline-block;\\n        font-family: sans-serif;\\n        font-size: 14px;\\n        margin: \", \"px;\\n        line-height: \", \"px;\\n    }\\n    .input-control {\\n        z-index: 1;\\n        width: calc(100% - \", \"px);\\n        vertical-align: middle;\\n        display: inline-block;\\n    }\\n    .control {\\n        display: block;\\n        padding: \", \"px \", \"px;\\n    }\\n    \", \"\\n\"])), $nodecolor, function (props) {\n  return Number.isFinite(props.width) ? \"\".concat(props.width, \"px\") : \"\".concat($nodewidth, \"px\");\n}, function (props) {\n  return Number.isFinite(props.height) ? \"\".concat(props.height, \"px\") : 'auto';\n}, $nodecolor, function (props) {\n  return props.selected && css(_templateObject2$2 || (_templateObject2$2 = _taggedTemplateLiteral([\"\\n        background: \", \";\\n        border-color: #e3c000;\\n    \"])), $nodecolorselected);\n}, $socketsize / 2 + $socketmargin, $socketsize / 2 + $socketmargin, $socketmargin, $socketsize, $socketsize + 2 * $socketmargin, $socketmargin, $socketsize / 2 + $socketmargin, function (props) {\n  return props.styles && props.styles(props);\n});\nfunction sortByIndex(entries) {\n  entries.sort(function (a, b) {\n    var _a$, _b$;\n    var ai = ((_a$ = a[1]) === null || _a$ === void 0 ? void 0 : _a$.index) || 0;\n    var bi = ((_b$ = b[1]) === null || _b$ === void 0 ? void 0 : _b$.index) || 0;\n    return ai - bi;\n  });\n}\n// eslint-disable-next-line max-statements\nfunction Node(props) {\n  var inputs = Object.entries(props.data.inputs);\n  var outputs = Object.entries(props.data.outputs);\n  var controls = Object.entries(props.data.controls);\n  var selected = props.data.selected || false;\n  var _props$data = props.data,\n    id = _props$data.id,\n    label = _props$data.label,\n    width = _props$data.width,\n    height = _props$data.height;\n  sortByIndex(inputs);\n  sortByIndex(outputs);\n  sortByIndex(controls);\n  return /*#__PURE__*/React.createElement(NodeStyles, {\n    selected: selected,\n    width: width,\n    height: height,\n    styles: props.styles,\n    \"data-testid\": \"node\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"title\",\n    \"data-testid\": \"title\"\n  }, label), outputs.map(function (_ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n      key = _ref2[0],\n      output = _ref2[1];\n    return output && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"output\",\n      key: key,\n      \"data-testid\": \"output-\".concat(key)\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"output-title\",\n      \"data-testid\": \"output-title\"\n    }, output === null || output === void 0 ? void 0 : output.label), /*#__PURE__*/React.createElement(RefSocket, {\n      name: \"output-socket\",\n      side: \"output\",\n      socketKey: key,\n      nodeId: id,\n      emit: props.emit,\n      payload: output.socket,\n      \"data-testid\": \"output-socket\"\n    }));\n  }), controls.map(function (_ref3) {\n    var _ref4 = _slicedToArray(_ref3, 2),\n      key = _ref4[0],\n      control = _ref4[1];\n    return control ? /*#__PURE__*/React.createElement(RefControl, {\n      key: key,\n      name: \"control\",\n      emit: props.emit,\n      payload: control,\n      \"data-testid\": \"control-\".concat(key)\n    }) : null;\n  }), inputs.map(function (_ref5) {\n    var _ref6 = _slicedToArray(_ref5, 2),\n      key = _ref6[0],\n      input = _ref6[1];\n    return input && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"input\",\n      key: key,\n      \"data-testid\": \"input-\".concat(key)\n    }, /*#__PURE__*/React.createElement(RefSocket, {\n      name: \"input-socket\",\n      side: \"input\",\n      socketKey: key,\n      nodeId: id,\n      emit: props.emit,\n      payload: input.socket,\n      \"data-testid\": \"input-socket\"\n    }), input && (!input.control || !input.showControl) && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"input-title\",\n      \"data-testid\": \"input-title\"\n    }, input === null || input === void 0 ? void 0 : input.label), (input === null || input === void 0 ? void 0 : input.control) && (input === null || input === void 0 ? void 0 : input.showControl) && /*#__PURE__*/React.createElement(RefControl, {\n      key: key,\n      name: \"input-control\",\n      emit: props.emit,\n      payload: input.control,\n      \"data-testid\": \"input-control\"\n    }));\n  }));\n}\nvar _templateObject$8, _templateObject2$1;\nvar Styles$4 = styled.div(_templateObject$8 || (_templateObject$8 = _taggedTemplateLiteral([\"\\n    display: inline-block;\\n    cursor: pointer;\\n    border: 1px solid white;\\n    border-radius: \", \"px;\\n    width: \", \"px;\\n    height: \", \"px;\\n    vertical-align: middle;\\n    background: \", \";\\n    z-index: 2;\\n    box-sizing: border-box;\\n    &:hover {\\n      border-width: 4px;\\n    }\\n    &.multiple {\\n      border-color: yellow;\\n    }\\n\"])), $socketsize / 2.0, $socketsize, $socketsize, $socketcolor);\nvar Hoverable = styled.div(_templateObject2$1 || (_templateObject2$1 = _taggedTemplateLiteral([\"\\n    border-radius: \", \"px;\\n    padding: \", \"px;\\n    &:hover \", \" {\\n      border-width: 4px;\\n    }\\n\"])), ($socketsize + $socketmargin * 2) / 2.0, $socketmargin, Styles$4);\nfunction Socket(props) {\n  return /*#__PURE__*/React.createElement(Hoverable, null, /*#__PURE__*/React.createElement(Styles$4, {\n    title: props.data.name\n  }));\n}\n\n/**\n * Classic preset for rendering nodes, connections, controls and sockets.\n */\nfunction setup$3(props) {\n  var positionWatcher = typeof (props === null || props === void 0 ? void 0 : props.socketPositionWatcher) === 'undefined' ? getDOMSocketPosition() : props === null || props === void 0 ? void 0 : props.socketPositionWatcher;\n  var _ref = (props === null || props === void 0 ? void 0 : props.customize) || {},\n    node = _ref.node,\n    connection = _ref.connection,\n    socket = _ref.socket,\n    control = _ref.control;\n  return {\n    attach: function attach(plugin) {\n      positionWatcher.attach(plugin);\n    },\n    // eslint-disable-next-line max-statements, complexity\n    render: function render(context, plugin) {\n      if (context.data.type === 'node') {\n        var parent = plugin.parentScope();\n        var Component = node ? node(context.data) : Node;\n        return Component && /*#__PURE__*/React.createElement(Component, {\n          data: context.data.payload,\n          emit: function emit(data) {\n            return parent.emit(data);\n          }\n        });\n      } else if (context.data.type === 'connection') {\n        var _Component = connection ? connection(context.data) : Connection;\n        var payload = context.data.payload;\n        var sourceOutput = payload.sourceOutput,\n          targetInput = payload.targetInput,\n          source = payload.source,\n          target = payload.target;\n        return _Component && /*#__PURE__*/React.createElement(ConnectionWrapper, {\n          start: context.data.start || function (change) {\n            return positionWatcher.listen(source, 'output', sourceOutput, change);\n          },\n          end: context.data.end || function (change) {\n            return positionWatcher.listen(target, 'input', targetInput, change);\n          },\n          path: /*#__PURE__*/function () {\n            var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(start, end) {\n              var response, _response$data, path, points, curvature;\n              return _regeneratorRuntime.wrap(function _callee$(_context) {\n                while (1) switch (_context.prev = _context.next) {\n                  case 0:\n                    _context.next = 2;\n                    return plugin.emit({\n                      type: 'connectionpath',\n                      data: {\n                        payload: payload,\n                        points: [start, end]\n                      }\n                    });\n                  case 2:\n                    response = _context.sent;\n                    if (response) {\n                      _context.next = 5;\n                      break;\n                    }\n                    return _context.abrupt(\"return\", '');\n                  case 5:\n                    _response$data = response.data, path = _response$data.path, points = _response$data.points;\n                    curvature = 0.3;\n                    if (!(!path && points.length !== 2)) {\n                      _context.next = 9;\n                      break;\n                    }\n                    throw new Error('cannot render connection with a custom number of points');\n                  case 9:\n                    if (path) {\n                      _context.next = 11;\n                      break;\n                    }\n                    return _context.abrupt(\"return\", payload.isLoop ? loopConnectionPath(points, curvature, 120) : classicConnectionPath(points, curvature));\n                  case 11:\n                    return _context.abrupt(\"return\", path);\n                  case 12:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }, _callee);\n            }));\n            return function (_x, _x2) {\n              return _ref2.apply(this, arguments);\n            };\n          }()\n        }, /*#__PURE__*/React.createElement(_Component, {\n          data: context.data.payload\n        }));\n      } else if (context.data.type === 'socket') {\n        var _Component2 = socket ? socket(context.data) : Socket;\n        return _Component2 && context.data.payload && /*#__PURE__*/React.createElement(_Component2, {\n          data: context.data.payload\n        });\n      } else if (context.data.type === 'control') {\n        var _Component3 = control && context.data.payload ? control(context.data) : context.data.payload instanceof ClassicPreset.InputControl ? Control : null;\n        return _Component3 && /*#__PURE__*/React.createElement(_Component3, {\n          data: context.data.payload\n        });\n      }\n    }\n  };\n}\nvar index$4 = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  vars: vars,\n  setup: setup$3,\n  Connection: Connection,\n  useConnection: useConnection,\n  Control: Control,\n  InputControl: Control,\n  Node: Node,\n  NodeStyles: NodeStyles,\n  RefControl: RefControl,\n  RefSocket: RefSocket,\n  Socket: Socket\n});\nfunction useDebounce(cb, timeout) {\n  var ref = useRef();\n  function cancel() {\n    ref.current && clearTimeout(ref.current);\n  }\n  var func = function func() {\n    cancel();\n    ref.current = setTimeout(function () {\n      cb();\n    }, timeout);\n  };\n  useEffect(function () {\n    return cancel;\n  }, []);\n  return [func, cancel];\n}\nvar $contextColor = 'rgba(110,136,255,0.8)';\nvar $contextColorLight = 'rgba(130, 153, 255, 0.8)';\nvar $contextColorDark = 'rgba(69, 103, 255, 0.8)';\nvar $contextMenuRound = '5px';\nvar $width = 120;\nvar _templateObject$7;\nvar CommonStyle = styled.div(_templateObject$7 || (_templateObject$7 = _taggedTemplateLiteral([\"\\n  color: #fff;\\n  padding: 4px;\\n  border-bottom: 1px solid \", \";\\n  background-color: \", \";\\n  cursor: pointer;\\n  width: 100%;\\n  position: relative;\\n  &:first-child {\\n    border-top-left-radius: \", \";\\n    border-top-right-radius: \", \";\\n  }\\n  &:last-child {\\n    border-bottom-left-radius: \", \";\\n    border-bottom-right-radius: \", \";\\n  }\\n  &:hover {\\n    background-color: \", \";\\n  }\\n\"])), $contextColorDark, $contextColor, $contextMenuRound, $contextMenuRound, $contextMenuRound, $contextMenuRound, $contextColorLight);\nvar _templateObject$6, _templateObject2, _templateObject3;\nvar ItemStyle = styled(CommonStyle)(_templateObject$6 || (_templateObject$6 = _taggedTemplateLiteral([\"\\n    \", \"\\n\"])), function (props) {\n  return props.hasSubitems && css(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"&:after {\\n    content: '\\u25BA';\\n    position: absolute;\\n    opacity: 0.6;\\n    right: 5px;\\n    top: 5px;\\n    }\"])));\n});\nvar SubitemStyles = styled.div(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n    position: absolute;\\n    top: 0;\\n    left: 100%;\\n    width: \", \"px;\\n\"])), $width);\nfunction ItemElement(props) {\n  var _props$components, _props$components$ite, _props$components2, _props$components2$su;\n  var _React$useState = React.useState(false),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    visibleSubitems = _React$useState2[0],\n    setVisibleSubitems = _React$useState2[1];\n  var setInvisibile = React.useCallback(function () {\n    return setVisibleSubitems(false);\n  }, [setVisibleSubitems]);\n  var _useDebounce = useDebounce(setInvisibile, props.delay),\n    _useDebounce2 = _slicedToArray(_useDebounce, 2),\n    hide = _useDebounce2[0],\n    cancelHide = _useDebounce2[1];\n  var Component = ((_props$components = props.components) === null || _props$components === void 0 ? void 0 : (_props$components$ite = _props$components.item) === null || _props$components$ite === void 0 ? void 0 : _props$components$ite.call(_props$components, props.data)) || ItemStyle;\n  var Subitems = ((_props$components2 = props.components) === null || _props$components2 === void 0 ? void 0 : (_props$components2$su = _props$components2.subitems) === null || _props$components2$su === void 0 ? void 0 : _props$components2$su.call(_props$components2, props.data)) || SubitemStyles;\n  return /*#__PURE__*/React.createElement(Component, {\n    onClick: function onClick(e) {\n      e.stopPropagation();\n      props.data.handler();\n      props.hide();\n    },\n    hasSubitems: Boolean(props.data.subitems),\n    onPointerDown: function onPointerDown(e) {\n      return e.stopPropagation();\n    },\n    onPointerOver: function onPointerOver() {\n      cancelHide();\n      setVisibleSubitems(true);\n    },\n    onPointerLeave: function onPointerLeave() {\n      return hide && hide();\n    },\n    \"data-testid\": \"context-menu-item\"\n  }, props.children, props.data.subitems && visibleSubitems && /*#__PURE__*/React.createElement(Subitems, null, props.data.subitems.map(function (item) {\n    return /*#__PURE__*/React.createElement(ItemElement, {\n      key: item.key,\n      data: item,\n      delay: props.delay,\n      hide: props.hide,\n      components: props.components\n    }, item.label);\n  })));\n}\nvar _templateObject$5;\nvar SearchInput = styled.input(_templateObject$5 || (_templateObject$5 = _taggedTemplateLiteral([\"\\n  color: white;\\n  padding: 1px 8px;\\n  border: 1px solid white;\\n  border-radius: 10px;\\n  font-size: 16px;\\n  font-family: serif;\\n  width: 100%;\\n  box-sizing: border-box;\\n  background: transparent;\\n\"])));\nfunction Search(props) {\n  var Component = props.component || SearchInput;\n  return /*#__PURE__*/React.createElement(Component, {\n    value: props.value,\n    onInput: function onInput(e) {\n      return props.onChange(e.target.value);\n    },\n    onPointerDown: function onPointerDown(e) {\n      return e.stopPropagation();\n    },\n    \"data-testid\": \"context-menu-search-input\"\n  });\n}\nvar _templateObject$4;\nvar Styles$3 = styled.div(_templateObject$4 || (_templateObject$4 = _taggedTemplateLiteral([\"\\n  padding: 10px;\\n  width: \", \"px;\\n  margin-top: -20px;\\n  margin-left: -\", \"px;\\n\"])), $width, $width / 2);\nfunction Menu(props) {\n  var _props$components, _props$components$mai, _props$components2, _props$components2$co, _props$components3, _props$components3$se;\n  var _useDebounce = useDebounce(props.onHide, props.delay),\n    _useDebounce2 = _slicedToArray(_useDebounce, 2),\n    hide = _useDebounce2[0],\n    cancelHide = _useDebounce2[1];\n  var _React$useState = React.useState(''),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    filter = _React$useState2[0],\n    setFilter = _React$useState2[1];\n  var filterRegexp = new RegExp(filter, 'i');\n  var filteredList = props.items.filter(function (item) {\n    return item.label.match(filterRegexp);\n  });\n  var Component = ((_props$components = props.components) === null || _props$components === void 0 ? void 0 : (_props$components$mai = _props$components.main) === null || _props$components$mai === void 0 ? void 0 : _props$components$mai.call(_props$components)) || Styles$3;\n  var Common = ((_props$components2 = props.components) === null || _props$components2 === void 0 ? void 0 : (_props$components2$co = _props$components2.common) === null || _props$components2$co === void 0 ? void 0 : _props$components2$co.call(_props$components2)) || CommonStyle;\n  return /*#__PURE__*/React.createElement(Component, {\n    onMouseOver: function onMouseOver() {\n      return cancelHide();\n    },\n    onMouseLeave: function onMouseLeave() {\n      return hide && hide();\n    },\n    onWheel: function onWheel(e) {\n      return e.stopPropagation();\n    },\n    \"data-testid\": \"context-menu\"\n  }, props.searchBar && /*#__PURE__*/React.createElement(Common, null, /*#__PURE__*/React.createElement(Search, {\n    value: filter,\n    onChange: setFilter,\n    component: (_props$components3 = props.components) === null || _props$components3 === void 0 ? void 0 : (_props$components3$se = _props$components3.search) === null || _props$components3$se === void 0 ? void 0 : _props$components3$se.call(_props$components3)\n  })), filteredList.map(function (item) {\n    return /*#__PURE__*/React.createElement(ItemElement, {\n      key: item.key,\n      data: item,\n      delay: props.delay,\n      hide: props.onHide,\n      components: props.components\n    }, item.label);\n  }));\n}\n\n/**\n * Preset for rendering context menu.\n */\nfunction setup$2(props) {\n  var delay = typeof (props === null || props === void 0 ? void 0 : props.delay) === 'undefined' ? 1000 : props.delay;\n  return {\n    render: function render(context) {\n      if (context.data.type === 'contextmenu') {\n        return /*#__PURE__*/React.createElement(Menu, {\n          items: context.data.items,\n          delay: delay,\n          searchBar: context.data.searchBar,\n          onHide: context.data.onHide,\n          components: props === null || props === void 0 ? void 0 : props.customize\n        });\n      }\n    }\n  };\n}\nvar index$3 = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  setup: setup$2,\n  Item: ItemStyle,\n  Subitems: SubitemStyles,\n  Menu: Styles$3,\n  Search: SearchInput,\n  Common: CommonStyle\n});\nundefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nfunction useElementSize() {\n  const [ref, setRef] = useState(null);\n  const [size, setSize] = useState({\n    width: 0,\n    height: 0\n  });\n  const handleSize = useCallback(() => {\n    setSize({\n      width: (ref === null || ref === void 0 ? void 0 : ref.offsetWidth) || 0,\n      height: (ref === null || ref === void 0 ? void 0 : ref.offsetHeight) || 0\n    });\n  }, [ref === null || ref === void 0 ? void 0 : ref.offsetHeight, ref === null || ref === void 0 ? void 0 : ref.offsetWidth]);\n  useEventListener('resize', handleSize);\n  useIsomorphicLayoutEffect(() => {\n    handleSize();\n  }, [ref === null || ref === void 0 ? void 0 : ref.offsetHeight, ref === null || ref === void 0 ? void 0 : ref.offsetWidth]);\n  return [setRef, size];\n}\nfunction useEventListener(eventName, handler, element, options) {\n  const savedHandler = useRef(handler);\n  useIsomorphicLayoutEffect(() => {\n    savedHandler.current = handler;\n  }, [handler]);\n  useEffect(() => {\n    var _a;\n    const targetElement = (_a = element === null || element === void 0 ? void 0 : element.current) !== null && _a !== void 0 ? _a : window;\n    if (!(targetElement && targetElement.addEventListener)) return;\n    const listener = event => savedHandler.current(event);\n    targetElement.addEventListener(eventName, listener, options);\n    return () => {\n      targetElement.removeEventListener(eventName, listener, options);\n    };\n  }, [eventName, element, options]);\n}\nundefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nconst useIsomorphicLayoutEffect = typeof window !== 'undefined' ? useLayoutEffect : useEffect;\nfunction px(value) {\n  return \"\".concat(value, \"px\");\n}\nvar _templateObject$3;\nvar Styles$2 = styled.div(_templateObject$3 || (_templateObject$3 = _taggedTemplateLiteral([\"\\n    position: absolute;\\n    background: rgba(110, 136, 255, 0.8);\\n    border: 1px solid rgb(192 206 212 / 60%);\\n\"])));\nfunction MiniNode(props) {\n  return /*#__PURE__*/React.createElement(Styles$2, {\n    style: {\n      left: px(props.left),\n      top: px(props.top),\n      width: px(props.width),\n      height: px(props.height)\n    },\n    \"data-testid\": \"minimap-node\"\n  });\n}\nvar _templateObject$2;\nvar MiniViewportStyles = styled.div(_templateObject$2 || (_templateObject$2 = _taggedTemplateLiteral([\"\\n  position: absolute;\\n  background: rgba(255, 251, 128, 0.32);\\n  border: 1px solid #ffe52b;\\n\"])));\nfunction MiniViewport(props) {\n  var scale = function scale(v) {\n    return v * props.containerWidth;\n  };\n  var invert = function invert(v) {\n    return v / props.containerWidth;\n  };\n  var drag = useDrag(function (dx, dy) {\n    return props.translate(invert(-dx), invert(-dy));\n  }, function (e) {\n    return {\n      x: e.pageX,\n      y: e.pageY\n    };\n  });\n  return /*#__PURE__*/React.createElement(MiniViewportStyles, {\n    onPointerDown: drag.start,\n    style: {\n      left: px(scale(props.left)),\n      top: px(scale(props.top)),\n      width: px(scale(props.width)),\n      height: px(scale(props.height))\n    },\n    \"data-testid\": \"minimap-viewport\"\n  });\n}\nvar _templateObject$1;\nvar Styles$1 = styled.div(_templateObject$1 || (_templateObject$1 = _taggedTemplateLiteral([\"\\n    position: absolute;\\n    right: 24px;\\n    bottom: 24px;\\n    background: rgba(229, 234, 239, 0.65);\\n    padding: 20px;\\n    overflow: hidden;\\n    border: 1px solid #b1b7ff;\\n    border-radius: 8px;\\n    box-sizing: border-box;\\n\"])));\nfunction Minimap(props) {\n  var container = useRef();\n  var _useElementSize = useElementSize(),\n    _useElementSize2 = _slicedToArray(_useElementSize, 2),\n    containerRef = _useElementSize2[0],\n    containerWidth = _useElementSize2[1].width;\n  var scale = function scale(v) {\n    return v * containerWidth;\n  };\n  var ref = useCallback(function (node) {\n    container.current = node;\n    containerRef(node);\n  }, [containerRef]);\n  return /*#__PURE__*/React.createElement(Styles$1, {\n    size: props.size,\n    style: {\n      width: px(props.size * props.ratio),\n      height: px(props.size)\n    },\n    onPointerDown: function onPointerDown(e) {\n      e.stopPropagation();\n      e.preventDefault();\n    },\n    onDoubleClick: function onDoubleClick(e) {\n      e.stopPropagation();\n      e.preventDefault();\n      if (!container.current) return;\n      var box = container.current.getBoundingClientRect();\n      var x = (e.clientX - box.left) / (props.size * props.ratio);\n      var y = (e.clientY - box.top) / (props.size * props.ratio);\n      props.point(x, y);\n    },\n    ref: ref,\n    \"data-testid\": \"minimap\"\n  }, containerWidth && props.nodes.map(function (node, i) {\n    return /*#__PURE__*/React.createElement(MiniNode, {\n      key: i,\n      left: scale(node.left),\n      top: scale(node.top),\n      width: scale(node.width),\n      height: scale(node.height)\n    });\n  }), /*#__PURE__*/React.createElement(MiniViewport, _extends({}, props.viewport, {\n    start: props.start,\n    containerWidth: containerWidth,\n    translate: props.translate\n  })));\n}\n\n/**\n * Preset for rendering minimap.\n */\nfunction setup$1(props) {\n  return {\n    render: function render(context) {\n      if (context.data.type === 'minimap') {\n        return /*#__PURE__*/React.createElement(Minimap, {\n          nodes: context.data.nodes,\n          size: (props === null || props === void 0 ? void 0 : props.size) || 200,\n          ratio: context.data.ratio,\n          viewport: context.data.viewport,\n          start: context.data.start,\n          translate: context.data.translate,\n          point: context.data.point\n        });\n      }\n    }\n  };\n}\nvar index$2 = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  setup: setup$1\n});\nvar _templateObject;\nvar pinSize = 20;\nvar Styles = styled.div(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n  width: \", \"px;\\n  height: \", \"px;\\n  box-sizing: border-box;\\n  background: \", \";\\n  border: 2px solid white;\\n  border-radius: \", \"px;\\n\"])), pinSize, pinSize, function (props) {\n  return props.selected ? '#ffd92c' : 'steelblue';\n}, pinSize);\nfunction Pin(props) {\n  var drag = useDrag(function (dx, dy) {\n    return props.translate(dx, dy);\n  }, props.pointer);\n  var _props$position = props.position,\n    x = _props$position.x,\n    y = _props$position.y;\n  return /*#__PURE__*/React.createElement(Styles, {\n    onPointerDown: function onPointerDown(e) {\n      e.stopPropagation();\n      e.preventDefault();\n      drag.start(e);\n      props.pointerdown();\n    },\n    onContextMenu: function onContextMenu(e) {\n      e.stopPropagation();\n      e.preventDefault();\n      props.contextMenu();\n    },\n    selected: props.selected,\n    style: {\n      position: 'absolute',\n      top: \"\".concat(y - pinSize / 2, \"px\"),\n      left: \"\".concat(x - pinSize / 2, \"px\")\n    },\n    \"data-testid\": \"pin\"\n  });\n}\n\n/**\n * Preset for rendering pins.\n */\nfunction setup(props) {\n  function renderPins(data, pointer) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, data.pins.map(function (pin) {\n      return /*#__PURE__*/React.createElement(Pin, _extends({}, pin, {\n        key: pin.id,\n        contextMenu: function contextMenu() {\n          return (props === null || props === void 0 ? void 0 : props.contextMenu) && props.contextMenu(pin.id);\n        },\n        translate: function translate(dx, dy) {\n          return (props === null || props === void 0 ? void 0 : props.translate) && props.translate(pin.id, dx, dy);\n        },\n        pointerdown: function pointerdown() {\n          return (props === null || props === void 0 ? void 0 : props.pointerdown) && props.pointerdown(pin.id);\n        },\n        pointer: pointer\n      }));\n    }));\n  }\n  return {\n    render: function render(context, plugin) {\n      var data = context.data;\n      var area = plugin.parentScope(BaseAreaPlugin);\n      if (data.type === 'reroute-pins') {\n        return renderPins(data.data, function () {\n          return area.area.pointer;\n        });\n      }\n    }\n  };\n}\nvar index$1 = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  setup: setup\n});\n\n/**\n * Built-in presets, responsible for rendering different parts of the editor.\n * @module\n */\n\nvar index = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  classic: index$4,\n  contextMenu: index$3,\n  minimap: index$2,\n  reroute: index$1\n});\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n      var F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var normalCompletion = true,\n    didErr = false,\n    err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Signals that can be emitted by the plugin\n * @priority 9\n */\n\n/**\n * Plugin props\n */\n\n/**\n * React plugin. Renders nodes, connections and other elements using React.\n * @priority 10\n * @emits connectionpath\n * @listens render\n * @listens unmount\n */\nvar ReactPlugin = /*#__PURE__*/function (_Scope) {\n  _inherits(ReactPlugin, _Scope);\n  var _super = _createSuper(ReactPlugin);\n  function ReactPlugin(props) {\n    var _this;\n    _classCallCheck(this, ReactPlugin);\n    _this = _super.call(this, 'react-render');\n    _defineProperty(_assertThisInitialized(_this), \"presets\", []);\n    _this.renderer = getRenderer({\n      createRoot: props === null || props === void 0 ? void 0 : props.createRoot\n    });\n    _this.addPipe(function (context) {\n      if (!context || _typeof(context) !== 'object' || !('type' in context)) return context;\n      if (context.type === 'unmount') {\n        _this.unmount(context.data.element);\n      } else if (context.type === 'render') {\n        if ('filled' in context.data && context.data.filled) {\n          return context;\n        }\n        if (_this.mount(context.data.element, context)) {\n          return _objectSpread(_objectSpread({}, context), {}, {\n            data: _objectSpread(_objectSpread({}, context.data), {}, {\n              filled: true\n            })\n          });\n        }\n      }\n      return context;\n    });\n    return _this;\n  }\n  _createClass(ReactPlugin, [{\n    key: \"setParent\",\n    value: function setParent(scope) {\n      var _this2 = this;\n      _get(_getPrototypeOf(ReactPlugin.prototype), \"setParent\", this).call(this, scope);\n      this.presets.forEach(function (preset) {\n        if (preset.attach) preset.attach(_this2);\n      });\n    }\n  }, {\n    key: \"mount\",\n    value: function mount(element, context) {\n      var parent = this.parentScope();\n      var _iterator = _createForOfIteratorHelper(this.presets),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var preset = _step.value;\n          var result = preset.render(context, this);\n          if (!result) continue;\n          var reactElement = /*#__PURE__*/React.createElement(Root, {\n            rendered: function rendered() {\n              return parent.emit({\n                type: 'rendered',\n                data: context.data\n              });\n            }\n          }, result);\n          this.renderer.mount(reactElement, element);\n          return true;\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n  }, {\n    key: \"unmount\",\n    value: function unmount(element) {\n      this.renderer.unmount(element);\n    }\n\n    /**\n     * Adds a preset to the plugin.\n     * @param preset Preset that can render nodes, connections and other elements.\n     */\n  }, {\n    key: \"addPreset\",\n    value: function addPreset(preset) {\n      var local = preset;\n      if (local.attach) local.attach(this);\n      this.presets.push(local);\n    }\n  }]);\n  return ReactPlugin;\n}(Scope);\nexport { drag as Drag, index as Presets, ReactPlugin, RefComponent, useRete };","map":{"version":3,"names":["getRenderer","props","createRoot","wrappers","WeakMap","getWrapper","container","wrapper","get","span","document","createElement","appendChild","set","removeWrapper","remove","roots","mount","element","has","root","render","unmount","ReactDOM","unmountComponentAtNode","Root","_ref","children","rendered","useEffect","syncFlush","ready","useRef","current","apply","f","queueMicrotask","flushSync","useRete","create","_useState","useState","_useState2","_slicedToArray","setContainer","editorRef","_useState3","_useState4","editor","setEditor","ref","destroy","innerHTML","then","value","ConnectionContext","createContext","start","end","path","ConnectionWrapper","computedStart","setStart","computedEnd","setEnd","_useState5","_useState6","setPath","flush","unwatch1","s","unwatch2","p","React","Provider","useConnection","useContext","Svg","styled","svg","_templateObject$b","_taggedTemplateLiteral","Path","_templateObject2$3","styles","Connection","_useConnection","d","copyEvent","e","newEvent","constructor","type","Object","getPrototypeOf","keys","getOwnPropertyNames","_iterator","_createForOfIteratorHelper$1","_step","n","done","k","item","defineProperty","err","rootPrefix","findReactRoot","_reactRootContainer","some","key","startsWith","parentElement","useDrag","translate","getPointer","previous","_objectSpread$1","move","moveEvent","dx","x","dy","y","up","window","removeEventListener","addEventListener","useNoDrag","disabled","handleClick","target","version","stopPropagation","dispatchEvent","el","NoDrag","Input","input","_templateObject$a","Control","_React$useState","data","_React$useState2","setValue","readOnly","readonly","onChange","val","$nodecolor","$nodecolorselected","$socketsize","$socketmargin","$socketcolor","$nodewidth","RefComponent","init","_objectWithoutProperties","_excluded$2","_extends","RefControl","name","emit","payload","_excluded$1","className","RefSocket","nodeId","side","socketKey","_excluded","NodeStyles","div","_templateObject$9","Number","isFinite","width","concat","height","selected","css","_templateObject2$2","sortByIndex","entries","sort","a","b","_a$","_b$","ai","index","bi","Node","inputs","outputs","controls","_props$data","id","label","map","_ref2","output","socket","_ref3","_ref4","control","_ref5","_ref6","showControl","Styles$4","_templateObject$8","Hoverable","_templateObject2$1","Socket","title","setup$3","positionWatcher","socketPositionWatcher","getDOMSocketPosition","customize","node","connection","attach","plugin","context","parent","parentScope","Component","_Component","sourceOutput","targetInput","source","change","listen","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","_response$data","points","curvature","wrap","_callee$","_context","prev","next","sent","abrupt","length","Error","isLoop","loopConnectionPath","classicConnectionPath","stop","_x","_x2","arguments","_Component2","_Component3","ClassicPreset","InputControl","useDebounce","cb","timeout","cancel","clearTimeout","func","setTimeout","$contextColor","$contextColorLight","$contextColorDark","$contextMenuRound","$width","CommonStyle","_templateObject$7","ItemStyle","_templateObject$6","hasSubitems","_templateObject2","SubitemStyles","_templateObject3","ItemElement","_props$components","_props$components$ite","_props$components2","_props$components2$su","visibleSubitems","setVisibleSubitems","setInvisibile","useCallback","_useDebounce","delay","_useDebounce2","hide","cancelHide","components","call","Subitems","subitems","onClick","handler","Boolean","onPointerDown","onPointerOver","onPointerLeave","SearchInput","_templateObject$5","Search","component","onInput","Styles$3","_templateObject$4","Menu","_props$components$mai","_props$components2$co","_props$components3","_props$components3$se","onHide","filter","setFilter","filterRegexp","RegExp","filteredList","items","match","main","Common","common","onMouseOver","onMouseLeave","onWheel","searchBar","search","setup$2","undefined","__awaiter","thisArg","_arguments","P","generator","adopt","resolve","Promise","reject","fulfilled","step","rejected","result","useElementSize","setRef","size","setSize","handleSize","offsetWidth","offsetHeight","useEventListener","useIsomorphicLayoutEffect","eventName","options","savedHandler","_a","targetElement","listener","event","useLayoutEffect","px","Styles$2","_templateObject$3","MiniNode","style","left","top","MiniViewportStyles","_templateObject$2","MiniViewport","scale","v","containerWidth","invert","drag","pageX","pageY","Styles$1","_templateObject$1","Minimap","_useElementSize","_useElementSize2","containerRef","ratio","preventDefault","onDoubleClick","box","getBoundingClientRect","clientX","clientY","point","nodes","i","viewport","setup$1","pinSize","Styles","_templateObject","Pin","pointer","_props$position","position","pointerdown","onContextMenu","contextMenu","setup","renderPins","Fragment","pins","pin","area","BaseAreaPlugin","ReactPlugin","_Scope","_inherits","_super","_createSuper","_this","_classCallCheck","_defineProperty","_assertThisInitialized","renderer","addPipe","_typeof","filled","_objectSpread","_createClass","setParent","scope","_this2","_get","_getPrototypeOf","prototype","presets","forEach","preset","_createForOfIteratorHelper","reactElement","addPreset","local","push","Scope"],"sources":["/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/renderer.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/utils.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/classic/components/ConnectionWrapper.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/classic/components/Connection.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/shared/utils.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/shared/drag.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/classic/components/Control.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/classic/vars.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/ref-component.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/classic/components/refs/RefControl.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/classic/components/refs/RefSocket.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/classic/components/Node.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/classic/components/Socket.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/classic/index.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/context-menu/hooks.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/context-menu/vars.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/context-menu/styles.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/context-menu/components/Item.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/context-menu/components/Search.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/context-menu/components/Menu.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/context-menu/index.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/node_modules/usehooks-ts/dist/esm/useCopyToClipboard/useCopyToClipboard.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/node_modules/usehooks-ts/dist/esm/useElementSize/useElementSize.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/node_modules/usehooks-ts/dist/esm/useEventListener/useEventListener.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/node_modules/usehooks-ts/dist/esm/useFetch/useFetch.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/node_modules/usehooks-ts/dist/esm/useIsomorphicLayoutEffect/useIsomorphicLayoutEffect.js","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/minimap/utils.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/minimap/components/MiniNode.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/minimap/components/MiniViewport.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/minimap/components/Minimap.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/minimap/index.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/reroute-pins/Pin.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/reroute-pins/index.tsx","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/presets/index.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-react-plugin/src/index.tsx"],"sourcesContent":["import * as ReactDOM from 'react-dom'\n\nexport type Renderer = { mount: ReactDOM.Renderer, unmount: (container: HTMLElement) => void }\n\ntype CreateRoot = (container: Element | DocumentFragment) => any\n\nexport function getRenderer(props?: { createRoot?: CreateRoot }): Renderer {\n  const createRoot = props?.createRoot\n  const wrappers = new WeakMap<HTMLElement, HTMLElement>()\n\n  function getWrapper(container: HTMLElement) {\n    const wrapper = wrappers.get(container)\n\n    if (wrapper) return wrapper\n\n    const span = document.createElement('span')\n\n    container.appendChild(span)\n    return wrappers.set(container, span).get(container) as HTMLElement\n  }\n  function removeWrapper(container: HTMLElement) {\n    const wrapper = wrappers.get(container)\n\n    if (wrapper) wrapper.remove()\n    wrappers.delete(container)\n  }\n\n  if (createRoot) {\n    const roots = new WeakMap<HTMLElement, any>()\n\n    return {\n      mount: ((\n        element: React.DOMElement<React.DOMAttributes<any>, any>,\n        container: HTMLElement\n      ): Element => {\n        const wrapper = getWrapper(container)\n\n        if (!roots.has(wrapper)) {\n          roots.set(wrapper, createRoot(wrapper))\n        }\n        const root = roots.get(wrapper)\n\n        return root.render(element)\n      }) as ReactDOM.Renderer,\n      unmount: (container: HTMLElement) => {\n        const wrapper = getWrapper(container)\n        const root = roots.get(wrapper)\n\n        if (root) {\n          root.unmount()\n          roots.delete(wrapper)\n          removeWrapper(container)\n        }\n      }\n    }\n  }\n\n  return {\n    mount: ((element: React.DOMElement<React.DOMAttributes<any>, any>, container: HTMLElement): Element => {\n      return ReactDOM.render(element, getWrapper(container))\n    }) as ReactDOM.Renderer,\n    unmount: (container: HTMLElement) => {\n      ReactDOM.unmountComponentAtNode(getWrapper(container))\n      removeWrapper(container)\n    }\n  }\n}\n","import { useEffect, useRef, useState } from 'react'\nimport { flushSync } from 'react-dom'\n\nexport function Root({ children, rendered }: { children: JSX.Element | null, rendered: () => void }) {\n  useEffect(() => {\n    rendered()\n  })\n\n  return children\n}\n\nexport function syncFlush() {\n  const ready = useRef(false)\n\n  useEffect(() => {\n    ready.current = true\n  }, [])\n\n  return {\n    apply(f: () => void) {\n      if (ready.current) {\n        queueMicrotask(() => flushSync(f))\n      } else {\n        f()\n      }\n    }\n  }\n}\n\nexport function useRete<T extends { destroy(): void }>(create: (el: HTMLElement) => Promise<T>) {\n  const [container, setContainer] = useState<null | HTMLElement>(null)\n  const editorRef = useRef<T>()\n  const [editor, setEditor] = useState<T | null>(null)\n  const ref = useRef(null)\n\n  useEffect(() => {\n    if (container) {\n      if (editorRef.current) {\n        editorRef.current.destroy()\n        container.innerHTML = ''\n      }\n      create(container).then((value) => {\n        editorRef.current = value\n        setEditor(value)\n      })\n    }\n  }, [container, create])\n\n  useEffect(() => {\n    return () => {\n      if (editorRef.current) {\n        editorRef.current.destroy()\n      }\n    }\n  }, [])\n  useEffect(() => {\n    if (ref.current) {\n      setContainer(ref.current)\n    }\n  }, [ref.current])\n\n  return [ref, editor] as const\n}\n","import * as React from 'react'\nimport { createContext, useContext, useEffect, useState } from 'react'\n\nimport { Position } from '../../../types'\nimport { syncFlush } from '../../../utils'\n\nexport type ConnectionContextValue = { start: Position | null, end: Position | null, path: null | string }\n\nexport const ConnectionContext = createContext<ConnectionContextValue>({\n  start: null,\n  end: null,\n  path: null\n})\n\ntype PositionWatcher = (cb: (value: Position) => void) => (() => void)\n\ntype Props = {\n    children: JSX.Element,\n    start: Position | PositionWatcher,\n    end: Position | PositionWatcher,\n    path(start: Position, end: Position): Promise<null | string>\n}\n\nexport function ConnectionWrapper(props: Props) {\n  const { children } = props\n  const [computedStart, setStart] = useState<Position | null>(null)\n  const [computedEnd, setEnd] = useState<Position| null>(null)\n  const [path, setPath] = useState<string | null>(null)\n  const start = 'x' in props.start ? props.start : computedStart\n  const end = 'x' in props.end ? props.end : computedEnd\n  const flush = syncFlush()\n\n  useEffect(() => {\n    const unwatch1 = typeof props.start === 'function' && props.start(s => flush.apply(() => setStart(s)))\n    const unwatch2 = typeof props.end === 'function' && props.end(s => flush.apply(() => setEnd(s)))\n\n    return () => {\n      unwatch1 && unwatch1()\n      unwatch2 && unwatch2()\n    }\n  }, [])\n  useEffect(() => {\n    if (start && end) props.path(start, end).then(p => flush.apply(() => setPath(p)))\n  }, [start, end])\n\n  return (\n    <ConnectionContext.Provider value={{ start, end, path }}>\n      {children}\n    </ConnectionContext.Provider>\n  )\n}\n\nexport function useConnection() {\n  return useContext(ConnectionContext)\n}\n","import * as React from 'react'\nimport styled from 'styled-components'\n\nimport { ClassicScheme } from '../types'\nimport { useConnection } from './ConnectionWrapper'\n\nconst Svg = styled.svg`\n    overflow: visible !important;\n    position: absolute;\n    pointer-events: none;\n    width: 9999px;\n    height: 9999px;\n`\n\nconst Path = styled.path<{ styles?: (props: any) => any }>`\n    fill: none;\n    stroke-width: 5px;\n    stroke: steelblue;\n    pointer-events: auto;\n    ${props => props.styles && props.styles(props)}\n`\n\nexport function Connection(props: { data: ClassicScheme['Connection'] & { isLoop?: boolean }, styles?: () => any }) {\n  const { path } = useConnection()\n\n  if (!path) return null\n\n  return (\n    <Svg data-testid=\"connection\">\n      <Path\n        styles={props.styles}\n        d={path} />\n    </Svg>\n  )\n}\n","export function copyEvent<T extends Event & Record<string, any>>(e: T) {\n  const newEvent = new (e.constructor as { new(type: string): T })(e.type)\n  let current = newEvent\n\n  while ((current = Object.getPrototypeOf(current))) {\n    const keys = Object.getOwnPropertyNames(current)\n\n    for (const k of keys) {\n      const item = newEvent[k]\n\n      if (typeof item === 'function') continue\n\n      Object.defineProperty(newEvent, k, { value: e[k] })\n    }\n  }\n\n  return newEvent\n}\n\nconst rootPrefix = '__reactContainer$'\n\ntype Keys = `${typeof rootPrefix}${string}` | '_reactRootContainer'\ntype ReactNode = { [key in Keys]?: unknown } & HTMLElement\n\nexport function findReactRoot(element: HTMLElement) {\n  let current: ReactNode | null = element as ReactNode\n\n  while (current) {\n    if (current._reactRootContainer || Object.keys(current).some(key => key.startsWith(rootPrefix))) return current\n    current = current.parentElement as ReactNode\n  }\n}\n","import * as React from 'react'\n\nimport { Position } from '../types'\nimport { copyEvent, findReactRoot } from './utils'\n\ntype Translate = (dx: number, dy: number) => void\ntype StartEvent = { pageX: number, pageY: number }\n\nexport function useDrag(translate: Translate, getPointer: (e: StartEvent) => Position) {\n  return {\n    start(e: StartEvent) {\n      let previous = { ...getPointer(e) }\n\n      function move(moveEvent: MouseEvent) {\n        const current = { ...getPointer(moveEvent) }\n        const dx = current.x - previous.x\n        const dy = current.y - previous.y\n\n        previous = current\n\n        translate(dx, dy)\n      }\n      function up() {\n        window.removeEventListener('pointermove', move)\n        window.removeEventListener('pointerup', up)\n        window.removeEventListener('pointercancel', up)\n      }\n\n      window.addEventListener('pointermove', move)\n      window.addEventListener('pointerup', up)\n      window.addEventListener('pointercancel', up)\n    }\n  }\n}\n\nexport function useNoDrag(ref: React.MutableRefObject<HTMLElement | null>, disabled?: boolean) {\n  React.useEffect(() => {\n    const handleClick = (e: PointerEvent) => {\n      if (disabled) return\n\n      const root = findReactRoot(e.target as HTMLElement)\n      const target = React.version.startsWith('16') ? document : root\n\n      if (target) {\n        e.stopPropagation()\n        target.dispatchEvent(copyEvent(e))\n      }\n    }\n    const el = ref.current\n\n    el?.addEventListener('pointerdown', handleClick)\n\n    return () => {\n      el?.removeEventListener('pointerdown', handleClick)\n    }\n  }, [ref, disabled])\n}\n\nexport function NoDrag(props: { children: React.ReactNode, disabled?: boolean }) {\n  const ref = React.useRef<HTMLDivElement | null>(null)\n\n  useNoDrag(ref, props.disabled)\n\n  return <span ref={ref}>{props.children}</span>\n}\n","import * as React from 'react'\nimport { ClassicPreset } from 'rete'\nimport styled from 'styled-components'\n\nimport { Drag } from '../../../shared'\n\nconst Input = styled.input<{ styles?: (props: any) => any }>`\n  width: 100%;\n  border-radius: 30px;\n  background-color: white;\n  padding: 2px 6px;\n  border: 1px solid #999;\n  font-size: 110%;\n  box-sizing: border-box;\n  ${props => props.styles && props.styles(props)}\n`\n\nexport function Control<N extends 'text' | 'number'>(props: { data: ClassicPreset.InputControl<N>, styles?: () => any }) {\n  const [value, setValue] = React.useState(props.data.value)\n  const ref = React.useRef(null)\n\n  Drag.useNoDrag(ref)\n\n  React.useEffect(() => {\n    setValue(props.data.value)\n  }, [props.data.value])\n\n  return (\n    <Input\n      value={value}\n      type={props.data.type}\n      ref={ref}\n      readOnly={props.data.readonly}\n      onChange={e => {\n        const val = (props.data.type === 'number'\n          ? +e.target.value\n          : e.target.value) as typeof props.data['value']\n\n        setValue(val)\n        props.data.setValue(val)\n      }}\n      styles={props.styles}\n    />\n  )\n}\n","export const $nodecolor = 'rgba(110,136,255,0.8)'\nexport const $nodecolorselected = '#ffd92c'\nexport const $socketsize = 24\nexport const $socketmargin = 6\nexport const $socketcolor = '#96b38a'\nexport const $nodewidth = 180\n","import * as React from 'react'\n\ntype RefUpdate = (ref: HTMLElement) => void\ntype BaseProps = { init: RefUpdate, unmount: RefUpdate } & Record<string, unknown>\n\n/**\n * Component for rendering various elements embedded in the React.js component tree.\n */\nexport function RefComponent<Props extends BaseProps>({ init, unmount, ...props }: Props) {\n  const ref = React.useRef<HTMLSpanElement>(null)\n\n  React.useEffect(() => {\n    const element = ref.current\n\n    return () => {\n      if (element) unmount(element)\n    }\n  }, [])\n  React.useEffect(() => {\n    if (ref.current) init(ref.current)\n  })\n\n  return <span {...props} ref={ref} />\n}\n","import * as React from 'react'\nimport { ClassicPreset } from 'rete'\n\nimport { RefComponent } from '../../../../ref-component'\nimport { ClassicScheme, GetControls, ReactArea2D } from '../../types'\n\ntype Props<Scheme extends ClassicScheme> = {\n  name: string\n  emit: (props: ReactArea2D<Scheme>) => void\n  payload: ClassicPreset.Control\n}\n\nexport function RefControl<Scheme extends ClassicScheme>({ name, emit, payload, ...props }: Props<Scheme>) {\n  return <RefComponent\n    {...props}\n    className={name}\n    init={ref => emit({ type: 'render', data: {\n      type: 'control',\n      element: ref,\n      payload: payload as GetControls<Scheme['Node']>\n    } })}\n    unmount={ref => emit({ type: 'unmount', data: { element: ref } })}\n  />\n}\n","import * as React from 'react'\nimport { ClassicPreset, NodeId } from 'rete'\n\nimport { RefComponent } from '../../../../ref-component'\nimport { ClassicScheme, GetSockets, ReactArea2D, Side } from '../../types'\n\ntype Props<Scheme extends ClassicScheme> = {\n  name: string\n  emit: (props: ReactArea2D<Scheme>) => void\n  side: Side\n  nodeId: NodeId\n  socketKey: string\n  payload: ClassicPreset.Socket\n}\n\nexport function RefSocket<Scheme extends ClassicScheme>({ name, emit, nodeId, side, socketKey, payload, ...props }: Props<Scheme>) {\n  return <RefComponent\n    {...props}\n    className={name}\n    init={ref => emit({ type: 'render', data: {\n      type: 'socket',\n      side,\n      key: socketKey,\n      nodeId,\n      element: ref,\n      payload: payload as GetSockets<Scheme['Node']>\n    } })}\n    unmount={ref => emit({ type: 'unmount', data: { element: ref } })}\n  />\n}\n","import * as React from 'react'\nimport styled, { css } from 'styled-components'\n\nimport { ClassicScheme, RenderEmit } from '../types'\nimport { $nodecolor, $nodecolorselected, $nodewidth, $socketmargin, $socketsize } from '../vars'\nimport { RefControl } from './refs/RefControl'\nimport { RefSocket } from './refs/RefSocket'\n\ntype NodeExtraData = { width?: number, height?: number }\n\nexport const NodeStyles = styled.div<NodeExtraData & { selected: boolean, styles?: (props: any) => any }>`\n    background: ${$nodecolor};\n    border: 2px solid #4e58bf;\n    border-radius: 10px;\n    cursor: pointer;\n    box-sizing: border-box;\n    width: ${props => Number.isFinite(props.width) ? `${props.width}px` : `${$nodewidth}px`};\n    height: ${props => Number.isFinite(props.height) ? `${props.height}px` : 'auto'};\n    padding-bottom: 6px;\n    position: relative;\n    user-select: none;\n    line-height: initial;\n    font-family: Arial;\n\n    &:hover {\n        background: lighten(${$nodecolor},4%);\n    }\n    ${props => props.selected && css`\n        background: ${$nodecolorselected};\n        border-color: #e3c000;\n    `}\n    .title {\n        color: white;\n        font-family: sans-serif;\n        font-size: 18px;\n        padding: 8px;\n    }\n    .output {\n        text-align: right;\n    }\n    .input {\n        text-align: left;\n    }\n    .output-socket {\n        text-align: right;\n        margin-right: -${$socketsize / 2 + $socketmargin}px;\n        display: inline-block;\n    }\n    .input-socket {\n        text-align: left;\n        margin-left: -${$socketsize / 2 + $socketmargin}px;\n        display: inline-block;\n    }\n    .input-title,.output-title {\n        vertical-align: middle;\n        color: white;\n        display: inline-block;\n        font-family: sans-serif;\n        font-size: 14px;\n        margin: ${$socketmargin}px;\n        line-height: ${$socketsize}px;\n    }\n    .input-control {\n        z-index: 1;\n        width: calc(100% - ${$socketsize + 2 * $socketmargin}px);\n        vertical-align: middle;\n        display: inline-block;\n    }\n    .control {\n        display: block;\n        padding: ${$socketmargin}px ${$socketsize / 2 + $socketmargin}px;\n    }\n    ${props => props.styles && props.styles(props)}\n`\n\nfunction sortByIndex<T extends [string, undefined | { index?: number }][]>(entries: T) {\n  entries.sort((a, b) => {\n    const ai = a[1]?.index || 0\n    const bi = b[1]?.index || 0\n\n    return ai - bi\n  })\n}\n\ntype Props<S extends ClassicScheme> = {\n    data: S['Node'] & NodeExtraData\n    styles?: () => any\n    emit: RenderEmit<S>\n}\nexport type NodeComponent<Scheme extends ClassicScheme> = (props: Props<Scheme>) => JSX.Element\n\n// eslint-disable-next-line max-statements\nexport function Node<Scheme extends ClassicScheme>(props: Props<Scheme>) {\n  const inputs = Object.entries(props.data.inputs)\n  const outputs = Object.entries(props.data.outputs)\n  const controls = Object.entries(props.data.controls)\n  const selected = props.data.selected || false\n  const { id, label, width, height } = props.data\n\n  sortByIndex(inputs)\n  sortByIndex(outputs)\n  sortByIndex(controls)\n\n  return (\n    <NodeStyles\n      selected={selected}\n      width={width}\n      height={height}\n      styles={props.styles}\n      data-testid=\"node\"\n    >\n      <div className=\"title\" data-testid=\"title\">{label}</div>\n      {/* Outputs */}\n      {outputs.map(([key, output]) => (\n        output && <div className=\"output\" key={key} data-testid={`output-${key}`}>\n          <div className=\"output-title\" data-testid=\"output-title\">{output?.label}</div>\n          <RefSocket\n            name=\"output-socket\"\n            side=\"output\"\n            socketKey={key}\n            nodeId={id}\n            emit={props.emit}\n            payload={output.socket}\n            data-testid=\"output-socket\"\n          />\n        </div>\n      ))}\n      {/* Controls */}\n      {controls.map(([key, control]) => {\n        return control ? <RefControl\n          key={key}\n          name=\"control\"\n          emit={props.emit}\n          payload={control}\n          data-testid={`control-${key}`}\n        /> : null\n      })}\n      {/* Inputs */}\n      {inputs.map(([key, input]) => (\n        input && <div className=\"input\" key={key} data-testid={`input-${key}`}>\n          <RefSocket\n            name=\"input-socket\"\n            side=\"input\"\n            socketKey={key}\n            nodeId={id}\n            emit={props.emit}\n            payload={input.socket}\n            data-testid=\"input-socket\"\n          />\n          {input && (!input.control || !input.showControl) && (\n            <div className=\"input-title\" data-testid=\"input-title\">{input?.label}</div>\n          )}\n          {input?.control && input?.showControl && (\n            <RefControl\n              key={key}\n              name=\"input-control\"\n              emit={props.emit}\n              payload={input.control}\n              data-testid=\"input-control\"\n            />\n          )\n          }\n        </div>\n      ))}\n    </NodeStyles>\n  )\n}\n","import * as React from 'react'\nimport { ClassicPreset } from 'rete'\nimport styled from 'styled-components'\n\nimport { $socketcolor, $socketmargin, $socketsize } from '../vars'\n\nconst Styles = styled.div`\n    display: inline-block;\n    cursor: pointer;\n    border: 1px solid white;\n    border-radius: ${$socketsize/2.0}px;\n    width: ${$socketsize}px;\n    height: ${$socketsize}px;\n    vertical-align: middle;\n    background: ${$socketcolor};\n    z-index: 2;\n    box-sizing: border-box;\n    &:hover {\n      border-width: 4px;\n    }\n    &.multiple {\n      border-color: yellow;\n    }\n`\n\nconst Hoverable = styled.div`\n    border-radius: ${($socketsize + $socketmargin * 2)/2.0}px;\n    padding: ${$socketmargin}px;\n    &:hover ${Styles} {\n      border-width: 4px;\n    }\n`\n\nexport function Socket<T extends ClassicPreset.Socket>(props: { data: T }) {\n  return (\n    <Hoverable>\n      <Styles title={props.data.name} />\n    </Hoverable>\n  )\n}\n","import * as React from 'react'\nimport { ClassicPreset, Scope } from 'rete'\nimport {\n  classicConnectionPath, getDOMSocketPosition,\n  loopConnectionPath, SocketPositionWatcher\n} from 'rete-render-utils'\n\nimport { Position } from '../../types'\nimport { RenderPreset } from '../types'\nimport { Connection } from './components/Connection'\nimport { ConnectionWrapper } from './components/ConnectionWrapper'\nimport { Control } from './components/Control'\nimport { Node } from './components/Node'\nimport { Socket } from './components/Socket'\nimport {\n  ClassicScheme, ExtractPayload, ReactArea2D, RenderEmit\n} from './types'\nimport { AcceptComponent } from './utility-types'\n\nexport { Connection } from './components/Connection'\nexport { useConnection } from './components/ConnectionWrapper'\nexport { Control } from './components/Control'\nexport { Control as InputControl } from './components/Control'\nexport { Node, NodeStyles } from './components/Node'\nexport { RefControl } from './components/refs/RefControl'\nexport { RefSocket } from './components/refs/RefSocket'\nexport { Socket } from './components/Socket'\nexport type { ClassicScheme, ReactArea2D, RenderEmit } from './types'\nexport * as vars from './vars'\n\ntype CustomizationProps<Schemes extends ClassicScheme> = {\n  node?: (data: ExtractPayload<Schemes, 'node'>) => AcceptComponent<typeof data['payload'], { emit: RenderEmit<Schemes> }> | null\n  connection?: (data: ExtractPayload<Schemes, 'connection'>) => AcceptComponent<typeof data['payload']> | null\n  socket?: (data: ExtractPayload<Schemes, 'socket'>) => AcceptComponent<typeof data['payload']> | null\n  control?: (data: ExtractPayload<Schemes, 'control'>) => AcceptComponent<typeof data['payload']> | null\n}\n\ntype ClassicProps<Schemes extends ClassicScheme, K> = {\n  socketPositionWatcher?: SocketPositionWatcher<Scope<never, [K]>>\n  customize?: CustomizationProps<Schemes>\n}\n\n/**\n * Classic preset for rendering nodes, connections, controls and sockets.\n */\nexport function setup<Schemes extends ClassicScheme, K extends ReactArea2D<Schemes>>(\n  props?: ClassicProps<Schemes, K>\n): RenderPreset<Schemes, K> {\n  const positionWatcher = typeof props?.socketPositionWatcher === 'undefined'\n    ? getDOMSocketPosition<Schemes, K>()\n    : props?.socketPositionWatcher\n  const { node, connection, socket, control } = props?.customize || {}\n\n  return {\n    attach(plugin) {\n      positionWatcher.attach(plugin as unknown as Scope<never, [K]>)\n    },\n    // eslint-disable-next-line max-statements, complexity\n    render(context, plugin) {\n      if (context.data.type === 'node') {\n        const parent = plugin.parentScope()\n        const Component = (node ? node(context.data) : Node) as typeof Node\n\n        return (Component &&\n          <Component\n            data={context.data.payload}\n            emit={data => parent.emit(data as any)}\n          />\n        )\n      } else if (context.data.type === 'connection') {\n        const Component = (connection ? connection(context.data) : Connection) as typeof Connection\n        const payload = context.data.payload\n        const { sourceOutput, targetInput, source, target } = payload\n\n        return (Component &&\n          <ConnectionWrapper\n            start={context.data.start || (change => positionWatcher.listen(source, 'output', sourceOutput, change))}\n            end={context.data.end || (change => positionWatcher.listen(target, 'input', targetInput, change))}\n            path={async (start, end) => {\n              type FixImplicitAny = typeof plugin.__scope.produces | undefined\n              const response: FixImplicitAny = await plugin.emit({\n                type: 'connectionpath', data: {\n                  payload,\n                  points: [start, end]\n                }\n              })\n\n              if (!response) return ''\n\n              const { path, points } = response.data\n              const curvature = 0.3\n\n              if (!path && points.length !== 2) throw new Error('cannot render connection with a custom number of points')\n              if (!path) return payload.isLoop\n                ? loopConnectionPath(points as [Position, Position], curvature, 120)\n                : classicConnectionPath(points as [Position, Position], curvature)\n\n              return path\n            }}\n          >\n            <Component data={context.data.payload} />\n          </ConnectionWrapper>\n        )\n      } else if (context.data.type === 'socket') {\n        const Component = (socket ? socket(context.data) : Socket) as typeof Socket\n\n        return (Component && context.data.payload && <Component data={context.data.payload} />\n        )\n      } else if (context.data.type === 'control') {\n        const Component = control && context.data.payload\n          ? control(context.data)\n          : (\n            context.data.payload instanceof ClassicPreset.InputControl\n              ? Control\n              : null\n          )\n\n        return Component && <Component data={context.data.payload as any} />\n      }\n    }\n  }\n}\n","import { useEffect, useRef } from 'react'\n\nexport function useDebounce(cb: () => void, timeout: number): [null | (() => void), () => void] {\n  const ref = useRef<ReturnType<typeof setTimeout>>()\n\n  function cancel() {\n    ref.current && clearTimeout(ref.current)\n  }\n  const func = () => {\n    cancel()\n\n    ref.current = setTimeout(() => {\n      cb()\n    }, timeout)\n  }\n\n  useEffect(() => cancel, [])\n\n  return [\n    func,\n    cancel\n  ]\n}\n","\nexport const $contextColor = 'rgba(110,136,255,0.8)'\nexport const $contextColorLight = 'rgba(130, 153, 255, 0.8)'\nexport const $contextColorDark = 'rgba(69, 103, 255, 0.8)'\nexport const $contextMenuRound = '5px'\nexport const $width = 120\n","import styled from 'styled-components'\n\nimport { $contextColor, $contextColorDark, $contextColorLight, $contextMenuRound } from './vars'\n\nexport const CommonStyle = styled.div`\n  color: #fff;\n  padding: 4px;\n  border-bottom: 1px solid ${$contextColorDark};\n  background-color: ${$contextColor};\n  cursor: pointer;\n  width: 100%;\n  position: relative;\n  &:first-child {\n    border-top-left-radius: ${$contextMenuRound};\n    border-top-right-radius: ${$contextMenuRound};\n  }\n  &:last-child {\n    border-bottom-left-radius: ${$contextMenuRound};\n    border-bottom-right-radius: ${$contextMenuRound};\n  }\n  &:hover {\n    background-color: ${$contextColorLight};\n  }\n`\n","import * as React from 'react'\nimport styled, { css } from 'styled-components'\n\nimport { useDebounce } from '../hooks'\nimport { CommonStyle } from '../styles'\nimport { Customize, Item } from '../types'\nimport { $width } from '../vars'\n\nexport const ItemStyle = styled(CommonStyle) <{ hasSubitems?: boolean }>`\n    ${props => props.hasSubitems && css`&:after {\n    content: '►';\n    position: absolute;\n    opacity: 0.6;\n    right: 5px;\n    top: 5px;\n    }`}\n`\n\nexport const SubitemStyles = styled.div`\n    position: absolute;\n    top: 0;\n    left: 100%;\n    width: ${$width}px;\n`\n\ntype Props = {\n  data: Item\n  delay: number\n  hide(): void\n  children: React.ReactNode\n  components?: Pick<Customize, 'item' | 'subitems'>\n}\n\nexport function ItemElement(props: Props) {\n  const [visibleSubitems, setVisibleSubitems] = React.useState(false)\n  const setInvisibile = React.useCallback(() => setVisibleSubitems(false), [setVisibleSubitems])\n  const [hide, cancelHide] = useDebounce(setInvisibile, props.delay)\n  const Component = props.components?.item?.(props.data) || ItemStyle\n  const Subitems = props.components?.subitems?.(props.data) || SubitemStyles\n\n  return <Component\n    onClick={e => { e.stopPropagation(); props.data.handler(); props.hide() }}\n    hasSubitems={Boolean(props.data.subitems)}\n    onPointerDown={e => e.stopPropagation()}\n    onPointerOver={() => { cancelHide(); setVisibleSubitems(true) }}\n    onPointerLeave={() => hide && hide()}\n    data-testid=\"context-menu-item\"\n  >\n    {props.children}\n    {props.data.subitems && visibleSubitems && (\n      <Subitems>\n        {props.data.subitems.map(item => (\n          <ItemElement\n            key={item.key}\n            data={item}\n            delay={props.delay}\n            hide={props.hide}\n            components={props.components}\n          >{item.label}</ItemElement>\n        ))}\n      </Subitems>\n    )}\n  </Component>\n}\n","import * as React from 'react'\nimport styled from 'styled-components'\n\nimport { ComponentType } from '../types'\n\nexport const SearchInput = styled.input`\n  color: white;\n  padding: 1px 8px;\n  border: 1px solid white;\n  border-radius: 10px;\n  font-size: 16px;\n  font-family: serif;\n  width: 100%;\n  box-sizing: border-box;\n  background: transparent;\n`\n\nexport function Search(props: { value: string, onChange(value: string): void, component?: ComponentType }) {\n  const Component = props.component || SearchInput\n\n  return (\n    <Component\n      value={props.value}\n      onInput={e => props.onChange((e.target as HTMLInputElement).value)}\n      onPointerDown={e => e.stopPropagation()}\n      data-testid=\"context-menu-search-input\"\n    />\n  )\n}\n","import * as React from 'react'\nimport styled from 'styled-components'\n\nimport { useDebounce } from '../hooks'\nimport { CommonStyle } from '../styles'\nimport { Customize, Item } from '../types'\nimport { $width } from '../vars'\nimport { ItemElement } from './Item'\nimport { Search } from './Search'\n\nexport const Styles = styled.div`\n  padding: 10px;\n  width: ${$width}px;\n  margin-top: -20px;\n  margin-left: -${$width / 2}px;\n`\n\ntype Props = {\n  items: Item[]\n  delay: number\n  searchBar?: boolean\n  onHide(): void\n  components?: Customize\n}\n\nexport function Menu(props: Props) {\n  const [hide, cancelHide] = useDebounce(props.onHide, props.delay)\n  const [filter, setFilter] = React.useState('')\n  const filterRegexp = new RegExp(filter, 'i')\n  const filteredList = props.items.filter(item => (\n    item.label.match(filterRegexp)\n  ))\n  const Component = props.components?.main?.() || Styles\n  const Common = props.components?.common?.() || CommonStyle\n\n  return <Component\n    onMouseOver={() => cancelHide()}\n    onMouseLeave={() => hide && hide()}\n    onWheel={e => e.stopPropagation()}\n    data-testid=\"context-menu\"\n  >\n    {props.searchBar && (\n      <Common>\n        <Search value={filter} onChange={setFilter} component={props.components?.search?.()} />\n      </Common>\n    )}\n    {filteredList.map(item => {\n      return <ItemElement\n        key={item.key}\n        data={item}\n        delay={props.delay}\n        hide={props.onHide}\n        components={props.components}\n      >\n        {item.label}\n      </ItemElement>\n    })}\n  </Component>\n}\n","\nimport * as React from 'react'\nimport { BaseSchemes } from 'rete'\n\nimport { RenderPreset } from '../types'\nimport { Menu } from './components/Menu'\nimport { ContextMenuRender, Customize } from './types'\n\nexport { ItemStyle as Item, SubitemStyles as Subitems } from './components/Item'\nexport { Styles as Menu } from './components/Menu'\nexport { SearchInput as Search } from './components/Search'\nexport { CommonStyle as Common } from './styles'\n\ntype Props = {\n  delay?: number\n  customize?: Customize\n}\n\n/**\n * Preset for rendering context menu.\n */\nexport function setup<Schemes extends BaseSchemes, K extends ContextMenuRender>(props?: Props): RenderPreset<Schemes, K> {\n  const delay = typeof props?.delay === 'undefined' ? 1000 : props.delay\n\n  return {\n    render(context) {\n      if (context.data.type === 'contextmenu') {\n        return <Menu\n          items={context.data.items}\n          delay={delay}\n          searchBar={context.data.searchBar}\n          onHide={context.data.onHide}\n          components={props?.customize}\n        />\n      }\n    }\n  }\n}\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { useState } from 'react';\nfunction useCopyToClipboard() {\n    const [copiedText, setCopiedText] = useState(null);\n    const copy = (text) => __awaiter(this, void 0, void 0, function* () {\n        if (!(navigator === null || navigator === void 0 ? void 0 : navigator.clipboard)) {\n            console.warn('Clipboard not supported');\n            return false;\n        }\n        try {\n            yield navigator.clipboard.writeText(text);\n            setCopiedText(text);\n            return true;\n        }\n        catch (error) {\n            console.warn('Copy failed', error);\n            setCopiedText(null);\n            return false;\n        }\n    });\n    return [copiedText, copy];\n}\nexport default useCopyToClipboard;\n","import { useCallback, useState } from 'react';\nimport { useEventListener, useIsomorphicLayoutEffect } from '..';\nfunction useElementSize() {\n    const [ref, setRef] = useState(null);\n    const [size, setSize] = useState({\n        width: 0,\n        height: 0,\n    });\n    const handleSize = useCallback(() => {\n        setSize({\n            width: (ref === null || ref === void 0 ? void 0 : ref.offsetWidth) || 0,\n            height: (ref === null || ref === void 0 ? void 0 : ref.offsetHeight) || 0,\n        });\n    }, [ref === null || ref === void 0 ? void 0 : ref.offsetHeight, ref === null || ref === void 0 ? void 0 : ref.offsetWidth]);\n    useEventListener('resize', handleSize);\n    useIsomorphicLayoutEffect(() => {\n        handleSize();\n    }, [ref === null || ref === void 0 ? void 0 : ref.offsetHeight, ref === null || ref === void 0 ? void 0 : ref.offsetWidth]);\n    return [setRef, size];\n}\nexport default useElementSize;\n","import { useEffect, useRef } from 'react';\nimport { useIsomorphicLayoutEffect } from '..';\nfunction useEventListener(eventName, handler, element, options) {\n    const savedHandler = useRef(handler);\n    useIsomorphicLayoutEffect(() => {\n        savedHandler.current = handler;\n    }, [handler]);\n    useEffect(() => {\n        var _a;\n        const targetElement = (_a = element === null || element === void 0 ? void 0 : element.current) !== null && _a !== void 0 ? _a : window;\n        if (!(targetElement && targetElement.addEventListener))\n            return;\n        const listener = event => savedHandler.current(event);\n        targetElement.addEventListener(eventName, listener, options);\n        return () => {\n            targetElement.removeEventListener(eventName, listener, options);\n        };\n    }, [eventName, element, options]);\n}\nexport default useEventListener;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { useEffect, useReducer, useRef } from 'react';\nfunction useFetch(url, options) {\n    const cache = useRef({});\n    const cancelRequest = useRef(false);\n    const initialState = {\n        error: undefined,\n        data: undefined,\n    };\n    const fetchReducer = (state, action) => {\n        switch (action.type) {\n            case 'loading':\n                return Object.assign({}, initialState);\n            case 'fetched':\n                return Object.assign(Object.assign({}, initialState), { data: action.payload });\n            case 'error':\n                return Object.assign(Object.assign({}, initialState), { error: action.payload });\n            default:\n                return state;\n        }\n    };\n    const [state, dispatch] = useReducer(fetchReducer, initialState);\n    useEffect(() => {\n        if (!url)\n            return;\n        cancelRequest.current = false;\n        const fetchData = () => __awaiter(this, void 0, void 0, function* () {\n            dispatch({ type: 'loading' });\n            if (cache.current[url]) {\n                dispatch({ type: 'fetched', payload: cache.current[url] });\n                return;\n            }\n            try {\n                const response = yield fetch(url, options);\n                if (!response.ok) {\n                    throw new Error(response.statusText);\n                }\n                const data = (yield response.json());\n                cache.current[url] = data;\n                if (cancelRequest.current)\n                    return;\n                dispatch({ type: 'fetched', payload: data });\n            }\n            catch (error) {\n                if (cancelRequest.current)\n                    return;\n                dispatch({ type: 'error', payload: error });\n            }\n        });\n        void fetchData();\n        return () => {\n            cancelRequest.current = true;\n        };\n    }, [url]);\n    return state;\n}\nexport default useFetch;\n","import { useEffect, useLayoutEffect } from 'react';\nconst useIsomorphicLayoutEffect = typeof window !== 'undefined' ? useLayoutEffect : useEffect;\nexport default useIsomorphicLayoutEffect;\n","export function px(value: number) {\n  return `${value}px`\n}\n","import * as React from 'react'\nimport styled from 'styled-components'\n\nimport { px } from '../utils'\n\nconst Styles = styled.div`\n    position: absolute;\n    background: rgba(110, 136, 255, 0.8);\n    border: 1px solid rgb(192 206 212 / 60%);\n`\n\nexport function MiniNode(props: { left: number, top: number, width: number, height: number }) {\n  return <Styles style={{\n    left: px(props.left),\n    top: px(props.top),\n    width: px(props.width),\n    height: px(props.height)\n  }} data-testid=\"minimap-node\"/>\n}\n","import * as React from 'react'\nimport styled from 'styled-components'\n\nimport { useDrag } from '../../../shared/drag'\nimport { Rect, Transform, Translate } from '../types'\nimport { px } from '../utils'\n\nconst MiniViewportStyles = styled.div`\n  position: absolute;\n  background: rgba(255, 251, 128, 0.32);\n  border: 1px solid #ffe52b;\n`\n\nexport function MiniViewport(props: Rect & { containerWidth: number, start(): Transform, translate: Translate }) {\n  const scale = (v: number) => v * props.containerWidth\n  const invert = (v: number) => v / props.containerWidth\n  const drag = useDrag((dx, dy) => props.translate(invert(-dx), invert(-dy)), e => ({ x: e.pageX, y: e.pageY }))\n\n  return <MiniViewportStyles\n    onPointerDown={drag.start}\n    style={{\n      left: px(scale(props.left)),\n      top: px(scale(props.top)),\n      width: px(scale(props.width)),\n      height: px(scale(props.height))\n    }}\n    data-testid=\"minimap-viewport\"\n  />\n}\n","import * as React from 'react'\nimport { useCallback, useRef } from 'react'\nimport styled from 'styled-components'\nimport { useElementSize } from 'usehooks-ts'\n\nimport { Rect, Transform, Translate } from '../types'\nimport { px } from '../utils'\nimport { MiniNode } from './MiniNode'\nimport { MiniViewport } from './MiniViewport'\n\nconst Styles = styled.div<{ size: number }>`\n    position: absolute;\n    right: 24px;\n    bottom: 24px;\n    background: rgba(229, 234, 239, 0.65);\n    padding: 20px;\n    overflow: hidden;\n    border: 1px solid #b1b7ff;\n    border-radius: 8px;\n    box-sizing: border-box;\n`\n\ntype Props = {\n    size: number\n    ratio: number\n    nodes: Rect[]\n    viewport: Rect\n    start(): Transform\n    translate: Translate\n    point(x: number, y: number): void\n}\n\nexport function Minimap(props: Props) {\n  const container = useRef<HTMLElement | null>()\n  const [containerRef, { width: containerWidth }] = useElementSize()\n  const scale = (v: number) => v * containerWidth\n  const ref = useCallback((node: HTMLDivElement | null) => {\n    container.current = node\n    containerRef(node)\n  }, [containerRef])\n\n  return <Styles\n    size={props.size}\n    style={{\n      width: px(props.size * props.ratio),\n      height: px(props.size)\n    }}\n    onPointerDown={e => {\n      e.stopPropagation()\n      e.preventDefault()\n    }}\n    onDoubleClick={e => {\n      e.stopPropagation()\n      e.preventDefault()\n      if (!container.current) return\n      const box = container.current.getBoundingClientRect()\n      const x = (e.clientX - box.left) / (props.size * props.ratio)\n      const y = (e.clientY - box.top) / (props.size * props.ratio)\n\n      props.point(x, y)\n    }}\n    ref={ref}\n    data-testid=\"minimap\"\n  >\n    {containerWidth && props.nodes.map((node, i) => (\n      <MiniNode\n        key={i}\n        left={scale(node.left)}\n        top={scale(node.top)}\n        width={scale(node.width)}\n        height={scale(node.height)}\n      />\n    ))}\n    <MiniViewport\n      {...props.viewport}\n      start={props.start}\n      containerWidth={containerWidth}\n      translate={props.translate}\n    />\n  </Styles>\n}\n","\nimport * as React from 'react'\nimport { BaseSchemes } from 'rete'\n\nimport { RenderPreset } from '../types'\nimport { Minimap } from './components/Minimap'\nimport { MinimapRender } from './types'\n\n/**\n * Preset for rendering minimap.\n */\nexport function setup<Schemes extends BaseSchemes, K extends MinimapRender>(props?: { size?: number }): RenderPreset<Schemes, K> {\n  return {\n    render(context) {\n      if (context.data.type === 'minimap') {\n        return <Minimap\n          nodes={context.data.nodes}\n          size={props?.size || 200}\n          ratio={context.data.ratio}\n          viewport={context.data.viewport}\n          start={context.data.start}\n          translate={context.data.translate}\n          point={context.data.point}\n        />\n      }\n    }\n  }\n}\n","import * as React from 'react'\nimport styled, { } from 'styled-components'\n\nimport { useDrag } from '../../shared/drag'\nimport { Position } from '../../types'\nimport { Pin as PinType } from './types'\n\nconst pinSize = 20\n\nconst Styles = styled.div<{ selected?: boolean }>`\n  width: ${pinSize}px;\n  height: ${pinSize}px;\n  box-sizing: border-box;\n  background: ${props => props.selected ? '#ffd92c' : 'steelblue'};\n  border: 2px solid white;\n  border-radius: ${pinSize}px;\n`\n\ntype Props = PinType & {\n    contextMenu(): void\n    translate(dx: number, dy: number): void\n    pointerdown(): void\n    pointer(): Position\n}\n\nexport function Pin(props: Props) {\n  const drag = useDrag((dx, dy) => props.translate(dx, dy), props.pointer)\n  const { x, y } = props.position\n\n  return (\n    <Styles\n      onPointerDown={e => {\n        e.stopPropagation()\n        e.preventDefault()\n        drag.start(e)\n        props.pointerdown()\n      }}\n      onContextMenu={e => {\n        e.stopPropagation()\n        e.preventDefault()\n        props.contextMenu()\n      }}\n      selected={props.selected}\n      style={{ position: 'absolute', top: `${y - pinSize / 2}px`, left: `${x - pinSize / 2}px` }}\n      data-testid=\"pin\"\n    >\n\n    </Styles>\n  )\n}\n","\nimport * as React from 'react'\nimport { BaseSchemes } from 'rete'\nimport { BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { Position } from '../../types'\nimport { RenderPreset } from '../types'\nimport { Pin } from './Pin'\nimport { PinData, PinsRender } from './types'\n\ntype Props = {\n  translate?: (id: string, dx: number, dy: number) => void\n  contextMenu?: (id: string) => void\n  pointerdown?: (id: string) => void\n}\n\n/**\n * Preset for rendering pins.\n */\nexport function setup<Schemes extends BaseSchemes, K extends PinsRender>(props?: Props): RenderPreset<Schemes, K> {\n  function renderPins(data: PinData, pointer: () => Position) {\n    return <>\n      {data.pins.map(pin => (\n        <Pin\n          {...pin}\n          key={pin.id}\n          contextMenu={() => props?.contextMenu && props.contextMenu(pin.id)}\n          translate={(dx, dy) => props?.translate && props.translate(pin.id, dx, dy)}\n          pointerdown={() => props?.pointerdown && props.pointerdown(pin.id)}\n          pointer={pointer}\n        />\n      ))}\n    </>\n  }\n\n  return {\n    render(context, plugin) {\n      const data = context.data\n      const area = plugin.parentScope<BaseAreaPlugin<Schemes, PinsRender>>(BaseAreaPlugin)\n\n      if (data.type === 'reroute-pins') {\n        return renderPins(data.data, () => area.area.pointer)\n      }\n    }\n  }\n}\n","/**\n * Built-in presets, responsible for rendering different parts of the editor.\n * @module\n */\nexport * as classic from './classic'\nexport * as contextMenu from './context-menu'\nexport * as minimap from './minimap'\nexport * as reroute from './reroute-pins'\n","import * as React from 'react'\nimport { BaseSchemes, CanAssignSignal, Scope } from 'rete'\n\nimport { RenderPreset } from './presets/types'\nimport { getRenderer, Renderer } from './renderer'\nimport { Position, RenderSignal } from './types'\nimport { Root } from './utils'\n\nexport * as Presets from './presets'\nexport type { ClassicScheme, ReactArea2D, RenderEmit } from './presets/classic'\nexport { RefComponent } from './ref-component'\nexport * from './shared'\nexport * from './types'\nexport { useRete } from './utils'\n\n/**\n * Signals that can be emitted by the plugin\n * @priority 9\n */\nexport type Produces<Schemes extends BaseSchemes> =\n  | { type: 'connectionpath', data: { payload: Schemes['Connection'], path?: string, points: Position[] } }\n\ntype Requires<Schemes extends BaseSchemes> =\n  | RenderSignal<'node', { payload: Schemes['Node'] }>\n  | RenderSignal<'connection', { payload: Schemes['Connection'], start?: Position, end?: Position }>\n  | { type: 'unmount', data: { element: HTMLElement } }\n\n/**\n * Plugin props\n */\nexport type Props = {\n  /** root factory for React.js 18+ */\n  createRoot?: (container: Element | DocumentFragment) => any\n}\n\n/**\n * React plugin. Renders nodes, connections and other elements using React.\n * @priority 10\n * @emits connectionpath\n * @listens render\n * @listens unmount\n */\nexport class ReactPlugin<Schemes extends BaseSchemes, T = Requires<Schemes>> extends Scope<Produces<Schemes>, [Requires<Schemes> | T]> {\n  renderer: Renderer\n  presets: RenderPreset<Schemes, T>[] = []\n\n  constructor(props?: Props) {\n    super('react-render')\n    this.renderer = getRenderer({ createRoot: props?.createRoot })\n\n    this.addPipe(context => {\n      if (!context || typeof context !== 'object' || !('type' in context)) return context\n      if (context.type === 'unmount') {\n        this.unmount(context.data.element)\n      } else if (context.type === 'render') {\n        if ('filled' in context.data && context.data.filled) {\n          return context\n        }\n        if (this.mount(context.data.element, context)) {\n          return {\n            ...context,\n            data: {\n              ...context.data,\n              filled: true\n            }\n          } as typeof context\n        }\n      }\n\n      return context\n    })\n  }\n\n  setParent(scope: Scope<Requires<Schemes> | T>): void {\n    super.setParent(scope)\n\n    this.presets.forEach(preset => {\n      if (preset.attach) preset.attach(this)\n    })\n  }\n\n  private mount(element: HTMLElement, context: Requires<Schemes>) {\n    const parent = this.parentScope()\n\n    for (const preset of this.presets) {\n      const result = preset.render(context as any, this)\n\n      if (!result) continue\n\n      const reactElement = (\n        <Root rendered={() => parent.emit({ type: 'rendered', data: context.data } as T)}>\n          {result}\n        </Root>\n      )\n\n      this.renderer.mount(reactElement, element)\n      return true\n    }\n  }\n\n  private unmount(element: HTMLElement) {\n    this.renderer.unmount(element)\n  }\n\n  /**\n   * Adds a preset to the plugin.\n   * @param preset Preset that can render nodes, connections and other elements.\n   */\n  public addPreset<K>(preset: RenderPreset<Schemes, CanAssignSignal<T, K> extends true ? K : 'Cannot apply preset. Provided signals are not compatible'>) {\n    const local = preset as RenderPreset<Schemes, T>\n\n    if (local.attach) local.attach(this)\n    this.presets.push(local)\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}