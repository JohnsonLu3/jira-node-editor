{"ast":null,"code":"/*!\n* rete-area-plugin v2.0.3\n* (c) 2024 Vitaliy Stoliarov\n* Released under the MIT license.\n* */\nfunction ___$insertStyle(css) {\n  if (!css) {\n    return;\n  }\n  if (typeof window === 'undefined') {\n    return;\n  }\n  var style = document.createElement('style');\n  style.setAttribute('type', 'text/css');\n  style.innerHTML = css;\n  document.head.appendChild(style);\n  return css;\n}\nimport _asyncToGenerator from '@babel/runtime/helpers/asyncToGenerator';\nimport _typeof from '@babel/runtime/helpers/typeof';\nimport _classCallCheck from '@babel/runtime/helpers/classCallCheck';\nimport _createClass from '@babel/runtime/helpers/createClass';\nimport _assertThisInitialized from '@babel/runtime/helpers/assertThisInitialized';\nimport _inherits from '@babel/runtime/helpers/inherits';\nimport _possibleConstructorReturn from '@babel/runtime/helpers/possibleConstructorReturn';\nimport _getPrototypeOf from '@babel/runtime/helpers/getPrototypeOf';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport _regeneratorRuntime from '@babel/runtime/regenerator';\nimport _toConsumableArray from '@babel/runtime/helpers/toConsumableArray';\nimport { Scope, NodeEditor } from 'rete';\nvar Content = /*#__PURE__*/function () {\n  function Content(reordered) {\n    _classCallCheck(this, Content);\n    this.reordered = reordered;\n    this.holder = document.createElement('div');\n    this.holder.style.transformOrigin = '0 0';\n  }\n  _createClass(Content, [{\n    key: \"getPointerFrom\",\n    value: function getPointerFrom(event) {\n      var _this$holder$getBound = this.holder.getBoundingClientRect(),\n        left = _this$holder$getBound.left,\n        top = _this$holder$getBound.top;\n      var x = event.clientX - left;\n      var y = event.clientY - top;\n      return {\n        x: x,\n        y: y\n      };\n    }\n  }, {\n    key: \"add\",\n    value: function add(element) {\n      this.holder.appendChild(element);\n    }\n\n    // eslint-disable-next-line no-undef\n  }, {\n    key: \"reorder\",\n    value: function () {\n      var _reorder = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(target, next) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (this.holder.contains(target)) {\n                _context.next = 2;\n                break;\n              }\n              throw new Error(\"content doesn't have 'target' for reordering\");\n            case 2:\n              if (!(next !== null && !this.holder.contains(next))) {\n                _context.next = 4;\n                break;\n              }\n              throw new Error(\"content doesn't have 'next' for reordering\");\n            case 4:\n              this.holder.insertBefore(target, next);\n              _context.next = 7;\n              return this.reordered(target);\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function reorder(_x, _x2) {\n        return _reorder.apply(this, arguments);\n      }\n      return reorder;\n    }()\n  }, {\n    key: \"remove\",\n    value: function remove(element) {\n      this.holder.removeChild(element);\n    }\n  }]);\n  return Content;\n}();\n\n/**\n * listen to pointerdown, window's pointermove and pointerup events,\n * where last two not active before pointerdown triggered for performance reasons\n */\nfunction usePointerListener(element, handlers) {\n  var move = function move(event) {\n    handlers.move(event);\n  };\n  var up = function up(event) {\n    window.removeEventListener('pointermove', move);\n    window.removeEventListener('pointerup', up);\n    window.removeEventListener('pointercancel', up);\n    handlers.up(event);\n  };\n  var down = function down(event) {\n    window.addEventListener('pointermove', move);\n    window.addEventListener('pointerup', up);\n    window.addEventListener('pointercancel', up);\n    handlers.down(event);\n  };\n  element.addEventListener('pointerdown', down);\n  return {\n    destroy: function destroy() {\n      element.removeEventListener('pointerdown', down);\n      window.removeEventListener('pointermove', move);\n      window.removeEventListener('pointerup', up);\n      window.removeEventListener('pointercancel', up);\n    }\n  };\n}\n\n/**\n * Bounding box\n */\nvar min = function min(arr) {\n  return arr.length === 0 ? 0 : Math.min.apply(Math, _toConsumableArray(arr));\n};\nvar max = function max(arr) {\n  return arr.length === 0 ? 0 : Math.max.apply(Math, _toConsumableArray(arr));\n};\nfunction getBoundingBox$1(rects) {\n  var left = min(rects.map(function (rect) {\n    return rect.position.x;\n  }));\n  var top = min(rects.map(function (rect) {\n    return rect.position.y;\n  }));\n  var right = max(rects.map(function (rect) {\n    return rect.position.x + rect.width;\n  }));\n  var bottom = max(rects.map(function (rect) {\n    return rect.position.y + rect.height;\n  }));\n  return {\n    left: left,\n    right: right,\n    top: top,\n    bottom: bottom,\n    width: Math.abs(left - right),\n    height: Math.abs(top - bottom),\n    center: {\n      x: (left + right) / 2,\n      y: (top + bottom) / 2\n    }\n  };\n}\nfunction ownKeys$4(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread$4(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys$4(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$4(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\n/**\n * Drag handler, used to handle dragging of the area and nodes. Can be extended to add custom behavior.\n */\nvar Drag = /*#__PURE__*/function () {\n  function Drag(guards) {\n    var _this = this;\n    _classCallCheck(this, Drag);\n    _defineProperty(this, \"down\", function (e) {\n      if (!_this.guards.down(e)) return;\n      e.stopPropagation();\n      _this.pointerStart = {\n        x: e.pageX,\n        y: e.pageY\n      };\n      _this.startPosition = _objectSpread$4({}, _this.config.getCurrentPosition());\n      _this.events.start(e);\n    });\n    _defineProperty(this, \"move\", function (e) {\n      if (!_this.pointerStart || !_this.startPosition) return;\n      if (!_this.guards.move(e)) return;\n      e.preventDefault();\n      var delta = {\n        x: e.pageX - _this.pointerStart.x,\n        y: e.pageY - _this.pointerStart.y\n      };\n      var zoom = _this.config.getZoom();\n      var x = _this.startPosition.x + delta.x / zoom;\n      var y = _this.startPosition.y + delta.y / zoom;\n      _this.events.translate(x, y, e);\n    });\n    _defineProperty(this, \"up\", function (e) {\n      if (!_this.pointerStart) return;\n      delete _this.pointerStart;\n      _this.events.drag(e);\n    });\n    this.guards = guards || {\n      down: function down(e) {\n        return !(e.pointerType === 'mouse' && e.button !== 0);\n      },\n      move: function move() {\n        return true;\n      }\n    };\n  }\n  _createClass(Drag, [{\n    key: \"initialize\",\n    value: function initialize(element, config, events) {\n      this.config = config;\n      this.events = events;\n      element.style.touchAction = 'none';\n      this.pointerListener = usePointerListener(element, {\n        down: this.down,\n        move: this.move,\n        up: this.up\n      });\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.pointerListener.destroy();\n    }\n  }]);\n  return Drag;\n}();\n\n/**\n * Zoom source\n */\n\n/**\n * Zoom class, used to handle zooming of the area. Can be extended to add custom behavior.\n * @internal\n */\nvar Zoom = /*#__PURE__*/function () {\n  function Zoom(intensity) {\n    var _this = this;\n    _classCallCheck(this, Zoom);\n    _defineProperty(this, \"previous\", null);\n    _defineProperty(this, \"pointers\", []);\n    _defineProperty(this, \"wheel\", function (e) {\n      e.preventDefault();\n      var _this$element$getBoun = _this.element.getBoundingClientRect(),\n        left = _this$element$getBoun.left,\n        top = _this$element$getBoun.top;\n      var isNegative = e.deltaY < 0;\n      var delta = isNegative ? _this.intensity : -_this.intensity;\n      var ox = (left - e.clientX) * delta;\n      var oy = (top - e.clientY) * delta;\n      _this.onzoom(delta, ox, oy, 'wheel');\n    });\n    _defineProperty(this, \"down\", function (e) {\n      _this.pointers.push(e);\n    });\n    _defineProperty(this, \"move\", function (e) {\n      _this.pointers = _this.pointers.map(function (p) {\n        return p.pointerId === e.pointerId ? e : p;\n      });\n      if (!_this.isTranslating()) return;\n      var _this$element$getBoun2 = _this.element.getBoundingClientRect(),\n        left = _this$element$getBoun2.left,\n        top = _this$element$getBoun2.top;\n      var _this$getTouches = _this.getTouches(),\n        cx = _this$getTouches.cx,\n        cy = _this$getTouches.cy,\n        distance = _this$getTouches.distance;\n      if (_this.previous !== null && _this.previous.distance > 0) {\n        var _delta = distance / _this.previous.distance - 1;\n        var _ox = (left - cx) * _delta;\n        var _oy = (top - cy) * _delta;\n        _this.onzoom(_delta, _ox - (_this.previous.cx - cx), _oy - (_this.previous.cy - cy), 'touch');\n      }\n      _this.previous = {\n        cx: cx,\n        cy: cy,\n        distance: distance\n      };\n    });\n    _defineProperty(this, \"contextmenu\", function () {\n      _this.pointers = [];\n    });\n    _defineProperty(this, \"up\", function (e) {\n      _this.previous = null;\n      _this.pointers = _this.pointers.filter(function (p) {\n        return p.pointerId !== e.pointerId;\n      });\n    });\n    _defineProperty(this, \"dblclick\", function (e) {\n      e.preventDefault();\n      var _this$element$getBoun3 = _this.element.getBoundingClientRect(),\n        left = _this$element$getBoun3.left,\n        top = _this$element$getBoun3.top;\n      var delta = 4 * _this.intensity;\n      var ox = (left - e.clientX) * delta;\n      var oy = (top - e.clientY) * delta;\n      _this.onzoom(delta, ox, oy, 'dblclick');\n    });\n    this.intensity = intensity;\n  }\n  _createClass(Zoom, [{\n    key: \"initialize\",\n    value: function initialize(container, element, onzoom) {\n      this.container = container;\n      this.element = element;\n      this.onzoom = onzoom;\n      this.container.addEventListener('wheel', this.wheel);\n      this.container.addEventListener('pointerdown', this.down);\n      this.container.addEventListener('dblclick', this.dblclick);\n      window.addEventListener('pointermove', this.move);\n      window.addEventListener('pointerup', this.up);\n      window.addEventListener('contextmenu', this.contextmenu);\n      window.addEventListener('pointercancel', this.up);\n    }\n  }, {\n    key: \"getTouches\",\n    value: function getTouches() {\n      var e = {\n        touches: this.pointers\n      };\n      var _ref = [e.touches[0].clientX, e.touches[0].clientY],\n        x1 = _ref[0],\n        y1 = _ref[1];\n      var _ref2 = [e.touches[1].clientX, e.touches[1].clientY],\n        x2 = _ref2[0],\n        y2 = _ref2[1];\n      var distance = Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));\n      return {\n        cx: (x1 + x2) / 2,\n        cy: (y1 + y2) / 2,\n        distance: distance\n      };\n    }\n  }, {\n    key: \"isTranslating\",\n    value: function isTranslating() {\n      // is translating while zoom (works on multitouch)\n      return this.pointers.length >= 2;\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.container.removeEventListener('wheel', this.wheel);\n      this.container.removeEventListener('pointerdown', this.down);\n      this.container.removeEventListener('dblclick', this.dblclick);\n      window.removeEventListener('pointermove', this.move);\n      window.removeEventListener('pointerup', this.up);\n      window.removeEventListener('pointercancel', this.up);\n    }\n  }]);\n  return Zoom;\n}();\nvar Area = /*#__PURE__*/function () {\n  function Area(container, events, guards) {\n    var _this = this;\n    _classCallCheck(this, Area);\n    _defineProperty(this, \"transform\", {\n      k: 1,\n      x: 0,\n      y: 0\n    });\n    _defineProperty(this, \"pointer\", {\n      x: 0,\n      y: 0\n    });\n    _defineProperty(this, \"zoomHandler\", null);\n    _defineProperty(this, \"dragHandler\", null);\n    _defineProperty(this, \"pointerdown\", function (event) {\n      _this.setPointerFrom(event);\n      _this.events.pointerDown(_this.pointer, event);\n    });\n    _defineProperty(this, \"pointermove\", function (event) {\n      _this.setPointerFrom(event);\n      _this.events.pointerMove(_this.pointer, event);\n    });\n    _defineProperty(this, \"pointerup\", function (event) {\n      _this.setPointerFrom(event);\n      _this.events.pointerUp(_this.pointer, event);\n    });\n    _defineProperty(this, \"resize\", function (event) {\n      _this.events.resize(event);\n    });\n    _defineProperty(this, \"onTranslate\", function (x, y) {\n      if (_this.zoomHandler && _this.zoomHandler.isTranslating()) return; // lock translation while zoom on multitouch\n      _this.translate(x, y);\n    });\n    _defineProperty(this, \"onZoom\", function (delta, ox, oy, source) {\n      _this.zoom(_this.transform.k * (1 + delta), ox, oy, source);\n      _this.update();\n    });\n    this.container = container;\n    this.events = events;\n    this.guards = guards;\n    this.content = new Content(function (element) {\n      return _this.events.reordered(element);\n    });\n    this.content.holder.style.transformOrigin = '0 0';\n    this.setZoomHandler(new Zoom(0.1));\n    this.setDragHandler(new Drag());\n    this.container.addEventListener('pointerdown', this.pointerdown);\n    this.container.addEventListener('pointermove', this.pointermove);\n    window.addEventListener('pointerup', this.pointerup);\n    window.addEventListener('resize', this.resize);\n    container.appendChild(this.content.holder);\n    this.update();\n  }\n  _createClass(Area, [{\n    key: \"update\",\n    value: function update() {\n      var _this$transform = this.transform,\n        x = _this$transform.x,\n        y = _this$transform.y,\n        k = _this$transform.k;\n      this.content.holder.style.transform = \"translate(\".concat(x, \"px, \").concat(y, \"px) scale(\").concat(k, \")\");\n    }\n\n    /**\n     * Drag handler. Destroy previous drag handler if exists.\n     * @param drag drag handler\n     * @example area.area.setDragHandler(null) // disable drag\n     */\n  }, {\n    key: \"setDragHandler\",\n    value: function setDragHandler(drag) {\n      var _this2 = this;\n      if (this.dragHandler) this.dragHandler.destroy();\n      this.dragHandler = drag;\n      if (this.dragHandler) this.dragHandler.initialize(this.container, {\n        getCurrentPosition: function getCurrentPosition() {\n          return _this2.transform;\n        },\n        getZoom: function getZoom() {\n          return 1;\n        }\n      }, {\n        start: function start() {\n          return null;\n        },\n        translate: this.onTranslate,\n        drag: function drag() {\n          return null;\n        }\n      });\n    }\n\n    /**\n     * Set zoom handler. Destroy previous zoom handler if exists.\n     * @param zoom zoom handler\n     * @example area.area.setZoomHandler(null) // disable zoom\n     */\n  }, {\n    key: \"setZoomHandler\",\n    value: function setZoomHandler(zoom) {\n      if (this.zoomHandler) this.zoomHandler.destroy();\n      this.zoomHandler = zoom;\n      if (this.zoomHandler) this.zoomHandler.initialize(this.container, this.content.holder, this.onZoom);\n    }\n  }, {\n    key: \"setPointerFrom\",\n    value: function setPointerFrom(event) {\n      var _this$content$getPoin = this.content.getPointerFrom(event),\n        x = _this$content$getPoin.x,\n        y = _this$content$getPoin.y;\n      var k = this.transform.k;\n      this.pointer = {\n        x: x / k,\n        y: y / k\n      };\n    }\n  }, {\n    key: \"translate\",\n    value:\n    /**\n     * Change position of the area\n     * @param x desired x coordinate\n     * @param y desired y coordinate\n     * @returns true if the translation was successful, false otherwise\n     * @emits translate\n     * @emits translated\n     */\n    function () {\n      var _translate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(x, y) {\n        var position, result;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              position = {\n                x: x,\n                y: y\n              };\n              _context.next = 3;\n              return this.guards.translate({\n                previous: this.transform,\n                position: position\n              });\n            case 3:\n              result = _context.sent;\n              if (result) {\n                _context.next = 6;\n                break;\n              }\n              return _context.abrupt(\"return\", false);\n            case 6:\n              this.transform.x = result.data.position.x;\n              this.transform.y = result.data.position.y;\n              this.update();\n              _context.next = 11;\n              return this.events.translated(result.data);\n            case 11:\n              return _context.abrupt(\"return\", true);\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function translate(_x, _x2) {\n        return _translate.apply(this, arguments);\n      }\n      return translate;\n    }()\n    /**\n     * Change zoom level of the area\n     * @param zoom new zoom level\n     * @param ox x coordinate of the origin of the zoom\n     * @param oy y coordinate of the origin of the zoom\n     * @param source source of the zoom\n     * @returns true if the zoom was successful, false otherwise\n     * @emits zoom\n     * @emits zoomed\n     */\n  }, {\n    key: \"zoom\",\n    value: function () {\n      var _zoom2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_zoom) {\n        var ox,\n          oy,\n          source,\n          k,\n          result,\n          d,\n          _args2 = arguments;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              ox = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : 0;\n              oy = _args2.length > 2 && _args2[2] !== undefined ? _args2[2] : 0;\n              source = _args2.length > 3 ? _args2[3] : undefined;\n              k = this.transform.k;\n              _context2.next = 6;\n              return this.guards.zoom({\n                previous: this.transform,\n                zoom: _zoom,\n                source: source\n              });\n            case 6:\n              result = _context2.sent;\n              if (result) {\n                _context2.next = 9;\n                break;\n              }\n              return _context2.abrupt(\"return\", true);\n            case 9:\n              d = (k - result.data.zoom) / (k - _zoom || 1);\n              this.transform.k = result.data.zoom || 1;\n              this.transform.x += ox * d;\n              this.transform.y += oy * d;\n              this.update();\n              _context2.next = 16;\n              return this.events.zoomed(result.data);\n            case 16:\n              return _context2.abrupt(\"return\", false);\n            case 17:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function zoom(_x3) {\n        return _zoom2.apply(this, arguments);\n      }\n      return zoom;\n    }()\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.container.removeEventListener('pointerdown', this.pointerdown);\n      this.container.removeEventListener('pointermove', this.pointermove);\n      window.removeEventListener('pointerup', this.pointerup);\n      window.removeEventListener('resize', this.resize);\n      if (this.dragHandler) this.dragHandler.destroy();\n      if (this.zoomHandler) this.zoomHandler.destroy();\n      this.content.holder.innerHTML = '';\n    }\n  }]);\n  return Area;\n}();\nfunction _createSuper$1(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct$1();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _isNativeReflectConstruct$1() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * A union of all possible signals that can be emitted by any area plugin\n * @priority 10\n */\n\n/**\n * Base abstract class for area plugins that provides a common interface\n * @abstract\n */\nvar BaseAreaPlugin = /*#__PURE__*/function (_Scope) {\n  _inherits(BaseAreaPlugin, _Scope);\n  var _super = _createSuper$1(BaseAreaPlugin);\n  function BaseAreaPlugin() {\n    _classCallCheck(this, BaseAreaPlugin);\n    return _super.apply(this, arguments);\n  }\n  return _createClass(BaseAreaPlugin);\n}(Scope);\nvar ConnectionView = /*#__PURE__*/_createClass(function ConnectionView(events) {\n  _classCallCheck(this, ConnectionView);\n  this.element = document.createElement('div');\n  this.element.style.position = 'absolute';\n  this.element.style.left = '0';\n  this.element.style.top = '0';\n  this.element.addEventListener('contextmenu', function (event) {\n    return events.contextmenu(event);\n  });\n});\nvar ElementsHolder = /*#__PURE__*/function () {\n  function ElementsHolder() {\n    _classCallCheck(this, ElementsHolder);\n    _defineProperty(this, \"views\", new WeakMap());\n    _defineProperty(this, \"viewsElements\", new Map());\n  }\n  _createClass(ElementsHolder, [{\n    key: \"set\",\n    value: function set(context) {\n      var element = context.element,\n        type = context.type,\n        payload = context.payload;\n      if (payload !== null && payload !== void 0 && payload.id) {\n        this.views.set(element, context);\n        this.viewsElements.set(\"\".concat(type, \"_\").concat(payload.id), element);\n      }\n    }\n  }, {\n    key: \"get\",\n    value: function get(type, id) {\n      var element = this.viewsElements.get(\"\".concat(type, \"_\").concat(id));\n      return element && this.views.get(element);\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete(element) {\n      var _view$payload;\n      var view = this.views.get(element);\n      if (view && (_view$payload = view.payload) !== null && _view$payload !== void 0 && _view$payload.id) {\n        this.views[\"delete\"](element);\n        this.viewsElements[\"delete\"](\"\".concat(view.type, \"_\").concat(view.payload.id));\n      }\n    }\n  }]);\n  return ElementsHolder;\n}();\nfunction ownKeys$3(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread$3(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys$3(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$3(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nvar NodeView = /*#__PURE__*/function () {\n  function NodeView(getZoom, events, guards) {\n    var _this = this;\n    _classCallCheck(this, NodeView);\n    _defineProperty(this, \"translate\", /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(x, y) {\n        var previous, translation;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              previous = _objectSpread$3({}, _this.position);\n              _context.next = 3;\n              return _this.guards.translate({\n                previous: previous,\n                position: {\n                  x: x,\n                  y: y\n                }\n              });\n            case 3:\n              translation = _context.sent;\n              if (translation) {\n                _context.next = 6;\n                break;\n              }\n              return _context.abrupt(\"return\", false);\n            case 6:\n              _this.position = _objectSpread$3({}, translation.data.position);\n              _this.element.style.transform = \"translate(\".concat(_this.position.x, \"px, \").concat(_this.position.y, \"px)\");\n              _context.next = 10;\n              return _this.events.translated({\n                position: _this.position,\n                previous: previous\n              });\n            case 10:\n              return _context.abrupt(\"return\", true);\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n    _defineProperty(this, \"resize\", /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(width, height) {\n        var size, el;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              size = {\n                width: width,\n                height: height\n              };\n              _context2.next = 3;\n              return _this.guards.resize({\n                size: size\n              });\n            case 3:\n              if (_context2.sent) {\n                _context2.next = 5;\n                break;\n              }\n              return _context2.abrupt(\"return\", false);\n            case 5:\n              el = _this.element.querySelector('*:not(span)');\n              if (!(!el || !(el instanceof HTMLElement))) {\n                _context2.next = 8;\n                break;\n              }\n              return _context2.abrupt(\"return\", false);\n            case 8:\n              el.style.width = \"\".concat(width, \"px\");\n              el.style.height = \"\".concat(height, \"px\");\n              _context2.next = 12;\n              return _this.events.resized({\n                size: size\n              });\n            case 12:\n              return _context2.abrupt(\"return\", true);\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }));\n      return function (_x3, _x4) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n    this.getZoom = getZoom;\n    this.events = events;\n    this.guards = guards;\n    this.element = document.createElement('div');\n    this.element.style.position = 'absolute';\n    this.position = {\n      x: 0,\n      y: 0\n    };\n    this.translate(0, 0);\n    this.element.addEventListener('contextmenu', function (event) {\n      return _this.events.contextmenu(event);\n    });\n    this.dragHandler = new Drag();\n    this.dragHandler.initialize(this.element, {\n      getCurrentPosition: function getCurrentPosition() {\n        return _this.position;\n      },\n      getZoom: function getZoom() {\n        return _this.getZoom();\n      }\n    }, {\n      start: this.events.picked,\n      translate: this.translate,\n      drag: this.events.dragged\n    });\n  }\n  _createClass(NodeView, [{\n    key: \"destroy\",\n    value: function destroy() {\n      this.dragHandler.destroy();\n    }\n  }]);\n  return NodeView;\n}();\nfunction getNodesRect(nodes, views) {\n  return nodes.map(function (node) {\n    return {\n      view: views.get(node.id),\n      node: node\n    };\n  }).filter(function (item) {\n    return item.view;\n  }).map(function (_ref) {\n    var view = _ref.view,\n      node = _ref.node;\n    var width = node.width,\n      height = node.height;\n    if (typeof width !== 'undefined' && typeof height !== 'undefined') {\n      return {\n        position: view.position,\n        width: width,\n        height: height\n      };\n    }\n    return {\n      position: view.position,\n      width: view.element.clientWidth,\n      height: view.element.clientHeight\n    };\n  });\n}\n\n/**\n * Get the bounding box of the given nodes\n * @param plugin The area plugin\n * @param nodes The nodes to get the bounding box of\n * @returns The bounding box\n */\nfunction getBoundingBox(plugin, nodes) {\n  var editor = plugin.parentScope(NodeEditor);\n  var list = nodes.map(function (node) {\n    return _typeof(node) === 'object' ? node : editor.getNode(node);\n  });\n  var rects = getNodesRect(list, plugin.nodeViews);\n  return getBoundingBox$1(rects);\n}\n\n/**\n * Simple nodes order extension\n * @param base The base area plugin\n * @listens nodepicked\n * @listens connectioncreated\n */\nfunction simpleNodesOrder(base) {\n  var area = base;\n  area.addPipe(function (context) {\n    if (!context || _typeof(context) !== 'object' || !('type' in context)) return context;\n    if (context.type === 'nodepicked') {\n      var view = area.nodeViews.get(context.data.id);\n      var content = area.area.content;\n      if (view) {\n        content.reorder(view.element, null);\n      }\n    }\n    if (context.type === 'connectioncreated') {\n      var _view = area.connectionViews.get(context.data.id);\n      var _content = area.area.content;\n      if (_view) {\n        _content.reorder(_view.element, _content.holder.firstChild);\n      }\n    }\n    return context;\n  });\n}\nfunction ownKeys$2(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread$2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys$2(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$2(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\n/**\n * Restrictor extension parameters\n */\n\n/**\n * Restrictor extension. Restricts the area zoom and position\n * @param plugin The area plugin\n * @param params The restrictor parameters\n * @listens zoom\n * @listens zoomed\n * @listens translated\n */\nfunction restrictor(plugin, params) {\n  var scaling = params !== null && params !== void 0 && params.scaling ? params.scaling === true ? {\n    min: 0.1,\n    max: 1\n  } : params.scaling : false;\n  var translation = params !== null && params !== void 0 && params.translation ? params.translation === true ? {\n    left: 0,\n    top: 0,\n    right: 1000,\n    bottom: 1000\n  } : params.translation : false;\n  function restrictZoom(zoom) {\n    if (!scaling) throw new Error('scaling param isnt defined');\n    var _ref = typeof scaling === 'function' ? scaling() : scaling,\n      min = _ref.min,\n      max = _ref.max;\n    if (zoom < min) {\n      return min;\n    } else if (zoom > max) {\n      return max;\n    }\n    return zoom;\n  }\n\n  // eslint-disable-next-line max-statements\n  function restrictPosition(position) {\n    if (!translation) throw new Error('translation param isnt defined');\n    var nextPosition = _objectSpread$2({}, position);\n    var _ref2 = typeof translation === 'function' ? translation() : translation,\n      left = _ref2.left,\n      top = _ref2.top,\n      right = _ref2.right,\n      bottom = _ref2.bottom;\n    if (nextPosition.x < left) {\n      nextPosition.x = left;\n    }\n    if (nextPosition.x > right) {\n      nextPosition.x = right;\n    }\n    if (nextPosition.y < top) {\n      nextPosition.y = top;\n    }\n    if (nextPosition.y > bottom) {\n      nextPosition.y = bottom;\n    }\n    return nextPosition;\n  }\n  plugin.addPipe(function (context) {\n    if (!context || _typeof(context) !== 'object' || !('type' in context)) return context;\n    if (scaling && context.type === 'zoom') {\n      return _objectSpread$2(_objectSpread$2({}, context), {}, {\n        data: _objectSpread$2(_objectSpread$2({}, context.data), {}, {\n          zoom: restrictZoom(context.data.zoom)\n        })\n      });\n    }\n    if (translation && context.type === 'zoomed') {\n      var position = restrictPosition(plugin.area.transform);\n      plugin.area.translate(position.x, position.y);\n    }\n    if (translation && context.type === 'translate') {\n      return _objectSpread$2(_objectSpread$2({}, context), {}, {\n        data: _objectSpread$2(_objectSpread$2({}, context.data), {}, {\n          position: restrictPosition(context.data.position)\n        })\n      });\n    }\n    return context;\n  });\n}\n\n/**\n * Selector's accumulate function, activated when the ctrl key is pressed\n */\nfunction accumulateOnCtrl() {\n  var pressed = false;\n  function keydown(e) {\n    if (e.key === 'Control') pressed = true;\n  }\n  function keyup(e) {\n    if (e.key === 'Control') pressed = false;\n  }\n  document.addEventListener('keydown', keydown);\n  document.addEventListener('keyup', keyup);\n  return {\n    active: function active() {\n      return pressed;\n    },\n    destroy: function destroy() {\n      document.removeEventListener('keydown', keydown);\n      document.removeEventListener('keyup', keyup);\n    }\n  };\n}\n/**\n * Selector class. Used to collect selected entities (nodes, connections, etc.) and synchronize them (select, unselect, translate, etc.).\n * Can be extended to add custom functionality.\n */\nvar Selector = /*#__PURE__*/function () {\n  function Selector() {\n    _classCallCheck(this, Selector);\n    _defineProperty(this, \"entities\", new Map());\n    _defineProperty(this, \"pickId\", null);\n  }\n  _createClass(Selector, [{\n    key: \"isSelected\",\n    value: function isSelected(entity) {\n      return this.entities.has(\"\".concat(entity.label, \"_\").concat(entity.id));\n    }\n  }, {\n    key: \"add\",\n    value: function add(entity, accumulate) {\n      if (!accumulate) this.unselectAll();\n      this.entities.set(\"\".concat(entity.label, \"_\").concat(entity.id), entity);\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(entity) {\n      var id = \"\".concat(entity.label, \"_\").concat(entity.id);\n      var item = this.entities.get(id);\n      if (item) {\n        this.entities[\"delete\"](id);\n        item.unselect();\n      }\n    }\n  }, {\n    key: \"unselectAll\",\n    value: function unselectAll() {\n      var _this = this;\n      _toConsumableArray(Array.from(this.entities.values())).forEach(function (item) {\n        return _this.remove(item);\n      });\n    }\n  }, {\n    key: \"translate\",\n    value: function translate(dx, dy) {\n      var _this2 = this;\n      this.entities.forEach(function (item) {\n        return !_this2.isPicked(item) && item.translate(dx, dy);\n      });\n    }\n  }, {\n    key: \"pick\",\n    value: function pick(entity) {\n      this.pickId = \"\".concat(entity.label, \"_\").concat(entity.id);\n    }\n  }, {\n    key: \"release\",\n    value: function release() {\n      this.pickId = null;\n    }\n  }, {\n    key: \"isPicked\",\n    value: function isPicked(entity) {\n      return this.pickId === \"\".concat(entity.label, \"_\").concat(entity.id);\n    }\n  }]);\n  return Selector;\n}();\n\n/**\n * Selector factory, uses default Selector class\n * @returns Selector instance\n */\nfunction selector() {\n  return new Selector();\n}\n\n/**\n * Accumulating interface, used to determine whether to accumulate entities on selection\n */\n\n/**\n * Selectable nodes extension. Adds the ability to select nodes in the area.\n * @param base BaseAreaPlugin instance\n * @param core Selectable instance\n * @param options.accumulating Accumulating interface\n * @listens nodepicked\n * @listens nodetranslated\n * @listens pointerdown\n * @listens pointermove\n * @listens pointerup\n */\nfunction selectableNodes(base, core, options) {\n  var editor = null;\n  var area = base;\n  var getEditor = function getEditor() {\n    return editor || (editor = area.parentScope(NodeEditor));\n  };\n  var twitch = 0;\n  function selectNode(node) {\n    if (!node.selected) {\n      node.selected = true;\n      area.update('node', node.id);\n    }\n  }\n  function unselectNode(node) {\n    if (node.selected) {\n      node.selected = false;\n      area.update('node', node.id);\n    }\n  }\n  /**\n   * Select node programmatically\n   * @param nodeId Node id\n   * @param accumulate Whether to accumulate nodes on selection\n   */\n  function add(nodeId, accumulate) {\n    var node = getEditor().getNode(nodeId);\n    if (!node) return;\n    core.add({\n      label: 'node',\n      id: node.id,\n      translate: function translate(dx, dy) {\n        var view = area.nodeViews.get(node.id);\n        var current = view === null || view === void 0 ? void 0 : view.position;\n        if (current) {\n          view.translate(current.x + dx, current.y + dy);\n        }\n      },\n      unselect: function unselect() {\n        unselectNode(node);\n      }\n    }, accumulate);\n    selectNode(node);\n  }\n  /**\n   * Unselect node programmatically\n   * @param nodeId Node id\n   */\n  function remove(nodeId) {\n    core.remove({\n      id: nodeId,\n      label: 'node'\n    });\n  }\n\n  // eslint-disable-next-line max-statements, complexity\n  area.addPipe(function (context) {\n    if (!context || _typeof(context) !== 'object' || !('type' in context)) return context;\n    if (context.type === 'nodepicked') {\n      var pickedId = context.data.id;\n      var accumulate = options.accumulating.active();\n      core.pick({\n        id: pickedId,\n        label: 'node'\n      });\n      twitch = null;\n      add(pickedId, accumulate);\n    } else if (context.type === 'nodetranslated') {\n      var _context$data = context.data,\n        id = _context$data.id,\n        position = _context$data.position,\n        previous = _context$data.previous;\n      var _dx = position.x - previous.x;\n      var _dy = position.y - previous.y;\n      if (core.isPicked({\n        id: id,\n        label: 'node'\n      })) core.translate(_dx, _dy);\n    } else if (context.type === 'pointerdown') {\n      twitch = 0;\n    } else if (context.type === 'pointermove') {\n      if (twitch !== null) twitch++;\n    } else if (context.type === 'pointerup') {\n      if (twitch !== null && twitch < 4) {\n        core.unselectAll();\n      }\n      twitch = null;\n    }\n    return context;\n  });\n  return {\n    select: add,\n    unselect: remove\n  };\n}\n\n/**\n * Show input control extension. It will show the input's control when there is no connection and hide it when there is a connection.\n * @param area The base area plugin\n * @param visible The visible function\n * @listens connectioncreated\n * @listens connectionremoved\n */\nfunction showInputControl(area, visible) {\n  var editor = null;\n  var getEditor = function getEditor() {\n    return editor || (editor = area.parentScope(NodeEditor));\n  };\n  function updateInputControlVisibility(target, targetInput) {\n    var node = getEditor().getNode(target);\n    if (!node) return;\n    var input = node.inputs[targetInput];\n    if (!input) throw new Error('cannot find input');\n    var previous = input.showControl;\n    var connections = getEditor().getConnections();\n    var hasAnyConnection = Boolean(connections.find(function (connection) {\n      return connection.target === target && connection.targetInput === targetInput;\n    }));\n    input.showControl = visible ? visible({\n      hasAnyConnection: hasAnyConnection,\n      input: input\n    }) : !hasAnyConnection;\n    if (input.showControl !== previous) {\n      area.update('node', node.id);\n    }\n  }\n  area.addPipe(function (context) {\n    if (context.type === 'connectioncreated' || context.type === 'connectionremoved') {\n      updateInputControlVisibility(context.data.target, context.data.targetInput);\n    }\n    return context;\n  });\n}\nfunction ownKeys$1(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread$1(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys$1(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$1(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\n/**\n * Snap grid extension parameters\n */\n\n/**\n * Snap grid extension\n * @param base The base area plugin\n * @param params The snap parameters\n * @listens nodetranslate\n * @listens nodedragged\n */\nfunction snapGrid(base, params) {\n  var area = base;\n  var size = typeof (params === null || params === void 0 ? void 0 : params.size) === 'undefined' ? 16 : params.size;\n  var dynamic = typeof (params === null || params === void 0 ? void 0 : params.dynamic) === 'undefined' ? true : params.dynamic;\n  function snap(value) {\n    return Math.round(value / size) * size;\n  }\n  area.addPipe(function (context) {\n    if (!context || _typeof(context) !== 'object' || !('type' in context)) return context;\n    if (dynamic && context.type === 'nodetranslate') {\n      var position = context.data.position;\n      var x = snap(position.x);\n      var y = snap(position.y);\n      return _objectSpread$1(_objectSpread$1({}, context), {}, {\n        data: _objectSpread$1(_objectSpread$1({}, context.data), {}, {\n          position: {\n            x: x,\n            y: y\n          }\n        })\n      });\n    }\n    if (!dynamic && context.type === 'nodedragged') {\n      var view = area.nodeViews.get(context.data.id);\n      if (view) {\n        var _view$position = view.position,\n          _x = _view$position.x,\n          _y = _view$position.y;\n        view.translate(snap(_x), snap(_y));\n      }\n    }\n    return context;\n  });\n}\n\n/**\n * Zoom extension parameters\n */\n\n/**\n * Zooms the area to fit the given nodes\n * @param plugin The area plugin\n * @param nodes The nodes to fit\n * @param params The zoom parameters\n */ // eslint-disable-next-line max-statements, max-len\nfunction zoomAt(_x, _x2, _x3) {\n  return _zoomAt.apply(this, arguments);\n}\nfunction _zoomAt() {\n  _zoomAt = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(plugin, nodes, params) {\n    var _ref, _ref$scale, scale, editor, list, rects, boundingBox, _ref2, w, h, kw, kh, k;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _ref = params || {}, _ref$scale = _ref.scale, scale = _ref$scale === void 0 ? 0.9 : _ref$scale;\n          editor = plugin.parentScope(NodeEditor);\n          list = nodes.map(function (node) {\n            return _typeof(node) === 'object' ? node : editor.getNode(node);\n          });\n          rects = getNodesRect(list, plugin.nodeViews);\n          boundingBox = getBoundingBox$1(rects);\n          _ref2 = [plugin.container.clientWidth, plugin.container.clientHeight], w = _ref2[0], h = _ref2[1];\n          kw = w / boundingBox.width, kh = h / boundingBox.height;\n          k = Math.min(kh * scale, kw * scale, 1);\n          plugin.area.transform.x = w / 2 - boundingBox.center.x * k;\n          plugin.area.transform.y = h / 2 - boundingBox.center.y * k;\n          _context.next = 12;\n          return plugin.area.zoom(k, 0, 0);\n        case 12:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return _zoomAt.apply(this, arguments);\n}\n\n/**\n * Area extensions\n * @priority 7\n * @module Extensions\n */\n\nvar index = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  getBoundingBox: getBoundingBox,\n  simpleNodesOrder: simpleNodesOrder,\n  restrictor: restrictor,\n  accumulateOnCtrl: accumulateOnCtrl,\n  selectableNodes: selectableNodes,\n  Selector: Selector,\n  selector: selector,\n  showInputControl: showInputControl,\n  snapGrid: snapGrid,\n  zoomAt: zoomAt\n});\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * A union of all possible signals that can be emitted by the area\n * @priority 9\n */\n\n/**\n * A plugin that provides a 2D area for nodes and connections\n * @priority 8\n * @emits render\n * @emits rendered\n * @emits unmount\n * @listens nodecreated\n * @listens noderemoved\n * @listens connectioncreated\n * @listens connectionremoved\n */\nvar AreaPlugin = /*#__PURE__*/function (_BaseAreaPlugin) {\n  _inherits(AreaPlugin, _BaseAreaPlugin);\n  var _super = _createSuper(AreaPlugin);\n  function AreaPlugin(container) {\n    var _this;\n    _classCallCheck(this, AreaPlugin);\n    _this = _super.call(this, 'area');\n    _defineProperty(_assertThisInitialized(_this), \"nodeViews\", new Map());\n    _defineProperty(_assertThisInitialized(_this), \"connectionViews\", new Map());\n    _defineProperty(_assertThisInitialized(_this), \"elements\", new ElementsHolder());\n    _defineProperty(_assertThisInitialized(_this), \"onContextMenu\", function (event) {\n      _this.emit({\n        type: 'contextmenu',\n        data: {\n          event: event,\n          context: 'root'\n        }\n      });\n    });\n    _this.container = container;\n    container.style.overflow = 'hidden';\n    container.addEventListener('contextmenu', _this.onContextMenu);\n\n    // eslint-disable-next-line max-statements\n    _this.addPipe(function (context) {\n      if (!context || !(_typeof(context) === 'object' && 'type' in context)) return context;\n      if (context.type === 'nodecreated') {\n        _this.addNodeView(context.data);\n      }\n      if (context.type === 'noderemoved') {\n        _this.removeNodeView(context.data.id);\n      }\n      if (context.type === 'connectioncreated') {\n        _this.addConnectionView(context.data);\n      }\n      if (context.type === 'connectionremoved') {\n        _this.removeConnectionView(context.data.id);\n      }\n      if (context.type === 'render') {\n        _this.elements.set(context.data);\n      }\n      if (context.type === 'unmount') {\n        _this.elements[\"delete\"](context.data.element);\n      }\n      return context;\n    });\n    _this.area = new Area(container, {\n      zoomed: function zoomed(params) {\n        return _this.emit({\n          type: 'zoomed',\n          data: params\n        });\n      },\n      pointerDown: function pointerDown(position, event) {\n        return _this.emit({\n          type: 'pointerdown',\n          data: {\n            position: position,\n            event: event\n          }\n        });\n      },\n      pointerMove: function pointerMove(position, event) {\n        return _this.emit({\n          type: 'pointermove',\n          data: {\n            position: position,\n            event: event\n          }\n        });\n      },\n      pointerUp: function pointerUp(position, event) {\n        return _this.emit({\n          type: 'pointerup',\n          data: {\n            position: position,\n            event: event\n          }\n        });\n      },\n      resize: function resize(event) {\n        return _this.emit({\n          type: 'resized',\n          data: {\n            event: event\n          }\n        });\n      },\n      translated: function translated(params) {\n        return _this.emit({\n          type: 'translated',\n          data: params\n        });\n      },\n      reordered: function reordered(element) {\n        return _this.emit({\n          type: 'reordered',\n          data: {\n            element: element\n          }\n        });\n      }\n    }, {\n      translate: function translate(params) {\n        return _this.emit({\n          type: 'translate',\n          data: params\n        });\n      },\n      zoom: function zoom(params) {\n        return _this.emit({\n          type: 'zoom',\n          data: params\n        });\n      }\n    });\n    return _this;\n  }\n  _createClass(AreaPlugin, [{\n    key: \"addNodeView\",\n    value: function addNodeView(node) {\n      var _this2 = this;\n      var id = node.id;\n      var view = new NodeView(function () {\n        return _this2.area.transform.k;\n      }, {\n        picked: function picked() {\n          return _this2.emit({\n            type: 'nodepicked',\n            data: {\n              id: id\n            }\n          });\n        },\n        translated: function translated(data) {\n          return _this2.emit({\n            type: 'nodetranslated',\n            data: _objectSpread({\n              id: id\n            }, data)\n          });\n        },\n        dragged: function dragged() {\n          return _this2.emit({\n            type: 'nodedragged',\n            data: node\n          });\n        },\n        contextmenu: function contextmenu(event) {\n          return _this2.emit({\n            type: 'contextmenu',\n            data: {\n              event: event,\n              context: node\n            }\n          });\n        },\n        resized: function resized(_ref) {\n          var size = _ref.size;\n          return _this2.emit({\n            type: 'noderesized',\n            data: {\n              id: node.id,\n              size: size\n            }\n          });\n        }\n      }, {\n        translate: function translate(data) {\n          return _this2.emit({\n            type: 'nodetranslate',\n            data: _objectSpread({\n              id: id\n            }, data)\n          });\n        },\n        resize: function resize(_ref2) {\n          var size = _ref2.size;\n          return _this2.emit({\n            type: 'noderesize',\n            data: {\n              id: node.id,\n              size: size\n            }\n          });\n        }\n      });\n      this.nodeViews.set(id, view);\n      this.area.content.add(view.element);\n      this.emit({\n        type: 'render',\n        data: {\n          element: view.element,\n          type: 'node',\n          payload: node\n        }\n      });\n      return view;\n    }\n  }, {\n    key: \"removeNodeView\",\n    value: function removeNodeView(id) {\n      var view = this.nodeViews.get(id);\n      if (view) {\n        this.emit({\n          type: 'unmount',\n          data: {\n            element: view.element\n          }\n        });\n        this.nodeViews[\"delete\"](id);\n        this.area.content.remove(view.element);\n      }\n    }\n  }, {\n    key: \"addConnectionView\",\n    value: function addConnectionView(connection) {\n      var _this3 = this;\n      var view = new ConnectionView({\n        contextmenu: function contextmenu(event) {\n          return _this3.emit({\n            type: 'contextmenu',\n            data: {\n              event: event,\n              context: connection\n            }\n          });\n        }\n      });\n      this.connectionViews.set(connection.id, view);\n      this.area.content.add(view.element);\n      this.emit({\n        type: 'render',\n        data: {\n          element: view.element,\n          type: 'connection',\n          payload: connection\n        }\n      });\n      return view;\n    }\n  }, {\n    key: \"removeConnectionView\",\n    value: function removeConnectionView(id) {\n      var view = this.connectionViews.get(id);\n      if (view) {\n        this.emit({\n          type: 'unmount',\n          data: {\n            element: view.element\n          }\n        });\n        this.connectionViews[\"delete\"](id);\n        this.area.content.remove(view.element);\n      }\n    }\n\n    /**\n     * Force update rendered element by id (node, connection, etc.)\n     * @param type Element type\n     * @param id Element id\n     * @emits render\n     */\n  }, {\n    key: \"update\",\n    value: function () {\n      var _update = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(type, id) {\n        var data;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              data = this.elements.get(type, id);\n              if (!data) {\n                _context.next = 4;\n                break;\n              }\n              _context.next = 4;\n              return this.emit({\n                type: 'render',\n                data: data\n              });\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function update(_x, _x2) {\n        return _update.apply(this, arguments);\n      }\n      return update;\n    }()\n    /**\n     * Resize node\n     * @param id Node id\n     * @param width Desired width\n     * @param height Desired height\n     */\n  }, {\n    key: \"resize\",\n    value: function () {\n      var _resize = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id, width, height) {\n        var view;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              view = this.nodeViews.get(id);\n              if (!view) {\n                _context2.next = 5;\n                break;\n              }\n              _context2.next = 4;\n              return view.resize(width, height);\n            case 4:\n              return _context2.abrupt(\"return\", _context2.sent);\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function resize(_x3, _x4, _x5) {\n        return _resize.apply(this, arguments);\n      }\n      return resize;\n    }()\n    /**\n     * Translate node to position\n     * @param id Node id\n     * @param position Position\n     */\n  }, {\n    key: \"translate\",\n    value: function () {\n      var _translate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(id, _ref3) {\n        var x, y, view;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              x = _ref3.x, y = _ref3.y;\n              view = this.nodeViews.get(id);\n              if (!view) {\n                _context3.next = 6;\n                break;\n              }\n              _context3.next = 5;\n              return view.translate(x, y);\n            case 5:\n              return _context3.abrupt(\"return\", _context3.sent);\n            case 6:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function translate(_x6, _x7) {\n        return _translate.apply(this, arguments);\n      }\n      return translate;\n    }()\n    /**\n     * Destroy all views and remove all event listeners\n     */\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      var _this4 = this;\n      this.container.removeEventListener('contextmenu', this.onContextMenu);\n      Array.from(this.connectionViews.keys()).forEach(function (id) {\n        return _this4.removeConnectionView(id);\n      });\n      Array.from(this.nodeViews.keys()).forEach(function (id) {\n        return _this4.removeNodeView(id);\n      });\n      this.area.destroy();\n    }\n  }]);\n  return AreaPlugin;\n}(BaseAreaPlugin);\nexport { Area, index as AreaExtensions, AreaPlugin, BaseAreaPlugin, Drag, NodeView, Zoom, usePointerListener };","map":{"version":3,"names":["Content","reordered","_classCallCheck","holder","document","createElement","style","transformOrigin","_createClass","key","value","getPointerFrom","event","_this$holder$getBound","getBoundingClientRect","left","top","x","clientX","y","clientY","add","element","appendChild","_reorder","_asyncToGenerator","_regeneratorRuntime","mark","_callee","target","next","wrap","_callee$","_context","prev","contains","Error","insertBefore","stop","reorder","_x","_x2","apply","arguments","remove","removeChild","usePointerListener","handlers","move","up","window","removeEventListener","down","addEventListener","destroy","min","arr","length","Math","_toConsumableArray","max","getBoundingBox$1","rects","map","rect","position","right","width","bottom","height","abs","center","Drag","guards","_this","_defineProperty","e","stopPropagation","pointerStart","pageX","pageY","startPosition","_objectSpread$4","config","getCurrentPosition","events","start","preventDefault","delta","zoom","getZoom","translate","drag","pointerType","button","initialize","touchAction","pointerListener","Zoom","intensity","_this$element$getBoun","isNegative","deltaY","ox","oy","onzoom","pointers","push","p","pointerId","isTranslating","_this$element$getBoun2","_this$getTouches","getTouches","cx","cy","distance","previous","_delta","_ox","_oy","filter","_this$element$getBoun3","container","wheel","dblclick","contextmenu","touches","_ref","x1","y1","_ref2","x2","y2","sqrt","pow","Area","k","setPointerFrom","pointerDown","pointer","pointerMove","pointerUp","resize","zoomHandler","source","transform","update","content","setZoomHandler","setDragHandler","pointerdown","pointermove","pointerup","_this$transform","concat","_this2","dragHandler","onTranslate","onZoom","_this$content$getPoin","_translate","result","sent","abrupt","data","translated","_zoom2","_callee2","_zoom","d","_args2","_callee2$","_context2","undefined","zoomed","_x3","innerHTML","BaseAreaPlugin","_Scope","_inherits","_super","_createSuper$1","Scope","ConnectionView","ElementsHolder","WeakMap","Map","set","context","type","payload","id","views","viewsElements","get","_delete","_view$payload","view","NodeView","translation","_objectSpread$3","size","el","querySelector","HTMLElement","resized","_x4","picked","dragged","getNodesRect","nodes","node","item","clientWidth","clientHeight","getBoundingBox","plugin","editor","parentScope","NodeEditor","list","_typeof","getNode","nodeViews","simpleNodesOrder","base","area","addPipe","_view","connectionViews","_content","firstChild","restrictor","params","scaling","restrictZoom","restrictPosition","nextPosition","_objectSpread$2","accumulateOnCtrl","pressed","keydown","keyup","active","Selector","isSelected","entity","entities","has","label","accumulate","unselectAll","unselect","Array","from","values","forEach","dx","dy","isPicked","pick","pickId","release","selector","selectableNodes","core","options","getEditor","twitch","selectNode","selected","unselectNode","nodeId","current","pickedId","accumulating","_context$data","_dx","_dy","select","showInputControl","visible","updateInputControlVisibility","targetInput","input","inputs","showControl","connections","getConnections","hasAnyConnection","Boolean","find","connection","snapGrid","dynamic","snap","round","_objectSpread$1","_view$position","_y","zoomAt","_zoomAt","_ref$scale","scale","boundingBox","w","h","kw","kh","AreaPlugin","_BaseAreaPlugin","_createSuper","call","_assertThisInitialized","emit","overflow","onContextMenu","addNodeView","removeNodeView","addConnectionView","removeConnectionView","elements","_objectSpread","_this3","_update","_resize","_x5","_callee3","_ref3","_callee3$","_context3","_x6","_x7","_this4","keys"],"sources":["/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/content.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/utils.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/drag.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/zoom.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/area.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/base.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/connection-view.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/elements-holder.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/node-view.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/extensions/shared/utils.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/extensions/bounding-box.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/extensions/order.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/extensions/restrictor.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/extensions/selectable.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/extensions/show-input-control.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/extensions/snap.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/extensions/zoom-at.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/extensions/index.ts","/Users/jolu/Documents/code/jira-node-editor/node_modules/rete-area-plugin/src/index.ts"],"sourcesContent":["export class Content {\n  public holder: HTMLElement\n\n  constructor(private reordered: (target: HTMLElement) => Promise<unknown>) {\n    this.holder = document.createElement('div')\n    this.holder.style.transformOrigin = '0 0'\n  }\n\n  public getPointerFrom(event: MouseEvent) {\n    const { left, top } = this.holder.getBoundingClientRect()\n    const x = event.clientX - left\n    const y = event.clientY - top\n\n    return { x, y }\n  }\n\n  add(element: HTMLElement) {\n    this.holder.appendChild(element)\n  }\n\n  // eslint-disable-next-line no-undef\n  async reorder(target: HTMLElement, next: ChildNode | null) {\n    if (!this.holder.contains(target)) {\n      throw new Error(`content doesn't have 'target' for reordering`)\n    }\n    if (next !== null && !this.holder.contains(next)) {\n      throw new Error(`content doesn't have 'next' for reordering`)\n    }\n\n    this.holder.insertBefore(target, next)\n    await this.reordered(target)\n  }\n\n  remove(element: HTMLElement) {\n    this.holder.removeChild(element)\n  }\n}\n","import { Position, Size } from './types'\n\ntype PointerHandler = (event: PointerEvent) => void\ntype PointerListenerHandlers = {\n    down: PointerHandler\n    move: PointerHandler\n    up: PointerHandler\n}\n\nexport type PointerListener = { destroy: () => void }\n\n/**\n * listen to pointerdown, window's pointermove and pointerup events,\n * where last two not active before pointerdown triggered for performance reasons\n */\nexport function usePointerListener(element: HTMLElement, handlers: PointerListenerHandlers): PointerListener {\n  const move: PointerHandler = (event) => {\n    handlers.move(event)\n  }\n  const up: PointerHandler = (event) => {\n    window.removeEventListener('pointermove', move)\n    window.removeEventListener('pointerup', up)\n    window.removeEventListener('pointercancel', up)\n    handlers.up(event)\n  }\n  const down: PointerHandler = (event) => {\n    window.addEventListener('pointermove', move)\n    window.addEventListener('pointerup', up)\n    window.addEventListener('pointercancel', up)\n    handlers.down(event)\n  }\n\n  element.addEventListener('pointerdown', down)\n\n  return {\n    destroy() {\n      element.removeEventListener('pointerdown', down)\n      window.removeEventListener('pointermove', move)\n      window.removeEventListener('pointerup', up)\n      window.removeEventListener('pointercancel', up)\n    }\n  }\n}\n\n/**\n * Bounding box\n */\nconst min = (arr: number[]) => arr.length === 0 ? 0 : Math.min(...arr)\nconst max = (arr: number[]) => arr.length === 0 ? 0 : Math.max(...arr)\n\nexport function getBoundingBox(rects: ({ position: Position } & Size)[]) {\n  const left = min(rects.map(rect => rect.position.x))\n  const top = min(rects.map(rect => rect.position.y))\n  const right = max(rects.map(rect => rect.position.x + rect.width))\n  const bottom = max(rects.map(rect => rect.position.y + rect.height))\n\n  return {\n    left,\n    right,\n    top,\n    bottom,\n    width: Math.abs(left - right),\n    height: Math.abs(top - bottom),\n    center: {\n      x: (left + right) / 2,\n      y: (top + bottom) / 2\n    }\n  }\n}\n","import { Position } from './types'\nimport { PointerListener, usePointerListener } from './utils'\n\ntype Events = {\n  start: (e: PointerEvent) => void\n  translate: (x: number, y: number, e: PointerEvent) => void\n  drag: (e: PointerEvent) => void\n}\n\ntype Guards = {\n  down: (e: PointerEvent) => boolean\n  move: (e: PointerEvent) => boolean\n}\n\ntype DragConfig = {\n  getCurrentPosition: () => Position\n  getZoom: () => number\n}\n\n/**\n * Drag handler, used to handle dragging of the area and nodes. Can be extended to add custom behavior.\n */\nexport class Drag {\n  private pointerStart?: Position\n  private startPosition?: Position\n  private pointerListener!: PointerListener\n  protected config!: DragConfig\n  protected events!: Events\n  protected guards: Guards\n\n  constructor(guards?: Guards) {\n    this.guards = guards || {\n      down: e => !(e.pointerType === 'mouse' && e.button !== 0),\n      move: () => true\n    }\n  }\n\n  public initialize(element: HTMLElement, config: DragConfig, events: Events) {\n    this.config = config\n    this.events = events\n    element.style.touchAction = 'none'\n    this.pointerListener = usePointerListener(element, {\n      down: this.down,\n      move: this.move,\n      up: this.up\n    })\n  }\n\n  private down = (e: PointerEvent) => {\n    if (!this.guards.down(e)) return\n\n    e.stopPropagation()\n    this.pointerStart = { x: e.pageX, y: e.pageY }\n    this.startPosition = { ...this.config.getCurrentPosition() }\n\n    this.events.start(e)\n  }\n\n  private move = (e: PointerEvent) => {\n    if (!this.pointerStart || !this.startPosition) return\n    if (!this.guards.move(e)) return\n    e.preventDefault()\n\n    const delta = {\n      x: e.pageX - this.pointerStart.x,\n      y: e.pageY - this.pointerStart.y\n    }\n    const zoom = this.config.getZoom()\n    const x = this.startPosition.x + delta.x / zoom\n    const y = this.startPosition.y + delta.y / zoom\n\n    this.events.translate(x, y, e)\n  }\n\n  private up = (e: PointerEvent) => {\n    if (!this.pointerStart) return\n\n    delete this.pointerStart\n    this.events.drag(e)\n  }\n\n  public destroy() {\n    this.pointerListener.destroy()\n  }\n}\n","\n/**\n * Zoom source\n */\nexport type ZoomSource = 'wheel' | 'touch' | 'dblclick'\nexport type OnZoom = (delta: number, ox: number, oy: number, source?: ZoomSource) => void\n\n/**\n * Zoom class, used to handle zooming of the area. Can be extended to add custom behavior.\n * @internal\n */\nexport class Zoom {\n  protected previous: { cx: number, cy: number, distance: number } | null = null\n  protected pointers: PointerEvent[] = []\n  protected container!: HTMLElement\n  protected element!: HTMLElement\n  protected onzoom!: OnZoom\n\n  constructor(protected intensity: number) { }\n\n  public initialize(container: HTMLElement, element: HTMLElement, onzoom: OnZoom) {\n    this.container = container\n    this.element = element\n    this.onzoom = onzoom\n    this.container.addEventListener('wheel', this.wheel)\n    this.container.addEventListener('pointerdown', this.down)\n    this.container.addEventListener('dblclick', this.dblclick)\n\n    window.addEventListener('pointermove', this.move)\n    window.addEventListener('pointerup', this.up)\n    window.addEventListener('contextmenu', this.contextmenu)\n    window.addEventListener('pointercancel', this.up)\n  }\n\n  protected wheel = (e: WheelEvent) => {\n    e.preventDefault()\n\n    const { left, top } = this.element.getBoundingClientRect()\n    const isNegative = e.deltaY < 0\n    const delta = isNegative ? this.intensity : - this.intensity\n    const ox = (left - e.clientX) * delta\n    const oy = (top - e.clientY) * delta\n\n    this.onzoom(delta, ox, oy, 'wheel')\n  }\n\n  private getTouches() {\n    const e = { touches: this.pointers }\n    const [x1, y1] = [e.touches[0].clientX, e.touches[0].clientY]\n    const [x2, y2] = [e.touches[1].clientX, e.touches[1].clientY]\n\n    const distance = Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2))\n\n    return {\n      cx: (x1 + x2) / 2,\n      cy: (y1 + y2) / 2,\n      distance\n    }\n  }\n\n  protected down = (e: PointerEvent) => {\n    this.pointers.push(e)\n  }\n\n  protected move = (e: PointerEvent) => {\n    this.pointers = this.pointers.map(p => p.pointerId === e.pointerId ? e : p)\n    if (!this.isTranslating()) return\n\n    const { left, top } = this.element.getBoundingClientRect()\n    const { cx, cy, distance } = this.getTouches()\n\n    if (this.previous !== null && this.previous.distance > 0) {\n      const delta = distance / this.previous.distance - 1\n\n      const ox = (left - cx) * delta\n      const oy = (top - cy) * delta\n\n      this.onzoom(delta, ox - (this.previous.cx - cx), oy - (this.previous.cy - cy), 'touch')\n    }\n    this.previous = { cx, cy, distance }\n  }\n\n  protected contextmenu = () => {\n    this.pointers = []\n  }\n\n  protected up = (e: PointerEvent) => {\n    this.previous = null\n    this.pointers = this.pointers.filter(p => p.pointerId !== e.pointerId)\n  }\n\n  protected dblclick = (e: MouseEvent) => {\n    e.preventDefault()\n\n    const { left, top } = this.element.getBoundingClientRect()\n    const delta = 4 * this.intensity\n\n    const ox = (left - e.clientX) * delta\n    const oy = (top - e.clientY) * delta\n\n    this.onzoom(delta, ox, oy, 'dblclick')\n  }\n\n  public isTranslating() { // is translating while zoom (works on multitouch)\n    return this.pointers.length >= 2\n  }\n\n  public destroy() {\n    this.container.removeEventListener('wheel', this.wheel)\n    this.container.removeEventListener('pointerdown', this.down)\n    this.container.removeEventListener('dblclick', this.dblclick)\n\n    window.removeEventListener('pointermove', this.move)\n    window.removeEventListener('pointerup', this.up)\n    window.removeEventListener('pointercancel', this.up)\n  }\n}\n","import { Content } from './content'\nimport { Drag } from './drag'\nimport { Position } from './types'\nimport { Zoom, ZoomSource } from './zoom'\n\nexport type Transform = Position & { k: number }\nexport type TranslateEventParams = { previous: Transform, position: Position }\nexport type ZoomEventParams = { previous: Transform, zoom: number, source?: ZoomSource }\n\ntype Events = {\n  zoomed: (params: ZoomEventParams) => Promise<unknown>\n  pointerDown: (position: Position, event: PointerEvent) => void\n  pointerMove: (position: Position, event: PointerEvent) => void\n  pointerUp: (position: Position, event: PointerEvent) => void\n  resize: (event: Event) => void\n  translated: (params: TranslateEventParams) => Promise<unknown>\n  reordered: (element: HTMLElement) => Promise<unknown>\n}\ntype Guards = {\n  translate: (params: TranslateEventParams) => Promise<unknown | boolean>\n  zoom: (params: ZoomEventParams) => Promise<unknown | boolean>\n}\n\nexport class Area {\n  public transform: Transform = { k: 1, x: 0, y: 0 }\n  public pointer: Position = { x: 0, y: 0 }\n  public content: Content\n\n  private zoomHandler: Zoom | null = null\n  private dragHandler: Drag | null = null\n\n  constructor(private container: HTMLElement, private events: Events, private guards: Guards) {\n    this.content = new Content(element => this.events.reordered(element))\n    this.content.holder.style.transformOrigin = '0 0'\n\n    this.setZoomHandler(new Zoom(0.1))\n    this.setDragHandler(new Drag())\n\n    this.container.addEventListener('pointerdown', this.pointerdown)\n    this.container.addEventListener('pointermove', this.pointermove)\n    window.addEventListener('pointerup', this.pointerup)\n    window.addEventListener('resize', this.resize)\n\n    container.appendChild(this.content.holder)\n    this.update()\n  }\n\n  private update() {\n    const { x, y, k } = this.transform\n\n    this.content.holder.style.transform = `translate(${x}px, ${y}px) scale(${k})`\n  }\n\n  /**\n   * Drag handler. Destroy previous drag handler if exists.\n   * @param drag drag handler\n   * @example area.area.setDragHandler(null) // disable drag\n   */\n  public setDragHandler(drag: Drag | null) {\n    if (this.dragHandler) this.dragHandler.destroy()\n    this.dragHandler = drag\n    if (this.dragHandler) this.dragHandler.initialize(\n      this.container,\n      {\n        getCurrentPosition: () => this.transform,\n        getZoom: () => 1\n      },\n      {\n        start: () => null,\n        translate: this.onTranslate,\n        drag: () => null\n      }\n    )\n  }\n\n  /**\n   * Set zoom handler. Destroy previous zoom handler if exists.\n   * @param zoom zoom handler\n   * @example area.area.setZoomHandler(null) // disable zoom\n   */\n  public setZoomHandler(zoom: Zoom | null) {\n    if (this.zoomHandler) this.zoomHandler.destroy()\n    this.zoomHandler = zoom\n    if (this.zoomHandler) this.zoomHandler.initialize(this.container, this.content.holder, this.onZoom)\n  }\n\n  public setPointerFrom(event: MouseEvent) {\n    const { x, y } = this.content.getPointerFrom(event)\n    const { k } = this.transform\n\n    this.pointer = { x: x / k, y: y / k }\n  }\n\n  private pointerdown = (event: PointerEvent) => {\n    this.setPointerFrom(event)\n    this.events.pointerDown(this.pointer, event)\n  }\n\n  private pointermove = (event: PointerEvent) => {\n    this.setPointerFrom(event)\n    this.events.pointerMove(this.pointer, event)\n  }\n\n  private pointerup = (event: PointerEvent) => {\n    this.setPointerFrom(event)\n    this.events.pointerUp(this.pointer, event)\n  }\n\n  private resize = (event: Event) => {\n    this.events.resize(event)\n  }\n\n  private onTranslate = (x: number, y: number) => {\n    if (this.zoomHandler && this.zoomHandler.isTranslating()) return // lock translation while zoom on multitouch\n    this.translate(x, y)\n  }\n\n  private onZoom = (delta: number, ox: number, oy: number, source?: ZoomSource) => {\n    this.zoom(this.transform.k * (1 + delta), ox, oy, source)\n\n    this.update()\n  }\n\n  /**\n   * Change position of the area\n   * @param x desired x coordinate\n   * @param y desired y coordinate\n   * @returns true if the translation was successful, false otherwise\n   * @emits translate\n   * @emits translated\n   */\n  public async translate(x: number, y: number) {\n    type T = undefined | { data: TranslateEventParams }\n    const position = { x, y }\n    const result = await this.guards.translate({ previous: this.transform, position }) as T\n\n    if (!result) return false\n\n    this.transform.x = result.data.position.x\n    this.transform.y = result.data.position.y\n\n    this.update()\n\n    await this.events.translated(result.data)\n    return true\n  }\n\n  /**\n   * Change zoom level of the area\n   * @param zoom new zoom level\n   * @param ox x coordinate of the origin of the zoom\n   * @param oy y coordinate of the origin of the zoom\n   * @param source source of the zoom\n   * @returns true if the zoom was successful, false otherwise\n   * @emits zoom\n   * @emits zoomed\n   */\n  public async zoom(zoom: number, ox = 0, oy = 0, source?: ZoomSource) {\n    type T = undefined | { data: ZoomEventParams }\n    const k = this.transform.k\n    const result = await this.guards.zoom({ previous: this.transform, zoom, source }) as T\n\n    if (!result) return true\n\n    const d = (k - result.data.zoom) / ((k - zoom) || 1)\n\n    this.transform.k = result.data.zoom || 1\n    this.transform.x += ox * d\n    this.transform.y += oy * d\n\n    this.update()\n\n    await this.events.zoomed(result.data)\n    return false\n  }\n\n  public destroy() {\n    this.container.removeEventListener('pointerdown', this.pointerdown)\n    this.container.removeEventListener('pointermove', this.pointermove)\n    window.removeEventListener('pointerup', this.pointerup)\n    window.removeEventListener('resize', this.resize)\n    if (this.dragHandler) this.dragHandler.destroy()\n    if (this.zoomHandler) this.zoomHandler.destroy()\n    this.content.holder.innerHTML = ''\n  }\n}\n","import { BaseSchemes, ConnectionId, NodeId, Root, Scope } from 'rete'\n\nimport { NodeResizeEventParams, NodeTranslateEventParams } from './node-view'\nimport { GetRenderTypes, Position, RenderSignal } from './types'\n\ninterface NodeView {\n  element: HTMLElement\n  position: Position\n  translate(x: number, y: number): Promise<boolean>\n  resize(width: number, height: number): Promise<boolean>\n}\n\ninterface ConnectionView {\n  element: HTMLElement\n}\n\ninterface Content {\n  holder: HTMLElement\n  add(element: HTMLElement): void\n  // eslint-disable-next-line no-undef\n  reorder(target: HTMLElement, next: ChildNode | null): void\n  remove(element: HTMLElement): void\n}\n\ninterface Area {\n  pointer: Position\n  content: Content\n}\n\n/**\n * A union of all possible signals that can be emitted by any area plugin\n * @priority 10\n */\nexport type BaseArea<Schemes extends BaseSchemes> =\n  | { type: 'nodepicked', data: { id: string } }\n  | { type: 'nodedragged', data: Schemes['Node'] }\n  | { type: 'nodetranslate', data: { id: string } & NodeTranslateEventParams }\n  | { type: 'nodetranslated', data: { id: string } & NodeTranslateEventParams }\n  | { type: 'contextmenu', data: { event: MouseEvent, context: 'root' | Schemes['Node'] | Schemes['Connection'] } }\n  | { type: 'pointerdown', data: { position: Position, event: PointerEvent } }\n  | { type: 'pointermove', data: { position: Position, event: PointerEvent } }\n  | { type: 'pointerup', data: { position: Position, event: PointerEvent } }\n  | { type: 'noderesize', data: { id: string } & NodeResizeEventParams }\n  | { type: 'noderesized', data: { id: string } & NodeResizeEventParams }\n  | RenderSignal<'node', { payload: Schemes['Node'] }>\n  | RenderSignal<'connection', { payload: Schemes['Connection'], start?: Position, end?: Position }>\n  | { type: 'unmount', data: { element: HTMLElement } }\n  | { type: 'reordered', data: { element: HTMLElement } }\n\n/**\n * Base abstract class for area plugins that provides a common interface\n * @abstract\n */\nexport abstract class BaseAreaPlugin<Schemes extends BaseSchemes, Signals> extends Scope<Signals, [Root<Schemes>]> {\n  public abstract nodeViews: Map<NodeId, NodeView>\n  public abstract connectionViews: Map<ConnectionId, ConnectionView>\n  public abstract area: Area\n\n  abstract addNodeView(connection: Schemes['Node']): NodeView\n  abstract removeNodeView(connection: NodeId): void\n  abstract addConnectionView(connection: Schemes['Connection']): ConnectionView\n  abstract removeConnectionView(connection: ConnectionId): void\n  abstract update(type: GetRenderTypes<Signals>, id: string): Promise<void | boolean | undefined>\n  abstract resize(id: NodeId, width: number, height: number): Promise<void | boolean | undefined>\n  abstract translate(id: NodeId, position: Position): Promise<void | boolean | undefined>\n  abstract destroy(): void\n}\n","\ntype Events = {\n  contextmenu: (event: MouseEvent) => void\n}\n\nexport class ConnectionView {\n  element: HTMLElement\n\n  constructor(events: Events) {\n    this.element = document.createElement('div')\n\n    this.element.style.position = 'absolute'\n    this.element.style.left = '0'\n    this.element.style.top = '0'\n    this.element.addEventListener('contextmenu', event => events.contextmenu(event))\n  }\n}\n","\nexport class ElementsHolder<E extends HTMLElement, Ctx extends { type: string, element: E, payload?: { id: string } }> {\n  views = new WeakMap<E, Ctx>()\n  viewsElements = new Map<`${string}_${string}`, E>()\n\n  public set(context: Ctx) {\n    const { element, type, payload } = context\n\n    if (payload?.id) {\n      this.views.set(element, context)\n      this.viewsElements.set(`${type}_${payload.id}`, element)\n    }\n  }\n\n  public get(type: string, id: string) {\n    const element = this.viewsElements.get(`${type}_${id}`)\n\n    return element && this.views.get(element)\n  }\n\n  public delete(element: E) {\n    const view = this.views.get(element)\n\n    if (view && view.payload?.id) {\n      this.views.delete(element)\n      this.viewsElements.delete(`${view.type}_${view.payload.id}`)\n    }\n  }\n}\n","import { Drag } from './drag'\nimport { Position, Size } from './types'\n\nexport type NodeTranslateEventParams = { position: Position, previous: Position }\nexport type NodeResizeEventParams = { size: Size }\n\ntype Events = {\n  picked: () => void\n  translated: (params: NodeTranslateEventParams) => Promise<unknown | boolean>\n  dragged: () => void\n  contextmenu: (event: MouseEvent) => void\n  resized: (params: NodeResizeEventParams) => Promise<unknown | boolean>\n}\ntype Guards = {\n  resize: (params: NodeResizeEventParams) => Promise<unknown | boolean>\n  translate: (params: NodeTranslateEventParams) => Promise<unknown | boolean>\n}\n\nexport class NodeView {\n  element: HTMLElement\n  position: Position\n  dragHandler: Drag\n\n  constructor(private getZoom: () => number, private events: Events, private guards: Guards) {\n    this.element = document.createElement('div')\n    this.element.style.position = 'absolute'\n    this.position = { x: 0, y: 0 }\n    this.translate(0, 0)\n\n    this.element.addEventListener('contextmenu', event => this.events.contextmenu(event))\n\n    this.dragHandler = new Drag()\n    this.dragHandler.initialize(\n      this.element,\n      {\n        getCurrentPosition: () => this.position,\n        getZoom: () => this.getZoom()\n      },\n      {\n        start: this.events.picked,\n        translate: this.translate,\n        drag: this.events.dragged\n      }\n    )\n  }\n\n  public translate = async (x: number, y: number) => {\n    type Params = undefined | { data: NodeTranslateEventParams }\n    const previous = { ...this.position }\n    const translation = await this.guards.translate({ previous, position: { x, y } }) as Params\n\n    if (!translation) return false\n\n    this.position = { ...translation.data.position }\n    this.element.style.transform = `translate(${this.position.x}px, ${this.position.y}px)`\n\n    await this.events.translated({ position: this.position, previous })\n\n    return true\n  }\n\n  public resize = async (width: number, height: number) => {\n    const size = { width, height }\n\n    if (!(await this.guards.resize({ size }))) return false\n\n    const el = this.element.querySelector('*:not(span)')\n\n    if (!el || !(el instanceof HTMLElement)) return false\n\n    el.style.width = `${width}px`\n    el.style.height = `${height}px`\n\n    await this.events.resized({ size })\n\n    return true\n  }\n\n  public destroy() {\n    this.dragHandler.destroy()\n  }\n}\n","import { BaseAreaPlugin } from '../../base'\nimport { NodeView } from '../../node-view'\nimport { SchemesWithSizes } from './types'\n\nexport function getNodesRect<S extends SchemesWithSizes, K>(nodes: S['Node'][], views: BaseAreaPlugin<S, K>['nodeViews']) {\n  return nodes\n    .map(node => ({ view: views.get(node.id) as NodeView, node }))\n    .filter(item => item.view)\n    .map(({ view, node }) => {\n      const { width, height } = node\n\n      if (typeof width !== 'undefined' && typeof height !== 'undefined') {\n        return {\n          position: view.position,\n          width,\n          height\n        }\n      }\n\n      return {\n        position: view.position,\n        width: view.element.clientWidth,\n        height: view.element.clientHeight\n      }\n    })\n}\n","import { BaseSchemes, NodeEditor } from 'rete'\n\nimport { BaseAreaPlugin } from '../base'\nimport { getBoundingBox as getBBox } from '../utils'\nimport { NodeRef } from './shared/types'\nimport { getNodesRect } from './shared/utils'\n\n/**\n * Get the bounding box of the given nodes\n * @param plugin The area plugin\n * @param nodes The nodes to get the bounding box of\n * @returns The bounding box\n */\nexport function getBoundingBox<Schemes extends BaseSchemes, K>(plugin: BaseAreaPlugin<Schemes, K>, nodes: NodeRef<Schemes>[]) {\n  const editor = plugin.parentScope<NodeEditor<Schemes>>(NodeEditor)\n  const list = nodes.map(node => typeof node === 'object' ? node : editor.getNode(node))\n  const rects = getNodesRect(list, plugin.nodeViews)\n\n  return getBBox(rects)\n}\n","import { BaseSchemes } from 'rete'\n\nimport { BaseArea, BaseAreaPlugin } from '../base'\n\n/**\n * Simple nodes order extension\n * @param base The base area plugin\n * @listens nodepicked\n * @listens connectioncreated\n */\nexport function simpleNodesOrder<Schemes extends BaseSchemes, T>(base: BaseAreaPlugin<Schemes, T>) {\n  const area = base as BaseAreaPlugin<Schemes, BaseArea<Schemes>>\n\n  area.addPipe(context => {\n    if (!context || typeof context !== 'object' || !('type' in context)) return context\n\n    if (context.type === 'nodepicked') {\n      const view = area.nodeViews.get(context.data.id)\n      const { content } = area.area\n\n      if (view) {\n        content.reorder(view.element, null)\n      }\n    }\n    if (context.type === 'connectioncreated') {\n      const view = area.connectionViews.get(context.data.id)\n      const { content } = area.area\n\n      if (view) {\n        content.reorder(view.element, content.holder.firstChild)\n      }\n    }\n    return context\n  })\n}\n","import { BaseSchemes } from 'rete'\n\nimport { AreaPlugin } from '..'\nimport { Position } from '../types'\n\ntype ScaleRange = { min: number, max: number }\ntype TranslateRange = { left: number, top: number, right: number, bottom: number }\n\n/**\n * Restrictor extension parameters\n */\nexport type Params = {\n  /** The scaling range */\n  scaling?: ScaleRange | (() => ScaleRange) | boolean\n  /** The translation range */\n  translation?: TranslateRange | (() => TranslateRange) | boolean\n}\n\n/**\n * Restrictor extension. Restricts the area zoom and position\n * @param plugin The area plugin\n * @param params The restrictor parameters\n * @listens zoom\n * @listens zoomed\n * @listens translated\n */\nexport function restrictor<Schemes extends BaseSchemes, K>(plugin: AreaPlugin<Schemes, K>, params?: Params) {\n  const scaling = params?.scaling\n    ? params.scaling === true ? { min: 0.1, max: 1 } : params.scaling\n    : false\n  const translation = params?.translation\n    ? params.translation === true ? { left: 0, top: 0, right: 1000, bottom: 1000 } : params.translation\n    : false\n\n  function restrictZoom(zoom: number) {\n    if (!scaling) throw new Error('scaling param isnt defined')\n    const { min, max } = typeof scaling === 'function' ? scaling() : scaling\n\n    if (zoom < min) {\n      return min\n    } else if (zoom > max) {\n      return max\n    }\n    return zoom\n  }\n\n  // eslint-disable-next-line max-statements\n  function restrictPosition(position: Position): Position {\n    if (!translation) throw new Error('translation param isnt defined')\n    const nextPosition = { ...position }\n    const { left, top, right, bottom } = typeof translation === 'function'\n      ? translation()\n      : translation\n\n    if (nextPosition.x < left) {\n      nextPosition.x = left\n    }\n    if (nextPosition.x > right) {\n      nextPosition.x = right\n    }\n    if (nextPosition.y < top) {\n      nextPosition.y = top\n    }\n    if (nextPosition.y > bottom) {\n      nextPosition.y = bottom\n    }\n\n    return nextPosition\n  }\n\n  plugin.addPipe(context => {\n    if (!context || typeof context !== 'object' || !('type' in context)) return context\n    if (scaling && context.type === 'zoom') {\n      return {\n        ...context,\n        data: {\n          ...context.data,\n          zoom: restrictZoom(context.data.zoom)\n        }\n      }\n    }\n    if (translation && context.type === 'zoomed') {\n      const position = restrictPosition(plugin.area.transform)\n\n      plugin.area.translate(position.x, position.y)\n    }\n    if (translation && context.type === 'translate') {\n      return {\n        ...context,\n        data: {\n          ...context.data,\n          position: restrictPosition(context.data.position)\n        }\n      }\n    }\n    return context\n  })\n}\n","import { BaseSchemes, GetSchemes, NodeEditor, NodeId } from 'rete'\n\nimport { BaseArea, BaseAreaPlugin } from '../base'\n\ntype Schemes = GetSchemes<BaseSchemes['Node'] & { selected?: boolean }, any>\n\n/**\n * Selector's accumulate function, activated when the ctrl key is pressed\n */\nexport function accumulateOnCtrl() {\n  let pressed = false\n\n  function keydown(e: KeyboardEvent) {\n    if (e.key === 'Control') pressed = true\n  }\n  function keyup(e: KeyboardEvent) {\n    if (e.key === 'Control') pressed = false\n  }\n\n  document.addEventListener('keydown', keydown)\n  document.addEventListener('keyup', keyup)\n\n  return {\n    active() {\n      return pressed\n    },\n    destroy() {\n      document.removeEventListener('keydown', keydown)\n      document.removeEventListener('keyup', keyup)\n    }\n  }\n}\n\nexport type SelectorEntity = { label: string, id: string, unselect(): void, translate(dx: number, dy: number): void }\n\n/**\n * Selector class. Used to collect selected entities (nodes, connections, etc.) and synchronize them (select, unselect, translate, etc.).\n * Can be extended to add custom functionality.\n */\nexport class Selector<E extends SelectorEntity> {\n  entities = new Map<string, E>()\n  pickId: string | null = null\n\n  isSelected(entity: Pick<E, 'label' | 'id'>) {\n    return this.entities.has(`${entity.label}_${entity.id}`)\n  }\n\n  add(entity: E, accumulate: boolean) {\n    if (!accumulate) this.unselectAll()\n    this.entities.set(`${entity.label}_${entity.id}`, entity)\n  }\n\n  remove(entity: Pick<E, 'label' | 'id'>) {\n    const id = `${entity.label}_${entity.id}`\n    const item = this.entities.get(id)\n\n    if (item) {\n      this.entities.delete(id)\n      item.unselect()\n    }\n  }\n\n  unselectAll() {\n    [...Array.from(this.entities.values())].forEach(item => this.remove(item))\n  }\n\n  translate(dx: number, dy: number) {\n    this.entities.forEach(item => !this.isPicked(item) && item.translate(dx, dy))\n  }\n\n  pick(entity: Pick<E, 'label' | 'id'>) {\n    this.pickId = `${entity.label}_${entity.id}`\n  }\n\n  release() {\n    this.pickId = null\n  }\n\n  isPicked(entity: Pick<E, 'label' | 'id'>) {\n    return this.pickId === `${entity.label}_${entity.id}`\n  }\n}\n\n/**\n * Selector factory, uses default Selector class\n * @returns Selector instance\n */\nexport function selector<E extends SelectorEntity>() {\n  return new Selector<E>()\n}\n\n/**\n * Accumulating interface, used to determine whether to accumulate entities on selection\n */\nexport type Accumulating = {\n  active(): boolean\n}\n\nexport type Selectable = ReturnType<typeof selector>\n\n/**\n * Selectable nodes extension. Adds the ability to select nodes in the area.\n * @param base BaseAreaPlugin instance\n * @param core Selectable instance\n * @param options.accumulating Accumulating interface\n * @listens nodepicked\n * @listens nodetranslated\n * @listens pointerdown\n * @listens pointermove\n * @listens pointerup\n */\nexport function selectableNodes<T>(base: BaseAreaPlugin<Schemes, T>, core: Selectable, options: { accumulating: Accumulating }) {\n  let editor: null | NodeEditor<Schemes> = null\n  const area = base as BaseAreaPlugin<Schemes, BaseArea<Schemes>>\n  const getEditor = () => editor || (editor = area.parentScope<NodeEditor<Schemes>>(NodeEditor))\n\n  let twitch: null | number = 0\n\n  function selectNode(node: Schemes['Node']) {\n    if (!node.selected) {\n      node.selected = true\n      area.update('node', node.id)\n    }\n  }\n\n  function unselectNode(node: Schemes['Node']) {\n    if (node.selected) {\n      node.selected = false\n      area.update('node', node.id)\n    }\n  }\n  /**\n   * Select node programmatically\n   * @param nodeId Node id\n   * @param accumulate Whether to accumulate nodes on selection\n   */\n  function add(nodeId: NodeId, accumulate: boolean) {\n    const node = getEditor().getNode(nodeId)\n\n    if (!node) return\n\n    core.add({\n      label: 'node',\n      id: node.id,\n      translate(dx, dy) {\n        const view = area.nodeViews.get(node.id)\n        const current = view?.position\n\n        if (current) {\n          view.translate(current.x + dx, current.y + dy)\n        }\n      },\n      unselect() {\n        unselectNode(node)\n      }\n    }, accumulate)\n    selectNode(node)\n  }\n  /**\n   * Unselect node programmatically\n   * @param nodeId Node id\n   */\n  function remove(nodeId: NodeId) {\n    core.remove({ id: nodeId, label: 'node' })\n  }\n\n  // eslint-disable-next-line max-statements, complexity\n  area.addPipe(context => {\n    if (!context || typeof context !== 'object' || !('type' in context)) return context\n\n    if (context.type === 'nodepicked') {\n      const pickedId = context.data.id\n      const accumulate = options.accumulating.active()\n\n      core.pick({ id: pickedId, label: 'node' })\n      twitch = null\n      add(pickedId, accumulate)\n    } else if (context.type === 'nodetranslated') {\n      const { id, position, previous } = context.data\n      const dx = position.x - previous.x\n      const dy = position.y - previous.y\n\n      if (core.isPicked({ id, label: 'node' })) core.translate(dx, dy)\n    } else if (context.type === 'pointerdown') {\n      twitch = 0\n    } else if (context.type === 'pointermove') {\n      if (twitch !== null) twitch++\n    } else if (context.type === 'pointerup') {\n      if (twitch !== null && twitch < 4) {\n        core.unselectAll()\n      }\n      twitch = null\n    }\n    return context\n  })\n\n  return {\n    select: add,\n    unselect: remove\n  }\n}\n\n","import { BaseSchemes, ClassicPreset as Classic, GetSchemes, NodeEditor } from 'rete'\n\nimport { BaseAreaPlugin } from '../base'\n\ntype Scheme = GetSchemes<Classic.Node, Classic.Connection<Classic.Node, Classic.Node>>\ntype Visible<S extends Scheme> = (props: { hasAnyConnection: boolean, input: NonNullable<S['Node']['inputs'][string]> }) => boolean\n\n/**\n * Show input control extension. It will show the input's control when there is no connection and hide it when there is a connection.\n * @param area The base area plugin\n * @param visible The visible function\n * @listens connectioncreated\n * @listens connectionremoved\n */\nexport function showInputControl<S extends Scheme>(area: BaseAreaPlugin<BaseSchemes, any>, visible?: Visible<S>) {\n  let editor: null | NodeEditor<S> = null\n  const getEditor = () => editor || (editor = area.parentScope<NodeEditor<S>>(NodeEditor))\n\n  function updateInputControlVisibility(target: string, targetInput: string) {\n    const node = getEditor().getNode(target)\n\n    if (!node) return\n\n    const input = (node.inputs as Record<string, S['Node']['inputs'][string] | undefined>)[targetInput]\n\n    if (!input) throw new Error('cannot find input')\n\n    const previous = input.showControl\n    const connections = getEditor().getConnections()\n    const hasAnyConnection = Boolean(connections.find(connection => {\n      return connection.target === target && connection.targetInput === targetInput\n    }))\n\n    input.showControl = visible ? visible({ hasAnyConnection, input }) : !hasAnyConnection\n\n    if (input.showControl !== previous) {\n      area.update('node', node.id)\n    }\n  }\n\n  area.addPipe(context => {\n    if (context.type === 'connectioncreated' || context.type === 'connectionremoved') {\n      updateInputControlVisibility(context.data.target, context.data.targetInput)\n    }\n    return context\n  })\n}\n","import { BaseSchemes } from 'rete'\n\nimport { BaseArea, BaseAreaPlugin } from '../base'\n\n/**\n * Snap grid extension parameters\n */\nexport type Params = {\n  /** The grid size */\n  size?: number\n  /** Whether to snap on node drag */\n  dynamic?: boolean\n}\n\n/**\n * Snap grid extension\n * @param base The base area plugin\n * @param params The snap parameters\n * @listens nodetranslate\n * @listens nodedragged\n */\nexport function snapGrid<Schemes extends BaseSchemes, K>(base: BaseAreaPlugin<Schemes, K>, params?: Params) {\n  const area = base as BaseAreaPlugin<Schemes, BaseArea<Schemes>>\n  const size = typeof params?.size === 'undefined' ? 16 : params.size\n  const dynamic = typeof params?.dynamic === 'undefined' ? true : params.dynamic\n\n  function snap(value: number) {\n    return Math.round(value / size) * size\n  }\n\n  area.addPipe(context => {\n    if (!context || typeof context !== 'object' || !('type' in context)) return context\n    if (dynamic && context.type === 'nodetranslate') {\n      const { position } = context.data\n      const x = snap(position.x)\n      const y = snap(position.y)\n\n      return {\n        ...context,\n        data: {\n          ...context.data,\n          position: { x, y }\n        }\n      }\n    }\n    if (!dynamic && context.type === 'nodedragged') {\n      const view = area.nodeViews.get(context.data.id)\n\n      if (view) {\n        const { x, y } = view.position\n\n        view.translate(snap(x), snap(y))\n      }\n    }\n    return context\n  })\n}\n","import { NodeEditor } from 'rete'\n\nimport { AreaPlugin } from '..'\nimport { getBoundingBox } from '../utils'\nimport { NodeRef, SchemesWithSizes } from './shared/types'\nimport { getNodesRect } from './shared/utils'\n\n/**\n * Zoom extension parameters\n */\nexport type Params = {\n  /** Set gap between nodes and the viewport border */\n  scale?: number\n}\n\n/**\n * Zooms the area to fit the given nodes\n * @param plugin The area plugin\n * @param nodes The nodes to fit\n * @param params The zoom parameters\n */\n// eslint-disable-next-line max-statements, max-len\nexport async function zoomAt<Schemes extends SchemesWithSizes, K>(plugin: AreaPlugin<Schemes, K>, nodes: NodeRef<Schemes>[], params?: Params) {\n  const { scale = 0.9 } = params || {}\n  const editor = plugin.parentScope<NodeEditor<Schemes>>(NodeEditor)\n  const list = nodes.map(node => typeof node === 'object' ? node : editor.getNode(node))\n  const rects = getNodesRect(list, plugin.nodeViews)\n  const boundingBox = getBoundingBox(rects)\n  const [w, h] = [plugin.container.clientWidth, plugin.container.clientHeight]\n  const [kw, kh] = [w / boundingBox.width, h / boundingBox.height]\n  const k = Math.min(kh * scale, kw * scale, 1)\n\n  plugin.area.transform.x = w / 2 - boundingBox.center.x * k\n  plugin.area.transform.y = h / 2 - boundingBox.center.y * k\n  await plugin.area.zoom(k, 0, 0)\n}\n","/**\n * Area extensions\n * @priority 7\n * @module Extensions\n */\nexport { getBoundingBox } from './bounding-box'\nexport { simpleNodesOrder } from './order'\nexport type { Params as Restrictor } from './restrictor'\nexport { restrictor } from './restrictor'\nexport { accumulateOnCtrl, selectableNodes, Selector, selector } from './selectable'\nexport { showInputControl } from './show-input-control'\nexport type { Params as SnapGrid } from './snap'\nexport { snapGrid } from './snap'\nexport type { Params as ZoomAt } from './zoom-at'\nexport { zoomAt } from './zoom-at'\n","import { BaseSchemes, ConnectionId, NodeId, Root } from 'rete'\n\nimport { Area, TranslateEventParams, ZoomEventParams } from './area'\nimport { BaseArea, BaseAreaPlugin } from './base'\nimport { ConnectionView } from './connection-view'\nimport { ElementsHolder } from './elements-holder'\nimport { NodeView } from './node-view'\nimport { GetRenderTypes, Position, RenderMeta } from './types'\n\nexport { Area } from './area'\nexport type { BaseArea } from './base'\nexport { BaseAreaPlugin } from './base'\nexport { Drag } from './drag'\nexport * as AreaExtensions from './extensions'\nexport { NodeView } from './node-view'\nexport type { RenderSignal } from './types'\nexport type { PointerListener } from './utils'\nexport { usePointerListener } from './utils'\nexport { Zoom } from './zoom'\n\n/**\n * A union of all possible signals that can be emitted by the area\n * @priority 9\n */\nexport type Area2D<Schemes extends BaseSchemes> =\n  | BaseArea<Schemes>\n  | { type: 'translate', data: TranslateEventParams }\n  | { type: 'translated', data: TranslateEventParams }\n  | { type: 'zoom', data: ZoomEventParams }\n  | { type: 'zoomed', data: ZoomEventParams }\n  | { type: 'resized', data: { event: Event } }\n\nexport type Area2DInherited<Schemes extends BaseSchemes, ExtraSignals = never> = [Area2D<Schemes> | ExtraSignals, Root<Schemes>]\n\n/**\n * A plugin that provides a 2D area for nodes and connections\n * @priority 8\n * @emits render\n * @emits rendered\n * @emits unmount\n * @listens nodecreated\n * @listens noderemoved\n * @listens connectioncreated\n * @listens connectionremoved\n */\nexport class AreaPlugin<Schemes extends BaseSchemes, ExtraSignals = never> extends BaseAreaPlugin<Schemes, Area2D<Schemes> | ExtraSignals> {\n  public nodeViews = new Map<NodeId, NodeView>()\n  public connectionViews = new Map<ConnectionId, ConnectionView>()\n  public area: Area\n  private elements = new ElementsHolder<HTMLElement, Extract<Area2D<Schemes>, { type: 'render' }>['data'] & RenderMeta>()\n\n  constructor(public container: HTMLElement) {\n    super('area')\n    container.style.overflow = 'hidden'\n    container.addEventListener('contextmenu', this.onContextMenu)\n\n    // eslint-disable-next-line max-statements\n    this.addPipe(context => {\n      if (!context || !(typeof context === 'object' && 'type' in context)) return context\n      if (context.type === 'nodecreated') {\n        this.addNodeView(context.data)\n      }\n      if (context.type === 'noderemoved') {\n        this.removeNodeView(context.data.id)\n      }\n      if (context.type === 'connectioncreated') {\n        this.addConnectionView(context.data)\n      }\n      if (context.type === 'connectionremoved') {\n        this.removeConnectionView(context.data.id)\n      }\n      if (context.type === 'render') {\n        this.elements.set(context.data)\n      }\n      if (context.type === 'unmount') {\n        this.elements.delete(context.data.element)\n      }\n      return context\n    })\n    this.area = new Area(\n      container,\n      {\n        zoomed: params => this.emit({ type: 'zoomed', data: params }),\n        pointerDown: (position, event) => this.emit({ type: 'pointerdown', data: { position, event } }),\n        pointerMove: (position, event) => this.emit({ type: 'pointermove', data: { position, event } }),\n        pointerUp: (position, event) => this.emit({ type: 'pointerup', data: { position, event } }),\n        resize: event => this.emit({ type: 'resized', data: { event } }),\n        translated: params => this.emit({ type: 'translated', data: params }),\n        reordered: element => this.emit({ type: 'reordered', data: { element } })\n      },\n      {\n        translate: params => this.emit({ type: 'translate', data: params }),\n        zoom: params => this.emit({ type: 'zoom', data: params })\n      }\n    )\n  }\n\n  private onContextMenu = (event: MouseEvent) => {\n    this.emit({ type: 'contextmenu', data: { event, context: 'root' } })\n  }\n\n  public addNodeView(node: Schemes['Node']) {\n    const { id } = node\n    const view = new NodeView(\n      () => this.area.transform.k,\n      {\n        picked: () => this.emit({ type: 'nodepicked', data: { id } }),\n        translated: data => this.emit({ type: 'nodetranslated', data: { id, ...data } }),\n        dragged: () => this.emit({ type: 'nodedragged', data: node }),\n        contextmenu: event => this.emit({ type: 'contextmenu', data: { event, context: node } }),\n        resized: ({ size }) => this.emit({ type: 'noderesized', data: { id: node.id, size } })\n      },\n      {\n        translate: data => this.emit({ type: 'nodetranslate', data: { id, ...data } }),\n        resize: ({ size }) => this.emit({ type: 'noderesize', data: { id: node.id, size } })\n      }\n    )\n\n    this.nodeViews.set(id, view)\n    this.area.content.add(view.element)\n\n    this.emit({\n      type: 'render',\n      data: { element: view.element, type: 'node', payload: node }\n    })\n\n    return view\n  }\n\n  public removeNodeView(id: NodeId) {\n    const view = this.nodeViews.get(id)\n\n    if (view) {\n      this.emit({ type: 'unmount', data: { element: view.element } })\n      this.nodeViews.delete(id)\n      this.area.content.remove(view.element)\n    }\n  }\n\n  public addConnectionView(connection: Schemes['Connection']) {\n    const view = new ConnectionView({\n      contextmenu: event => this.emit({ type: 'contextmenu', data: { event, context: connection } })\n    })\n\n    this.connectionViews.set(connection.id, view)\n    this.area.content.add(view.element)\n\n    this.emit({\n      type: 'render',\n      data: { element: view.element, type: 'connection', payload: connection }\n    })\n\n    return view\n  }\n\n  public removeConnectionView(id: ConnectionId) {\n    const view = this.connectionViews.get(id)\n\n    if (view) {\n      this.emit({ type: 'unmount', data: { element: view.element } })\n      this.connectionViews.delete(id)\n      this.area.content.remove(view.element)\n    }\n  }\n\n  /**\n   * Force update rendered element by id (node, connection, etc.)\n   * @param type Element type\n   * @param id Element id\n   * @emits render\n   */\n  public async update(type: GetRenderTypes<Area2D<Schemes>> | GetRenderTypes<ExtraSignals>, id: string) {\n    const data = this.elements.get(type, id)\n\n    if (data) await this.emit({ type: 'render', data } as Area2D<Schemes>)\n  }\n\n  /**\n   * Resize node\n   * @param id Node id\n   * @param width Desired width\n   * @param height Desired height\n   */\n  public async resize(id: NodeId, width: number, height: number) {\n    const view = this.nodeViews.get(id)\n\n    if (view) return await view.resize(width, height)\n  }\n\n  /**\n   * Translate node to position\n   * @param id Node id\n   * @param position Position\n   */\n  public async translate(id: NodeId, { x, y }: Position) {\n    const view = this.nodeViews.get(id)\n\n    if (view) return await view.translate(x, y)\n  }\n\n  /**\n   * Destroy all views and remove all event listeners\n   */\n  public destroy() {\n    this.container.removeEventListener('contextmenu', this.onContextMenu)\n    Array.from(this.connectionViews.keys()).forEach(id => this.removeConnectionView(id))\n    Array.from(this.nodeViews.keys()).forEach(id => this.removeNodeView(id))\n    this.area.destroy()\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}